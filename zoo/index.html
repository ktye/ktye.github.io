<!doctype html><html><head><meta charset=utf-8><title>zoo</title>
<link rel="icon" type="image/png" sizes="16x16" href="../kelas16.png">
<style>
*{/*box-sizing:border-box;overflow:clip;*/font-family:monospace}
html{height:100vh}
body{display:flex;justify-content:center;align-items:center;background:#dec}
#tty{border:0px solid white;width:80ch;height:22rem;line-height:1.1rem;background:black;color:#ccc;display:inline-block}
#tty:focus-within{color:white}
#rdl{color:white;outline:none}

</style></head><body>

<pre id="tty"><span id="out" tabindex="-1">$</span><span id="rdl" contenteditable="plaintext-only" spellcheck=false tabindex="0"></span><span id="prm"></span></pre>

<script>

//tty
let pd=e=>(e.preventDefault(),e.stopPropagation()) 
let shpr="$",rlbuf=[],rlpos=0
let rladd=x=>{rlpos=rlbuf.length;if(rlbuf.length&&rlbuf[rlbuf.length]==x)return x;rlbuf.push(x);rlpos++;return x}
let rlprev=x=>{let n=rlbuf.length;  if(rlpos>0)rlpos--;rdl.textContent=(n?rlbuf[rlpos]:"");rlend()}
let rlnext=x=>{let n=rlbuf.length;  if(rlpos<n)rlpos++;rdl.textContent=(n?rlbuf[rlpos]:"");rlend()}
let rlend=_=>{let r=document.createRange(),s=window.getSelection();r.selectNodeContents(rdl);r.collapse(false);s.removeAllRanges();s.addRange(r);rdl.focus()}
let prmt=x=>{prm.textContent=x?"â–ˆ":"";rdl.hidden=!x;if(x)rdl.focus()}
tty.onclick=_=>rdl.focus()
rdl.onkeydown=(e,k,c)=>(k=e.key,c=e.ctrlKey,"Enter"==k?(pd(e),exec(rladd(rdl.textContent))):"ArrowUp"==k?(pd(e),rlprev(rdl.textContent)):"ArrowDown"==k?(pd(e),rlnext(rdl.textContent)):("c"==k&&c)?(pd(e),O("\n"),$="$",_=sh,term()):"Escape"==k?(pd(e),rdl.textContent=""):"Tab"==k?pd(e):0)

let sh=async x=>{x=x.trim(),"pwd"==x?On("/"):"cd"==x?0:"ls"==x?On(ls()):"clear"==x?out.textContent="":x.startsWith("he")||la.map(x=>x+" ").some(y=>y==x.slice(0,y.length))?await help(x):la.includes(x)?await run(x):O(x+": command not found\n")}
let $="$",_=sh,O=x=>out.textContent+=x,On=x=>O(x+"\n")
let term=v=>{v=out.textContent.split("\n"),v=(20<v.length?v.slice(v.length-20):v).map(x=>x.slice(0,80)).join("\n");
 v+=$/*v.endsWith("\n")?$:$+"\n"*/;out.textContent=v;rdl.textContent="";prmt(1)}

let exec=async x=>{rdl.textContent="";On(x);await _(x);term()}
let run=async x=>{x=await(await fetch("z/"+x)).text();[$,_]=await eval?.(x)(O);}

let la="apl j j0 k k2".split(" ")
let ls=_=>la.map((x,i,a)=>"\n "[+(i&&x[0]==a[i-1][0])]+x).join("").trim()+"\nhelp apl.."

let he={apl:"../apl.k",j:"../../j/j42/ref.txt",j0:"../../j/j00/j.c",k:"../../klib/ref",k2:"../../k2/doc/verbs"}
let hel=async x=>O((await(await fetch(x)).text()).split("\n").slice(0,19).join("\n")+"\n")
let help=async x=>(x=x.split(" "),he[x[0]]?hel(he[x[0]]):he[x[1]]?hel(he[x[1]]):O("no "+x.join(" ")+"\n"))

window.onerror=e=>On;window.onunhandledrejection=e=>On(e.reason)
prmt(1)
</script></body></html>



