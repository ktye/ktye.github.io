<!DOCTYPE html>
<head><meta charset="utf-8"><title>86</title>
<style>
</style>
</head>
<body>
<pre id="dir"></pre>
<script>

// grep import blinkenlib.wat|grep import|awk '{print $2,$3,$7}'|sort|awk '{print $2":ft"$3"("$2"),"}'|sed 's/)))//' > out

let B,U8,U32,fs=[]
let msl=_=>{U8=new Uint8Array(B.memory.buffer);U32=new Uint32Array(B.memory.buffer)}
let su=x=>t_.decode(x),t_=new TextDecoder("utf-8"),us=x=>_t.encode(x),_t=new TextEncoder("utf-8")

let ft0 =(f,x,y            )=>(x,y          )=>(console.log(f,x,y          ),0 )
let ft3 =(f,x              )=>(x            )=>(console.log(f,x            ),0 )
let ft4 =(f,x              )=>(x            )=>(console.log(f,x            ),0 )
let ft6 =(                 )=>(             )=>(console.log(f              ),0 )
let ft7 =(f,x,y,z          )=>(x,y,z        )=>(console.log(f,x,y,z        ),0 )
let ft8 =(f,x,y            )=>(x,y          )=>(console.log(f,x,y          ),0 )
let ft9 =(f,x,Y,z          )=>(x,Y,z        )=>(console.log(f,x,Y,z        ),0 )
let ft10=(f,x,y,z          )=>(x,y,z        )=>(console.log(f,x,y,z        ),0 )
let ft13=(f,x,y            )=>(x,y          )=>(console.log(f,x,y          ),0n)
let ft14=(f,x,y,Z          )=>(x,y,Z        )=>(console.log(f,x,y,Z        ),0 )
let ft15=(f                )=>(             )=>(console.log(f              ),0n)
let ft16=(f,x,y,z,a        )=>(x,y,z,a      )=>(console.log(f,x,y,z,a      ),0 )
let ft17=(f,x,y,z,a,b      )=>(x,y,z,a,b    )=>(console.log(f,x,y,z,a,b    ),0 )
let ft18=(f,x,Y            )=>(x,Y          )=>(console.log(f,x,Y          ),0 )
let ft19=(f,x,Y,z,a        )=>(x,Y,z,a      )=>(console.log(f,x,Y,z,a      ),0 )
let ft20=(f,x,y,z,a        )=>(X,x,y,z,a    )=>(console.log(f,x,y,z,a      ),0 )
let ft21=(f,X,y            )=>(X,y          )=>(console.log(f,X,y          ),0 )
let ft22=(f,x,y,z,a,b,c    )=>(x,y,z,a,b,c  )=>(console.log(f,x,y,z,a,b,c  ),0 )
let ft23=(f,x,y,z,a,B,c,d  )=>(x,y,z,a,B,c,d)=>(console.log(f,x,y,z,a,B,c,d),0 )
let ft24=(f,x,y,z,a,B      )=>(x,y,z,a,B    )=>(console.log(f,x,y,z,a,B    ),0 )
let ft25=(f,x,yf           )=>(x,yf         )=>(console.log(f,x,yf         ),0 )
let ft26=(f                )=>(             )=>(console.log(f              ),0 )
let env={
 env:{
  "__call_sighandler":ft0("__call_sighandler"),
  "__syscall_chdir":ft3("__syscall_chdir"),
  "__syscall_chmod":ft8("__syscall_chmod"),
  "__syscall_dup":ft3("__syscall_dup"),
  "__syscall_dup3":ft7("__syscall_dup3"),
  "__syscall_faccessat":ft16("__syscall_faccessat"),
  "__syscall_fchdir":ft3("__syscall_fchdir"),
  "__syscall_fchmod":ft8("__syscall_fchmod"),
  "__syscall_fchmodat2":ft16("__syscall_fchmodat2"),
  "__syscall_fchown32":ft7("__syscall_fchown32"),
  "__syscall_fchownat":ft17("__syscall_fchownat"),
  "__syscall_fcntl64":ft7("__syscall_fcntl64"),
  "__syscall_fdatasync":ft3("__syscall_fdatasync"),
  "__syscall_fstat64":ft8("__syscall_fstat64"),
  "__syscall_fstatfs64":ft7("__syscall_fstatfs64"),
  "__syscall_ftruncate64":ft18("__syscall_ftruncate64"),
  "__syscall_getcwd":ft8("__syscall_getcwd"),
  "__syscall_getdents64":ft7("__syscall_getdents64"),
  "__syscall_ioctl":ft7("__syscall_ioctl"),
  "__syscall_lstat64":ft8("__syscall_lstat64"),
  "__syscall_mkdirat":ft7("__syscall_mkdirat"),
  "__syscall_newfstatat":ft16("__syscall_newfstatat"),
  "__syscall_openat":ft16("__syscall_openat"),
  "__syscall_pipe":ft3("__syscall_pipe"),
  "__syscall_poll":ft7("__syscall_poll"),
  "__syscall_readlinkat":ft16("__syscall_readlinkat"),
  "__syscall_renameat":ft16("__syscall_renameat"),
  "__syscall_stat64":ft8("__syscall_stat64"),
  "__syscall_statfs64":ft7("__syscall_statfs64"),
  "__syscall_symlinkat":ft7("__syscall_symlinkat"),
  "__syscall_unlinkat":ft7("__syscall_unlinkat"),
  "__syscall_utimensat":ft16("__syscall_utimensat"),
  "_abort_js":ft6("_abort_js"),
  "_emscripten_runtime_keepalive_clear":ft6("_emscripten_runtime_keepalive_clear"),
  "_emscripten_throw_longjmp":ft6("_emscripten_throw_longjmp"),
  "_localtime_js":ft21("_localtime_js"),
  "_mmap_js":ft23("_mmap_js"),
  "_msync_js":ft22("_msync_js"),
  "_munmap_js":ft22("_munmap_js"),
  "_setitimer_js":ft25("_setitimer_js"),
  "_tzset_js":ft20("_tzset_js"),
  "emscripten_date_now":ft15("emscripten_date_now"),
  "emscripten_err":ft4("emscripten_err"),
  "emscripten_get_heap_max":ft26("emscripten_get_heap_max"),
  "emscripten_get_now":ft15("emscripten_get_now"),
  "emscripten_resize_heap":ft3("emscripten_resize_heap"),
  "emscripten_sleep":ft4("emscripten_sleep"),
  "exit":ft4("exit"),
  "invoke_ji":ft13("invoke_ji"),
  "invoke_vi":ft0("invoke_vi"),
  "invoke_vii":ft10("invoke_vii"),
  "invoke_vij":ft14("invoke_vij"),
 },
 wasi_snapshot_preview1:{
  "clock_res_get":ft8("clock_res_get"),
  "clock_time_get":ft9("clock_time_get"),
  "environ_get":ft8("environ_get"),
  "environ_sizes_get":(x,y)=>{U32[((x)>>2)]=0;U32[((y)>>2)]=0}, //ft8("environ_sizes_get"),
  "fd_close":ft3("fd_close"),
  "fd_fdstat_get":ft8("fd_fdstat_get"),
  "fd_pread":ft24("fd_pread"),
  "fd_pwrite":ft24("fd_pwrite"),
  "fd_read":ft16("fd_read"),
  "fd_seek":ft19("fd_seek"),
  "fd_sync":ft3("fd_sync"),
  "fd_write":(fd,io,nio,rp)=>{console.log("fd_write",fd,io,nio,rp);let buf=U32[io>>2],n=U32[1+(io>>2)];
    console.log(su(U8.slice(buf,buf+n)))
    U32[rp>>2]=n;
    return 2;
  },
  "proc_exit":ft4("proc_exit"),
 },
}
let blink=args=>{
 WebAssembly.instantiateStreaming(fetch("blinkenlib.wasm"),env).then(r=>{B=r.instance.exports
  console.log(r.instance.exports)
  msl()
  B.__wasm_call_ctors()
  main(args)
 })}
let stkstr=s=>{let u=us(s),n=1+u.length,r=B._emscripten_stack_alloc(n);u.forEach((x,i)=>U8[r+i]=x);U8[r+n]=0;return r}
let main=args=>{args.unshift("blink");let a=B._emscripten_stack_alloc(4*(1+args.length));args.forEach(s=>{U32[a>>2]=stkstr(s);a+=4});U32[a>>2]=0;B.__main_argc_argv(args.length,a)}

let ls=_=>{let s="";fs.forEach(f=>s+=f.name.padEnd(10," ")+f.u.length+"\n");dir.textContent=s}
let fsadd=(name,u)=>{fs.push({name:name,u:u});ls()}
fetch("fasm.elf").then(r=>r.arrayBuffer()).then(u=>{fsadd("fasm",new Uint8Array(u));blink(["program","fasm"])})


</script>

</body></html>
