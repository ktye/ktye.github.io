<!doctype html>
<html><head><meta charset=utf-8><title>86</title>
<link rel="icon" type="image/png" sizes="16x16" href="../kelas16.png">
<style>
*{box-sizing:border-box;/*overflow:clip;*/font-family:monospace}
html{height:100vh}
body{}
button{padding:0}
#tty{width:80ch;height:22rem;line-height:1.1rem;background:black;color:#ccc;margin:0;display:inline-block}
#tty:focus-within{color:white}
#rdl{color:white;outline:none}
#editor{background:#ffe;outline:none;margin:0;border:1px solid black;width:80ch;height:22rem;overflow:scroll;resize:none}
#disa:focus{border-bottom:1px solid;outline:none}
#regs:focus{border-bottom:1px solid;outline:none}
#heap:focus{border-bottom:1px solid;outline:none}
.b{background:#444;color:white}
.p{border:1px solid}
.p:hover{cursor:pointer}
.l{color:blue}
.l:hover{cursor:pointer}
.w{color:#ccc}
</style></head><body>

<div style="display:flex;width:100%;justify-content:space-between" class="w">
<pre style="margin:0" id="regs">
 rax rsp  r8 r12  rcx rbp  r9 r13  rdx rsi  r10 r14 rbx rdi  r11 r15
 <span id="reg0" >0000000000000000</span> <span id="reg1" >0000000000000000</span> <span id="reg2" >0000000000000000</span> <span id="reg3" >0000000000000000</span>
┌<span id="reg4" >0000000000000000</span> <span id="reg5" >0000000000000000</span> <span id="reg6" >0000000000000000</span> <span id="reg7" >0000000000000000</span>
│<span id="reg8" >0000000000000000</span> <span id="reg9" >0000000000000000</span> <span id="reg10">0000000000000000</span> <span id="reg11">0000000000000000</span>
│<span id="reg12">0000000000000000</span> <span id="reg13">0000000000000000</span> <span id="reg14">0000000000000000</span> <span id="reg15">0000000000000000</span></pre>
 <pre style="margin:0">
xmm0  4   8   12 1    5    9   13 2    6   10   14 3    7   11   15
<span id="reg16">0000000000000000</span> <span id="reg17">0000000000000000</span> <span id="reg18">0000000000000000</span> <span id="reg19">0000000000000000</span>
<span id="reg20">0000000000000000</span> <span id="reg21">0000000000000000</span> <span id="reg22">0000000000000000</span> <span id="reg23">0000000000000000</span>
<span id="reg24">0000000000000000</span> <span id="reg25">0000000000000000</span> <span id="reg26">0000000000000000</span> <span id="reg27">0000000000000000</span>
<span id="reg28">0000000000000000</span> <span id="reg29">0000000000000000</span> <span id="reg30">0000000000000000</span> <span id="reg31">0000000000000000</span></pre>
</div>
<div style="display:flex;justify-content:space-between"><pre id="stac" data-i="0" data-n="16" style="margin:0;display:inline-block" class="w">
│rip              brk  flg <span id="flags"></span>
│<span id="reg32">0000000000000000</span> <span id="brk">0000000000000000</span>
│stack
<span id="stk0"> 0000000000000000 0000000000000000</span> 
<span id="stk1"> 0000000000000000 0000000000000000</span> 
<span id="stk2"> 0000000000000000 0000000000000000</span> 
<span id="stk3"> 0000000000000000 0000000000000000</span>
<span id="stk4"> 0000000000000000 0000000000000000</span>
<span id="stk5"> 0000000000000000 0000000000000000</span>
<span id="stk6"> 0000000000000000 0000000000000000</span>
<span id="stk7"> 0000000000000000 0000000000000000</span>
<span id="stk8"> 0000000000000000 0000000000000000</span>
<span id="stk9"> 0000000000000000 0000000000000000</span>
<span id="stk10"> 0000000000000000 0000000000000000</span>
<span id="stk11"> 0000000000000000 0000000000000000</span>
<span id="stk12"> 0000000000000000 0000000000000000</span>
<span id="stk13"> 0000000000000000 0000000000000000</span>
<span id="stk14"> 0000000000000000 0000000000000000</span>
<span id="stk15"> 0000000000000000 0000000000000000</span>
</pre>
<pre id="tty"><span id="out" tabindex="-1">linux/x86-64 [read write open close lseek brk exit] 1core 1proc 2g</span><span id="rdl" contenteditable="plaintext-only" spellcheck=false tabindex="0"></span><span id="prm"></span></pre>
<div style="display:flex;flex-wrap:wrap;gap:1em"><textarea id="editor" rows="20" cols="80" hidden></textarea></div>
<div style="display:flex;flex-flow:column;justify-content:space-between">
 <pre id="disk" style="margin:0;margin-left:1em">$ls</pre>
 <div id="kdbut" ><input id="deb" name="deb" type="checkbox" checked/><label for="deb">debug</label></div>
 <div id="edbut" hidden>
  <button onclick="edshow(0)">close</button>
  <button onclick="edwrite()" id="edbutw">write</button>
  <button onclick="download()">download</button>
  <span id="filename">filename</span>
  <a id="dl" hidden></a>
 </div>
</div>
</div>

<div style="display:flex;justify-content:space-between;align-items:flex-end" class="w">
 <pre id="disa" tabindex="-1" data-i="0" data-n="16" style="margin:0">disa</pre>
 <pre style="margin:0">
<span id="cal15"></span>
<span id="cal14"></span>
<span id="cal13"></span>
<span id="cal12"></span>
<span id="cal11"></span>
<span id="cal10"></span>
<span id="cal9"></span>
<span id="cal8"></span>
<span id="cal7"></span>
<span id="cal6"></span>
<span id="cal5"></span>
<span id="cal4"></span>
<span id="cal3"></span>
<span id="cal2"></span>
<span id="cal1"></span>
<span id="cal0">entry</span>
</pre>
 <pre id="heap" tabindex="-1" data-i="0" data-n="16" style="margin:0">00000000 0000000000000000 0000000000000000 ........ ........
</div>

<div style="display:flex;justify-content:space-between;width:100%" class="w">
 <span class="p" onclick="pager.move(1)"><span class="b">&nbsp;↑↓&nbsp;</span> sroll&nbsp;</span>
 <span class="p" onclick="stepover()"><span class="b">&nbsp;s&nbsp;</span> step over&nbsp;</span>
 <span class="p" onclick="traceinto()"><span class="b">&nbsp;→&nbsp;</span> trace into&nbsp;</span>
 <span class="p" onclick="gotoret()"><span class="b">&nbsp;←&nbsp;</span> run to ret&nbsp;</span>
 <span class="p" onclick="runto(parseInt(debstr.value,16))"><span class="b">&nbsp;↵&nbsp;</span> run to break&nbsp;</span>
 <input class="p" id="debstr" value="40021c"/>
 <span class="p" onclick="pager.find(parseInt(debstr.value,16))"><span class="b">&nbsp;/&nbsp;</span> find&nbsp;</span>
</div>

<script>
var asm
let af=x=>Array.from(x),pd=e=>{e.preventDefault();e.stopPropagation()},ce=x=>document.createElement(x),ge=x=>document.getElementById(x),tc=(t,x)=>(x.textContent=t,x)
let rM=p=>{while(p.firstChild)p.removeChild(p.firstChild);return p}
let su=x=>t_.decode(x),t_=new TextDecoder("utf-8"),us=x=>_t.encode(x),_t=new TextEncoder("utf-8"),xs=s=>parseInt(s,16)
let min=Math.min,max=Math.max
</script>
<script src="k.js"></script>
<script src="fs.js"></script>
<script src="ed.js"></script>
<script src="86.js"></script>
<script src="sh.js"></script>
<script>sh()</script>
<script>

let kdb=x=>{let s=document.styleSheets[0],r=s.rules;for(let i=0;i<r.length;i++)if(r[i].selectorText==".w"){r[i].style.color=x?"black":"#ccc";return}}

fe("fasm.elf","fasm")
fe("readme","readme")
fe("x.as","x.as");
fe("x.cpulog","x.cpulog")
rdl.textContent="fasm"
//fetch("fasm.elf").then(r=>r.arrayBuffer()).then(r=>{fsadd("fasm",new Uint8Array(r)); execv(["fasm"]); disa.focus()} )
 
let pager=disa;disa.onfocus=_=>pager=disa;regs.onfocus=_=>pager=regs;heap.onfocus=_=>pager=heap;
let keydown=p=>(e,k)=>(k=e.key,pd(e),"Home"==k?p.move(-Infinity):"End"==k?p.move(Infinity):"ArrowUp"==k?p.move(-1):"ArrowDown"==k?p.move(1):"PageUp"==k?p.move(-+p.dataset.n):"PageDown"==k?p.move(+p.dataset.n):"ArrowLeft"==k?gotoret():"ArrowRight"==k?traceinto():"s"==k?stepover():"Enter"==k?runto(parseInt(debstr.value,16)):"/"==k?p.find(parseInt(debstr.value,16)):0)
disa.onkeydown=keydown(disa);disa.move=d=>{let p=disa,i=+p.dataset.i,n=+p.dataset.n,N=asm.length,j=i+d,pc=reg32.textContent.slice(8,16);rM(p);i=min(max(0,j),N-n),j=i+n;p.dataset.i=i;while(i<j){ p.appendChild( tc(asm[i++]+"\n",ce("span")));if(asm[i].startsWith(pc))bold(p.lastChild) } ;}
stac.onkeydown=keydown(regs);regs.move=d=>{let i=+stac.dataset.i,n=+datc.dataset.n,j=i+d;i=min(max(0,j),1024);rsp=BigInt("0x"+reg4.textContent);showstack(i,rsp);stac.dataset.i=i;}
heap.onkeydown=keydown(heap);heap.move=d=>{let i=xs(heap.textContent.slice(0,8)),j=i+16*d;i=min(max(0,j),xs(brk.textContent)-16*32);showheap(i);}

disa.ondblclick=e=>{let s=e.target.textContent,x,pc=xs(e.target.nextSibling.textContent.slice(0,8)),sel=document.getSelection().toString();x=xs(sel);isNaN(x)?0:show(x+(s.indexOf("rip+"+sel)<0?0:pc))}
regs.ondblclick=s=>(s=xs(document.getSelection().toString()),isNaN(s)?0:show(s))
stac.ondblclick=s=>(s=xs(document.getSelection().toString()),isNaN(s)?0:show(s))
for(let i=0;i<16;i++)ge("cal"+i).ondblclick=s=>(s=xs(document.getSelection().toString()),isNaN(s)?0:show(s))
let show=x=>{let a=xs(asm[0]),e=xs(asm[asm.length-1].slice(0,8)),s=h4(x);debstr.value=s;if(x>=a&&x<e){let i=asm.findIndex(x=>x.startsWith(s));if(i>=0){disa.dataset.i=i;disa.move(0)}}else{console.log("showheap",x,x>>4<<4);showheap(x>>4<<4)}}

disa.find=x=>{let s=h4(x),i=asm.findIndex(x=>x.startsWith(s));if(i>=0){disa.dataset.i=i;disa.move(0)}}
heap.find=x=>showheap(x>>4<<4)

</script>
</body>





