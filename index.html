<html>
<head><meta charset="utf-8"><title>w</title></head>
<link rel='icon' type'image/png' href="k32.png">
<style>
 html,body,textarea{height:100%;margin:0;padding:0;overflow:hidden;}
 #kons{top:0;left:0;width:100%;height:100%;position:absolute;border:0pt;resize:none;font-family:monospace;overflow:auto;}
 .term{background:black;color:white}
 .hold{background:white;color:black}
 .edit{background:#ffffea;color:black}
 #cnv{width:100;height:100;top:0;right:0;position:absolute;}
 #dl{display:none;}
</style>
<body>
<textarea id="kons" class="term" wrap="off" autofocus spellcheck="false"></textarea>
<canvas id="cnv"></canvas>
<script>
var r = "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CBAKIAsQCAwCC0EBQQAQAiELIAYEQEEAIQwDQCAJIAs2AgAgBygCACEKIAogA0kEQCAJIARBBCAKbGooAgA2AgALIAlBBGohCSAHQQRqIQcgDEEBaiIMIAZJDQALCyAIEAogCxAIDAELAAwACyAAEAggARAIIAgLNAEDfyAAKAIAQR12IQEgACgCAEH/////AXEhAkEIIABqIQMgAkUEQCAADwsgACACEA0QDgtGAQN/IAAoAgBBHXYhASAAKAIAQf////8BcSECQQggAGohAyABQQdGBEBBDCAAahAJIAAQCEEMIABqEBAPCyAAQQAQAxAOC+YBAQt/IAAoAgBBHXYhAiAAKAIAQf////8BcSEDQQggAGohBCABKAIAQR12IQUgASgCAEH/////AXEhBkEIIAFqIQcgAkECRkUEQAALIANBAUYEQCABIAQoAgAQEiEIIAAQCCAIDwtBBSADEAIhCCAIQQhqIQkgAwRAQQAhDANAIAQoAgAhCiAEQQRqKAIAIQsgDCADQQFrRgRAIAYhCwsgCyAKSQRAAAsgARAJIAkgASAKIAsgCmtBARAMEA42AgAgBEEEaiEEIAlBBGohCSAMQQFqIgwgA0kNAAsLIAAQCCABEAggCAs7AQN/IAAoAgBBHXYhAiAAKAIAQf////8BcSEDQQggAGohBCABIANLBEAACyAAIAEgAyABa0EBEAwQDgvIAQELfyAAKAIAQR12IQIgACgCAEH/////AXEhA0EIIABqIQQgASgCAEEddiEFIAEoAgBB/////wFxIQZBCCABaiEHIAJBAkZFBEAACyAEIAMQFCEIIAEgCBAVIQkgA0EBRgRAIAAQCCAJDwsgA0EBayEDIARBBCADbGohCiADBEBBACEMA0AgCigCACELIAggC24hCCAEIAMgDGsQFCEIQQAgCCALEAwgCRARIQkgCkEEayEKIAxBAWoiDCADSQ0ACwsgABAIIAkLMwECf0EBIQIgAQRAQQAhAwNAIAIgACgCAGwhAiAAQQRqIQAgA0EBaiIDIAFJDQALCyACC2gBBn8gACgCAEEddiECIAAoAgBB/////wFxIQNBCCAAaiEEIAEQAxALIQUgBUEIaiEGIAMgAUkEQCABBEBBACEHA0AgBkEEIAdsaiAHIANwNgIAIAdBAWoiByABSQ0ACwsLIAAgBRAOCywBAX8gAgRAQQAhAwNAIAAgA2ogASADai0AADoAACADQQFqIgMgAkkNAAsLC24BBn8gACgCAEEddiECIAAoAgBB/////wFxIQNBCCAAaiEEIAEoAgBBHXYhBSABKAIAQf////8BcSEGQQggAWohByACRSAFRXIEQAALIAIgBUYEQCAAIAEQGA8LIAJBBUYEQCAAIAEQGQ8LACAAC60BAQh/IAAoAgBBHXYhAiAAKAIAQf////8BcSEDQQggAGohBCABKAIAQR12IQUgASgCAEH/////AXEhBkEIIAFqIQcgAkEESwRAIAAQCgsgAkEFSwRAIABBCGogAEEMahAFIQggABAIIAEQCCAIDwsgAiADIAZqEAIhCCACLQAAIQkgCEEIaiAEIAkgA2wQFiAIQQggCSADbGpqIAcgCSAGbBAWIAAQCCABEAggCAt9AQR/IAAoAgBBHXYhAiAAKAIAQf////8BcSEDQQggAGohBCACIAMQASACIANBAWoQAUkEQCACIANBAWoQAiEFIAVBCGogBEEEIANsEBYgABAIIAUhACAAQQhqIQQLIARBBCADbGogATYCACAAIANBAWpBBUEddHI2AgAgAAsMAEEFQQAQAiAAEBkLKwEDfyAAKAIAQR12IQEgACgCAEH/////AXEhAkEIIABqIQMgABAIIAIQAws7AQR/IAAoAgBBHXYhASAAKAIAQf////8BcSECQQggAGohA0ECQQEQAiEEQQggBGogATYCACAAEAggBAvAAQEJfyAAKAIAQR12IQEgACgCAEH/////AXEhAkEIIABqIQMgAUECRkUEQAALQQAhBCACBEBBACEHA0AgBCADKAIAaiEEIANBBGohAyAHQQFqIgcgAkkNAAsLQQggAGohA0ECIAQQAiEFIAVBCGohBiACBEBBACEHA0AgAygCACIIBEBBACEJA0AgBiAHNgIAIAZBBGohBiAJQQFqIgkgCEkNAAsLIANBBGohAyAHQQFqIgcgAkkNAAsLIAAQCCAFCwoAIABBABADEB8LxgMBCX8gACgCAEEddiECIAAoAgBB/////wFxIQNBCCAAaiEEIAEoAgBBHXYhBSABKAIAQf////8BcSEGQQggAWohByACIAVGRQRAAAsgA0EBRiAGQQFLcQRAIAAgBhAVIQAgBiEDIABBCGohBAsgBkEBRiADQQFLcQRAIAEgAxAVIQEgAyEGIAFBCGohBwsgAyAGRkUEQAALAkACQAJAAkACQAJAAkACQAJAAkAgAg4IAAECAwQFBgcICwwHC0ECIAMQAiEIIAhBCGohCSADBEBBACEKA0AgCSAELQAAIActAABGNgIAIAlBBGohCSAEQQFqIQQgB0EBaiEHIApBAWoiCiADSQ0ACwsMBwsMBQtBAiADEAIhCCAIQQhqIQkgAwRAQQAhCgNAIAkgBCsDACAHKwMAYTYCACAJQQRqIQkgBEEIaiEEIAdBCGohByAKQQFqIgogA0kNAAsLDAULDAMLAAwDCwAMAgsADAELQQIgAxACIQggCEEIaiEJIAMEQEEAIQoDQCAJIAQoAgAgBygCAEY2AgAgCUEEaiEJIARBBGohBCAHQQRqIQcgCkEBaiIKIANJDQALCwwACyAAEAggARAIIAgLggIBBn8gACgCAEEddiECIAAoAgBB/////wFxIQNBCCAAaiEEAkADQCACIAFJRQ0BAkACQAJAAkACQAJAIAIOBAABAgMECwwDC0ECIAMQAiEFQQggBWohBiADBEBBACEHA0AgBiAEIAdqLQAANgIAIAZBBGohBiAHQQFqIgcgA0kNAAsLIAAQCCAFIQBBAiECDAMLQQMgAxACIQVBCCAFaiEGIAMEQEEAIQcDQCAGIAQoAgC4OQMAIAZBCGohBiAEQQRqIQQgB0EBaiIHIANJDQALCyAAEAggBSEAQQMhAgwCCyAARAAAAAAAAAAAEAQQBg8MAQsADAALDAALCyAAEAggBQs="
var rt = "NSAgICAgICAgICAgICAgICAgICAgICAgICAgICAvNQo1IHRpbCAgICAgICAgICAgICAgICAgICAgICAgIC8wIDEgMiAzIDQKNSB0aWwgcmV2ICAgICAgICAgICAgICAgICAgICAvNCAzIDIgMSAwCiJhYmNkIiAgICAgICAgICAgICAgICAgICAgICAgLyJhYmNkIgoiYWJjZCIgcmV2ICAgICAgICAgICAgICAgICAgIC8iZGNiYSIKMSwyLDMgICAgICAgICAgICAgICAgICAgICAgICAvMSAyIDMKMSwyLiwzICAgICAgICAgICAgICAgICAgICAgICAvMSAyIDNmCjQsNSwzLDIgcmV2ICAgICAgICAgICAgICAgICAgLzIgMyA1IDQKNCw1LDMsMiAgMSwzIGF0eCAgICAgICAgICAgICAvNSAyCjQsNSwzLDIuIDEsMyBhdHggICAgICAgICAgICAgLzUgMmYKNSB0aWwgcmV2IDMgdGlsIGF0eCAgICAgICAgICAvNCAzIDIKMyB0aWwgcmV2IDUgdGlsIGF0eCAgICAgICAgICAvMiAxIDAgME4gME4KImFiYyIgNCB0aWwgYXR4ICAgICAgICAgICAgICAvImFiYyAiCjUgdGlsIHJldiBmc3QgICAgICAgICAgICAgICAgLzQKMyA1IHRpbCByc2ggICAgICAgICAgICAgICAgICAvMCAxIDIKNSAzIHRpbCByc2ggICAgICAgICAgICAgICAgICAvMCAxIDIgMCAxCjIsMyA0IHRpbCByc2ggICAgICAgICAgICAgICAgLygwIDEgMjszIDAgMSkKMyA1IHRpbCBjdXQgICAgICAgICAgICAgICAgICAvMyA0CjIsNCw0LDYgOSB0aWwgY3V0ICAgICAgICAgICAgLygyIDM7OzQgNTs2IDcgOCkKMiBlbmwgICAgICAgICAgICAgICAgICAgICAgICAvKDIpCigxOzIpICAgICAgICAgICAgICAgICAgICAgICAgLygxOzIpCigxOzI7KGBhYGI7My4wKSkgICAgICAgICAgICAgLygxOzI7KGBhYGI7M2YpKQooMTsyOzMuMCkgMCwyIGF0eCAgICAgICAgICAgIC8oMTszZikKKCkgICAgICAgICAgICAgICAgICAgICAgICAgICAvKCkKMSwyIDMsNCBjYXQgICAgICAgICAgICAgICAgICAvMSAyIDMgNAoxLDIsMyw0IGNudCAgICAgICAgICAgICAgICAgIC80CjEsMCwwLDEgd2VyICAgICAgICAgICAgICAgICAgLzAgMwozLDAsMiB3ZXIgICAgICAgICAgICAgICAgICAgIC8wIDAgMCAyIDIKMSAyIGVxbCAgICAgICAgICAgICAgICAgICAgICAvMAoxLDIsMyAzLDIsMSBlcWwgICAgICAgICAgICAgIC8wIDEgMAozIHRpbCBub3QgICAgICAgICAgICAgICAgICAgIC8xIDAgMAoxLDIuMiwzIDMsMi4yLDEgZXFsICAgICAgICAgIC8wIDEgMAoxLDIgdGlwICAgICAgICAgICAgICAgICAgICAgIC8yCiJhYmMiIHRpcCAgICAgICAgICAgICAgICAgICAgLzEKYGFgYmVgY2V0YSAgICAgICAgICAgICAgICAgICAvYGFgYmVgY2V0YQpgYWxwaGFgYmV0YWBnYW1tYSA0LDIsMSBhdHggIC9gYGdhbW1hYGJldGEK"
var rs = "aW5pOkk6SXswOjoyODkzNjA2OTE0MTk0MTQ3ODRqOzEyODo6eDtwOjI1NjtpOjg7KGk8eCk/LygoNCppKTo6cDtwKjoyO2krOjEpO3h9IC94OjE2KDY0aykKYms6STpJSXtyOjMyLSo3K3kqST9DIHg7KHI8NCk/IDo0O3J9Cm1rOkk6SUl7dDp4IGJrIHk7aTo0KnQ7KH5JIGkpPy9pKzo0OygxMjh+aSk/ITthOkkgaTtpOjpJIGE7ajppLTQ7KGo+PTQqdCk/Lyh1OmErMTw8aj4+Mjt1OjpJIGo7ajo6dTtqLTo0KTthOjp5fHg8PDI5OyhhKzQpOjoxO2F9Cm1raTpJOkl7cjoyIG1rIDE7KHIrOCk6Ong7cn0KbWtmOkk6RntyOjMgbWsgMTsocis4KTo6eDtyfQpta2Q6STpJSXt2MjtleHQ7cjo3IG1rIDI7KHIrOCk6Ong7KHIrMTIpOjp5O3J9bWt6Okk6SUl7cjp4IG1rZCB5O3I6OjJ8Njw8Mjk7cn0KdjE6e3h0OihJIHgpPj4yOTt4bjooSSB4KSY1MzY4NzA5MTE7eHA6OCt4fXYyOnt2MTt5dDooSSB5KT4+Mjk7eW46KEkgeSkmNTM2ODcwOTExO3lwOjgreX0KZnI6MDpJe3YxO3Q6NCp4dCBiayB4bjt4OjpJIHQ7dDo6eH1keDowOkl7KHg+MjU1KT8oeHI6SSB4KzQ7KHgrNCk6OnhyLTE7KDF+eHIpPyh2MTsoeHQ+Myk/eG4vKGR4IEkgeHArNCppKTtmciB4KSl9ZHhyOntkeCB4O3J9ZHh5cjp7ZHggeDtkeCB5O3J9cng6MDpJeyh4PjI1NSk/KHgrOjQ7eDo6MStJIHgpfXJsOjA6SXt2MTt4bi8ocnggSSB4cDt4cCs6NCl9CnRpbDpJOkl7djE7KH4yfnh0KT8hO246SSB4cDtkeCB4OyhuPCcwKT8gOnRpciAtbjtzZXEoMDtuOzEpfXNlcTpJOklJSXtyOjIgbWsgeTtycDo4K3I7eS8ocnA6OnoqaSt4O3JwKzo0KTtyfXRpcjpJOkl7cjoyIG1rIHg7cnA6NCtyKzQqeDt4LyhycDo6aTtycC06NCk7cn0KZXh0Onsofnh0fnl0KT8hOygoeG5+MSkmeW4+MSk/KHg6eCB0YWtlIHluO3huOnluO3hwOngrOCk7KCh5bn4xKSZ4bj4xKT8oeTp5IHRha2UgeG47eW46eG47eXA6eSs4KTsofnhufnluKT8hfQphdHg6STpJSXt2MjsoeHR+Nyk/ITsofnl0fjIpPyE7cjp4dCBtayB5bjtycDpyKzg7eHQ/WyE7YXRjO2F0STthdEY7YXRMO2F0TDshXTtkeHlyfQphdGM6eyh5bi8oKHJwK2kpOjpDPzMyO3lpOkkgeXA7KHlpPHhuKT8ocnAraSk6OkMgeHAreWk7eXArOjQpKX0KYXRMOnsobmFzOjEgbWsgMDt5bi8ocnA6Om5hczt5aTpJIHlwOyh5aTx4bik/cnA6OkkgeHArNCp5aTtycCs6NDt5cCs6NCk7cmwgcjtkeCBuYXMpfQphdFQ6eyh5bi8ocnA6Om5hVDt5aTpJIHlwOyh5aTx4bik/cnA6OlQgeHArVyp5aTtycCs6Vzt5cCs6NCkpfW5hSTp7LTIxNDc0ODM2NDh9bmFGOns5MjIxMTIwMjM3MDQxMDkwNTYxZn0KcmV2Okk6SXt2MTsofnhuKT8gOng7eCBhdHggdGlyIHhufQpmc3Q6STpJe3YxOyh4dH43KT8ocnggMTIreDtkeCB4OyA6ZnN0IDEyK3gpO3ggYXR4IG1raSAwfQpjdXQ6STpJSXt2Mjsofnh0fjIpPyE7KHhufjEpPyhyOnkgZHJvcCBJIHhwO2R4IHg7IDpyKTtyOjUgbWsgeG47cnA6cis4O3huLyhhOkkgeHA7YjpJIHhwKzQ7KGl+eG4tMSk/Yjp5bjsoYjxhKT8hO3J4IHk7cnA6OnkgYXR4IHNlcShhO2ItYTsxKTt4cCs6NDtycCs6NCk7ZHh5cn0KZHJvcDpJOklJe3YxOyh5PnhuKT8hO3ggYXR4IHNlcSh5O3huLXk7MSl9CnJzaDpJOklJe3YyOyh+eHR+Mik/ITtuOnByb2QoeHA7eG4pO3I6eSB0YWtlIG47KHhufjEpPyhkeCB4OyA6cik7eG4tOjE7eGU6eHArNCp4bjt4bi8obTpJIHhlO246biVtO246eHAgcHJvZCB4bi1pO3I6KHNlcSgwO247bSkpY3V0IHI7eGUtOjQpO2R4cn0KcHJvZDpJOklJe3I6MTt5LyhyKjpJIHg7eCs6NCk7cn0KdGFrZTpJOklJe3YxO3I6dGlsIG1raSB5O3JwOnIrODsoeG48eSk/KHkvKHJwKzQqaSk6OmlceG4pO3ggYXR4IHJ9CnVzZTp7KH4xfkkgdis0KT8ocjp4dCBtayB4bjtycCtyKzg7bXYocnA7eHA7eG4qST9DIHh0KTtkeCB4O3g6cjt4cDp4KzgpfW12OjA6SUlJe3ovKCh4K2kpOjpDIHkraSl9CmNhdDpJOklJe3YyOygofnh0KXx+eXQpPyE7KHh0fnl0KT8gOnggdWNhdCB5Oyh4dH41KT8gOnggbGNhdCB5OyE7eH0KdWNhdDpJOklJe3YyOyh4dD40KT8ocmwgeCk7KHh0PjUpPyhyOih4KzgpbWtkIHgrMTI7ZHggeDtkeCB5OyA6cik7cjp4dCBtayB4bit5bjt3Okk/QyB4dDttdihyKzg7eHA7dyp4bik7bXYocis4K3cqeG47eXA7dyp5bik7ZHh5cn0KbGNhdDpJOklJe3YxOygoeHQgYmsgeG4pPCh4dCBiayB4bisxKSk/KHI6eHQgbWsgeG4rMTttdihyKzg7eHA7NCp4bik7ZHggeDt4OnI7eHA6eCs4KTsoeHArNCp4bik6Onk7eDo6KHhuKzEpfDU8PDI5O3h9CmVubDpJOkl7KDUgbWsgMCkgbGNhdCB4fQpjbnQ6STpJe3YxO2R4IHg7bWtpIHhufXRpcDpJOkl7djE7cjoyIG1rIDE7KDgrcik6Onh0O2R4cn0Kd2VyOkk6SXt2MTsofnh0fjIpPyE7bjowO3huLyhuKzpJIHhwO3hwKzo0KTt4cDo4K3g7cjoyIG1rIG47cnA6cis4O3huLygoSSB4cCkvKHJwOjppO3JwKzo0KTt4cCs6NCk7ZHhyfQpub3Q6STpJe3ggZXFsIG1raSAwfQplcWw6STpJSXt2MjtleHQ7eHQ/WztlcUM7O2VxRjs7ITshOyE7ZXFJXTtkeHlyfSBlcVQ6eyhyOjIgbWsgeG47cnA6cis4O3huLyhycDo6KFQgeHApflQgeXA7cnArOjQ7eHArOlc7eXArOlcpKX0KdXA6STpJSXt2MTsgKHh0PHkpPy94dD9bO2ljO2ZpOyA6eCBta3ogbWtmIDAuOyFdO2R4cn0gaWM6eyhyOjIgbWsgeG47cnA6OCtyO3huLyhycDo6ST9DIHhwK2k7cnArOjQpO2R4IHg7eDpyO3h0OjIpfSBmaTp7KHI6MyBtayB4bjtycDo4K3I7eG4vKHJwOjpGP0kgeHA7cnArOjg7eHArOjQpO2R4IHg7eDpyO3h0OjMpfQoK"
function sa(s){var r=new Uint8Array(new ArrayBuffer(s.length));for(var i=0;i<s.length;i++)r[i]=s.charCodeAt(i);return r}
function pd(e){if(e){e.preventDefault();e.stopPropagation()}};
function ae(x,y,z){x.addEventListener(y,z)};
var kwasm = sa(atob(r))
var tests = atob(rt)
var src = atob(rs)
var K
// kons (k console)
var hit = kons
var konstore = ""
var edname = ""
var ed = false
function initKons() {
 kons.value = "kwasm(4190 b) 2020.03.11 tests src ini bk mk mki mkf mkd mkz til tir atx rev fst cut drop rsh prod take cat ucat lcat enl cnt tip wer not eql up\n "
 var hold = false
 kons.onkeydown = function(e) {
  if(e.which === 27) { // quit edit / toggle hold / close image
   delay = 0
   pd(e)
   if (ed) { qed(); hold=true }
   hold = !hold
   kons.className = (hold) ? "hold" : "term"
   imgSize(0, 0)
   hit = kons
  } else if (e.which === 13 && !hold && !ed) { // execute
   pd(e)
   var a = kons.selectionStart
   var b = kons.selectionEnd
   var s = kons.value.substring(a, b)
   if (b == a) {
    if (kons.value[a] == "\n") a -= 1
    a = kons.value.lastIndexOf("\n", a)
    if (a == -1) a = 0
    b = kons.value.indexOf("\n", b)
    if (b == -1) b = kons.value.length
    s = kons.value.substring(a, b)
   }
   if (kons.selectionEnd != kons.value.length) O(s)
   O("\n")
   s = s.trim()
   if (s === "tests")           { O(tests);                        return }
   if (s === "src")             { O(src);                          return }
   if (s === "\\c")             { kons.value=" ";imgSize(0, 0);    return }
   if (s === "\\h")             { O(atob(h));P();                  return }
   if (s.substr(0,2) === "\\e") { P();edit(s.substr(2));           return }
   if (s.substr(0,2) === "\\w") { download(s.substr(2).trim());P();return }
   if (s.substr(0,2) === "\\L") { P();loop(s.substr(2).trim());    return }
   if (s === "\\lf")            { s = "\\m #:'.fs"                        }
   hash(s);E(s);P()
  }
 }
 kons.onmousedown = function(e) { hit=kons; if(e.button==2)pd(e); }
 kons.onblur  = function(e) { kons.style.filter = "brightness(70%)" }
 kons.onfocus = function(e) { kons.style.filter = "brightness(100%)" }
}
function O(s) { kons.value += s; kons.scrollTo(0, kons.scrollHeight) }
function P()  { kons.value += " " }

function us(s) { return new TextEncoder("utf-8").encode(s) } // uint8array from string
function su(u) { return (u.length) ? new TextDecoder("utf-8").decode(u) : "" }
function kst(x) {
 var h = K.I[x>>>2]
 var t = (h>>>29)>>>0
 var n = (h&536870911)>>>0
 var o = []
 switch(t){
 case 1:
  return '"'+su(K.C.slice(8+x, 8+x+n))+'"'
 case 2:
  x >>>= 2
  return K.I.slice(2+x, 2+x+n).join(" ").split("2147483648").join("0N")
 case 3:
  x >>>= 3
  var s = K.F.slice(1+x, 1+x+n).join(" ")
  if(s.indexOf(".")==-1) s+="f"
  return s
 case 4:
  x >>>= 2
  var r = ""
  var v = K.I.slice(2+x, 2+x+n)
  var tr = function(s) { return s.substr(1, s.length-2) }
  for (var i=0; i<n; i++) r += String.fromCharCode(96) + tr(kst(v[i]))
  return r
 case 5:
  x >>>= 2
  var r = []
  for (var i=0; i<n; i++) r.push(kst(K.I[2+x+i]))
  return "("+r.join(";")+")"
 default:
  return "kst nyi: t=" + String(t)
 }
}

var funcs = {"ini":1,"bk":2,"mk":2,"mki":1,"mkf":1,"mkd":2,"mkz":2,"til":1,"tir":1,"atx":2,"rev":1,"fst":1,"cut":2,"drop":2,"rsh":2,"prod":2,"take":2,"cat":2,"ucat":2,"lcat":2,"enl":1,"cnt":1,"tip":1,"wer":1,"not":1,"eql":2,"up":2}
function parseNoun(s) {
 var t = 2
 if(s.startsWith('"'))                     return chrVector(s);
 if(s.startsWith(String.fromCharCode(96))) return symVector(s);
 if(s.startsWith('('))                     return lstVector(s.substr(1));
 if(s.indexOf(".") != -1) t = 3
 var v = s.split(",").map(x=>Number(x))
 var n = v.length
 if (n==0) return 0;
 var x = K.exports.mk(t, n)
 if (t==2) for (var i=0;i<n;i++) K.I[2+i+(x>>>2)] = v[i];
 else      for (var i=0;i<n;i++) K.F[1+i+(x>>>3)] = v[i];
 return x
}
function chrVector(s) {
 s = s.substr(1,s.length-2)
 var n = s.length
 var x = K.exports.mk(1, n)
 for (var i=0;i<n;i++) K.C[8+x+i] = s.charCodeAt(i);
 return x
}
function symVector(s) {
 var v = s.substr(1).split(String.fromCharCode(96))
 var x = K.exports.mk(4, v.length)
 for (var i=0; i<v.length; i++) K.I[2+i+(x>>>2)] = chrVector("_"+v[i]+"_")
 return x
}
function lstVector(s) {
 if (s.length == 0 || s.endsWith(')') == false) { throw new Error("parse list: "+s) }
 if (s.length == 1) return K.exports.mk(5, 0);
 s = s.substr(0, s.length-1)
 var a = 0
 var l = 0
 var r = []
 for (var i=0; i<s.length; i++) {
  var c = s[i]
  if (c == '(') l++
  else if (c == ')') { l--; if(l<0) throw new Error("list)") }
  else if ((l==0) && (c==';')) {
   r.push(parseNoun(s.substring(a,i)))
   a = i + 1
  }
 }
 r.push(parseNoun(s.substr(a)))
 var x = K.exports.mk(5, r.length)
 for (var i=0; i<r.length; i++) K.I[2+i+(x>>>2)] = r[i]
 return x
}
function xx(x) { return x.toString(16).padStart(8,'0') }
function dump(x, n) {
 var p = x >>> 2
 O("\n"+xx(p)+" ")
 for (var i=0; i<n; i++) {
  O(" "+xx(K.I[p+i]))
  if ((i>0)&&((i+1)%8==0)) O("\n"+xx(x+4*i+4)+" ")
  else if ((i>0)&&((i+1)%4==0)) O(" ")
 }
 O("\n")
}
function E(s) {
 try{ // todo save/restore
  var stack = []
  var v = s.split(" ").filter(x => x)
  for (var i=0; i<v.length; i++) {
   s = v[i]
   if (s=="dump") { dump(0,100); continue; }
   if(s in funcs) {
    var n = funcs[s]
    x = stack.pop()
    if(n==2) {
     y = x
     x = stack.pop()
     stack.push(K.exports[s](x, y))
    } else {
     stack.push(K.exports[s](x))
    }
    continue
   }
   var x = parseNoun(s)
   if (x!=0) { stack.push(x); continue; }
   else      { throw new Error(s); }
  }
  if(stack.length != 1) { throw new Error("stack length "+String(stack.length)) }
  else {
   x = stack.pop()
   O(kst(x)+"\n")
   K.exports.dx(x)
  }
 } catch(e) {
  console.log(e)
  O("error")
 }
}

function edit(name) { 
 edname = name; ed = true; konstore = kons.value; 
 var u = getfile(name.trim())
 kons.value = (u.length>0) ? su(u) : ""
 kons.className = "edit"
 kons.scrollTo(0,0);
}
function qed() { // quit edit
 putfile(edname, us(kons.value))
 kons.value = konstore; kons.scrollTo(0, kons.scrollHeight)
 ed = false
}
ae(kons,"contextmenu", function(e) { // button-3 search
 var l = kons.selectionEnd-kons.selectionStart; if(e.button==2&l>0) {
  pd(e); var t = kons.value.substring(kons.selectionStart,kons.selectionEnd)
  var f = function(a){ return kons.value.indexOf(t,a) }; var n = f(kons.selectionEnd)
  if (n<0){n=f(0)}; kons.setSelectionRange(n,n+l); }
})
function hash(s){window.location.hash=encodeURIComponent(s.trim())}

(async () => {
 initKons()
 const module = await WebAssembly.compile(kwasm.buffer);
 K = await WebAssembly.instantiate(module);
 K.C = new Uint8Array(K.exports.mem.buffer)
 K.I = new Uint32Array(K.exports.mem.buffer)
 K.F = new Float64Array(K.exports.mem.buffer)
 K.exports.ini(16);
 var h = decodeURIComponent(window.location.hash.substr(1))
 window.location.hash = h
 if (h.length > 0) {
  var p = kons.value.length
  kons.value += h
  kons.setSelectionRange(p, kons.value.length)
 }
 kons.focus()
})();
</script></body></html>
