<head><meta charset="utf-8"><title>.</title></head>
<link rel=icon href='data:;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAACVBMVEX/AAAAAAD////KksOZAAAAMElEQVR4nGJYtWrVKoYFq1ZxMSyYhkZMgxNRXAwLpmbBCDAXSRZEgAwAGQUIAAD//+QzHr+8V1EyAAAAAElFTkSuQmCC'>
<link rel="stylesheet" href="codemirror/codemirror.min.css">
<style>
 @font-face{font-family:'apl2741'; src:url('apl2741.woff2') format('woff2');}
 html{font-family:monospace;}
 .ibm2741{width:100%;height:100%;resize:none;padding:1px;border:none;outline:none;font-family:apl2741;position:absolute;top:0;left:0;z-index:8;display:none};.hit{paddint-top:0px}
 .codemirror{height:100%;border:none;resize:none}
 .cm-fat-cursor .CodeMirror-cursor{width:auto;border:0!important;background:black}
 #_uid{position:absolute;right:0;top:0;z-index:10}
</style>

<script src="codemirror/jquery.min.js"></script>
<script src="codemirror/codemirror.min.js"></script>
<script src="codemirror/matchbrackets.js"></script>

<body>
<div id="_edt" class="cm.fat-cursor"></div>
<textarea id="_ibm" class="ibm2741"></textarea>
<div id="_uid""></pre><canvas id="_icv"></canvas></div>
<a id="_dl" style:"display:none"></a>

<script>


function pd(e){if(e){e.preventDefault();e.stopPropagation()}};
function hash(){return decodeURIComponent(window.location.hash.substr(1))}
function ge(x){return document.getElementById(x)}
function ce(x){return document.createElement(x)}

var _edt=ge("_edt")
var _ed = CodeMirror(_edt, {"dark":true,"lineNumbers":false,"dragDrop":false,"tabSize":8,"indentUnit":8,"indentWithTabs":true,"smartIndent":false,"matchBrackets":true,"extraKeys":{"Enter": enter, "Up":function(){return updown(-1)}, "Down": function(){return updown(1)}}})

// search selected: middle-button(all), right(next) (bug: mouseup(chrome), ff ok)
_edt.addEventListener('contextmenu',function(e){console.log("click");pd(e);})
_ed.on('mousedown', function(cm, e) {
 if     (e.button==2 && (_ed.getSelection().length>0)){search(_ed.getSelection(),false);pd(e)}
 else if(e.button==1 && (_ed.getSelection().length>0)){search(_ed.getSelection(),true );pd(e)}
})
function indexAll(a, s) { var r = [], i = -1; while ((i = a.indexOf(s, i+1)) != -1){ r.push(i); }; return r; }
function search(t, all){
 var v=_ed.getValue();var p=_ed.getCursor();if(all){
  var n=indexAll(v,t);for(var i=0; i<n.length; i++)_ed.addSelection(_ed.posFromIndex(n[i]),_ed.posFromIndex(n[i]+t.length),{"scroll":true})
 }else{
  var c=_ed.indexFromPos(_ed.getCursor());c=(p.sticky=="after")?c+t.length:c
  var n=v.indexOf(t,c);if(n==-1){n=v.indexOf(t,0)};_ed.setSelection(_ed.posFromIndex(n), _ed.posFromIndex(n+t.length), {"scroll":true})}}

window.addEventListener('unhandledrejection', function(e) {_ed.setValue(String(e.reason))})
function banner(x){_ed.setValue("ktye/k "+x.byteLength+"\n ");return x}

function fatCursor(x){
 if(x)CodeMirror.addClass(_ed.getWrapperElement(),"cm-fat-cursor")
 else CodeMirror.rmClass (_ed.getWrapperElement(),"cm-fat-cursor")
}

// atEOF: block cursor. console(execute) editor(exit-at-\)
function atEOF(){var c=_ed.getCursor();var l=_ed.lastLine();return ((c.line==l)&&(true/*_ed.getLine(l).length==c.ch*/)&&(_ed.getSelection().length==0))}
_ed.on("cursorActivity", function(e){ fatCursor(atEOF()) })
function KO(s){_ed.replaceRange(s,{line:Infinity});_ed.setCursor(_ed.lineCount(),0,{"scroll":true});}
var O=KO

var editor=false
var _hist=[""];_histn=1
var _buf="\\"
var cons=""
function setEditor(b){editor=b;if(b){cons=_ed.getValue();_ed.setValue(_buf)}else{_ed.setValue(cons)};_ed.setCursor(_ed.lineCount(),0,{"scroll":true})}
function enter(){if(!atEOF())return CodeMirror.Pass;var l=_ed.getLine(_ed.lastLine());var t=l.trim()
 if(!editor){
  if(t=="\\e"){
   setEditor(true);return
  }else if(t.startsWith("\\e ")){
   t=t.slice(3); _buf=t+":"+sk(K.Atx(K.sc(ks("edit")),lup(t)))+"\n\\"; setEditor(true);return
  }else if(t=="\\"){help()
  }else if(t=="\\\\"){_ed.execCommand("deleteLine");_ed.replaceRange(" ",{"line":_ed.lastLine()});if(!system360up)bootSystem360();else SWTCH("APL")
  }else{exec(l);if(l!=" "&&_hist[_hist.length-1]!=l)_hist.push(l);_histn=_hist.length;return}
 }else{
  switch(t){
  case "\\":
  case "\\\\":
   var s=_ed.getValue()
   setEditor(false)
   if(t=="\\"){_buf=s.slice(0,-2);if(_buf.startsWith("\\c\n")){reset();_buf.slice(3)};window.location.hash=encodeURIComponent(_buf);exec(_buf)} break;
  default: return CodeMirror.Pass
  }}}
function updown(d){if(editor||!atEOF())return CodeMirror.Pass; _histn=Math.min(Math.max(0,_histn+d),_hist.length-1);var l=_ed.lastLine();_ed.replaceRange(_hist[_histn],{"line":l,"ch":0},{"line":l,"ch":Infinity}) }

function exec(s){s=(s.startsWith("  "))?" "+s.trim():s.trim()
 var l=_ed.lastLine()
 _ed.markText({line:l,ch:0},{line:l,ch:Infinity},{css:"color: darkred"})
 _ed.replaceRange("\n", {line:l})
 ktry(s);O(" ");ui()}

function apl(s){if(s==")"){_ibm.value=_ibm.value.slice(0,_ibm.value.lastIndexOf("\n"))+"\n      ";SWTCH("k");return}
 var sk=function(x){msl();var t=K.tp(x);if(t!=18){K.dx(x);return "RETURN TYPE ERROR"}var xp=lo(x);var r=su(C.slice(xp,xp+K.nn(x)));K.dx(x);return r}
 var r=sk(K.Atx(lup("APL"),ks(s)));r="\n"+r;if(r.length>1)r+="\n";O(r+"      ")}
 
//IBM2741
var _ibm=ge("_ibm");_ibm.value=""
_ibm.value=""
_ibm.addEventListener('keydown',function(e){ var t=_ibm
 var u={49:"¨",50:"¯",51:"<",52:"≤",53:"=",54:"≥",55:">",56:"≠",57:"∨",48:"^",173:"-",61:"÷",81:"?",87:"⍵",69:"∊",82:"⍴",84:"~",89:"↑",85:"↓",73:"⍳",79:"○",80:"*",219:"→",65:"⍺",83:"⌈",68:"⌊",70:"_",71:"∇",72:"∆",74:"∘",75:"'",76:"⎕",59:"(",222:")",90:"⊂",88:"⊃",67:"∩",86:"∪",66:"⊥",78:"⊤",77:"|",188:";",190:":",191:"\\"}
 var w={219:"←",59:"[",222:"]",188:",",190:".",191:"/"}
 var c=e.keyCode;var s=e.getModifierState("Shift");//console.log(c, s)
 var n=t.value.length;var p=t.selectionStart
 if(c==8){t.selectionStart=(p>0)?p-1:0;t.selectionEnd=t.selectionStart}
 if(c==46){t.value=t.value.slice(0,p)}
 if(!s&&(c>=65&&c<=90)){emit(String.fromCharCode(c))} //AZ
 if(!s&&(c>=48&&c<=57))emit(String.fromCharCode(c))   //09
 if(c==32){emit(" ")}
 if(s&&u[c]!=undefined){emit(u[c])}  //shift-apl
 if(!s&&w[c]!=undefined){emit(w[c])} //unshift-apl
 if(c==13){new channel("ret.m4a").play();var nl=t.value.lastIndexOf("\n");apl(t.value.slice((nl<0)?0:1+nl).trim())}
 pd(e)})
emits=async function emits(s){var a=s.split("");for(var i=0;i<a.length;i++){await sleep(50);emit(a[i])}}
emit =async function emit(c){var t=_ibm;var h=(c!=" ")
 if(h)t.classList.add("hit");
 new channel((c==" ")?"spc.m4a":"key.m4a").play()
 var o=t.value[t.selectionStart];if(o!=undefined)c=overstrike(o,c)
 var p=t.selectionStart;t.value=t.value.slice(0,p)+c+t.value.slice(1+p)
 t.selectionStart=1+p;t.selectionEnd=1+p
 await sleep(200)
 if(h)t.classList.remove("hit")}
var overstrikes={};var a="'.!'⎕⍞⎕∘⌼⊤○⍕⊥○⍎○*⍟/-⌿\\-⍀∩∘⍝○\\⍉○|⌽○∘⌾○-⊖∆|⍋∇|⍒÷⎕⌹";for(var i=0;i<a.length;i+=3){overstrikes[a[i]+a[1+i]]=a[2+i];overstrikes[a[1+i]+a[i]]=a[2+i]}
function overstrike(a,b){var r=overstrikes[a+b];return(r==undefined)?b:r}
function sleep(x){return new Promise(r=>setTimeout(r,x))}
function channel(u){this.u=u;this.r=new Audio(u)};channel.prototype.play = function(){this.r.play()}

function setIcon(w){var l=document.querySelector("link[rel~='icon']");
 l.href=(w=="apl")?'log.png':'data:;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAACVBMVEX/AAAAAAD////KksOZAAAAMElEQVR4nGJYtWrVKoYFq1ZxMSyYhkZMgxNRXAwLpmbBCDAXSRZEgAwAGQUIAAD//+QzHr+8V1EyAAAAAElFTkSuQmCC'
 document.title=(w=="apl")?"↓":"."}


var K, C, I, U, F, bak
function us(s){return new TextEncoder("utf-8").encode(s)}
function su(u){return (u.length)?new TextDecoder("utf-8").decode(u):""}
function lo(x){return Number(BigInt.asUintN(32,x))}
function ku(u){msl();var x=K.mk(18,u.length);C.set(u,lo(x));return x}
function ks(s){return ku(us(s))}
function sk(x){msl();var t=K.tp(x);x=(4==t)?x=K.cs(x):(18==t)?x:K.Kst(x);var xp=lo(x);var r=su(C.slice(xp,xp+K.nn(x)));K.dx(x);return r}
function la(a){msl();var r=K.mk(23,a.length);for(var i=0;i<a.length;i++)J[i+(lo(r)>>>3)]=a[i];return r}
function lup(s){return K.Val(K.sc(ks(s)))}
function asn(s,x){K.dx(K.Asn(K.sc(ks(s)),x))}

var filename="" 
function path_open(fd,dirflags,path,pathlen,oflags,baserights,inheritrights,fdflags,res){
 msl();filename=su(C.slice(path,path+pathlen));if(oflags==0)return 1;U[res>>2]=3;return 0 //no read in js.
} 
function fd_write(fd,p,nio,nw){
 msl();var x=U[p>>>2]; var n=U[(4+p)>>>2];var u=(C.slice(x,x+n));if(fd==1){O(su(u))}else{download(filename,u)};return 0
}
var env={wasi_unstable:{ 
// l32:function(x){console.log(x);return x},
// l64:function(x){console.log(BigInt.asUintN(64,x));return x},
 args_get: function(a,b){return 0},
 args_sizes_get: function(a,b){return 0},
 proc_exit:function(x){console.log("exit", x)},
 fd_read:  function(a,b,c,d){console.log("read",a,b,c,d);return 0},
 fd_write: fd_write,
 fd_seek:  function(fd,o,w,r){return 0},
 fd_close: function(fd){return 0},
 path_open:path_open,
 clock_time_get:function(a,b,p){msl();J[p>>>3]=BigInt.asIntN(64, BigInt(Math.floor(1e6*performance.now())));return 0}
}}


function download(name,u){
 var dl=ge("_dl");var b=new Blob([u],{type:"application/octet-stream"})
 dl.href=URL.createObjectURL(b);dl.download=name;dl.click()}

fetch('k.wasm').then(r=>r.arrayBuffer()).then(r=>WebAssembly.instantiate(banner(r),env)).then(r=>{
 K=r.instance.exports
 K.kinit();reset()
 var s=hash();if(s=="2741"){bootSystem360()}else if(s.length!=0){_buf=s+"\n\\";setEditor(true)}
})

function reset(){
 K.reset()
 asn("WIDTH",K.Ki(window.innerWidth));asn("HEIGHT",K.Ki(window.innerHeight-40));
 var z=ge("_icv").getContext('2d');z.font="20px monospace";asn("FH",K.Ki(20));asn("FW",K.Ki(z.measureText("M").width))
 ksave()
}

var bak
function msl() {
 C=new Uint8Array(K.memory.buffer)
 I=new Int32Array(K.memory.buffer)
 U=new Uint32Array(K.memory.buffer)
 J=new BigInt64Array(K.memory.buffer)
 F=new Float64Array(K.memory.buffer)}
function ksave(){ msl();bak=C.slice(0,1<<U[32]) }

var E
function ktry(s){ 
 try      { if(typeof(s)==="function"){s()}else{K.repl(ks(s))}; ksave();return 0}
 catch(e) { console.log(e); if(e.message!="unreachable executed")O(e.name+": "+e.message+"\n"); C.set(bak); return K.Srcp() }}
//function ktry(s) { if(typeof(s)==="function"){s()}else{K.repl(ks(s))}; ksave();return 0 } //unprotected

var system360up=false
function bootSystem360(){SWTCH("APL")
 keyboard = `┌────┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬────────┐\n│    │ ¨ │ ¯ │ < │ ≤ │ = │ ≥ │ > │ ≠ │ ∨ │ ^ │ - │ ÷ │        │\n│    │ 1 │ 2 │ 3 │ 4 │ 5 │ 6 │ 7 │ 8 │ 9 │ 0 │ + │ × │ BACKSP │\n├────┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬──────┤\n│      │ ? │ ⍵ │ ∊ │ ⍴ │ ~ │ ↑ │ ↓ │ ⍳ │ ○ │ * │ → │   │      │\n│      │ Q │ W │ E │ R │ T │ Y │ U │ I │ O │ P │ ← │   │      │\n├──────┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴─┬─┴──────┤\n│        │ ⍺ │ ⌈ │ ⌊ │ _ │ ∇ │ ∆ │ ∘ │ ' │ ⎕ │ ( │ ) │        │\n│        │ A │ S │ D │ F │ G │ H │ J │ K │ L │ [ │ ] │ RETURN │\n───────┴──┬┴──┬┴──┬┴──┬┴──┬┴──┬┴──┬┴──┬┴──┬┴──┬┴──┬┴────────┤\n│           │ ⊂ │ ⊃ │ ∩ │ ∪ │ ⊥ │ ⊤ │ | │ ; │ : │ \\ │         │\n│  SHIFT    │ Z │ X │ C │ V │ B │ N │ M │ , │ . │ / │  SHIFT  │\n└───────────┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴─────────┘`
 fetch('∘.k').then(r=>r.text()).then(s=>{K.dx(K.Val(ks(s))); ksave();system360up=true})
}
function SWTCH(w){var APL=w=="APL"
 var l=document.querySelector("link[rel~='icon']");
 l.href=APL?'log.png':'data:;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAACVBMVEX/AAAAAAD////KksOZAAAAMElEQVR4nGJYtWrVKoYFq1ZxMSyYhkZMgxNRXAwLpmbBCDAXSRZEgAwAGQUIAAD//+QzHr+8V1EyAAAAAElFTkSuQmCC'
 document.title=APL?"↓":"."
 O=APL?emits:KO;_ibm.style.display=APL?"block":"none"
 if(APL){_ibm.focus()}else{_ed.setCursor(_ed.lineCount(),0,{"scroll":true});_ed.focus()}}

// drop file in console (store in variable)
window.ondragover=function(e){pd(e)}
window.ondrop=function(e){pd(e);if (e.dataTransfer.items){for (var i=0;i<e.dataTransfer.items.length;i++){if(e.dataTransfer.items[i].kind=='file'){var file=e.dataTransfer.items[i].getAsFile();addfile(file)}}}else for(vari=0;i<e.dataTransfer.files.length;i++)addfile(e.dataTransfer.files[i])}
function addfile(x){
 var r = new FileReader()
 r.onload = function(){
  var u = new Uint8Array(r.result)
  //if(x.name.endsWith(".k")) run(su(u))
  //else ktry(function(){term.value+=" /"+x.name+":.. ("+u.length+" bytes)\n ";asn(x.name,ku(u))})
  asn(x.name,ku(u))
 }
 r.readAsArrayBuffer(x)
}

function help(){fetch('readme').then(r=>r.text()).then(r=>O("\n"+r+" "))}


/*
 ui:"int list <input id='X'>
 <button id='f'>push</button>"
 X:1 2 3
 f:{X+:1}

variables are bound to html elements with the same id, value contain their type.

 html-element k-type
 input        bcifzBCIFZ   <input id='X'/>
 checkbox     b            <input type='checkbox' id='X'/>
 table        DT           <table id='X'/>
 select       BCFIZL       <select id='X' data-options='o'/>    selection assigns X
 listbox      LDT          <select id='X' data-index='i'/>      selection assigns i (single/multiple)
 textarea     CL           <textarea id='X'/>
 pre          (2d-display) <pre id='X'/>
 button       l  (niladic) <button id='X'/>
 canvas       ID (I:pixels, D:2d-api-calls) <canvas id='X' data-click='c' data-zoom='z'/>  c,z: callbacks
 default      k-string

/vector graphics
d:\`fillStyle\`fillRect!("green";10 20 50 60)
ui:"<canvas width=300 height=200 id='d'></canvas>"
 
s:{(-/x*x;2(*)/x)}
m:{+/x*x}
C:(3*!85),(255+768*!85),(65535+196608*!86)
W:600;H:400
O:0 -.5
S:2*2 3.
f:{ 
 d:S*((y;x)-n%2.)%n:(H;W)
 O::O+d
 S::S%2
 c:|(O-S%2)+S*(!n)%0.+n
 X::C@+/(.001*!255)<\:m(c+s@)10/0 0}
X:f[W%2;H%2]
ui:"<canvas width=",($W)," height=",($H)," data-click='f' id='X'/>"
*/

var udiv=ge("_uid")
function ui(){var u=K.Val(K.Ku(BigInt(26997)));if(u==0)return;clr(udiv);ktry(function(){showui(u,udiv)})}
function clr(p){while(p.firstChild)p.removeChild(p.firstChild)}
function showui(x,p){var e=p;/*if(K.tp(x)==19){return framebuffer(x)};*/if(K.tp(x)!=18){x=K.Atx(K.Val(K.sc(ks(".html"))),x)};p.insertAdjacentHTML("beforeend",sk(x));glueAll(udiv);}
function glueAll(p){var nodes=p.childNodes;if(nodes.length==0)glue(p);for(var i=0;i<nodes.length;i++){glueAll(nodes[i])}}
function glue(e){if(e.id===undefined)return;var s=K.sc(ks(e.id));var x=K.Val(s);if(lo(s)==0)return;var t=tstr(K.tp(x))
 switch(e.nodeName){
 case "INPUT":    glueInput(e,s,x,t); break;
 case "CANVAS":   glueCanvas(e,s,x,t); break;
 case "BUTTON":   glueButton(e,s,x,t); break;
 case "PRE":      e.textContent=lstr(x);break;
 case "SELECT":   glueSelect(e,s,x,t);break;
 case "TABLE":    glueTable(e,s,x,t);break;
 case "TEXTAREA": glueTextarea(e,s,x,t);break;
 default:e.textContent = kstr(x)}}
 
function glueInput(e,s,x,t){if(e.type=="checkbox"){glueCheckbox(e,s,x,t);return}
 switch(t){
 case"b":case"c":case"i":case"f":case"z":case"B":case"C":case"I":case"F":case"Z":
  e.onchange=function(){var v=e.value;var r=update(e,s,t,v);e.style.backgroundColor=r?"white":"orange";if(r)e.value=v;return r}
  e.value=kstr(x);break
 default: e.value="type "+t+"?";K.dx(x)}}

function glueCheckbox(e,s,x,t){if(t!="b")return;e.checked=lo(x)!=0;e.onchange=function(){K.dx(K.Asn(s,K.Kb(e.checked?1:0)))}}

function glueCanvas(e,s,x,t){var z=e.getContext('2d');var w=e.width;var h=e.height;
 if(t=="I"){x=K.alpha(x);var d=z.createImageData(w,h);d.data.set(C.slice(lo(x),lo(x)+4*K.nn(x)));z.putImageData(d,0,0)}
 else if(t=="D"){var [k,x]=K.spl2(x);var n=K.nn(k);for(var i=0;i<n;i++){
  var s=sk(K.ati(K.rx(k),i));var a=jk(K.ati(K.rx(x),i));
  if(typeof(z[s])==="function")z[s](...a);else z[s]=a}
 }else{K.dx(x);return}
 if(e.dataset.click){e.ondblclick=function(ev){var f=lup(e.dataset.click);if(lo(f)==0)return;K.dx(K.Cal(f,K.l2(K.Ki(ev.offsetX),K.Ki(ev.offsetY))));ui()}}
 if(e.dataset.zoom){
  var zoom=false; var bg=z.getImageData(0,0,e.width,e.height)
  var zs=function(ev){e.onmousemove=zm;zoom=[ev.offsetX,ev.offsetY,0,0];e.style.cursor="crosshair"}
  var zm=function(ev){if(zoom!==false){zoom=[zoom[0],zoom[1],ev.offsetX-zoom[0],ev.offsetY-zoom[1]];z.putImageData(bg,0,0);z.beginPath();z.rect(...zoom);z.strokeStyle='red';z.stroke()}}
  var ze=function(ev){z.putImageData(bg,0,0);e.style.cursor="";if(Math.abs(zoom[2])< 5||Math.abs(zoom[3])<5){zoom=false;return}
   var f=lup(e.dataset.zoom);if(lo(f)!=0){K.dx(K.Cal(f,K.l1(K.Cat(K.Cat(K.Ki(zoom[0]),K.Ki(zoom[1])),K.Cat(K.Ki(zoom[0]+zoom[2]),K.Ki(zoom[1]+zoom[3]))))));ui()}
   zoom=false;e.onmousemove=null}
  e.onmousedown=zs;e.onmouseup=ze}}


function glueButton(e,s,x,t){if(t!="l")return;e.onclick=function(){ktry(function(){K.Cal(x,K.mk(23,0)); ui()})}}

function glueSelect(e,s,x,t){if(e.dataset.options){glueCombo(e,s,x,t)}else{glueListbox(e,s,x,t)}}

function glueCombo(e,s,x,t){var o=lup(e.dataset.options);if(o==0){K.dx(x);return}
 var n=K.nn(o);for(var i=0;i<n;i++){var oe=ce("option");var oi=K.Atx(K.rx(o),K.Ki(i));oe.selected=(K.match(oi,x)==1);oe.innerText=kstr(oi);e.appendChild(oe)}
 K.dx(o);K.dx(x);e.onchange=function(){K.dx(K.Asn(s,K.Atx(lup(e.dataset.options),K.Ki(e.selectedIndex))))}}

function glueListbox(e,s,x,t){var y=lup(e.dataset.index);if(x==0||y==0){K.dx(x);K.dx(y);return};
 var n=K.nn(x);if(e.size==0)e.size=n;e.multiple=K.tp(y)==19;if(t=="T"){x=K.Drp(K.Atx(K.sc(ks("l")),x), K.Ki(1))};
 for(var i=0;i<n;i++){var o=ce("option");o.innerText=kstr(K.Atx(K.rx(x),K.Ki(i)));o.selected=e.multiple?lo(K.In(K.Ki(i),K.rx(y)))==1:lo(y)==i;e.appendChild(o)}
 var selectedIndexes=function(){var o=e.selectedOptions;var r=K.mk(3+16,o.length);for(var i=0;i<o.length;i++)K.sti(r,i,K.Ki(o[i].index));return r}
 K.dx(x);K.dx(y);e.onchange=function(){var si=e.dataset.index;if(e.multiple){asn(si,selectedIndexes())}else{
 asn(si,K.Ki(e.selectedIndex))}}}
 
function glueTable(e,s,x,t){if(t!="T"){K.dx(x);return};var n=K.nn(x);var [k,x]=K.spl2(x);var m=K.nn(k);
 var tr=ce("tr");var th=ce("th");th.textContent="#";tr.appendChild(th);var h=[];var ti=[];var ts=K.Ech(BigInt(19),K.l1(K.rx(x)));
 for(var i=0;i<m;i++){var th=ce("th");h[i]=sk(K.ati(K.rx(k),i));ti[i]=sk(K.ati(K.rx(ts),i)).toLowerCase();th.textContent=h[i];tr.appendChild(th)};e.appendChild(tr);K.dx(k);K.dx(ts)
 for(var j=0;j<n;j++){var tr=ce("tr");var td=ce("td");td.textContent=j;tr.appendChild(td);
  for(var i=0;i<m;i++){var td=ce("td");td.textContent=sk(K.ati(K.ati(K.rx(x),i),j));td.dataset.i=i;td.dataset.j=j;td.v=td.textContent
   td.ondblclick=function(ev){
    var td=ev.target;var tr=td.parentNode;
    var restore=function(s,ed){td.textContent=s;tr.insertBefore(td,ed);tr.removeChild(ed)}
    var c=td.textContent;var ed=ce("input");ed.dataset.i=td.dataset.i;ed.dataset.j=td.dataset.j;ed.dataset.v=c;ed.value=c;tr.insertBefore(ed,td);tr.removeChild(td)
    ed.onchange=function(ev){var ed=ev.target;var rs=ed.value;var i=Number(ed.dataset.i);var j=Number(ed.dataset.j); var r=update(ed,[s,K.sc(ks(h[i])),K.Ki(j)],ti[i],ed.value);if(r){restore(rs,ed)}else{ed.style.backgroundColor="orange"};return r}
    ed.onkeydown=function(ev){if(ev.keyCode!=27)return;var ed=ev.target;var rs=ed.value;restore(ed.dataset.v,ed)}
  }
   tr.appendChild(td)
  };e.appendChild(tr)};K.dx(x)}

function glueTextarea(e,s,x,t){if(t=="L"){x=K.join(K.Kc(10),x)}else if(t!="C"){K.dx(x);return};e.value=sk(x);e.onchange=function(){x=ks(e.value);K.dx(K.Asn(s,t=="L"?K.split(K.Kc(10),x):x))}}

function update(e,path,t,s){ // ui-assign callback
 var x=K.Cst(K.sc(ks(t=="s"?"":t)), ks(s)) // x:t$s or `$s
 e.setCustomValidity((x==0)?"invalid type "+t:""); if(x==0)return false;
 if(typeof path=="object") K.dx(K.Asn(path[0], K.Dmd(K.Val(path[0]),la(path.slice(1)),BigInt(1),x)))
 else K.dx(K.Asn(path,x)); return true}
 
function kstr(x){var t=K.tp(x);if(t==2)return String.fromCharCode(lo(x));if(t==18||t==4)return sk(x);if(t>16&&t<23){
 var n=K.nn(x);if(n==0){K.dx(x);return ""}else if(n==1){x=K.Fst(x)}};return sk(K.Kst(x))}

function lstr(x){return sk(K.join(K.Kc(10),K.Atx(K.sc(ks("l")),x)))}
function tstr(t){const T="vbcisfzldtcdpl000BCISFZLDT";return T[t]}

function jk(x,t,n,p){msl();t=K.tp(x);if(t>16)n=K.nn(x);p=lo(x);switch(t){
 case  1: return p==1
 case  3: return p
 case  4: return sk(x)
 case  5: return F[p>>>3]
 case 18: return sk(x)
 case 19: var r=[];for(var i=0;i<n;i++) r.push(lo(K.ati(K.rx(x),i))); K.dx(x);return r
 case 21: var r=[];for(var i=0;i<n;i++) r.push(F[(p>>>3)+i]);         K.dx(x);return r
 case 23: var r=[];for(var i=0;i<n;i++){r.push(jk(K.ati(K.rx(x),i)))};K.dx(x);return r
}}

/*
function framebuffer(x){if(K.nn(x)!=2){K.dx(x);return};
 var c=ce("canvas");c.id="_fb";c.width=lo(K.ati(K.rx(x),0));c.height=lo(K.ati(K.rx(x),1));c.tabIndex=1; //triggers keydown
 ge("_uid").appendChild(c)
 var z=c.getContext("2d");z.fillStyle='grey';z.fillRect(0,0,c.width,c.height);
 var m=K.Val(K.sc(ks("click")));var k=K.Val(K.sc(ks("key")));var f=K.Val(K.sc(ks("frame")))
 if(m!=0)c.addEventListener("click",function(e){K.dx(K.Cal(K.rx(m),K.l2(K.Ki(e.offsetX),K.Ki(e.offsetY))))},true);
 if(k!=0)c.addEventListener("keydown",function(e){K.dx(K.Cal(K.rx(k),K.l1(K.Ki((e.key.length==1)?e.key.charCodeAt():e.keyCode))))},true)
 if(f!=0){
  var loop=function(t){
   var x=K.alpha(K.Cal(K.rx(f),K.l1(K.Kf(t))));
   var d = new ImageData(new Uint8ClampedArray(K.memory.buffer, lo(x), 4*c.width*c.height), c.width, c.height)
   z.putImageData(d,0,0)
   K.dx(x)
   window.requestAnimationFrame(loop)
  }
  window.requestAnimationFrame(loop)
 }
}
*/

</script>
</body></html>

