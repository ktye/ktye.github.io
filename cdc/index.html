<!DOCTYPE html>
<head><meta charset="utf-8"><title>cdc 6600</title>
<rel="icon" type="image/png" sizes="32x32" href="../kelas16.png">
<style>
@font-face{font-family:'AVHersheySimplexHeavy';src:url(./AVHersheySimplexHeavy.woff2) format('woff2');}
*{font-family:'AVHersheySimplexHeavy';font-size:20px;box-sizing:border-box;text-shadow:0 0 3px #00ff00;}
body{background:#020e02}
#a{background-image:url('cdc.jpg');background-size:cover;position:absolute;top:0;left:50%;margin-left:-600px;width:1200px;height:600px;}
#l{width:340px;height:330px;color:#84fa82;position:absolute;left:100px;top:150px;overflow:hidden;outline:none;border:none;resize:none;background:transparent}
#r{width:340px;height:330px;color:#84fa82;position:absolute;left:750px;top:140px;overflow:hidden;outline:none;border:none}
#p{width:460px;height:460px;position:absolute;left:688px;top:90px;background:transparent}
</style></head>

<body onload="h=decodeURIComponent(location.hash.slice(1));l.value=(h.length)?h:aoc;kinit(l.value)">
<div id="a"><textarea id="l"  spellcheck="false">!100</textarea><pre id="r"></pre><svg id="p"></svg></div>


<script>
let ge=x=>document.getElementById(x)
const td_=new TextDecoder("utf-8"),su=x=>td_.decode(x)
const te_=new TextEncoder("utf-8"),us=x=>te_.encode(x)

let keydown=e=>{if((e.key=="Enter")&&e.shiftKey){let x=e.target.selectionStart;
 let v=ge("l").value.split("\n"),p=0
 for(let i=0;i<v.length;i++){let s=v[i];if((x>=p)&&(x<1+p+s.length)){exec(s);break};p+=1+s.length}
 return false}}
let exec=(s)=>{K.repl(KC(s));let r=ge("r");r.scrollTo(0,r.scrollHeight)}

ge("a").onclick=e=>{if("a"==e.target.id){let s=ge("l").value;location.hash="#"+encodeURIComponent(s);kinit(s)}}
ge("l").onkeydown=keydown


let /*there be*/ K
let C=()=>new Int8Array(K.memory.buffer),I=()=>new Int32Array(K.memory.buffer),J=()=>new BigInt64Array(K.memory.buffer),F=()=>new Float64Array(K.memory.buffer),lo=x=>Number(BigInt.asUintN(32,x))
let kenv={env:{ 
 Exit:  function(x      ){},
 Args:  function(       ){return 0},
 Arg:   function(x,y    ){return 0},
 Read:  function(a,b,c  ){return -1},
 Write: function(a,b,c,d){kout(su(new Uint8Array(K.memory.buffer,c,d)));return 0},
 ReadIn:function(x,y    ){return 0},
 Native:function(x,y    ){let i=lo(x);K.dx(x);return xcal[i](K.Atx(4n,y))}}}
function kout(s){ge("r").textContent+=s}
async function kinit(s){
 ge("r").textContent="";p.innerHTML=""
 let kw;await fetch("../k.wasm").then(r=>r.arrayBuffer()).then(r=>kw=r)
 let r=await WebAssembly.instantiate(kw,kenv)
 K=r.instance.exports
 K.kinit()
 xcal=[];xreg("plot",plot)
 K.dx(K.Asn(Ks("l."),K.Atx(Ks("lxy"),K.Val(KC("44 15")))))
 K.Val(KC(ak))
 
 if("string"==typeof s)exec(s)}

let xcal=[],xreg=(name,g)=>{xcal.push(g)
 let f=K.l2(BigInt(xcal.length-1),Ks(name))       //external function representation idx-as-verb,name
 I()[(lo(f)>>>2)-3]=1                             //arity(here:monadic only)
 f=(BigInt(14)<<BigInt(59))+BigInt(lo(BigInt(f))) //type tag xf
 asn(name,f)},
KT=t=>K.Atx(K.Val(KC("+!/")),K.l2(KS(t.k),KL(t.v.map((x,i)=>("i"==t.t[i])?KI(x):("f"==t.t[i])?KF(x):KS(x))))),
KC=x=>{let r=K.mk(18,x.length  );C().set(("string"===typeof x)?us(x):x,lo(r));return r},
KF=x=>{let r=K.mk(21,x.length  );F().set(x,lo(r)>>>3);return r},
KS=x=>{let r=K.mk(20,x.length);I().set(x.map(x=>lo(Ks(x))),lo(r)>>>2);return r},
KI=x=>{let r=K.mk(19,x.length);I().set(x,lo(r)>>>2);return r},
KL=x=>{let r=K.mk(23,x.length);J().set(x,lo(r)>>>3,new BigInt64Array(x));return r},
IK=x=>{let p=lo(x)>>>2,n=K.nn(x);let r=I().slice(p,p+n);K.dx(x);return r},
FK=x=>{let p=lo(x)>>>3,n=K.nn(x);let r=F().slice(p,p+n);K.dx(x);return r},
ZK=x=>{let p=lo(x)>>>3,n=K.nn(x);let r=F().slice(p,p+2*n);K.dx(x);return r},
DK=x=>{let j=J(),p=lo(x)>>>3,r=[K.rx(j[p]),K.rx(j[1+p])];K.dx(x);return r},
Ks=x=>K.sc(KC(x)),
asn=(s,y)=>K.dx(K.Asn(Ks(s),y)),
unpkg=(x,y)=>{if(24!=K.tp(x))K.trap(1);[x,y]=DK(x);return[vec(x),vec(y)]}


// e.g. plot 3a30+?10a
let cE=x=>{return document.createElementNS("http://www.w3.org/2000/svg",x)},sA=(x,...y)=>{for(let i=0;i<y.length;i+=2)x.setAttributeNS(null,y[i],y[1+i]);return x}
let plot=x=>{if(6==K.tp(x))x=K.Atx(13n,x);if(22!=K.tp(x))return 0n;polar(ZK(x));return 0n},w=460,h=460
let polar=z=>{let svg=ge("p") /*sA(cE("svg"),"width",w,"height",w)*/ ,green="#84fa82"
 let x=z.filter((x,i)=>1==i%2),y=z.filter((x,i)=>0==i%2),r=x.map((x,i)=>Math.hypot(x,y[i])),a=r[0],rmax=niceLimits(0,r.reduce((x,y)=>Math.max(x,y)))[1],R=w/2
 let g=cE("g"),tx
 let sa=function(x,...y){for(let i=0;i<y.length;i+=2)x.setAttributeNS(null,y[i],y[1+i])}
 let ce=x=>document.createElementNS("http://www.w3.org/2000/svg",x)
 let ca=function(x,...y){let r=ce(x);sa(r,...y);g.appendChild(r);return r}
 let [se,ss]=expnum(rmax),ni=(3==se||4==se||8==se)?3:4;for(let i=0;i<ni;i++)
  ca("circle","cx",w/2,"cy",w/2,"r",(1+i)*R/(1+ni),"stroke-width",2,"stroke-dasharray","4,4","stroke",green,"fill","none")
 let r1=1*R/(1+ni),r2=ni*R/(1+ni)
 ca("line","x1",w/2-r2,"y1",w/2,"x2",w/2+r2,"y2",w/2,"stroke-width",2,"stroke",green)
 ca("circle","cx",R,"cy",R,"r",R,"stroke-width",2,"stroke",green,"fill","none")
 ca("line","x1",w/2-r2,"y1",w/2,"x2",w/2+r2,"y2",w/2,"stroke-width",2,"stroke",green)
 ca("line","x1",w/2,"y1",w/2-r2,"x2",w/2,"y2",w/2+r2,"stroke-width",2,"stroke",green)
 for(let a=30;a<360;a+=30){let sn=Math.sin(a/180*Math.PI),cs=Math.cos(a/180*Math.PI)
  if(a%90)ca("line","x1",w/2+r1*cs,"y1",w/2+r1*sn,"x2",w/2+R*cs,"y2",w/2+R*sn,"stroke-width",2,"stroke-dasharray","4,4","stroke",green)}
 tx=ca("text","x",w/2,"y",w/2-R+9,"font-size","18px","fill",green,"text-anchor","middle","alignment-baseline","hanging");tx.textContent="0"
 tx=ca("text","x",w/2+R-5,"y",w/2,"font-size","18px","fill",green,"text-anchor","end","alignment-baseline","central");tx.textContent="90"
 tx=ca("text","x",w/2,"y",w/2+R-9,"font-size","18px","fill",green,"text-anchor","middle","alignment-baseline","baseline");tx.textContent="180"
 tx=ca("text","x",w/2-R+5,"y",w/2,"font-size","18px","fill",green,"text-anchor","start","alignment-baseline","central");tx.textContent="270"
 let sc=R/rmax;for(let i=0;i<r.length;i++){
  ca("circle","cx",R+sc*x[i],"cy",R-sc*y[i],"r",6,"stroke","none","fill",green)
  ca("circle","cx",R+sc*x[i],"cy",R-sc*y[i],"r",10,"stroke-width",2,"stroke",green,"fill","none")}
 svg.appendChild(g)}
let niceLimits=(a,b)=>{let e=niceNumber(b-a,false),dx=niceNumber(e/4,true),mi=Math.floor(a/dx)*dx,ma=Math.ceil(b/dx)*dx;return[mi,ma,dx]}
let niceNumber=(x,round)=>{let e=Math.floor(Math.log10(x)),f=x/10**e,n;if(round){if(f<1.5)n=1;else if(f<3)n=2;else if(f<7)n=5;else n=10}else{if(f<=1)n=1;else if(f<=2)n=2;else if(f<=5)n=5;else n=10}return n*10**e}
let expnum=x=>{let p=Math.floor(Math.log10(x)),b=Math.round(x/10**p);if(Math.abs(x-0.3)<1e-12)return[3,"0.3"];return[b,(p>4||p<-3)?b+"e"+p:String(x)]}


const ak=String.raw`
qr:{K:!m:#*x;I:!n:#x;j:0;r:n#0a;turn:$[째Z~@*x;{(-x)@angle y};{x*1. -1@y>0}]
 while[j<n;I:1_I;r[j]:turn[s:abs@abs/j_x j;xx:x[j;j]]
  x[j;j]-:r[j];x[j;K]%:%s*(s+abs xx);x[I;K]-:{+/x*y}/[(conj x[j;K]);x[I;K]]*\x[j;K];K:1_K;j+:1];(x;r;n;m)}
solve:{qslv:{H:x 0;r:x 1;n:x 2;m:x 3;j:0;K:!m
 while[j<n;y[K]-:(+/(conj H[j;K])*y K)*H[j;K];K:1_K;j+:1]
 i:n-1;J:!n;y[i]%:r@i;while[i;j:i_J;i-:1;y[i]:(y[i]-+/H[j;i]*y@j)%r@i]
 n#y};q:$[째i~@*|x;x;qr x];$[째L~@y;qslv/[q;y];qslv[q;y]]}
dot:(+/*)\
avg:{(+/x)%0.+#x}
var:{(+/x*x:(x-avg x))%-1+#x}
std:{%var x}
mu95:{b:3.2;f:{(std x)^b};1.97*((f@_x)+f imag x)^(1%b)}
med: **|2^^
ic:{[c;s;t]n:#c;i:&c;np:n\#t;ns:n\#s;K:-1_'solve[((np^t)@\i),,(#i)#1a;(ns^s)@\i]}
unb:{[c;s;t]ns:(#c)\#s;K:ic[c;s;t];+solve[K;+ns^s]}
cnd22:{[A]A:A(+/*)\+conj A;m:a:_**A;d:_A[1;1];bb:abs A[0;1];t:.5*a+d;p:a*d-bb;%/|^%(t-s;t+s:%(t*t)-p)}
ix:{[x;a]r:solve[A:((#a)#1a;angle[1;a]);x];r,(+/r),1a*mu95(+/A*r)}
ct:{[u;t]r:solve[A:((#t)#1a;t)         ;u];r,(+/r),1a*mu95(+/A*r)}
cf:{[w;z]solve[A:((#z)#1a;angle[1%w*w;0]);z]}
cfx:{[r;w]+/r*(1;1%w*w)}
abc:{[abc;U]u:(-2\#U)^U;d:1.%abc 1;((u[0]*d*a+b)-u[1]*d*c;(u[1]*d*(c:abc 2)+b:abc 1)-u[0]*d*a:*abc)}
couple:{[ab;U](*U)-(+/U:((-2\#U)^U))*(ab 1)%0.+/ab}
convert:{z;$[0~z;y*x;y*x*(omega^z)*1a 1a90 1a180 1a270[4/8+z]]}
`.replaceAll(/째/g,"`")


let aoc=`s:"1abc2
pqr3stu8vwx
a1b2c3d4e5f
treb7uchet"
n:0+"0123456789"
+/{10/(*;*|)@\\x(&-1<x:n?0+x)}'"\\n"\\s`


</script></body></html>
