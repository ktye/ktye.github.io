<!DOCTYPE html>
<head><meta charset="utf-8">
<link rel=icon href='data:;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAACVBMVEX/AAAAAAD////KksOZAAAAMElEQVR4nGJYtWrVKoYFq1ZxMSyYhkZMgxNRXAwLpmbBCDAXSRZEgAwAGQUIAAD//+QzHr+8V1EyAAAAAElFTkSuQmCC'>
<title>k/db</title>
<!--style>body{font-family:monospace;white-space:pre}</style-->
<style>
body{margin:0;overflow:hidden}
#doc{position:absolute;top:0;margin:0;left: 0;background:#ffe;width:50vw;height:100vh;overflow:auto;border:none;outline:none}
#tty{position:absolute;top:0;margin:0;right:0;                width:50vw;height:100vh;overflow:auto}
</style>
</head>

<body>
<textarea id="doc" spellcheck="false"></textarea>
<pre id="tty">tty</pre>

<script type="module">
import {K} from '../k.js'

let tty=document.getElementById("tty")
let doc=document.getElementById("doc")

window.onkeydown=function(e){
 if((e.key=="Enter")&&(e.shiftKey==true)){
  tty.textContent=""
  K.restore()
  krep(doc.value)
  return false
}}

function init(){
 let  ext={}
 ext.init= function(){tty.textContent="ktye/k "+K.n+"\n t\n";load()}
 ext.read= function(){return new Uint8Array(0)}
 ext.write=function(f,x){if(f==="")O(new TextDecoder("utf-8").decode(x))}
 K.kinit(ext,"../k.wasm")}

function krep(s){
 try{K._.repl(K.KC(s.trim()))}catch(e){K.restore()}
 tty.scrollTo(0,tty.scrollHeight);doc.focus()}

function O(s){tty.textContent+=s;tty.textContent=tty.textContent.split("\n").slice(-30).join("\n")}

function load(){
 fetch("db").then(r=>r.text()).then(
 t=>{
  K.KA(K.Ks("db"), K.KC(t))
  let s=("t:{`id`type`year`week`day`time`dist`coords!`i``i`i`i`f`f`i$'\" \"\\:x}'-1_\"\\n\"\\:db")
  K._.repl(K.KC(s));
  K.save();krep("t")
})}

fetch("a.k").then(r=>r.text()).then(t=>doc.value=t)
init()

</script></body></html>

