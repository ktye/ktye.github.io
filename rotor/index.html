<!DOCTYPE html>
<head><meta charset="utf-8"><link rel="icon" type="image/png" sizes="16x16" href="../kelas16.png"><title>rotor</title>
<style>
*{margin:0;overflow:hidden;font-family:monospace}
svg{display:block;margin:auto}
.ln:hover{cursor:pointer}
textarea{background:#efe;border:none;outline:none}
input{width:5em}
th{text-align:left}


</style>
<body>
<svg id="svg" width="800" height="100" xmlns="http://www.w3.org/2000/svg"></svg><pre id="massprop" style="float:right"></pre>
<details id="details"><div  style="display:flex;flex-direction:row">
<div>units: <select id="units" onchange="changeunits()"><option>iso</option><option>large</option><option>medium</option><option>small</option></select></div>
<table id="nodeedit" style="display:none">
 <caption id="nodecaption" data-node="0">node</caption>
 <tr><th>disc Da</th><td><input type="number"    id="edDa" /></td><td class="unitL">m</td></tr>
 <tr><th>disc Di</th><td><input type="number"    id="edDa" /></td><td class="unitL">m</td></tr>
 <tr><th>support cx</th><td><input type="number" id="edCx" /></td><td class="unitC">N/m</td></tr>
 <tr><th>support cy</th><td><input type="number" id="edCy" /></td><td class="unitC">N/m</td></tr>
 <tr><th>unbalance</th><td><input type="number"  id="edU"  /></td><td class="unitU">kgm</td></tr>
 <tr><th>angle</th><td><input type="number"      id="edA" min="0" max="360" /></td><td>degree</td></tr>
 <tr><th>sensor direction</th><td><select        id="edSen"><option>none</option><option>x</option><option>y</option></select></td></tr>
 <tr><th>cal direction</th><td><select           id="edCal"><option>none</option><option>x</option><option>y</option></select></td></tr>
</table>
<table id="shaftedit" data-shaft="0" style="display:none">
 <caption id="shaftcaption">shaft</caption>
 <tr><th>length</th><td><input type="number"  id="edl"/></td><td class="unitL">m</td></tr>
 <tr><th>Da</th><td><input type="number"      id="edda"/></td><td class="unitL">m</td></tr>
 <tr><th>Di</th><td><input type="number"      id="eddi" /></td><td class="unitL">m</td></tr>
 <tr><th>density</th><td><input type="number" id="edrho" /></td><td class="unitR">kg/m^3</td></tr>
 <tr><th>mass</th><td><input type="number"    id="edm" /></td><td class="unitM">kg</td></tr>
</table>
<textarea id="ta" style="resize:none" onchange="modelT(this.value)" spellcheck="false"></textarea></div></details>


 


<script>

let
ge=x=>document.getElementById(x),
ce=x=>document.createElement(x),
af=x=>Array.from(x),
gc=x=>af(document.getElementsByClassName(x)),
cE=x=>document.createElementNS("http://www.w3.org/2000/svg",x),
sA=(x,...y)=>{for(let i=0;i<y.length;i+=2)x.setAttributeNS(null,y[i],y[1+i]);return x},

tamod=_=>{model.forEach(x=>{delete x.node;delete x.X;delete x.r});let v=model.map(x=>JSON.stringify(x).slice(1,-1));ta.cols=2+Math.max(...v.map(x=>x.length));ta.rows=v.length;ta.value=v.join("\n")},

modelT=x=>{try{model=JSON.parse("["+x.split("\n").map(x=>"{"+x+"}").join(",")+"]")}catch(e){};update()},

/*
node=x=>{
 let j=0,r={m:null,D:null,d:null,cx:null,cy:null,unbal:null,angle:null,sensor:null,cal:null}
 model.forEach(q=>{let t=q.type;
  if(t=="shaft")j++
  else if(j==x){
   
  }
 })
  
},
*/
shafts=m=>m.filter(x=>x.type=="shaft"),
addxnr=m=>{let n=0,X=0,r=shafts(m).map(x=>x.D/2);r.unshift(0);r.push(0);return m.map(x=>((x.type=="shaft")?(x.X=X,X+=x.L,n++,x):(x.X=X,x.node=n,x.r=Math.max(r[n],r[1+n]),x)))},
discs=m=>m.filter(x=>x.type=="disc"),
unbals=m=>m.filter(x=>x.type=="unbal"),
sensors=m=>m.filter(x=>x.type=="sensor"),
cals=m=>m.filter(x=>x.type=="cal"),
springs=m=>m.filter(x=>x.type=="spring"),

svgmod=m=>{let D=0,L=0,M=0,r="";addxnr(m);let sh=shafts(m)
 sh.forEach((x,i)=>{
  r+=`<rect x="${x.X}" y="${-x.D/2}"   width="${x.L}" height="${(x.D-x.d)/2}" fill="grey" class="ln" onclick="clickshaft(${i})"/>`
  r+=`<rect x="${x.X}" y="${x.d/2}"    width="${x.L}" height="${(x.D-x.d)/2}" fill="grey" class="ln" onclick="clickshaft(${i})"/>`
  r+=`<rect x="${x.X}" y="${(-x.d)/2}" width="${x.L}" height="${x.d}"    fill="lightgrey" class="ln" onclick="clickshaft(${i})"/>`
  r+=`<rect x="${x.X}" y="${-x.D/2}"   width="${x.L}" height="${x.D}" fill="none" stroke="black" stroke-width="2px" vector-effect="non-scaling-stroke" />`;
  D=Math.max(D,x.D);L+=x.L;M+=x.rho*area(x)*x.L})
 
                           
 sh.forEach((x,i)=>{r+=`<circle cx="${x.X}" cy="0" r="${D/10}" fill="black" class="ln" onclick="clicknode(${    i    })"/>`})
                    r+=`<circle cx="${ L }" cy="0" r="${D/10}" fill="black" class="ln" onclick="clicknode(${sh.length})"/>`
 
 D*=2
 sensors(m).forEach((x,i)=>{
  r+=`<line x1="${x.X}" y1="${-D/2}" x2="${x.X}" y2="${-1.1*x.r}"" stroke="red" stroke-width="2px" vector-effect="non-scaling-stroke" />`
  r+=`<rect x="${x.X-D/20}" y="${-D/2}" width="${D/10}" height="${D/10}" fill="lightgrey" stroke="black" stroke-width="2px" vector-effect="non-scaling-stroke" class="ln" onclick="clicknode(${x.node})"/>`
 })
 
 cals(m).forEach((x,i)=>{
  r+=`<line x1="${x.X}" y1="${D/2}" x2="${x.X}" y2="${1.1*x.r}"" stroke="green" stroke-width="2px" vector-effect="non-scaling-stroke" />`
  r+=`<rect x="${x.X-D/20}" y="${D/2-D/9.5}" width="${D/10}" height="${D/10}" fill="lightgrey" stroke="black" stroke-width="2px" vector-effect="non-scaling-stroke" class="ln" onclick="clicknode(${x.node})"/>`
 })
 
 springs(m).forEach((x,i)=>{
  r+=`<polygon points="${x.X},${x.r} ${x.X+D/20},${x.r+D/10} ${x.X-D/20},${x.r+D/10}" fill="black"/>`
 })
 
 unbals(m).forEach((x,i)=>{
  r+=`<rect x="${x.X-D/20}" y="${-x.r-D/10}" width="${D/10}" height="${D/10}" fill="black" class="ln" onclick="clicknode(${x.node})"/>`
 })
 
 let X=L+D/5
 r+=`<line x1="${X}" x2="${X+D/5}" y1="0" y2="0" stroke-width="3px" stroke="black" vector-effect="non-scaling-stroke" class="ln" onclick="addshaft()"/>`
 X+=D/10
 r+=`<line x1="${X}" x2="${X}" y1="${-D/10}" y2="${D/10}" stroke-width="3px" stroke="black" vector-effect="non-scaling-stroke" class="ln" onclick="addshaft()"/>`
 X+=D/5
 
 
 
 svg.innerHTML=r
 sA(svg,"viewBox",`0 ${-D/2} ${X} ${D}`,"preserveAspectRatio","xMidYMid")
 
 discs(model).forEach(x=>M+=x.m)
 massprop.textContent=`length ${(scL(L)).toPrecision(6)} ${uni("L")[0]}\nmass   ${scM(M).toPrecision(6)} ${uni("M")[0]}`
},
area=x=>0.25*Math.PI*(x.D*x.D-x.d*x.d),

clicknode=i=>{details.open=true;shaftedit.style.display="none";nodeedit.style.display="block";console.log("todo.. click node",i)},
clickshaft=i=>{details.open=true;shaftedit.style.display="block";nodeedit.style.display="none";
 let sh=shafts(model),e=sh[i];edl.value=scL(e.L);edda.value=scL(e.D);eddi.value=scL(e.d);edrho.value=scR(e.rho);edm.value=scM(e.rho*area(e)*e.L)
},
changeunits=()=>{if(shaftedit.style.display=="block")clickshaft(+shaftedit.dataset.shaft)
 gc("unitL").forEach(x=>x.textContent=uni("L")[0])
 gc("unitM").forEach(x=>x.textContent=uni("M")[0])
 gc("unitR").forEach(x=>x.textContent=uni("R")[0])
 gc("unitU").forEach(x=>x.textContent=uni("U")[0])
 update()
}
addshaft=_=>{let v=shafts(model);model.push({...v[v.length-1]});update()},

update=_=>{svgmod(model);tamod(model)},

uni=x=>{let t={
  iso:   {M:["kg",1],  L:["m",1],   R:["kg/m^3",1],U:["kgm",1],   C:["N/m",1]},
  large: {M:["t",1e-3],L:["mm",1e3],R:["kg/m^3",1],U:["kgm",1],   C:["N/µm",1e-6]},
  medium:{M:["kg",1],  L:["mm",1e3],R:["kg/m^3",1],U:["gmm",1e6], C:["N/µm",1e-6]},
  small: {M:["g",1e3], L:["mm",1e3],R:["kg/m^3",1],U:["mgmm",1e9],C:["N/µm",1e-6]}
 };return t[units.value][x]},
scL=x=>x*uni("L")[1],scM=x=>x*uni("M")[1],scR=x=>x*uni("R")[1],scU=x=>x*uni("M")[1],scC=x=>x*uni("M")[1],

model=[
 {type:"spring",cx:1000,cy:1000},
 {type:"shaft",L:0.020,D:0.010,d:0.005,rho:7850},
 {type:"spring",cx:1000,cy:1000},
 {type:"shaft",L:0.020,D:0.015,d:0.005,rho:7850},
 {type:"disc",m:0.2,D:0.010,d:0.005},
 {type:"unbal",u:15,a:30},
 {type:"sensor",dir:"xy"},
 {type:"cal",dir:"x"},
]

units.value="medium";changeunits()

</script>
</body></html>