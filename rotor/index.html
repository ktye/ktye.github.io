<!DOCTYPE html>
<head><meta charset="utf-8"><link rel="icon" type="image/png" sizes="16x16" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAE0lEQVR42mNk+M+AFzCOKhhJCgBrLxABLz0PwwAAAABJRU5ErkJggg=="><title>rotor</title>
<style>
*{margin:0;overflow:hidden;font-family:monospace}
svg{display:block;margin:auto}
svg:focus{outline:none}
.ln:hover{cursor:pointer}
.ul{border-bottom:1px solid}
table{border-collapse:collapse}
textarea{background:#efe;border:none;outline:none}
input{width:5em}
th{text-align:left}



</style>
<body>
<svg id="svg" width="800" height="200" xmlns="http://www.w3.org/2000/svg" onkeydown="svgkey(event)" tabindex="0"></svg>
<table style="float:right"><caption>legend</caption>
<tr><th>●</th><td>node</td></tr>
<tr><th>¦</th><td>mass/disc element</td></tr>
<tr><th>■</th><td>unbalance</td></tr>
<tr><th>▲</th><td>isotropic bearing</td></tr>
<tr><th>△</th><td>anisotropic bearing</td></tr>
<tr><th>◺</th><td>support (x-only)</td></tr>
<tr><th>◿</th><td>support (y-only)</td></tr>
<tr><th>⧅</th><td>sensor x-direction</td></tr>
<tr><th>⧄</th><td>sensor y-direction</td></tr>
<tr><th style="color:red">|</th><td>sensor for monitor only</td></tr>
<tr class="ul"><th style="color:green">|</th><td>sensor for balancing</td></tr>
<tr><th>length</th><td id="rotorlength"></td></tr>
<tr><th>mass</th><td id="rotormass"></td></tr>
</table>
<pre id="massprop" ></pre>
<details id="details"><div  style="display:flex;flex-direction:row">
<div>units: <select id="units" onchange="changeunits()"><option>iso</option><option>large</option><option>medium</option><option>small</option></select></div>
<table id="nodeedit" data-i="0" style="display:none">
 <caption id="nodecaption" data-i="0">node</caption>
 <tr><th>disc Da</th><td><input type="number"    id="edDa" onchange='ed(this,"D","L","disc")' /></td><td class="unitL">m</td></tr>
 <tr><th>disc Di</th><td><input type="number"    id="edDi" onchange='ed(this,"d","L","disc")' /></td><td class="unitL">m</td></tr>
 <tr class="ul"><th>mass</th><td><input type="number"       id="edM"  onchange='ed(this,"m","M","disc")' /></td><td class="unitM">kg</td></tr>
 <tr><th>support cx</th><td><input type="number" id="edCx" onchange='ed(this,"cx","C","spring")' /></td><td class="unitC">N/m</td></tr>
 <tr class="ul"><th>support cy</th><td><input type="number" id="edCy" onchange='ed(this,"cy","C","spring")' /></td><td class="unitC">N/m</td></tr>
 <tr><th>unbalance</th><td><input type="number"  id="edU"  onchange='ed(this,"u","U","unbal")' /></td><td class="unitU">kgm</td></tr>
 <tr class="ul"><th>angle</th><td><input type="number"      id="edA"  onchange='ed(this,"a","","unbal")' min="0" max="360" /></td><td>deg</td></tr>
 <tr><th>sensor direction</th><td><select        id="edSen" onchange='ed(this,"sen")'><option>none</option><option>x</option><option>y</option><option>xy</option></select></td></tr>
 <tr><th>cal direction</th><td><select           id="edCal" onchange='ed(this,"cal")'><option>none</option><option>x</option><option>y</option><option>xy</option></select></td></tr>
</table>
<table id="shaftedit" data-i="0" style="display:none">
 <caption id="shaftcaption">shaft</caption>
 <tr><th>length</th><td><input type="number"  id="edl"   onchange='ed(this,"L","L")' /></td><td class="unitL">m</td></tr>
 <tr><th>Da</th><td><input type="number"      id="edda"  onchange='ed(this,"D","L")' /></td><td class="unitL">m</td></tr>
 <tr><th>Di</th><td><input type="number"      id="eddi"  onchange='ed(this,"d","L")' /></td><td class="unitL">m</td></tr>
 <tr><th>density</th><td><input type="number" id="edrho" onchange='ed(this,"rho","R")'  /></td><td class="unitR">kg/m^3</td></tr>
 <tr><th>mass</th><td><input type="number"    id="edm"   onchange='ed(this,"m","M")' /></td><td class="unitM">kg</td></tr>
 <tr><td><button onclick="splitshaft()">split into</button></td><td><input id="splitinto" type="number" min="2" max="20" value="2"></td></tr>
</table>
<textarea id="ta" style="resize:none" onchange="modelT(this.value)" spellcheck="false"></textarea></div></details>



<script>

let
ge=x=>document.getElementById(x),
ce=x=>document.createElement(x),
af=x=>Array.from(x),
gc=x=>af(document.getElementsByClassName(x)),
cE=x=>document.createElementNS("http://www.w3.org/2000/svg",x),
sA=(x,...y)=>{for(let i=0;i<y.length;i+=2)x.setAttributeNS(null,y[i],y[1+i]);return x},


tamod=_=>{ let v=fmt(model.map(x=>JSON.stringify(x).slice(1,-1).replaceAll(`"`,"").replaceAll(","," "))) ;ta.cols=2+Math.max(...v.map(x=>x.length));ta.rows=v.length;ta.value=v.join("\n")},
modelT=x=>{try{model=JSON.parse("["+x.split("\n").map(x=>"{"+x.replace(/ +/g,",").replace(/[a-zA-Z]+/g,x=>'"'+x+'"')+"}").join(",")+"]")}catch(e){};update()},
fmt=v=>{v.forEach((x,i)=>{v[i]=x.split(" ");v[i].push(..." ".repeat(9-v[i].length).split(""))});let col=j=>v.map(x=>x[j]);for(let j=0;j<v[0].length;j++){let c=col(j),m=Math.max(...c.map(x=>x.length));v.forEach((x,i)=>v[i][j]+=" ".repeat(m-x[j].length)) };return v.map((x,i)=>v[i]=x.join(" "))},

shafts=m=>m.filter((_,i)=>i%2),nodes =m=>m.filter((_,i)=>(1+i)%2),
discs=m=>nodes(m).filter(x=>x.D!=0),springs=m=>nodes(m).filter(x=>x.cx!=0&&x.cy!=0),unbals=m=>m.filter(x=>x.u!=0),sensors=m=>nodes(m).filter(x=>x.sen!="none"),cals=m=>nodes(m).filter(x=>x.cal!="none"),

svgmod=(m,a)=>{let D=0,L=0,M=0,X=[0],r="";let sh=shafts(m);svg.dataset.i=a
 sh.forEach((x,i)=>{let st=(a==1+2*i)?"darkorange":"black"; let xi=L;
  r+=`<rect x="${xi}" y="${-x.D/2}"   width="${x.L}" height="${(x.D-x.d)/2}" fill="grey" class="ln" onclick="clickshaft(${1+2*i})"/>`
  r+=`<rect x="${xi}" y="${x.d/2}"    width="${x.L}" height="${(x.D-x.d)/2}" fill="grey" class="ln" onclick="clickshaft(${1+2*i})"/>`
  r+=`<rect x="${xi}" y="${(-x.d)/2}" width="${x.L}" height="${x.d}"    fill="lightgrey" class="ln" onclick="clickshaft(${1+2*i})"/>`
  r+=`<rect x="${xi}" y="${-x.D/2}"   width="${x.L}" height="${x.D}" fill="none" stroke="${st}" stroke-width="2px" vector-effect="non-scaling-stroke" />`;
  D=Math.max(D,x.D);L+=x.L;M+=x.rho*area(x)*x.L;X.push(X[i]+x.L)})
 
 sh.forEach((x,i)=>{
  r+=`<circle cx="${X[i]}" cy="0" r="${D/10}" fill="black" stroke="${(a==(    2*i    ))?"darkorange":"black"}" stroke-width="2px" vector-effect="non-scaling-stroke" class="ln" onclick="clicknode(${   2*i     })"/>`})
  r+=`<circle cx="${  L }" cy="0" r="${D/10}" fill="black" stroke="${(a==(2*sh.length))?"darkorange":"black"}" stroke-width="2px" vector-effect="non-scaling-stroke" class="ln" onclick="clicknode(${2*sh.length})"/>`
 
 D=(8*D<L)?L/4:2*D
 nodes(m).forEach((x,i)=>{let xi=X[i],xr=Math.max(x.D,i?m[2*i-1].D:0,(2*i+1<m.length)?m[2*i+1].D:0)/2;
  if(x.m!=0){ //discs
   r+=`<line x1="${xi}" y1="${-x.D/2}" x2="${xi}" y2="${-x.d/2}" stroke="black" stroke-width="7px" vector-effect="non-scaling-stroke" class="ln" onclick="clicknode(${2*i})"/>`
   r+=`<line x1="${xi}" y1="${ x.D/2}" x2="${xi}" y2="${ x.d/2}" stroke="black" stroke-width="7px" vector-effect="non-scaling-stroke" class="ln" onclick="clicknode(${2*i})"/>`}
  if(x.sen!="none"){ //sensors
   r+=`<line x1="${xi}" y1="${-D/2}" x2="${xi}" y2="${-1.1*xr}"" stroke="red" stroke-width="2px" vector-effect="non-scaling-stroke" />`
   r+=`<rect x="${xi-D/20}" y="${-D/2}" width="${D/10}" height="${D/10}" fill="lightgrey" stroke="black" stroke-width="2px" vector-effect="non-scaling-stroke" class="ln" onclick="clicknode(${2*i})"/>`
   if(x.sen.includes("x"))r+=`<line x1="${xi-D/20}" y1="${-D/2}" x2="${xi+D/20}" y2="${D/10-D/2}" stroke="black" stroke-width="2px" vector-effect="non-scaling-stroke" />`
   if(x.sen.includes("y"))r+=`<line x1="${xi+D/20}" y1="${-D/2}" x2="${xi-D/20}" y2="${D/10-D/2}" stroke="black" stroke-width="2px" vector-effect="non-scaling-stroke" />`}
  if(x.cal!="none"){ //cals
   r+=`<line x1="${xi}" y1="${D/2}" x2="${xi}" y2="${1.1*xr}"" stroke="green" stroke-width="2px" vector-effect="non-scaling-stroke" />`
   r+=`<rect x="${xi-D/20}" y="${D/2-D/9.5}" width="${D/10}" height="${D/10}" fill="lightgrey" stroke="black" stroke-width="2px" vector-effect="non-scaling-stroke" class="ln" onclick="clicknode(${2*i})"/>`
   if(x.cal.includes("x"))r+=`<line x1="${xi-D/20}" y1="${D/2-D/9.5}" x2="${xi+D/20}" y2="${D/2}" stroke="black" stroke-width="2px" vector-effect="non-scaling-stroke" />`
   if(x.cal.includes("y"))r+=`<line x1="${xi+D/20}" y1="${D/2-D/9.5}" x2="${xi-D/20}" y2="${D/2}" stroke="black" stroke-width="2px" vector-effect="non-scaling-stroke" />`}
  if(x.cx!=0||x.cy!=0){ //springs 
   let st=((x.cx==x.cy)?'fill="black"':'fill="none" stroke="black" stroke-width="2px" vector-effect="non-scaling-stroke"')
   if(x.cx!=0)r+=`<polygon points="${xi},${xr} ${xi+D/20},${xr+D/10} ${xi},${xr+D/10}" ${st} class="ln" onclick="clicknode(${2*i})"/>`
   if(x.cy!=0)r+=`<polygon points="${xi},${xr} ${xi},${xr+D/10} ${xi-D/20},${xr+D/10}" ${st} class="ln" onclick="clicknode(${2*i})"/>`}
  if(x.u!=0)r+=`<rect x="${xi-D/20}" y="${-xr-D/10}" width="${D/10}" height="${D/10}" fill="black" class="ln" onclick="clicknode(${2*i})"/>` //unbals
 })
 
 X=L+D/5
 r+=`<line x1="${X}" x2="${X+D/5}" y1="0" y2="0" stroke-width="3px" stroke="black" vector-effect="non-scaling-stroke" class="ln" onclick="addshaft()"/>`
 X+=D/10
 r+=`<line x1="${X}" x2="${X}" y1="${-D/10}" y2="${D/10}" stroke-width="3px" stroke="black" vector-effect="non-scaling-stroke" class="ln" onclick="addshaft()"/>`
 X+=D/5
 
 svg.innerHTML=r
 sA(svg,"viewBox",`0 ${-D/2} ${X} ${D}`,"preserveAspectRatio","xMidYMid")
 
 discs(model).forEach(x=>M+=x.m)
 rotorlength.textContent=`${scL(L).toPrecision(6)} ${uni("L")[0]}`
 rotormass.textContent  =`${scM(M).toPrecision(6)} ${uni("M")[0]}`
},
area=x=>0.25*Math.PI*(x.D*x.D-x.d*x.d),

emptynode=_=>{return{m:0,D:0,d:0,cx:0,cy:0,u:0,a:0,sen:"none",cal:"none"}},
clicknode=i=>{details.open=true;shaftedit.style.display="none";nodeedit.style.display="block";nodecaption.textContent="element "+i+" (node)";nodeedit.dataset.i=i;svgmod(model,i)
 af([edDa,edDi,edM,edCx,edCy,edU,edA]).forEach(x=>x.value=null);edSen.value="none";edCal.value="none"
 let e=model[i];edDa.value=scL(e.D);edDi.value=scL(e.d);edM.value=scM(e.m);edCx.value=scC(e.cx);edCy.value=scC(e.cy);edU.value=scU(e.u);edA.value=e.a;edSen.value=e.sen;edCal.value=e.cal},
clickshaft=i=>{details.open=true;shaftedit.style.display="block";nodeedit.style.display="none"; shaftcaption.textContent="element "+i+" (shaft)";shaftedit.dataset.i=i;svgmod(model,i)
 let e=model[i];edl.value=scL(e.L);edda.value=scL(e.D);eddi.value=scL(e.d);edrho.value=scR(e.rho);edm.value=scM(e.rho*area(e)*e.L)},
changeunits=()=>{if(shaftedit.style.display=="block")clickshaft(+shaftedit.dataset.i);else clicknode(+nodeedit.dataset.i);"LMRCU".split("").forEach(x=>gc("unit"+x).forEach(e=>e.textContent=uni(x)[0]))},
addshaft=_=>{let n=model.length; model.push({...model[n-2]},emptynode());clickshaft(model.length-2)},
delelem=i=>{ if(0==i%2){model[i]=emptynode();return update(i)};if(i==0||model.length<4)return; model.splice(i-1,2); update(model.length-2)},
ed=(inp,s,u,g)=>{let c=1/((""!=u)?uni(u)[1]:1),t=inp.closest("table"),i=+t.dataset.i,v=c*(+inp.value),e=model[i];if("shaftedit"==t.id){if(s=="mass"){s="rho";v=v/area(e)*e.L};e[s]=v;clickshaft(i)}else{e[s]=v;clicknode(i)}update(i)},

update=x=>{if(x%2)clickshaft(x);else clicknode(x);tamod(model)},
splitshaft=_=>{let i=+shaftedit.dataset.i,n=+splitinto.value;if(n<2||n>100)return;let sh=model[i];sh.L/=n;while(--n>0){console.log("n",n); model.splice(i,0,{L:sh.L,D:sh.D,d:sh.d,rho:sh.rho},emptynode()  )};update(i)},
svgkey=e=>{if(e.key=="Delete")delelem(+svg.dataset.i)},

uni=x=>{let t={
  iso:   {M:["kg",1],  L:["m",1],   R:["kg/m^3",1],U:["kgm",1],   C:["N/m",1]},
  large: {M:["t",1e-3],L:["mm",1e3],R:["kg/m^3",1],U:["kgmm",1e3],C:["N/µm",1e-6]},
  medium:{M:["kg",1],  L:["mm",1e3],R:["kg/m^3",1],U:["gmm",1e6], C:["N/µm",1e-6]},
  small: {M:["g",1e3], L:["mm",1e3],R:["kg/m^3",1],U:["mgmm",1e9],C:["N/µm",1e-6]}
 };return t[units.value][x]},
scL=x=>x*uni("L")[1],scM=x=>x*uni("M")[1],scR=x=>x*uni("R")[1],scU=x=>x*uni("U")[1],scC=x=>x*uni("C")[1],

model=[
 {m:0,D:0,d:0,cx:1000,cy:1000,u:0,a:0,sen:"none",cal:"none"},
 {L:0.020,D:0.010,d:0.005,rho:7850},
 {m:0,D:0,d:0,cx:1000,cy:1000,u:0,a:0,sen:"none",cal:"none"},
 {L:0.020,D:0.015,d:0.005,rho:7850},
 {m:0.2,D:0.010,d:0.005,cx:0,cy:0,u:15,a:30,sen:"xy",cal:"x"}
]

units.value="medium";update(0);changeunits()

</script>
</body></html>