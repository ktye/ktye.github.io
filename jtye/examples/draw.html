<!DOCTYPE html>
<head><meta charset="utf-8">
<link rel=icon href="../../kelas16.png"><title>jtye/draw</title>
<style>*{font-family:monospace;font-size:large}canvas{background:#ccc;margin:auto;display:block}</style>
</head>

<body onload="eval(parse(k.textContent))">
<select id="mode" onchange="draw()">
 <option value="ellipse" selected>ellipse(95%)</option>
 <option value="hull">convex hull</option>
</select><button onclick="reset()">reset</button> click on canvas to add points
<canvas id="cnv" width="600" height="600"></canvas>
<hr/><pre id="src"></pre>

<script src="../k.js"></script>
<script src="../parse.js"></script>
<script>
ctx=cnv.getContext("2d");ctx.strokeStyle="darkred";ctx.lineWidth=3;
clear=()=>ctx.clearRect(0,0,cnv.width,cnv.height)
points=(y,x)=>x.forEach((x,i)=>{ctx.beginPath();ctx.arc(x,y[i],5,0,6.2832);ctx.fill()})
ellipse=(a,ry,rx,y,x)=>{ctx.beginPath();ctx.ellipse(x,y,rx,ry,a,0,6.2832);ctx.stroke()}
</script>
<script id="k" type="text/k">

avg:{(+/x)%#x}
av1:{(+/x)%-1+#x}
cov:{|av1'(x*y;*x-:avg x;*y-:avg y)}
eig:{(xx;yy;xy):x;(m+s;m-s:%(*m:(.5*xx+yy))-(xx*yy)-*xy)}

(X;Y):200+2^_200*?4
reset:{X::2#X;Y::2#Y;draw[]}

cnv.addEventListener[{[e]X,:e.offsetX;Y,:e.offsetY;draw 0};"click"]
draw:{clear 0;points[X;Y];
 (ex;ey):eig(xx;yy;xy):cov[X;Y]
 a:.5*Math.atan2[xx-yy;2*xy]
 $[`"hull"==mode.value`;polygon todo;ellipse[avg X;avg Y;2.448*%ex;2.448*%ey;1.57-a]]}
draw[]


hull:{
 !Y=Y@@<Y /.. startpoint lowest Y or X(if Y is equal)
}

src.textContent:k.textContent

</script>

<script>
//click=e=>console.log(e)
</script>
</body></html>