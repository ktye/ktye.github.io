<!DOCTYPE html>
<head><meta charset="utf-8">
<link rel=icon href="../../kelas16.png"><title>jtye/draw</title>
<style>*{font-family:monospace;font-size:large}canvas{background:#ccc;margin:auto;display:block}</style>
</head>

<body onload="eval(parse(k.textContent))">
<select id="mode" onchange="draw()">
 <option value="elli" selected>ellipse(95%)</option>
 <option value="hull">convex hull</option>
</select><button onclick="reset()">reset</button> click on canvas to add points
<canvas id="cnv" width="600" height="600"></canvas>
<hr/><pre id="src"></pre>

<script src="../k.js"></script>
<script src="../parse.js"></script>
<script id="k" type="text/k">


avg:{(+/x)%#x}
av1:{(+/x)%-1+#x}
cov:{|av1'(x*y;*x-:avg x;*y-:avg y)}
eig:{(xx;yy;xy):x;(m+s;m-s:%(*m:(.5*xx+yy))-(xx*yy)-*xy)}
hyp:Math.hypot

(X;Y):200+2^_200*?4

ctx:cnv.getContext[0;"2d"];ctx.strokeStyle:"darkred";ctx.lineWidth:3
clear:{ctx.clearRect[cnv.height;cnv.width;0;0]}
point:{ctx.beginPath[];ctx.arc[6.2832;0;5;y;x];ctx.fill[]}
ellip:{[x;y;rx;ry;a]ctx.beginPath[];ctx.ellipse[6.2832;0;a;ry;rx;y;x];ctx.stroke[]}
reset:{X::2#X;Y::2#Y;draw[]}

elli:{(ex;ey):eig(xx;yy;xy):cov[X;Y];a:.5*Math.atan2[xx-yy;2*xy];ellip[avg X;avg Y;2.448*%ex;2.448*%ey;1.57-a]}
hull:{
 i:0,i@@<X i:!Y=@Y@<Y   /startpoint(lowest Y then X)
 X[i]:X[|i];Y[i]:Y[|i]  /exchange 0 with startpoint                            
 cross:{[o;i;j]xi:(X i)-X o;yi:(Y i)-Y o;xj:(X j)-X o;yj:(Y j)-Y o;$[0~a:(xi*yj)-xj*yi; hyp[xi;yi]<hyp[xj;yj];a]}
 i:sort[cross[0;;];!#X]      /sort by cross product with point 0
 X::X i;Y::Y i
 /..
}

/stack = append(stack, points[0], points[1])
/i := 2
/for i < len(points) {
/	pi := points[i]
/	p0 := stack[len(stack)-2]
/	p1 := stack[len(stack)-1]
/	if cross(p0, p1, pi) > 0 {
/		stack = append(stack, pi)
/		i++
/	} else if len(stack) == 2 {
/		stack[1] = pi
/		i++
/	} else {
/		stack = stack[:len(stack)-1]
/	}
/}
/Polygon(stack)



cnv.addEventListener[{[e]X,:e.offsetX;Y,:e.offsetY;draw 0};"click"]
draw:{clear[];point'[X;Y];window[mode.value][]}
draw[]



src.textContent:k.textContent

</script>

<script>
//click=e=>console.log(e)
</script>
</body></html>