<!DOCTYPE html>
<html><head><meta charset="utf-8"><title>xk</title>
<link rel="icon" type="image/png" sizes="16x16" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAArlBMVEUAAADxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSrxWSr///9FC+4XAAAAOHRSTlMAAGtt5IqV8W/ECCDi9vL7bONgNbSdBxfObgmRGgaMCg74CwVT7Y03d/3luA+9yC1fefTN0vnJ33qXflUAAAABYktHRDnXAJVAAAAAB3RJTUUH4wgfDRgVgxAgZQAAAHtJREFUGNNjYGBgZLKAAiZGBhDAFGBmYWVjRxbg4OTi5sEU4OXjF0ASEOQTEhbhQBYQFROXkIQLSHFLy8jKWSC0yIspMHIoIhmqxKjMqKKKJCCvoKbOqKGJbIuWto6OLtxQPXF9Fn4DMUNmqICAkbGJqQWLmTlOz6EIAABSBhJTH3DcmAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0wOC0zMVQxMzoyNDoyMSswMjowMB9Ymt4AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMDgtMzFUMTM6MjQ6MjErMDI6MDBuBSJiAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC">
<style>

*{font-family:monospace;box-sizing:border-box}
html,body{margin:0;padding:0}
body{width:100vw;height:100vh;display:flex;flex-direction:column;overflow:hidden}
option{margin:0;padding:0;min-height:1em}
table{border-collapse:collapse}
.head{background:black;color:white}
.link:hover{cursor:pointer}
.pointer:hover{cursor:pointer}
.bold{font-weight:bold}
.large{font-size:large}
.red{background:red}
input:read-only{color:grey;font-style:italic}
#sel{border:none;outline:none;/*background:#ffe*/;flex-grow:1;text-align:right}
#list{border-top:none;border-right:none;border-radius:0;outline:none;width:100%;height:100%;overflow-x:auto;overflow-y:auto;background:#fcfcfc}
#pcap{width:100%;min-height:50px;outline:none;border:none;border-radius:0;overflow:auto}
#L{border-right:1px solid;resize:horizontal;overflow-x:none;overflow-y:auto;min-width:10vw;max-width:90vw}
#R{height:calc(100vh - 3.25em);right:0;min-width:10vw;background:#fcfcfc}
#F{width:100vw;display:flex}
#E{background:orange;margin:0}
#O{background:#f8f8f8;margin:0;max-height:30vh;overflow:auto}
#P{resize:vertical;width:100%;height:60%;min-height:10vh;max-height:90vh;overflow:hidden;border-bottom:1px solid}
#B{background:black;color:white;border:2px solid black;outline:none;flex-grow:1;text-align:right;font-size:large}

</style></head><body onload="init()">
<div id="T" class="large"><div id="but" style='display:flex;gap:0.5em'><span class="link" style="margin-left:auto"><span onclick="bundle()">save </span><span id="kbut" onclick="showed(1)" ondblclick="showed(2)">x.k</span></span></div></div>
<div style="flex-grow:1;display:grid;grid-template-columns:auto 1fr">
 <div id="L">
  <select id="list" multiple oncontextmenu="listedit(event)" ondblclick="listedit(event)" onchange="listchange(event)" onkeydown="listkey(event)"></select>
  <div id="dict" style="display:none">abc</div>
 </div>
 <div id="R">
  <div id="D"></div>
  <pre id="E"></pre>
  <pre id="O" oncontextmenu="khid(event)"></pre>
  <div id="P"><canvas id="pcnv" style="width:100%;height:100%"></canvas></div>
  <select id="pcap" multiple oncontextmenu="copycap(event)">
  </select>
 </div>
</div>
<div id="F">
 <div id="foot" style="display:flex;gap:0.5em;flex-grow:1" class="large head"><span id="newtab" class="link" onclick="newtable()">+</span><input id="sel" onchange='kinit("#selec#")' class="large head"/></div>
 <div style="display:flex;flex-grow:1"><input id="B" onkeyup="kkey(event)"/>
  <span id="bac" class="large link" style="display:none;padding-top:2px;background:black;color:white">◀</span><!--class link, color white when active, or use ◁▷-->
  <span id="fwd" class="large link" style="display:none;padding-top:2px;background:black;color:white;padding-left:0.2em;padding-right:0.2em">▶</span>
 </div>
</div>
<a id="dl" style="display:none"></a>

<div id="edt" style="position:absolute;left:0;top:0;width:100vw;height:100vh;z-index:1;display:none"><textarea id="ed" wrap="off" style="left:0;top:0;width:100%;height:100%;resize:none;border:none;outline:none" spellcheck="false" onchange="kinit()" oncontextmenu="pd(event);edmark(7)">
/leading comments in x.k show up as help text
/click on the example functions in the top row:
/ rowcount: show number of rows from table A
/ countsel: show the number of selected rows (once clicked it's re-evaluated after each new selection)
/ xy      : plot a column as a timeseries in an xy diagram and the moving average as a second line.
/           it returns a dict with statistics shown below the plot.
/ square  : keep the axes square
/ polar   : plot complex values in a polar diagram. only selected rows are included. update the plot by selecting other rows.
/ ampang  : shows amplitude/phase and a polar diagram side-by-side
/ tby     : plot table with lines grouped by class, returns an aggregated keytable
/click or double-click on x.k to edit code

mavg:{(y-(-#y)#(-x)_y:+\y)%x}
mmax:{while[x-:1;y:{x|(*x),-1_x}y];y}
mmin:{while[x-:1;y:{x&(*x),-1_x}y];y}
avg:{(+/x)%0.+#x}
var:{(+/x*x:(x-avg x))%-1+#x}
std:{%var x}
med: **|2^^
r95:{1.97*(((std@_x)^b)+(std imag x)^b)^1%b:3.2}

/least squares, e.g.  A:(3 5 -8 12.;-2 3 3 0.;7 -8 2 1.);b:dot[+A;x:1 2 3];0.00001>|/abs x-solve[A;b]   /A:list of columns
dot:  (+/*)\
qr:   {K:!m:#*x;I:!n:#x;j:0;r:n#0a;turn:$[`Z~@*x;{(-x)@angle y};{x*1. -1@y>0}];while[j<n;I:1_I;r[j]:turn[s:abs@abs/j_x j;xx:x[j;j]];x[j;j]-:r[j];x[j;K]%:%s*(s+abs xx);x[I;K]-:{+/x*y}/[(conj x[j;K]);x[I;K]]*\x[j;K];K:1_K;j+:1];(x;r;n;m)}
solve:{qslv:{H:x 0;r:x 1;n:x 2;m:x 3;j:0;K:!m;while[j<n;y[K]-:(+/(conj H[j;K])*y K)*H[j;K];K:1_K;j+:1];i:n-1;J:!n;y[i]%:r@i;while[i;j:i_J;i-:1;y[i]:(y[i]-+/H[j;i]*y@j)%r@i];n#y};q:$[`i~@*|x;x;qr x];$[`L~@y;qslv/[q;y];qslv[q;y]]}

hist:{plot'(`bar;(x;(#'=x'y)@!#x))}
tplot:{[d;c;t]{[i]plot t plot``,c plot i;{plot@.(c i)#x}'d}'!#c;d}  /todo(maybe better): tplot[`group; ( (`x`y;`xlabel`ylabel`title); (,`vel;`polar;``velocity;,20); ) ]

/dp:p-avg p:A`pressure;A:(`dp_A),'+`dp!,dp;store`A  /a dependend column is recalculated on each button click

/these functions are displayed as buttons in the ui:
xkrowcount:{[]"table A has ",($#A)," rows"}
xkcountsel:{[]"number of selected rows: ",($#Asel)," (change selection to update)"}

/           plot two lines: plot(x;y0;y1)     ;     symbols are labels            ;axis limits   ; returned dict is shown in a listbox
xkxy:      {[]plot(1000;t;mavg[10]t:A`temp);plot`seconds`temperature`timeseries;plot 0 1 20 25;`min`max`average`median!(&/;|/;avg;med)@\t}
xksquare:  {[]plot`square;xkxy[]}                             /plot type square is like xy, but keeps axis in a square box.
xkenvelope:{[]plot'(`envelope;(100000;(0.1*?-#t)+(sin 0.01*t)+cos t:.1*!100000);`samples`y`"timeseries envelope(min/max reduction)");"envelope fills a downsampled min/max polygon if there are more then 512 points\nzoom will resample"}
xkbar:     {[]plot'(`bar;    (1 2 3 4 5;10 2 5 11 1;2 3 2 1 7;1 2 3 4 5);`class`count`"bar plot")}
xkstack:   {[]plot'(`stacked;(1 2 3 4 5;10 2 5 11 1;2 3 2 1 7;1 2 3 4 5);`class`count`"stacked bar plot")}
xkhist:    {[]hist[0.1*!40;abs@?10000a];plot```"rayleigh distribution"}
xkpolar:   {[]plot v:A[Asel]`vel;`<"select values from the list to update";`offset`r95!(avg v;r95 v)}   /plot`polar is implicit if data is complex
xkampang:  {[]x:0.02*!n:123;y0:2a30%1-0.5a90+x*x;y1:y0*1.1a15;plot'((x;y0);(x;y1);1;`polar;(x;y0;y1));"amplitude/angle and polar diagram"}
xktby:     {[]`<"select rows from the keytable below the plot to highlight lines";avg'tplot[`class?A;`temp`pressure`vel;`xy`xy`polar]}

/init is called when the page loads and can create tables.
init:{[]n:1078;A:+`class`temp`pressure`vel!(`a`b`c`d n?4;22.7+?n;1002+_10*?n;10.23a33+?0a+n);store`A}

</textarea></div><button id="edx" class="large" style="position:absolute;right:0;top:20px;border-radius:20px;background:aliceblue;z-index:2;display:none" onclick="showed(0)">✖</button>

<script src="plot.js" id="pjs"></script>
<script>



let ge=x=>document.getElementById(x),ce=x=>document.createElement(x),ac=(x,y)=>{x.appendChild(y);return y},cl=(x,y)=>{y.classList.add(...x.split(" "));return y},tc=(x,y)=>{y.textContent=x;return y},id=(x,y)=>{y.id=x;return y},oc=(f,x)=>{x.onclick=f;return x}
let pd=(e)=>{if(e){e.preventDefault();e.stopPropagation()}},rm=(p)=>{while(p.firstChild)p.removeChild(p.firstChild);return p},rm1=p=>{while(p.children.length>1)p.removeChild(p.firstChild);return p},af=Array.from,lo=x=>Number(BigInt.asUintN(32,x)),fe=(x,f)=>{fetch(x).then(r=>r.text()).then(f)}
let su=x=>t_.decode(x),t_=new TextDecoder("utf-8"),us=x=>_t.encode(x),_t=new TextEncoder("utf-8")
let s64u=u=>{let c=function(x){let r='';for(let i=0;i<x.length;i++)r+=String.fromCharCode(x[i]);return r};return btoa(c(u))},u64s=s=>{let c=function(x){const r=new Uint8Array(x.length);for(let i=0;i<x.length;i++)r[i]=x.charCodeAt(i);return r};return c(atob(s))}

let plotjsrc=null,kw=null,kw64=null,xk64=null
let plot=plotjs.plots,list=ge("list"),head=ge("head"),foot=ge("foot"),sel=ge("sel"),ed=ge("ed"),edt=ge("edt"),but=ge("but"),E=ge("E"),O=ge("O"),pcnv=ge("pcnv"),pcap=ge("pcap"),L=ge("L"),R=ge("R"),T=ge("T"),P=ge("P")
let init=_=>{if(ge("pjs").textContent=="")fe("plot.js",x=>plotjsrc=x);
 addtable(parsetable("A","id temp pressure vel \ns f i r a\n3 27.5 1002 2.1 33")) //overwritten by init()
 if(xk64){rbin(u64s(xk64).buffer);kinit()}else kinit("#init#")}
 
window.ondragover=e=>pd(e);window.ondrop=e=>{pd(e);let l=e.dataTransfer.files;for(let i=0;i<l.length;i++){let f=l.item(i);f.arrayBuffer().then(u=>{let n=f.name;if(n.endsWith(".csv")||n.endsWith(".txt")){addtable(parsetable(n.slice(0,-4),su(u)))}else if(n.endsWith(".k")){ed.value=su(u);kbut.textContent=n;kinit("#init#")}else if(n.endsWith(".xk")){rbin(u)}else console.log("ignore file",n)})}}
window.onscroll=()=>{window.scrollTo(0,0)}

let tables={},tnm=100
let parsetable=(name,s)=>{s=s.split(/\r?\n/);let comma=s[1][1];if(comma!=",")s=s.map(x=>x.replaceAll(",","."));if((comma==" ")||(comma=="\t"))comma=/[ \t]+/;
 let t={name:name,h:s[0].split(comma),t:s[1].split(comma),top:0,n:s.length-2};t.d=Array(t.h.length);t.sel="!0";t.isel=new Int32Array(0);t.t.forEach((x,i)=>t.d[i]=(t.t[i]=="s")?(Array(t.n).fill("")):(t.t[i]=="i")?new Int32Array(t.n):new Float64Array(t.n))
 for(let i=2;i<s.length;i++){let r=s[i].split(comma);r.forEach((x,j)=>t.d[j][i-2]=(t.t[j]=="s")?x:Number(x))};t.h=t.h.filter((_,i)=>t.t[i]!="a");t.d.forEach((x,i)=>{if(t.t[i]=="r"){t.d[i]=zra(t.d[i],t.d[1+i]);t.t[i]="z"}});t.d=t.d.filter((_,i)=>t.t[i]!="a");t.t=t.t.filter((_,i)=>t.t[i]!="a");return t}
let zra=(r,a)=>{let z=new Float64Array(2*r.length);a.forEach((p,i)=>{p*=Math.PI/180;z[2*i]=r[i]*Math.cos(p);z[2*i+1]=r[i]*Math.sin(p)});return z}
let sf=x=>{let a=Math.abs(x);return(a>=10000&&a<1e6)?x.toFixed(0):x.toPrecision(4)},sr=x=>(x<0.01|10000<x)?x.toExponential(1):x.toFixed(4).slice(0,6),sa=x=>x.toFixed(0),sz=x=>{let r=Math.hypot(x[0],x[1]),a=Math.atan2(x[1],x[0])*180/Math.PI; a=sa((a<0)?a+360:a);return sr(r)+"a"+" ".repeat(3-a.length)+a},Sz=(x,y)=>{let r=Math.hypot(x,y),a=Math.atan2(y,x)*180/Math.PI;return String(r)+"a"+String((a<0)?a+360:a)},zs=s=>{let v=s.split("a").map(parseFloat);return(v.length==2)?[v[0]*Math.cos(v[1]/180*Math.PI),v[0]*Math.sin(v[1]/180*Math.PI)]:[NaN,NaN]}
let fills=v=>{let m=Math.max(...v.map(s=>s.length));for(let j=0;j<v.length;j++)v[j]+=" ".repeat(m-v[j].length);return v}
let listtable=(t,p)=>{let n=Math.min(tnm,t.n-t.top),v=fills(Array(1+n).fill("").map((x,i)=>i?String(i+t.top-1):"i")),head=null,tail=null;
 if(t.top>0){head=oc(e=>{t.top=Math.max(0,t.top-tnm);listtable(t,p);pd(e)},tc(Math.max(0,t.top-tnm)+"‥"+(t.top-1)+" ↑",ce("option")));head.ondblclick=e=>{t.top=0;listtable(t,list);pd(e)}}
 if(tnm<t.n-t.top){tail=oc(e=>{t.top+=tnm;listtable(t,p);pd(e)},tc((t.top+tnm)+"‥"+Math.min(t.n,t.top+2*tnm)+" #"+t.n+" ↓",ce("option")));tail.ondblclick=e=>{t.top=tnm*(t.n/tnm>>0);listtable(t,list);pd(e)}}
 for(let i=0;i<t.h.length;i++){let ti=t.t[i],di=t.d[i];v[0]+="│"+trm(t.h[i]);for(let j=0;j<n;j++){let tj=t.top+j;dij=(ti=="s"||ti=="i")?String(di[tj]):(ti=="f")?sf(di[tj]):sz([di[2*tj],di[1+2*tj]]);v[1+j]+="│"+trm(dij+((ti=="r")?"a"+sa(t.d[1+i][tj]):""))};v=fills(v);if(ti=="r")i++}
 v.forEach((x,i)=>v[i]=esc(x));rm(p);for(let i=0;i<v.length;i++){let op=ce("option");op.innerHTML=v[i];if(!i){cl("head",op);if(p==list)op.onclick=listedit}else{op.dataset.i=t.top+i-1;op.selected=t.isel.includes(t.top+i-1)};ac(p,op);if(head&&!i)ac(p,head)};if(tail)ac(p,tail);return v}
let listedit=e=>{let t=tables[maintable];editrows(t,af(list.selectedOptions).filter(x=>"i"in x.dataset).map(x=>Number(x.dataset.i)));pd(e)}
let listchange=e=>{let a=af(list.selectedOptions).filter(x=>"i"in x.dataset);let t=tables[maintable],idx=a.map(x=>Number(x.dataset.i));if(!idx.length){pd(e);return};sel.value=rangestr(idx);t.isel=new Int32Array(idx);t.sel=sel.value;selbg(0);let c=curbut();if(c)kinit(c)}
let listkey=e=>{let t=tables[maintable];if(e.key=="Delete"){if(confirm("delete "+t.isel.length+" rows from "+maintable+"?"))delrows()}else if(e.key=="Enter"){listedit(e)}
 else if(e.ctrlKey&&e.key=="c"){copy(e)}else if(e.ctrlKey&&e.key=="x"){copy(e);delrows()}else if(e.ctrlKey&&e.key=="v"){paste(e)}
 else if(e.key=="Home"){t.top=0;listtable(t,list)}else if(e.key=="End"){t.top=Math.max(0,t.n-tnm);listtable(t,list)}
 else if(e.key=="PageDown"||e.key=="ArrowDown"){let l=list.options[list.options.length-1];if(l.selected&&l.dataset.i===undefined){t.top=Math.min(t.n-1,t.top+tnm);listtable(t,list);list.scrollTop=0}}
 else if((e.key=="PageUp"||e.key=="ArrowUp")&&0==list.selectedIndex){t.top=Math.max(0,t.top-tnm);listtable(t,list);list.selectedIndex=0}}
let addtable=t=>{tables[t.name]=t;listtable(t,list);let c=t.name
 let bld=s=>af(foot.childNodes).forEach(x=>{x.classList.remove("bold");if(x.textContent==s)cl("bold",x)}),exists=s=>af(foot.getElementsByTagName("span")).map(x=>x.textContent).includes(s)
 let sp=tc(t.name,cl("link",ce("span")));sp.onclick=()=>{let s=sp.textContent,t=tables[s];listtable(t,list);bld(s);maintable=s;sel.value=t.sel;mark()};sp.ondblclick=rentable;if(!exists(t.name))foot.insertBefore(sp,newtab);bld(t.name);maintable=t.name;listtable(t,list)}
let rentable=e=>{let t=e.target.textContent,s=prompt("rename table "+t,t);if(s===""){if(confirm("delete table "+t+"?"))deltable(t);return};if(s){if(Object.keys(tables).includes(s))return;delete Object.assign(tables,{[s]:tables[t]})[t];e.target.textContent=s;if(t==maintable)maintable=s}}
let deltable=s=>{delete tables[s];let k=Object.keys(tables);foot.removeChild(af(foot.childNodes).filter(x=>x.textContent==s)[0]);let t=foot.firstElementChild;if(t.textContent!="+")t.onclick()}
let delrows=()=>{let t=tables[maintable];t.d.forEach((d,i)=>t.d[i]=d.filter((t.t[i]=="z")?(_,i)=>!t.isel.includes(i>>1):(_,i)=>!t.isel.includes(i)));t.sel="!0";t.n-=t.isel.length;t.isel=new Int32Array(0);t.top=0;listtable(t,list)}
let rencolumn=(t,c)=>{let s=prompt("new column name for "+c+" from "+t.name+"?\nleave empty to delete column");if(s===""){if(confirm("delete column?"))delcolumn(t,c);return};if(s&&t.h.indexOf(s)==-1){t.h[t.h.indexOf(c)]=s}}
let addcolumn=(t,s)=>{let v=s.split(":");if(v.length!=2)return;let tp=v[1];if(t.h.includes(v[0])||(!"ifsz".split("").includes(tp)))return;t.h.push(v[0]);t.t.push(tp);t.d.push((tp=="s")?Array(t.n).fill(""):(tp=="i")?new Int32Array(t.n):new Float64Array((tp=="f")?t.n:2*t.n))}
let addrows=(t,n)=>{t.n+=n;t.t.forEach((ti,i)=>{if("s"==ti){t.d[i].push(...Array(n).fill(""))}else{let r=t.d[i];t.d[i]=("i"==ti)?new Int32Array(t.n):new Float64Array((ti=="f")?t.n:2*t.n);t.d[i].set(r)}})}
let dragcol=null,dragcolumn=e=>{dragcol=e.target},dropcolumn=e=>{pd(e);let p=e.target.parentNode,c=af(p.parentNode.children);if(c.indexOf(p)>c.indexOf(dragcol)){p.after(dragcol)}else{p.before(dragcol)};dragcol=null}
let editrows=(t,idx)=>{rm(dict);let ta=ce("table"),[h,s,tp,u]=uniqs(t,idx),hdrhlp="hdr help.."
 h.forEach((x,i)=>{let ti=tp[i],rdo=!u[i];let tr=ce("tr"),th=tc(x,cl("head pointer",ce("th")));tr.dataset.i=i;tr.draggable=!idx.length;tr.ondragstart=dragcolumn;tr.ondrop=dropcolumn;ac(tr,th);let td=ce("td"),ip=ce("input");th.onkeydown=e=>{console.log(e.key,"todo change order")};th.dataset.i=i;th.ondblclick=e=>{if(idx.length)return;rencolumn(t,e.target.textContent);th.textContent=t.h[+th.dataset.i]};if(rdo)th.onclick=()=>ip.removeAttribute("readonly");ip.style="border:none;outline:none";if(rdo)ip.setAttribute("readonly","true");ip.onchange=verify(tp[i]);ip.value=s[i];ip.style.background=(ti=="s")?"#ffe":(ti=="i")?"#efe":"#eee";ac(td,ip);ac(tr,td);ac(ta,tr)})
 ac(dict,ta);list.style.display="none";dict.style.display="block";ac(dict,ce("hr"));ac(dict,tc((idx.length==1)?("update row "+idx[0]+"?\n"):(idx.length?("update "+idx.length+" rows?\n"):hdrhlp),ce("span")));let d=ce("div");ac(dict,d);d.style="display:flex;justify-content:space-around"
 let ok=()=>{commit(ta,t,idx);list.style.display="block";dict.style.display="none"},cancel=()=>{list.style.display="block";dict.style.display="none"};ac(d,oc(ok,tc("ok",    ce("button"))));ac(d,oc(cancel,tc("cancel",ce("button"))))
 if(!idx.length){ac(d,oc(()=>{let s=prompt("add column\nname:type(ifsz)","name:s");if(s){addcolumn(t,s);cancel();listtable(t,list)}},tc("add column",ce("button"))));ac(d,oc(()=>{let s=prompt("add rows\nnumber of rows:","1"),n=parseInt(s);if(s&&n>0){idx=Array(n).fill().map((_,i)=>i+t.n);addrows(t,n);ok()}},tc("add rows",ce("button"))))}}
let uniqs=(t,idx)=>{let s=[],tp=[],u=[],i0=idx[0],i2=idx.map(x=>2*x),i3=idx.map(x=>1+2*x);t.h.forEach((x,i)=>{let ti=t.t[i],di=t.d[i];s.push((ti=="s")?di[i0]:(ti=="i"||ti=="f")?String(di[i0]):Sz(di[2*i0],di[1+2*i0]));u.push((ti!="z")?isuniq(at(di,idx)):(isuniq(at(di,i2))&&isuniq(at(di,i3))))});if(idx.length==0)t.t.forEach((tp,i)=>s[i]=(tp=="s")?"":(tp=="i")?"0":(tp=="f")?"0.0":"0a0");return[t.h,s,t.t,u]}
let verify=t=>{return e=>{let s=e.target.value,a=s.split("a");if(a.length<2)a.push("0");e.target.style.borderRight="1px solid";e.target.value=("s"==t)?s:("i"==t)?ON(String(Number(s))):("f"==t)?On(String(Number(s))):On(String(Number(a[0])))+"a"+On(String(Number(a[1])))}}
let commit=(ta,t,idx)=>{let inp=af(ta.rows).map(x=>x.children[1].firstElementChild),c=af(ta.children),j=c.map(x=>+x.dataset.i);inp.forEach((x,i)=>{if(x.style.borderRight=="1px solid")update(t,i,idx,x.value)});t.h=reorder(t.h,j);t.d=reorder(t.d,j);t.t=reorder(t.t,j);listtable(t,list)}
let update=(t,i,idx,s)=>{let old=af(list.selectedOptions).map(x=>x.index);idx.forEach(j=>{let ti=t.t[i],di=t.d[i];if(ti=="z"){[di[2*j],di[1+2*j]]=zs(s)}else{di[j]=("s"==ti)?s:("i"==ti)?parseInt(s):parseFloat(s)};listtable(t,list)});af(list.childNodes).forEach((x,i)=>x.selected=old.includes(i))}
let copy=e=>{pd(e);let t=tables[maintable];navigator.clipboard.writeText(af(t.isel).map(i=>t.t.map((tj,j)=>{let dj=t.d[j];return((tj=="s")?dj[i]:(tj=="z")?Sz(dj[2*i],dj[1+2*i]).replace("a","\t"):String(dj[i]))}).join("\t")).join("\n")).then(r=>r)}
let paste=e=>{pd(e);let t=tables[maintable];navigator.clipboard.readText().then(r=>merge(t,parsetable("paste",t.h.join(" ")+"\n"+(t.t.join("").replaceAll("z","ra")).split("").join(" ")+"\n"+r)))}
let merge=(t,T)=>{if(t.h.join("")!=T.h.join(""))return;(t.isel.length==1)?insrows(t,T,t.isel[0]):(t.isel.length==T.n)?reprows(t,T):insrows(t,T,t.n);listtable(t,list)}
let insrows=(t,T,ii)=>{t.t.forEach((ti,i)=>{if(ti=="s"){t.d[i].splice(1+ii,0,...T.d[i])}else{let j=(1+ii)*((ti=="z")?2:1),td=t.d[i],Td=T.d[i],d=new td.constructor(td.length+Td.length);d.set(td.subarray(0,j));d.set(Td,j);d.set(td.subarray(j),j+Td.length);t.d[i]=d}});t.n+=T.n;t.isel=new Int32Array(T.n).map((_,i)=>1+i+ii);t.sel=rangestr(t.isel)}
let reprows=(t,T)=>{t.t.forEach((ti,i)=>t.isel.forEach((x,j)=>{if(ti=="z"){x*=2;j*=2};t.d[i][x]=T.d[i][j]}))}
let newtable=()=>{let i=0;while(("t"+i)in tables)i++;addtable(parsetable("t"+i,"a\ni\n"))}


function copycap(e){pd(e)
	//let html="<span style='font-family:Consolas'>teletype</span> <span style='color:red'>red text</span> ok?"
	let html="<span style='font-family:Consolas,monospace'>&nbsp; column│column│column<br/><span style='color:red'>●</span> 123.45│100.23│first<br/><span style='color:green'>●</span> 456.78│901.23│second<br/></span>"
	//issues.chromium.org/issues/328477621
	//navigator.clipboard.write([new ClipboardItem({'text/plain':new Blob(["abc.."],{type:'text/plain'}),'text/html':new Blob(["html.."],{type:'text/html'})})]).then(r=>console.log("ok",r),r=>console.log("not ok",r))
	//workaround clipboard event & execCommand
	let l=e=>{window.removeEventListener("copy",l);e.clipboardData.setData("text/plain","plain text..");e.clipboardData.setData("text/html",html);pd(e)};window.addEventListener("copy",l);document.execCommand("copy");
}

let ON=x=>x.replace("NaN","ON"),On=x=>x.replace("NaN","On")
let isuniq=x=>x.every((x,i,a)=>a.length==1||x===a[0])
let at=(x,i)=>x.filter((_,j)=>i.includes(j))
let reorder=(v,i)=>{let y=Array(v.length);i.forEach((j,i)=>y[i]=v[j]);return y}
let trm=s=>(s.length<11)?s:s.slice(0,5)+"‥"+s.slice(-4)
let esc=s=>s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/ /g,"&nbsp;")
let rangestr=x=>(0==x.length)?"!0":(1==x.length)?(","+x[0]):(x[0]&&6>x.length)?x.join(" "):ranges(x)
let ranges=x=>{let r=[],t=[];x.forEach((y,i)=>{if(i&&(y-x[i-1])>1){r.push(t);t=[]};t.push(y)});r.push(t);let em=(i,x)=>(i<r.length-1)?("("+x+")"):x;return r.map((x,i)=>(1==x.length)?String(x):(!x[0])?em(i,"!"+x.length):(4>x.length)?x.join(" "):em(i,x[0]+"+!"+x.length)).join(",")}

let imgs=0,plots=0,pid=0,noplot=()=>{P.style.display="none"}
let obs=new ResizeObserver(m=>{let e=m[0];if(plots){pcnv.width=e.contentRect.width;pcnv.height=e.contentRect.height;scaleplot(plots)};pcap.style.height=(R.getBoundingClientRect().height-((plots)?pcnv.height:0))+"px"; if(imgs)setimg(imgs)   });obs.observe(pcnv)
let addbut=(x,b)=>{let f=oc(e=>kinit(x),cl("link",tc(x,ce("span"))));f.ondblclick=e=>showed(x);but.insertBefore(f,but.firstChild);if(b)setbut(f)}
let curbut=()=>{let b=af(but.childNodes).find(x=>x.classList.contains("bold"));return(b)?b.textContent:null}
let setbut=x=>{af(but.childNodes).forEach(y=>{y.classList.remove("bold")});cl("bold",x)}
let reset=()=>{plots=0;pid=0;imgs=0;zmin=0;zmax=0;E.textContent="";O.textContent=""}

/*
	plot 0                    / i:select current plot
	plot`polar                / s: s in `xy`bar`polar`ampang`square
	plot`xlabel`ylabel`title  /#S 1..3
	plot(x;y0;y1;..)          /[x:i|f] y:i|f|z  multiple lines
	plot axis                 /x:I|F #x 1...4 y1|x0,x1|x0,x1,0,y1|x0,x1,y0,y1
	image rows^x              /I:pixels,C:greyscale,F:colormap between zmin,zmax
 */
 
let zmin=0,zmax=0,axis=x=>{if(6==x.length){zmin=x[4];zmax=x[5]};plots[pid].limits=af(x)}
let plotk=x=>{
 let pn=x=>{if(plots.length<=x)plots[x]={};return x},pt=x=>{plots[pid].type=("square"==x)?"xy":x;plots[pid].square=x=="square"},ri=x=>{x=ZK(x);return[x.filter((_,i)=>i&1),x.filter((_,i)=>~i&1)]},la=x=>{x.push("","");[plots[pid].xlabel,plots[pid].ylabel,plots[pid].title]=x}
 let ln=x=>{if(!("lines"in plots[pid]))plots[pid].lines=[];let t=K.tp(x[0]),X;if(x.length>1&&22>t){X=(3==t)?iK(x[0]):(5==t)?fK(x[0]):(19==t)?IK(x[0]):FK(x[0]);x.shift()};x.forEach(y=>{let t=K.tp(y),v=(22==t)?ri(y):(19==t)?IK(y):FK(y);plots[pid].lines.push({x:X,y:(22==t)?v[0]:v,z:(22==t)?v[1]:undefined})})}
 if(plots===0){pid=0;plots=[]};if(undefined===plots[pid])plots[pid]={}
 let t=K.tp(x);(3==t)?pid=pn(lo(x)):(4==t)?pt(sK(x)):(20==t)?la(SK(x)):(19==t)?axis(IK(x)):(21==t)?axis(FK(x)):(22==t)?(pt("polar"),ln([x])):(23==t)?ln(LK(x)):K.dx(x)
 return K.Ki(pid)}
let cmap=new Int32Array("0300000400000600000700010901010b01010e01021002021202031403041603041804051b04061d05071f060821060923070a26070b28080d2a080e2d090f2f0910320a12340a13360b14390b163b0b173e0b19400b1a430c1c450c1d470c1f4a0c204c0b224e0b24500b26520b27540b29560a2b580a2d5a0a2e5c0a305d09325f093460093561093762093964093b65093c66093e660940670941680a43690a45690a466a0b486a0b4a6b0c4b6b0c4d6c0d4f6c0d506c0e526d0e536d0f556d0f576d10586d115a6e115b6e125d6e125f6e13606e14626e14636e15656e15666e16686e176a6e176b6e186d6e186e6e19706d19726d1a736d1b756d1b766d1c786d1c7a6c1d7b6c1d7d6c1e7e6b1f806b1f816b20836a20856a21866a218869228969228b69238d68248e68249067259167259366269566269665279864289964289b63299c63299e622aa0612ba1612ba3602ca45f2ca65f2da75e2ea95d2eab5c2fac5b30ae5b31af5a31b15932b25833b45733b55634b75635b85536ba5437bb5337bd5238be5139bf503ac14f3bc24e3cc44d3dc54c3ec74b3ec84a3fc94940cb4841cc4742cd4644cf4445d04346d14247d24148d44049d53f4ad63e4bd73d4dd93b4eda3a4fdb3950dc3852dd3753de3654df3456e03357e23258e3315ae4305be52e5ce62d5ee62c5fe72b61e82a62e92864ea2765eb2667ec2568ed236aed226cee216def1f6ff01e70f01d72f11c74f21a75f21977f31879f3167af4157cf5147ef51280f61181f61083f70e85f70d87f80c88f80b8af8098cf9088ef90890f90791fa0693fa0695fa0697fa0699fb069bfb069dfb079efb07a0fb08a2fb0aa4fb0ba6fb0da8fb0eaafb10acfb12aefb14b0fb16b1fb18b3fb1ab5fb1cb7fb1eb9fb21bbfa23bdfa25bffa28c1fa2ac3f92cc5f92fc7f931c9f834cbf837cdf83acff73cd1f73fd3f642d5f645d7f548d9f54bdbf44fdcf452def356e0f359e2f35de4f260e6f264e8f168e9f16cebf170edf174eef179f0f17df2f181f3f285f4f289f6f38df7f491f8f595faf699fbf79dfcf9a0fdfaa4fefc00ff00".match(/....../g).map(x=>"0xff"+x).map(Number)),grey=cmap.map((_,i)=>i+256*i+256*256*i)
let zscale=x=>{x=FK(x);if(zmin>=zmax){zmin=Math.min(...x);zmax=Math.max(...x)};x=x.map(x=>{x=255*(x-zmin)/(zmax-zmin);return(x>255)?255:(x<0)?0:x});return new Int32Array(x).map(x=>cmap[x])}
let image=x=>{/*x:LC,LI,LF*/let h=K.nn(x),y=K.Atx(K.Val(KC(",/")),x),w=K.nn(y)/h,u=new Uint8ClampedArray(((18==K.tp(y))?(new Int32Array(BK(y)).map(x=>grey[x])):(21==K.tp(y))?zscale(y):IK(y)).buffer);for(let i=3;i<u.length;i+=4)u[i]=255;imgs=[u,w,h,K.tp(y)];return 0n}
let setimg=x=>{let[I,w,h,t]=imgs,c=pcnv.getContext("2d"),rgb=i=>(i>=I.length)?[0,0,0]:I.slice(i,i+3),zz=(r,g,b)=>((r==g&&r==b)?r:zmin+(zmax-zmin)/255*cmap.indexOf(new Int32Array([0xff000000+65536*b+256*g+r])[0]));pcnv.width=pcnv.clientWidth;pcnv.height=pcnv.clientHeight;let m=c.createImageData(w,h);m.data.set(I);c.putImageData(m,0,0);P.style.display="";pcnv.onclick=e=>{let x=e.offsetX,y=e.offsetY,[r,g,b]=rgb(4*(x+w*y));B.value=("x:"+x+"; y:"+y)+((19==t)?("; r:"+r+"; g:"+g+"; b:"+b):("; z:"+zz(r,g,b)))}}

function debounce(f){let t;return(...a)=>{clearTimeout(t);t=setTimeout(()=>{f.apply(this,a)},100)}}
const scaleplot=debounce(a=>{P.style.display=""
 let fs=small=>(parseFloat(getComputedStyle(small?document.body:but).fontSize)*devicePixelRatio)+"px monospace"
 let p={plots:a,font1:fs(0),font2:fs(1)/*,cols:1*/}
 plot(p,pcnv,{b:bac,f:fwd},pcap,x=>B.value=x)})

let maintable
let kout=x=>{O.textContent+=x;O.style.display="";kend()},kend=_=>{O.scrollTop=O.scrollHeight},khid=e=>{O.style.display="none";pd(e)},selbg=x=>{sel.style.background=x?"orangered":"black"}
let show=x=>{rm(pcap);plots?scaleplot(plots):imgs?setimg():noplot();let t=K.tp(x);(4==t)?showtxt(sK(x),pcap):(18==t)?showtxt(CK(x),pcap):(20==t)?showtxt(SK(x).join("\n"),pcap):(24==t)?showdct(x,pcap):(25==t)?listtable(TK(x),pcap):showlst(x,pcap)}
let call=x=>{x=K.Val(Ks("xk"+x));return(13==K.tp(x))?K.Cal(x,K.mk(23,0)):x}
let kdat=_=>{Object.keys(tables).forEach(s=>{asn(s,KT(tables[s]));asn(s+"sel",KI(tables[s].isel))});asn("n",K.Ki(tables[maintable].n));asn("i",K.Val(KC("!n")));asn("sel",K.rx(K.Val(Ks(maintable+"sel"))))}
let mark=_=>{let s=sel.value.trim();selbg(1);expl(K.Val(Ks(maintable)));let r=K.Val(KC(s.length?s:"!0"));if(K.tp(r)!=19){cl("red",sel);return};let y=IK(K.Val(KC(s))),o=tables[maintable].top;af(list.childNodes).forEach((x,i)=>{x.selected=y.includes(("i"in x.dataset)?Number(x.dataset.i):-1)});tables[maintable].isel=y;tables[maintable].sel=s;selbg(0)}
let expl=t=>{if(25!=K.tp(t)){K.dx(t);return 0n};asn("i",K.Atx(12n,K.Atx(15n,K.rx(t))));let s=SK(K.Atx(12n,K.rx(t))),l=LK(K.Val(t));s.forEach((x,i)=>asn(x,l[i]));return 0n}
let help=_=>{let v=ed.value.split("\n"),a,i=v.findIndex(x=>(x.length==0)||x[0]!="/");if(i>0)O.textContent="\n\n"+v.slice(0,i).map(x=>x.slice(1)).join("\n")+"\n\n";a=ac(O,tc("xk documentation",ce("a")));a.href="xkdoc.html";a.target="_blank"}
let kkey=e=>{let b=B.value;if("Enter"==e.key){kout(" "+b+"\n");b.startsWith("\\")?(b=="\\c")?O.textContent="":O.textContent+=khelp:K.repl(KC(b))};if("Escape"==e.key)B.value="";kend()}

let showtxt=(x,l)=>{x.split("\n").forEach(x=>ac(pcap,ce("option")).innerHTML=esc(x))}
let showlst=(x,l)=>{return CL(K.Atx(Ks("l"),x)).forEach(x=>ac(pcap,ce("option")).innerHTML=esc(x))}
let showdct=(x,l)=>{let j=J(),k=j[lo(x)>>>3],v=j[8+lo(x)>>>3],tk=K.tp(k),tv=K.tp(v);if(tk!=20)return showlst(x,l);k=fills(SK(k));if(25==K.tp(v))return keyt(k,v,l);k.forEach((x,i)=>{let vi=K.Atx(K.rx(v),K.Ki(i)),t=K.tp(vi);k[i]+="│"+((3==t)?iK(vi):(4==t)?sK(vi):(5==t)?sf(fK(vi)):(6==t)?sz(zK(vi)):"?")});k.forEach(x=>{let o=ce("option");o.innerHTML=esc(x);ac(l,o)})}
let keyt=(k,v,l)=>{listtable(TK(v),pcap);k.unshift(k.length?" ".repeat(k[0].length):" ");k=k.map(x=>esc(x)+"║");af(pcap.childNodes).forEach((o,i)=>o.innerHTML=k[i]+o.innerHTML)}
let stor=s=>{if(4!=K.tp(s))return 0;let t=K.Val(s);if(25!=K.tp(t))return 0;t=TK(t);t.name=sK(s);if(t.name in tables)t.isel=tables[t.name]["isel"];addtable(t);return 0n}
let down=(f,u)=>{let x=new Blob([u],{type:"application/octet-stream"});dl.href=URL.createObjectURL(x);dl.download=f;dl.click()}

let bundle=()=>{let s=("<!DOCTYPE html>"+document.querySelector("html").innerHTML+"</"+"html>").replace("kw64=null",'kw64="'+kw64+'"').replace("<script src=\"plot.js\" id=\"pjs\">"+"</"+"script>","<script id=\"pjs\">"+plotjsrc+"</"+"script>").replace(/,xk64=.*\n/,";xk64=\""+s64u(wbin())+"\"\n");down("xk.html",us(s))}
let save=s=>down(s,wbin()),wbin=()=>{let t=Object.keys(tables).map(x=>tables[x]),sym={};t.forEach(t=>{sym[t.name]=true;t.h.forEach(x=>sym[x]=true);t.t.forEach((tp,i)=>{if(tp[i]=="s")t.d[i].forEach(s=>sym[s]=true)})});Object.keys(sym).forEach((x,i)=>sym[x]=i);
 let n=x=>new Uint8Array(new Int32Array([x]).buffer),o=[0,us(Object.keys(sym).join("\0"))],no=x=>o.push(n(x)),ot=t=>o.push(new Uint8Array([t.charCodeAt()])),sy=x=>o.push(new Uint8Array(new Int32Array(x.map(s=>sym[s])).buffer)),od=x=>o.push(new Uint8Array(x.buffer))
 o[0]=n(o[1].length);o.push(n(t.length)); t.forEach(t=>{ no(sym[t.name]); no(t.h.length); no(t.n); sy(t.h); t.t.forEach((tp,i)=>{ot(tp);(tp=="s")?sy(t.d[i]):od(t.d[i]) }) })
 let s=us(ed.value);no(s.length);o.push(s);let r=new Uint8Array(o.map(x=>x.length).reduce((x,y)=>x+y,0)),q=0;o.forEach(x=>{r.set(x,q);q+=x.length});return r}
let rbin=u=>{Object.keys(tables).forEach(()=>foot.removeChild(foot.firstChild));tables={};let p=0
 let I=n=>{p+=4*n;return new Int32Array(u.slice(p-4*n,p))},F=n=>{p+=8*n;return new Float64Array(u.slice(p-8*n,p))},n=()=>I(1)[0],un=n=>{p+=n;return new Uint8Array(u.slice(p-n,p))},tab=su(un(n())).split("\0"),sy=n=>{p+=4*n;return Array.from(new Int32Array(u.slice(p-4*n,p))).map(i=>tab[i])}
 let tb=()=>{ let t={name:tab[n()],top:0,t:[],d:[],sel:"!0",isel:new Int32Array(0)},nc=n();t.n=n();t.h=sy(nc);t.h.forEach((_,i)=>{let tp=su(un(1));t.t[i]=tp;t.d[i]=(tp=="s")?sy(t.n):(tp=="i")?I(t.n):F(t.n*(1+(+(tp=="z"))))});addtable(t)}
 let nt=n();while(nt--)tb();let s=su(un(n()));if(s.length)ed.value=s;kinit()}/*wbin,rbin see also xk.go*/

let showed=x=>{edx.style.display="";if("string"==typeof x){showed(1);edmark("xk"+x+":",0)}else if(1==x){ac(D,ed);D.style.height="30%"}else if(2==x){edt.style.display="block";ac(edt,ed)}else{D.style.height=0;edt.style.display="none";edx.style.display="none"}}
let edmark=(x,o)=>{if(7===x){o=ed.selectionEnd;x=ed.value.slice(ed.selectionStart,ed.selectionEnd)};ed.focus();let i=ed.value.slice(o).indexOf(x);if((0>i)&&(o>0))return edmark(x,0);if(0>i)return;i+=o;ed.setSelectionRange(i,i+x.length);let l=0;for(let j=0;j<i;j++)if(ed.value[j]=="\n")l++;ed.scrollTop=18*(l-3)}

let err=s=>{E.textContent=s}

const khelp="store`T /store(overwrite) table T from k\n\\c      /clear console\nESC     /clear input"


let /*there be*/ K
let C=()=>new Int8Array(K.memory.buffer),I=()=>new Int32Array(K.memory.buffer),J=()=>new BigInt64Array(K.memory.buffer),F=()=>new Float64Array(K.memory.buffer)
let kenv={env:{ 
 Exit:  function(x      ){},
 Args:  function(       ){return 0},
 Arg:   function(x,y    ){return 0},
 Read:  function(a,b,c  ){return -1},
 Write: function(a,b,c,d){let u=new Uint8Array(K.memory.buffer),v=u.slice(c,c+d),f=u.slice(a,a+b);a?down(su(f),v):kout(su(v));return 0},
 ReadIn:function(x,y    ){return 0},
 Native:function(x,y    ){let i=lo(x);K.dx(x);return xcal[i](...LK(y))}}}
let kinit=x=>{if(kw){kinst(kw,x)}else if(kw64){kinst(u64s(kw64),x)}else{fetch("k.wasm").then(r=>r.arrayBuffer()).then(r=>{kw=new Uint8Array(r);kw64=s64u(kw);kinst(kw,x)})}}
let kinst=(u,x)=>{reset();
 WebAssembly.instantiate(u,kenv).then(r=>{K=r.instance.exports;K.kinit();xcal=[];xreg("plot",plotk);xreg("image",image);xreg("explode",expl);xreg("store",stor);kdat();K.dx(K.Val(KC(ed.value)))
 rm1(but);syms().reverse().forEach(s=>addbut(s,s===x))
       if(x==="#selec#")mark(       )
  else if(x==="#init#"){let f=K.Val(Ks("init"));if(f)K.Cal(f,K.mk(23,0));return}
  else if(x!==undefined)show(call(x))
  else                  help(       )
  }).catch(e=>err(e.message+"\n\n"+e.stack))}

let xcal=[],xreg=(name,g,arity)=>{xcal.push(g);let f=K.l2(BigInt(xcal.length-1),Ks(name));I()[(lo(f)>>>2)-3]=(arity===undefined)?1:arity;f=(BigInt(14)<<BigInt(59))+BigInt(lo(BigInt(f)));asn(name,f)},
TK=x=>{let j=J(),k=SK(K.rx(j[lo(x)>>>3])),v=K.rx(j[1+(lo(x)>>>3)]),r={top:0,sel:"!0",h:[],t:[],d:[],n:K.nn(x),isel:new Int32Array(0),sel:"!0"},F={19:["i",IK],20:["s",SK],21:["f",FK],22:["z",ZK]};k.forEach((x,i)=>{let vi=j[i+(lo(v)>>>3)],t=K.tp(vi),f=F[t];r.h.push(x);r.t.push(f[0]);r.d.push(f[1](vi))});return r},
KC=x=>{let r=K.mk(18,x.length);C().set(("string"===typeof x)?us(x):x,lo(r));return r},
KI=x=>{let r=K.mk(19,x.length);I().set(x,lo(r)>>>2);return r},KF=x=>{let r=K.mk(21,x.length);F().set(x,lo(r)>>>3);return r},KZ=x=>{let r=K.mk(22,x.length/2);F().set(x,lo(r)>>>3);return r},
KS=x=>{let v=(x.map(x=>lo(Ks(x))))/*needs temporary*/,r=K.mk(20,x.length);I().set(v,lo(r)>>>2);return r},Ks=x=>K.sc(KC(x)),sK=x=>CK(K.cs(x)),
KL=x=>{let r=K.mk(23,x.length);J().set(x,lo(r)>>>3,new BigInt64Array(x));return r},LK=x=>{let n=K.nn(x),r=Array(n);for(let i=0;i<n;i++)r[i]=K.Atx(K.rx(x),K.Ki(i));K.dx(x);return r},
IK=x=>{let p=lo(x)>>>2,n=K.nn(x);let r=I().slice(p,p+n);K.dx(x);return r},iK=x=>lo(x),
FK=x=>{let p=lo(x)>>>3,n=K.nn(x);let r=F().slice(p,p+n);K.dx(x);return r},fK=x=>new Float64Array(K.memory.buffer,lo(x),1)[0],
ZK=x=>{let p=lo(x)>>>3,n=K.nn(x);let r=F().slice(p,p+2*n);K.dx(x);return r},zK=x=>new Float64Array(K.memory.buffer,lo(x),2),
DK=x=>{let j=J(),p=lo(x)>>>3,r=[K.rx(j[p]),K.rx(j[1+p])];K.dx(x);return r},
KT=T=>{let t=T.t,k=KS(T.h),v=K.mk(23,T.h.length),vi,p=lo(v)>>>3;t.forEach((ti,i)=>{let di=T.d[i];vi=("i"==ti)?KI(di):("s"==ti)?KS(di):("f"==ti)?KF(di):KZ(di);/*reattach*/J()[p+i]=vi});return K.Atx(2n,K.Cal(12n,K.l2(k,v)))},
SK=x=>CL(K.Atx(17n,x)),BK=x=>{K.dx(x);return new Uint8Array(K.memory.buffer,lo(x),K.nn(x))},CK=x=>{K.dx(x);return su(new Uint8Array(K.memory.buffer,lo(x),K.nn(x)))},CL=l=>{let j=J(),p=lo(l)>>>3,n=K.nn(l),r=[];for(let i=0;i<n;i++)r.push(CK(K.rx(j[p+i])));K.dx(l);return r},
asn=(s,y)=>K.dx(K.Asn(Ks(s),y)),syms=()=>CL(K.rx(J()[0])).filter(x=>x.startsWith("xk")).map(x=>x.slice(2))




</script></body></html>
