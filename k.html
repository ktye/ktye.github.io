<!DOCTYPE html>
<head><meta charset="utf-8">
<link rel=icon href="kelas16.png">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1">
<title>ktye/k</title>
<style>*{font-family:monospace;margin:0;border:none;padding:0;font-size:xx-large}
body{overflow:hidden;height:100vh;display:grid;grid-template-rows:auto 1fr}
#i{flex-grow:1;min-height:3em;background-color:#ffe;/*position:absolute;*/width:100vw;/*height:50vh;*/top:0;outline:none;border:none;overflow:auto;resize:vertical}
#o{flex-grow:1;min-height:3em;background-color:#efe;/*position:absolute;*/width:100vw;/*height:50vh;top:50vh;*/;bottom:0;overflow:auto}
</style>
<script>

let K,B,lo=x=>Number(BigInt.asUintN(32,x)),C=()=>new Int8Array(K.memory.buffer),U=()=>new Uint32Array(K.memory.buffer),KC=x=>{x=("string"===typeof x)?us(x):x;let r=K.mk(18,x.length);C().set(x,lo(r));return r},Ks=s=>K.sc(KC(s)),
su=x=>t_.decode(x),t_=new TextDecoder("utf-8"),us=x=>_t.encode(x),_t=new TextEncoder("utf-8"),
save=()=>{B=C().slice(0,1<<U()[32])},restore=()=>{C().set(B)},cw,

kenv={env:{ 
 Exit:  function(x      ){},
 Args:  function(       ){return 0},
 Arg:   function(x,y    ){return 0},
 Read:  function(a,b,c  ){return -1},
 Write: function(a,b,c,d){let u=new Uint8Array(K.memory.buffer),v=u.slice(c,c+d);o.textContent+=su(v);if(a)o.textContent+="\n";return 0},
 ReadIn:function(x,y    ){return 0},
 Native:function(x,y    ){return 0}}},
kinit=s=>{let n,nk=x=>{n=x.byteLength;return x}
 fetch("k.wasm").then(r=>r.arrayBuffer()).then(r=>WebAssembly.instantiate(nk(r),kenv)).then(r=>{
 K=r.instance.exports;K.kinit()
 cw=measure.getBoundingClientRect().width/10
 if(!s)o.textContent="ktye/k "+n+"\n ";
 window.onresize() //K.dx(K.Asn(Ks("l."),K.Atx(Ks("lxy"),K.Val(KC(cols()+" 20")))))
 if(s)K.repl(KC(s))
})},
cols=()=>Math.floor(document.body.getBoundingClientRect().width/cw)

window.init=()=>{kinit()
 let f=window.location.hash;if(f)fetch(f.slice(1)).then(r=>r.text()).then(r=>i.textContent=r)
 i.onblur=e=>{if(!o.textContent)kinit(i.innerText.replace(/^\\(.*)$/mg,"`o<`k@$1"))}
 i.oninput=e=>o.textContent=""
}
window.onresize=e=>{K.dx(K.Asn(Ks("l."),K.Atx(Ks("lxy"),K.Val(KC(cols()+" 20")))))}

</script>
</head>

<body onload="window.init()">
<pre id="i" contenteditable="true" spellcheck="false" autofocus>!1</pre>
<pre id="o">a
b
c</pre>
</div-->
<span id="measure" style="position:absolute;top:0;z-index:-1">0123456789</span>
</body></html>
