<!DOCTYPE html><head><meta charset="utf-8"><link rel=icon href="../kelas16.png"><title>chess</title><style>
body{margin:0;min-height:100vh;display:flex;justify-content:center;align-items:center;background:#f0f0f0;}
svg{width:min(100vw,100vh);height:min(100vw,100vh);background:#ffffcc}
.t{transform:translate(0,-20px)}
.p{filter:saturate(3)}
.b{fill:#333}
.x{stroke:red;stroke-width:0.02}
</style></head><body><svg id="board" viewBox="0 0 800 800"></svg><script>

//24 points, 32 edges
let P="-3 -3;0 -3;3 -3;-2 -2;0 -2;2 -2;-1 -1;0 -1;1 -1;-3 0;-2 0;-1 0;1 0;2 0;3 0;-3 3;-1 1;0 1;1 1;-2 2;0 2;2 2;0 3;3 3".split(";").map(x=>x.split(" ").map(Number));
let E="0 1;1 2;3 4;4 5;1 4;4 7;6 7;7 8;6 11;8 12;9 10;10 11;12 13;13 14;0 9;3 10;5 13;2 14;11 16;12 18;16 17;17 18;9 15;10 19;17 20;20 22;13 21;14 23;19 20;20 21;15 22;22 23".split(";").map(x=>x.split(" ").map(Number))
let M="0 1 2;3 4 5;6 7 8;9 10 11;12 13 14;16 17 18;19 20 21;15 22 23;0 9 15;3 10 19;6 11 16;1 4 7;17 20 22;8 12 18;5 13 21;2 14 23".split(";").map(x=>x.split(" ").map(Number))
let M_={};for(let i=0;i<24;i++){M_[i]=[];M.forEach(m=>{if(m.includes(i))M_[i].push(m.filter(x=>x!=i))})}
let B="-".repeat(24).split("");
let S=-1,R=0;
const nine=4

let fr=(b,i)=>b[i]=="-"
let mi=(b,i)=>{
	let x=b[i],m0=M_[i][0],m1=M_[i][1];return((b[m0[0]]==x&&b[m0[1]]==x)||(b[m1[0]]==x&&b[m1[1]]==x))}
let where=(b,x)=>{let r=[];for(let i=0;i<24;i++)if(b[i]==x)r.push(i);return r}
let A=(b,w)=>{ //all possible moves for board b and player w: [[s,d,t],..] source,destination,take
 let r=[],F=where(b,!w).filter(i=>!mi(b,i));
 let takes=(s,d)=>{b[d]=w;if(mi(b,d)){F.length?F.forEach(t=>r.push([s,d,t])):r.push([s,d,-1])}else{r.push([s,d,-1])};b[d]="-"}
 if(R<nine){let s=-1,d;
  console.log("R<nine");
  where(b,"-").forEach(d=>{b[d]=w; takes(-1,d)})
 }else{
  let bw=where(b,w);
  if(bw.length>3){
   bw.forEach(s=>{E.filter(e=>e[0]==s&&fr([e[1]])).forEach(e=>takes(s,e[1]));
                  E.filter(e=>e[1]==s&&fr([e[0]])).forEach(e=>takes(s,e[0]))})
  }else if(bw.length==3){
   let D=where(b,"-");
   bw.forEach(s=>{D.forEach(d=>F.forEach(t=>r.push([s,d,t])))})
  } //else: <2 lost
 }
 return r
}

let PN=(b,w)=>{let p=0;
 b.forEach(x=>p+=x=="-"?0:x==w?1:-1);
 M.forEach(m=>p+=0.5*m.every(x=>x==w));
 M.forEach(m=>p-=0.5*m.every(x=>x==!w));return p+Math.random()}

let id=t=>Number(t.id.slice(1))
let put=t=>{if(S>-1)B[S]="-";B[id(t)]=1;let m=mi(B,id(t));draw(!m,m)}
let beat=t=>(B[id(t)]="-",draw(1))
let pick=t=>(S=id(t),draw(0),S=-1)
let mv=(b,m,w)=>{let s=m[0],d=m[1],t=m[2];b=b.slice();b[d]=w;if(s>=0)b[s]="-";if(t>=0)b[t]="-";return b}
let turn=_=>{let bb=B.slice(),P=-Infinity;
	A(B,0).forEach(m=>{
		let b=mv(B,m,0),p=PN(b,0);
		if(p>P){P=p;bb=b}
	})
	if(bb.every((x,i)=>B[i]==x))gameover("black")
	B=bb
	if(R<nine)R++;
	draw(0)
}

//let ktye=(B,w,l)=>{let a=AM(B,w),S=-10000;a.forEach(b=>{let r=l?ktye(b,!w,l-1):b,s=PN(r,w);if(s>S){S=s;B=b.slice()}});return B}

const defs=`<defs>
<filter id="s"><feDropShadow dx="0.02" dy="0.02" stdDeviation="0.02"/></filter>
</defs>`
const styl=`<style>
rect{vector-effect:non-scaling-stroke;stroke-width:6;stroke:black;fill:none}
line{vector-effect:non-scaling-stroke;stroke-width:6;stroke:black;fill:none}
text{fill:white;font-size:0.15px;font-family:monospace};
</style>`

let draw=(Y,m)=>{let t=defs+styl,x=0,y=0,i=0,c;document.title=Y?"black":"white";
 t+=`<g transform="translate(400.5 400.5) scale(120 120)">`
 let d=[],q=[],s=[];
 if(!Y){let a=A(B,1);if(!a.length)gameover("white");d=a.map(x=>x[1]);s=a.filter(x=>x[0]>=0).map(x=>x[0]);
  if(S>=0){console.log("S",S);a=a.filter(x=>x[0]==S);s=[];d=a.map(x=>x[1]); console.log("d",d);}
  else if(s.length)d=[];
  if(m){q=where(B,0).filter(x=>!mi(B,x));s=[];d=[]}}
 /*
 let d=Y?[]:R<18?B.map((_,i)=>B[i]=="-"?i:-1).filter(x=>x>=0):[];
 let q=Y?[]:[0]
 let s=Y?[]:[1]
 */
 E.forEach(e=>t+=`<line x1="${P[e[0]][0]}" x2="${P[e[1]][0]}" y1="${P[e[0]][1]}" y2="${P[e[1]][1]}"/>`)
 P.forEach((p,i)=>t+=`<circle id="p${i}" cx="${p[0]}" cy="${p[1]}" r="0.12" fill="black" ${d.includes(i)?"onclick='put(this)'":''} class="${d.includes(i)?'x':''}" />`)
 B.forEach((x,i)=>t+=(x=="-")?"":`<circle id="s${i}" cx="${P[i][0]}" cy="${P[i][1]}" r="0.25" fill=${x?"#ffe2b6":"#171310"} filter="url(#s)" ${s.includes(i)?"onclick='pick(this)'":''} ${q.includes(i)?"onclick='beat(this)'":''} class="${s.includes(i)||q.includes(i)?'x':''}" />`)
// P.forEach((p,i)=>t+=`<text x="${p[0]-0.05}" y="${p[1]+0.08}">${i}</text>`)

 board.innerHTML=t+"</g>"
 if(Y)setTimeout(turn,500)
};draw(0);

let gameover=w=>(GO=`game over ${w} lost`,draw);
</script></body></html>

