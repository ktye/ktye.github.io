<!DOCTYPE html><head><meta charset="utf-8"><link rel=icon href="../kelas16.png">
<title>spacewar</title><style>
body{font-family:monospace;font-size:xxx-large;margin:0;min-height:100vh;display:flex;justify-content:center;align-items:center;background:#333;}
canvas{width:min(100vw,100vh);height:min(100vw,100vh);background:#333}
</style></head><body><canvas id="cnv"></canvas><script>
let min=Math.min,max=Math.max,abs=Math.abs,sqrt=Math.sqrt,hypot=Math.hypot
let cos=Math.cos,sin=Math.sin,sign=Math.sign,asin=Math.asin,atan2=Math.atan2
let rand=_=>Math.random()
const pi=Math.PI,pi2=2*pi

//NextVelocity = ThisVelocity + ThisAcceleration * dt ;
//NextPosition = ThisPosition + NextVelocity * dt ;

const Sun=0.02,Ship=0.08,G=0.01
let bc=(x,y,r,p)=>(r=hypot(x,y),r>1?((p=atan2(y,x)),r-=2,[r*cos(p),r*sin(p)]):[x,y])
let A=0,B=0,Ax,Ay,Ap,Ua,Va,Wa,Bx,By,Bp,Ub,Vb,Wb,acc,bcc,vcc,wcc
let Afire,Bfire,ammo
let stars=Array(100).fill(0).map(x=>2*rand()-1);for(let i=0;i<stars.length;i+=2)[stars[i],stars[1+i]]=bc(stars[i],stars[1+i])
let t0
let fly=_=>{let v=hypot(Ub,Vb);bcc+=v<1?1:-1;vcc++;
 let dx=Bx-Ax,dy=By-Ay,r=hypot(dx,dy);
 if(r-abs(cos(Bp)*dx+sin(Bp)*dy)<0.1*r&&rand()<0.1)fire(Bx,By,Bp,Ub,Vb)
}
let reset=_=>{
 Ax=0.5,Ay=0.3,Ap=pi2*rand(),Ua=0.05,Va=0,Wa=0,Bx=-0.5,By=-0.3,Bp=pi2*rand(),Ub=-0.05,Vb=0,Wb=0,acc=0,bcc=0,vcc=0,wcc=0
 Afire=0;Bfire=0;ammo=[];
 requestAnimationFrame(frame);
}
let frame=t=>{
 if(t0===undefined)t0=t;let dt=t-t0
 dt*=0.0005
 
 cnv.width=w=cnv.getBoundingClientRect().width;
 cnv.height=h=cnv.getBoundingClientRect().height;
 const padlen=h/20,r=h/2-2

 let Fx,Fy;
 fly();
 [Fx,Fy]=gr(Ax,Ay);Fx+=cos(Ap)*acc;Fy+=sin(Ap)*acc;acc=0;Ua+=Fx*dt;Va+=Fy*dt;Wa+=wcc*dt;wcc=0;Ap+=Wa*dt;
 [Fx,Fy]=gr(Bx,By);Fx+=cos(Bp)*bcc;Fy+=sin(Bp)*acc;bcc=0;Ub+=Fx*dt;Vb+=Fy*dt;Wb+=vcc*dt;vcc=0;Bp+=Wb*dt;
 Ax+=Ua*dt;Ay+=Va*dt;[Ax,Ay]=bc(Ax,Ay)
 Bx+=Ub*dt;By+=Vb*dt;[Bx,By]=bc(Bx,By)
 if(hypot(Ax-Bx,Ay-By)<Sun)return reset(++A,++B)
 if(hypot(Ax,Ay)<Sun)return reset(++B);if(hypot(Bx,By)<Sun)return reset(++A);
 ammo=dammo(ammo);for(let i=0;i<ammo.length;i+=5){let[f,g]=gr(ammo[i],ammo[1+i]);ammo[2+i]+=f*dt;ammo[3+i]+=g*dt;[ammo[i],ammo[1+i]]=bc(ammo[i]+ammo[2+i]*dt,ammo[1+i]+ammo[3+i]*dt);ammo[4+i]-=dt;if(hypot(ammo[i],ammo[1+i])<Sun)ammo[4]=-1}
 for(let i=0;i<ammo.length;i+=5){ let x=ammo[i],y=ammo[1+i]; if(hypot(Ax-x,Ay-y)<Sun)return reset(++B); if(hypot(Bx-x,By-y)<Sun)return reset(++A) }

 let sun=r*Sun,ship=r*Ship,ax=r*Ax,ay=r*Ay,bx=r*Bx,by=r*By

// P=max(L,min(1-L,P-0.007*dir));
// Q=max(L,min(1-L,Q+0.007*sign(Y-Q)));

 let ctx=cnv.getContext("2d");ctx.translate(h/2,h/2);
 ctx.fillStyle="black"
 ctx.beginPath();ctx.arc(0,0,r,0,pi2);ctx.fill()
 ctx.fillStyle="white";ctx.strokeStyle="white"

 ctx.beginPath();ctx.arc(0,0,sun,0,pi2);ctx.fill();
 for(let i=0;i<stars.length;i+=2)ctx.fillRect(r*stars[i],r*stars[1+i],2,2);

 drawship(ctx,ax,ay,Ap,ship);ctx.stroke()
 drawship(ctx,bx,by,Bp,ship);ctx.fill()

 for(let i=0;i<ammo.length;i+=5)ctx.fillRect(r*ammo[i],r*ammo[1+i],3,3)
 ctx.font="30px monospace"
 ctx.fillText(A,0.85*r,-0.85*r)
 ctx.fillText(B,-0.85*r,-0.85*r)
 t0=t;requestAnimationFrame(frame)
}
let ln=(c,x0,y0,x1,y1)=>{c.beginPath();c.moveTo(x0,y0);c.lineTo(x1,y1);c.stroke()}
let drawship=(c,x,y,p,l)=>{let x1=x-l*cos(p-pi/12),y1=y-l*sin(p-pi/12),x2=x-l*cos(p+pi/12),y2=y-l*sin(p+pi/12);c.beginPath();c.moveTo(x,y);c.lineTo(x1,y1);c.lineTo(x2,y2);c.closePath()}
let gr=(x,y,r,p,r2)=>(r=hypot(x,y),r2=1/(r*r),p=atan2(y,x),[-r2*G*cos(p),-r2*G*sin(p)])
let fire=(x,y,p,u,v)=>ammo.push(x+Sun*cos(p),y+Sun*sin(p),u+1.5*cos(p),v+1.5*sin(p),5)
let dammo=x=>{let r=[];for(let i=0;i<x.length;i+=5)if(x[4]>0)r.push(x[i],x[1+i],x[2+i],x[3+i],x[4+i]);return r}

window.onkeydown=e=>{
 acc+=e.key=="ArrowUp"?1.0:e.key=="ArrowDown"?-1.0:0;
 wcc+=e.key=="ArrowLeft"?-5:e.key=="ArrowRight"?5:0;
 e.key==" "?fire(Ax,Ay,Ap,Ua,Va):0}

reset();

</script></body></html>
