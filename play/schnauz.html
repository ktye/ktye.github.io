<!DOCTYPE html><head><meta charset="utf-8"><link rel=icon href="../kelas16.png">
<title>schnauz</title><style>
body{margin:0;width:100vw;height:100vh;font-size:18vh}
</style></head><body>
<script src="cards.js"></script>
<script>

let af=Array.from
let deck,players,t,closing;
let newgame=n=>{
 deck=shuffle(thirtytwo())
 players="Lina,Tina,Franz Lunsenberg".split(",").slice(0,n);players.push("me")
 t={};
 ([...players,"table"]).forEach(p=>{t[p]=deck.slice(0,3);deck=deck.slice(3)})
 t.turn="Lina"
 closing=""
 setTimeout(play,1000)
 let sp=(t,r,f)=>{let s=document.createElement("span");s.textContent=t;s.onclick=f;s.style.position="absolute";s.style.top=0;if(r)s.style.right=0;return s};
 let s1=sp("1",0,_=>newgame(1)),s2=sp("2",1,_=>newgame(2));
 [s1,s2].forEach(x=>document.body.appendChild(x));
}

let nextplayer=i=>t.turn=players[(1+players.indexOf(t.turn))%players.length]

let sum=x=>x[0]+x[1]+x[2]
let valeur=n=>(!n)?11:n>9?10:1+n
let count=h=>{h=h.map(x=>[Math.floor(x/13),x%13]);
 if(h.every(x=>x[1]==h[0][1]))return h[0][1]==0?32:30.5;
 return Math.max(...[0,1,2].map(i=>{let c=h[i][0];return sum(h.map(x=>valeur(x[1])*(x[0]==c)))}))}
let whowins=t=>{show(t,1);
 players.forEach(x=>chair(t,x).innerHTML+=count(t[x]))
 let w=[players[0]],q=count(t[players[0]]);
 players.slice(1).forEach((p,x)=>{x=count(t[p]);if(x>q){q=x;w=[p]}else if(x==q)w.push(p)})
 let s=1==w.length&&w[0]=="me"?"Ich hab gewonnen":1==w.length?w[0]+" hat gewonnen":(w.join(" und ")+" gewinnen").replace("me ","ich ");
 stock.innerHTML+=s
}
let span=(t, sp)=>(sp=document.createElement("span"),sp.textContent=t,sp)
let thirtyone=t=>Object.values(t).slice(0,-2).map(count).some(x=>x>30.5)
let myturn=t=>{let my=[0,0,0],ta=t.table.map(x=>0);
 let count=a=>a[0]+a[1]+a[2];
 let next=_=>(nextplayer(),play())
 let swap=_=>([t.me,t.table]=[t.table,t.me],next())
 let exch=(i,j)=>(i=my.indexOf(1),j=ta.indexOf(1),[t.me[i],t.table[j]]=[t.table[j],t.me[i]],next())
 let toggle=(x,a,i)=>{a[i]=1-a[i];x.style.verticalAlign=a[i]?"super":"";x.style.borderBottom=a[i]?"4px solid":""}
 let ck=_=>(1==count(my)&&1==count(ta)?exch():3==count(my)||3==count(ta)?swap():0)
 let ix=x=>t.me.indexOf(c_.indexOf(x.textContent))
 let jx=x=>t.table.indexOf(c_.indexOf(x.textContent));
 let f=x=>(toggle(x,my,ix(x)),ck());
 let g=x=>(toggle(x,ta,jx(x)),ck());
 af(south.children).forEach(x=>x.onclick=_=>f(x))
 af(stock.children).forEach(x=>x.onclick=_=>g(x))
 let bt=(t,f, b)=>(b=span(t),b.onclick=f,b)
 south.appendChild(bt("ðŸ¤›",_=>(closing="me",next())))
 south.insertBefore(bt("ðŸ«·",next),south.firstChild)
}
let youplay=t=>{
 let ha=t[t.turn]
 let ta=t.table
 let a=[[],[0,1,2]],c=[count(ha),count(ta)]
 let e=[[0,0],[0,1],[0,2],[1,0],[1,1],[1,2],[2,0],[2,1],[2,2]]
 e.forEach(x=>{a.push(x);let h=ha.slice();h[x[0]]=ta[x[1]];c.push(count(h))})
 let m=0,j=0;c.forEach((x,i)=>x>m?(m=x,j=i):0)
 if(closing==""&&m>27)closing=t.turn;
 if(j==0)return;
 if(j==1){t.table=ha,t[t.turn]=ta;return}
 if(j >1){e=a[j];let s=e[0],d=e[1],x=ha[s];
  //console.log(t.turn,c_[s]+" <-> "+c_[d]);
  t[t.turn][s]=t.table[d];
  t.table[d]=x;
  //console.log(t.turn+">",t[t.turn],"ta",t.table)
}}
let play=_=>{
 if(thirtyone(t))return whowins(t);
 show(t,0);
 if(closing){let c=chair(t,closing);c.insertBefore(span("ðŸ¤›"),c.fistChild);}
 if(closing==t.turn){t.turn="";return whowins(t)};
 if(t.turn=="me")return myturn(t)
 youplay(t);
 nextplayer();
 setTimeout(play,1000)
}

newgame()


</script></body></html>




