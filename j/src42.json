{"a.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Adverbs                                                                 */","","#include \"j.h\"","#include \"a.h\"","","","static B booltab[64]={"," 0,0,0,0, 0,0,0,1, 0,0,1,0, 0,0,1,1,  0,1,0,0, 0,1,0,1, 0,1,1,0, 0,1,1,1,"," 1,0,0,0, 1,0,0,1, 1,0,1,0, 1,0,1,1,  1,1,0,0, 1,1,0,1, 1,1,1,0, 1,1,1,1,","};","","static DF2(bool2){R from(plus(duble(cvt(BOOL,a)),cvt(BOOL,w)),VAV(self)-\u003eh);}","","static DF1(bool1){R bool2(zero,w,self);}","","F1(bool){A b,h;I j,*v;"," RZ(w=vi(w));"," v=AV(w);"," DO(AN(w), j=*v++; ASSERT(-16\u003c=j\u0026\u0026j\u003c16,EVINDEX););"," GA(b,BOOL,64,2,0); *AS(b)=16; *(1+AS(b))=4; mv(BOOL,64L,AV(b),booltab);"," RZ(h=cant2(apv(AR(w),0L,1L),from(w,b)));"," R fdef(CBOOL,VERB, bool1,bool2, w,0L,h, RMAXL,0L,0L);","}","","","A sreduce(a,w,f2)A a,w;SF f2;{A z;C*v,*x,*xx;I c,k,m;"," RZ(w);"," m=IC(w); c=aii(w); k=bp(AT(w));"," if(!m)R reshape(behead(shape(w)),a);"," if(!AR(w))R ca(w);"," RZ(z=from(neg1,w));"," if(1==m)R z;"," v=(C*)AV(w)+c*k*(m-1);"," x=(C*)AV(z)+c*k;"," if(1==c){x-=k; DO(m-1, RZ(f2(v-=k,x,x)););}"," else {xx=x; DO(m-1, DO(c, v-=k; x-=k; RZ(f2(v,x,x));); x=xx;);}"," R z;","}","","extern A sum();","","static DF1(reduce){PROLOG;DECLF;A y,z;C*u,*v;I c,k,m,old,r,*s,t;"," RZ(w);"," r=AR(w); s=AS(w); t=AT(w); m=IC(w); c=aii(w);"," if(!m)R df1(w,iden(fix(fs)));"," if(!r)R ca(w);"," RZ(z=from(neg1,w));"," if(1==m)R z;"," if(CPLUS==ID(fs))R sum(w);"," GA(y,t,c,r-1,1+s); u=(C*)AV(y); k=c*bp(t); v=(C*)AV(w)+k*(m-1);"," old=tbase+ttop;"," DO(m-1, mv(t,c,u,v-=k); RZ(z=f2(y,z,fs)); gc(z,old););"," EPILOG(z);","}","","static AS2(oprod, rank2ex(a,w,fs,lr(fs),RMAXL,f2))","","F1(slash){"," RZ(w);"," R VERB\u0026AT(w)?ADERIV(CSLASH,reduce,oprod,RMAXL,RMAXL,RMAXL):evger(w,sc(GINSERT));","}","","static DF1(merge1){PROLOG;DECLF;A ind,z;C*v,*x;I c,k,r,*s,t,*u;"," RZ(w);"," r=MAX(0,AR(w)-1); s=1+AS(w); t=AT(w); c=aii(w);"," RZ(ind=pind(tally(w),f1(w,fs)));"," ASSERT(r==AR(ind),EVRANK);"," u=AS(ind); DO(r,ASSERT(s[i]==u[i],EVLENGTH););"," GA(z,t,c,r,s); x=(C*)AV(z); v=(C*)AV(w); u=AV(ind); k=bp(t);"," DO(c, mv1(t,1L,x+k*i,v+k*(i+c*u[i])););"," EPILOG(z);","}","","static DF2(merge2){PROLOG;DECLF;A ind,z;C*u,*x;I ak,an,ar,*as,in,ir,*is,*iv,t,zk;"," RZ(a\u0026\u0026w);"," an=AN(a); ar=AR(a); as=AS(a);"," ASSERT(!an||HOMO(AT(a),AT(w)),EVDOMAIN);"," RZ(ind=pind(sc(AN(w)),f2(a,w,fs)));"," in=AN(ind); ir=AR(ind); is=AS(ind); iv=AV(ind);"," ASSERT(ar\u003c=ir,EVRANK);"," DO(ar, ASSERT(as[i]==is[i+ir-ar],EVLENGTH););"," t=MAX(AT(a),AT(w)); RZ(a=cvt(t,a)); RZ(z=cvt(t,w));"," zk=bp(t); ak=zk*!!ar;"," x=(C*)AV(z); u=(C*)AV(a);"," DO(in, mv1(t,1L,x+zk**iv++,u+ak*(i%an)););"," EPILOG(z);","}","","F1(rbrace){"," RZ(w);"," R NOUN\u0026AT(w)?rbrace(qq(w,scf(inf))):ADERIV(CRBRACE,merge1,merge2,RMAXL,RMAXL,RMAXL);","}","","","static AS1(swap1, f2(w,w,fs))","","static AS2(swap2, f2(w,a,fs))","","static DF1(unquo1){RZ(   w); R unquote(0L,w,self);}","","static DF2(unquo2){RZ(a\u0026\u0026w); R unquote(a ,w,self);}","","F1(swap){"," RZ(w);"," if(VERB\u0026AT(w))R ADERIV(CTILDE,swap1,swap2,RMAXL,rr(w),lr(w));"," else{A t;","  RZ(w=onm(w)); AT(w)=CHAR;","  t=srdlg(w);","  if(!t)RZ(t=ds(CZERO));","  R NOUN\u0026AT(t) ? t : fdef(CTILDE,AT(t), unquo1,unquo2, w,0L,0L, mr(t),lr(t),rr(t));","}}","","","static I fixi;","static A fixpath;","static A*fixpv;","","static F1(fixa){A fs,z;V*v;"," RZ(z=ca(w));"," if(NOUN\u0026AT(z))R z;"," v=VAV(z);"," switch(v-\u003eid){","  case CGRCO:","  case CATDOT:","   v-\u003eh=every(v-\u003eh,fixa); v-\u003ef=every(v-\u003eh,aro); v-\u003eg=fixa(v-\u003eg);","   R z;","  case CTILDE:","   fs=v-\u003ef;","   if(CHAR\u0026AT(fs)\u0026\u0026!all1(eps(box(fs),fixpath))){","    ASSERT(fixi,EVLIMIT);","    fixpv[--fixi]=fs; z=fixa(symbrd(fs)); fixpv[fixi++]=mtv;","    R z;","   }","  default:","   v-\u003ef=fixa(v-\u003ef); v-\u003eg=fixa(v-\u003eg); v-\u003eh=fixa(v-\u003eh);","   R z;","}}","","F1(fix){PROLOG;A z;"," ASSERT(VERB\u0026AT(w),EVDOMAIN);"," RZ(fixpath=reshape(sc(fixi=255L),jot)); fixpv=(A*)AV(fixpath);"," z=fixa(w);"," EPILOG(z);","}","","","A every(w,f)A w;AF f;{A*v,*x,z;"," RZ(w);"," GA(z,BOX,AN(w),AR(w),AS(w));"," x=(A*)AV(z); v=(A*)AV(w); DO(AN(w),RZ(*x++=f(*v++)););"," R z;","}",""],"a.h":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Macros and Defined-Constants for Adverbs \u0026 Conjunctions                 */","","","#define GAPPEND         0L","#define GINSERT         3L","#define GTRAIN          6L","","#define CONJCASE(a,w)   (2*!(VERB\u0026AT(a))+!(VERB\u0026AT(w)))","#define NN              3               /* NOUN NOUN                       */","#define NV              2               /* NOUN VERB                       */","#define VN              1               /* VERB NOUN                       */","#define VV              0               /* VERB VERB                       */","","#define DECLF           V*sv=VAV(self);A fs=sv-\u003ef;                   \\","                        AF f1=fs?VAV(fs)-\u003ef1:0,f2=fs?VAV(fs)-\u003ef2:0","","#define DECLFG          V*sv=VAV(self);A fs=sv-\u003ef,gs=sv-\u003eg;          \\","                        AF f1=fs?VAV(fs)-\u003ef1:0,f2=fs?VAV(fs)-\u003ef2:0,  \\","                           g1=gs?VAV(gs)-\u003ef1:0,g2=gs?VAV(gs)-\u003ef2:0","","#define PREF1(f)        {I m=mr(self);            F1RANK(  m,f,self);}","#define PREF2(f)        {I l=lr(self),r=rr(self); F2RANK(l,r,f,self);}","","#define DF1(f)          A f(  w,self)A   w,self;","#define DF2(f)          A f(a,w,self)A a,w,self;","#define AS1(f,exp)      DF1(f){PROLOG;DECLF ;A z; PREF1(f); z=(exp); EPILOG(z);}","#define AS2(f,exp)      DF2(f){PROLOG;DECLF ;A z; PREF2(f); z=(exp); EPILOG(z);}","#define CS1(f,exp)      DF1(f){PROLOG;DECLFG;A z; PREF1(f); z=(exp); EPILOG(z);}","#define CS2(f,exp)      DF2(f){PROLOG;DECLFG;A z; PREF2(f); z=(exp); EPILOG(z);}","","#define ADERIV(id,f1,f2,m,l,r)  fdef(id,VERB,f1,f2,w,0L,0L,m,l,r)","#define CDERIV(id,f1,f2,m,l,r)  fdef(id,VERB,f1,f2,a,w ,0L,m,l,r)","","#define SCALARFN(id,w)  (id==ID(w)\u0026\u0026!lr(w)\u0026\u0026!rr(w))",""],"ai.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Adverbs:  Inverse \u0026 Identity Functions                                  */","","#include \"j.h\"","#include \"a.h\"","","static F1(invdef){A h;"," h=atop(atop(ds(CEQ),ds(CIOTA)),ds(CPOUND));"," R obverse(folk(atop(atco(ds(CDOMINO),w),h),dot(slash(ds(CPLUS)),ds(CSTAR)),","     ds(CRIGHT)), w);","}","","static F1(invamp){A f,ff,g,h,x,y;B nf,ng;C c,*yv;V*v;"," RZ(w);"," v=VAV(w);"," f=v-\u003ef; nf=!!(NOUN\u0026AT(f));"," g=v-\u003eg; ng=!!(NOUN\u0026AT(g));"," h=nf?g:f; x=nf?f:g; c=ID(h);"," switch(c){","  case CPLUS:   R amp(ds(CMINUS),x);","  case CMINUS:  R amp(x,ds(nf?CMINUS:CPLUS));","  case CSTAR:   R amp(ds(CDIV),x);","  case CDIV:    R amp(x,ds(nf?CDIV:CSTAR));","  case CROOT:   R amp(ds(nf?CEXP:CLOG),x);","  case CEXP:    R amp(x,ds(nf?CLOG:CROOT));","  case CLOG:    R nf?amp(x,ds(CEXP)):amp(ds(CROOT),x);","  case CJDOT:   R nf?atop(inv(ds(CJDOT)),amp(ds(CMINUS),x)):amp(ds(CMINUS),jdot1(x));","  case CRDOT:   R nf?atop(inv(ds(CRDOT)),amp(ds(CDIV  ),x)):amp(ds(CDIV  ),rdot1(x));","  case CLBRACE: R nf?amp(pinv(x),h):amp(x,ds(CIOTA));","  case CCOMMA:  R obverse(amp(sc(nf?IC(x):-IC(x)),ds(CDROP)),w);","  case CBASE:   ASSERT(nf,EVDOMAIN); R amp(x,ds(CABASE));","  case CABASE:  ASSERT(nf,EVDOMAIN); R amp(x,ds(CBASE));","  case CCANT:   ASSERT(nf,EVDOMAIN); R amp(pinv(x),h);","  case CROT:","  case CCIRCLE: ASSERT(nf,EVDOMAIN); R amp(negate(x),h);","  case CPDT:     ","   ASSERT(2==AR(x),EVRANK);","   ASSERT(*AS(x)==*(1+AS(x)),EVLENGTH);","   R nf?amp(ds(CDOMINO),x):amp(h,minv(x));","  case CDOMINO:  ","   ASSERT(2==AR(x),EVRANK);","   ASSERT(*AS(x)==*(1+AS(x)),EVLENGTH);","   RZ(ff=dot(slash(ds(CPLUS)),ds(CSTAR)));","   R nf?atop(h,amp(ff,minv(x))):amp(x,ff);","  case CIOTA:    ","   ASSERT(nf,EVDOMAIN);","   R obverse(atop(amp(ds(CLBRACE),x),amp(tally(x),ds(CSTILE))),w);","  case CATOMIC:","  case CCYCLE:   ","   ASSERT(nf,EVDOMAIN);","   ASSERT(AR(x)\u003c=(c==CCYCLE),EVRANK);","   R obverse( folk(atop(atop(ds(CGRADE),w),atop(ds(CIOTA),ds(CPOUND))),","       ds(CLBRACE),ds(CRIGHT)), w);","  case CDROP:","   ASSERT(nf,EVDOMAIN);","   ASSERT(1\u003e=AR(x),EVRANK);","   RZ(x=cvt(INT,x));","   RZ(y=eps(v2(-1L,1L),signum(x))); yv=(C*)AV(y);","   f=amp(mag(x),ds(CPLUS));","   g=1==AN(x)?ds(CPOUND):atop(amp(tally(x),ds(CTAKE)),ds(CDOLLAR));","   h=!yv[1]?f:atop(!yv[0]?ds(CMINUS):amp(negate(signum(x)),ds(CSTAR)),f);","   R obverse(hook(swap(ds(CTAKE)),atop(h,g)),w);"," }"," R invdef(w);","}","","static F1(alt){R atop(amp(ds(CDOLLAR),v2(1L,-1L)),ds(CPOUND));}","","static F1(shl){R amp(one,fit(ds(CROT),w));}","","static F1(shr){R fit(ds(CROT),w);}","","static F1(sl1_){R qq(qq(slash(w),one),scf(inf));}","","F1(inv){A f,ff,g;AF shf;B b,nf,ng,vf,vg;C c,id;V*v;"," RZ(w); ASSERT(VERB\u0026AT(w),EVDOMAIN);"," id=ID(w); v=VAV(w);"," if(c=ps[psptr[(UC)id]].inv)R ds(c);"," f=v-\u003ef; nf=f\u0026\u0026!!(NOUN\u0026AT(f)); vf=f\u0026\u0026!nf;"," g=v-\u003eg; ng=g\u0026\u0026!!(NOUN\u0026AT(g)); vg=g\u0026\u0026!ng;"," if(id==CAMP\u0026\u0026nf!=ng)R invamp(w);"," switch(id){","  case CCIRCLE:  R amp(ds(CDIV),pie);","  case CJDOT:    R amp(ds(CDIV),a0j1);","  case CRDOT:    R atop(amp(ds(CDIV),a0j1),ds(CLOG));","  case CDGRADE:  R atop(ds(CGRADE),ds(CREV));","  case CRECT:    R obverse(sl1_(ds(CJDOT)),w);","  case CPOLAR:   R obverse(sl1_(ds(CRDOT)),w);","  case CWORDS:   R obverse(atop(ds(CRAZE),","                     qq(under(amp(scc(' '),ds(CCOMMA)),ds(COPE)),one)  ),w);","  case CQQ:      if(vf)R qq(inv(f),g);              break;","  case COBVERSE: if(vf\u0026\u0026vg)R obverse(g,f);          break;","  case CPOWOP:   if(vf\u0026\u0026-1==i0(g))R f;              break;","  case CAT:","  case CAMP:     if(vf\u0026\u0026vg)R atop(inv(g),inv(f));   break;","  case CATCO:","  case CAMPCO:   if(vf\u0026\u0026vg)R atco(inv(g),inv(f));   break;","  case CTILDE:","   switch(ID(f)){","    case CPLUS:  R ds(CHALVE);","    case CSTAR:  R ds(CSQRT);","    case CJDOT:  R amp(ds(CDIV),increm(a0j1));","    case CLAMIN: R obverse(ds(CHEAD),w);","    case CSEMICO:R obverse(atop(ds(COPE),ds(CHEAD)),w);","    case CCOMMA: R obverse( hook(swap(ds(CTAKE)),","                     atop(atop(ds(CFLOOR),ds(CHALVE)),ds(CPOUND))), w);","    case CEXP:   R obverse(qq(colon(cstr(\"(- -\u0026b@(*^.) % \u003e:@^.)^:_ b=.^.y.\"),","                     mtv),zero),w);","    }","    break;","  case CBSLASH:","  case CBSDOT:","   if(CSLASH==ID(f)\u0026\u0026(ff=VAV(f)-\u003ef,ff\u0026\u0026VERB\u0026AT(ff))){","    b=id==CBSDOT; shf=b?shl:shr;","    switch(ID(ff)){","     case CPLUS: R obverse(hook(ds(CMINUS),shf(zero)),w);","     case CSTAR: R obverse(hook(ds(CDIV  ),shf(one )),w);","     case CEQ:   R obverse(hook(ds(CEQ   ),shf(one )),w);","     case CNE:   R obverse(hook(ds(CNE   ),shf(zero)),w);","     case CMINUS:","      R b ? obverse(hook(ds(CPLUS),shf(zero)),w) :","          obverse(folk(hook(ds(CMINUS),shf(zero)),qq(ds(CSTAR),neg1),alt(mark)),w);","     case CDIV:","      R b ? obverse(hook(ds(CSTAR),shf(one )),w) :","          obverse(folk(hook(ds(CDIV  ),shf(one )),qq(ds(CEXP ),neg1),alt(mark)),w);"," }}}"," R invdef(w);","}","","F1(iden){A f,g,r,s,t,x=0;C id;V*v;"," RZ(w); ASSERT(VERB\u0026AT(w),EVDOMAIN);"," id=ID(w); v=VAV(w); f=v-\u003ef; g=v-\u003eg;"," RZ(s=ds(CDOLLAR));"," RZ(r=atop(ds(CBEHEAD),s));"," RZ(t=atop(ds(CIOTA),amp(one,ds(CTAKE))));"," switch(id){","  case CCOMMA:  R atop(atop(atop(ds(CIOTA),amp(zero,ds(CCOMMA))),amp(two,ds(CDROP))),s);","  case CPDT:","  case CDOMINO: R atop(ds(CEQ),atop(t,r));","  case CCYCLE:","  case CLBRACE: R atop(t,r);","  case CSLASH:  if(VERB\u0026AT(f))R atop(iden(f),ds(CPOUND)); break;","  case CPLUS: case CMINUS: case CSTILE: case CNE:","  case CGT:   case CLT:    case COR:    case CJDOT:   case CRDOT:","               \tx=zero; break;","  case CSTAR: case CDIV:   case CEXP:   case CROOT:   case CBANG:","  case CEQ:   case CGE:    case CLE:    case CAND:","               \tx=one; break;","  case CMAX:    x=scf(-inf); break;","  case CMIN:    x=scf( inf); break;","  case CUNDER:  x=df1(df1(mtv,iden(f)),inv(g)); break;","  case CBOOL:","   switch(i0(f)){","    case 2: case 4: case 5:  case 6:  case 7:   x=zero; break;","    case 1: case 9: case 11: case 13:           x=one;"," }}"," if(x)R atop(amp(s,x),r);"," ASSERT(0,EVDOMAIN);","}",""],"ap.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Adverbs:  Partitions                                                    */","","#include \"j.h\"","#include \"a.h\"","","","static F1(oind){A*x,z;I d,m,m1,n,n1,p,q,r,*s;"," r=AR(w); s=AS(w);"," m=1\u003cr?*s:1;       m1=m-!!m;"," n=r?*(s+(1\u003cr)):1; n1=n-!!n;"," d=m\u0026\u0026n?m+n-1:0;"," GA(z,BOX,d,1,0); x=(A*)AV(z);"," DO(d, p=MIN(i,m1); q=MIN(i,n1); RZ(*x++=apv((1+p+q-i),q+n*(i-q),n1));)"," R z;","}","","static F2(osub){R ope(IC(w)?from(ope(a),w):w);}","","static AS1(oblique, df2(oind(w),ravel(rank1ex(w,0L,-2L,box)),","  atop(fs,qq(ac2(osub),v2(0L,1L))) ))","","static DF2(key){PROLOG;DECLF;A i,p,x,z;B*u;I c,d=-1,n,*v;"," RZ(a\u0026\u0026w);"," ASSERT(IC(a)==IC(w),EVLENGTH);"," RZ(x=indexof(a,a));"," RZ(i=grade1(x));"," RZ(x=from(i,x));"," n=AN(x); GA(p,BOOL,n,1,0);"," u=(B*)AV(p); v=AV(x); DO(n, c=d; d=*v++; *u++=c!=d;);"," z=df2(p,from(i,w),cut(fs,one));"," EPILOG(z);","}","","F1(sldot){"," RZ(w);"," R VERB\u0026AT(w)?ADERIV(CSLDOT,oblique,key,RMAXL,RMAXL,RMAXL):evger(w,sc(GAPPEND));","}","","static F2(seg){A z;I c,k,m=0,n=0,*u,wt;"," RZ(a\u0026\u0026w);"," if(INT\u0026AT(a)){u=AV(a); m=*u; n=*(1+u);}"," wt=AT(w); c=aii(w); k=c*bp(wt);"," GA(z,wt,n*c,MAX(1,AR(w)),AS(w)); *AS(z)=n;"," memcpy(AV(z),m*k+(C*)AV(w),n*k);"," R z;","}","","static F2(iind){A z;I d,j,k,m,n,p,*x;"," RZ(a\u0026\u0026w);"," m=i0(a); p=ABS(m); n=IC(w);"," d=0\u003em?(n+p-1)/p:MAX(0,1+n-m);"," GA(z,INT,2*d,2,0); *AS(z)=d; *(1+AS(z))=2;"," x=AV(z); k=0\u003em?p:1; j=-k; DO(d, *x++=j+=k; *x++=p;); if(d)*--x=MIN(p,n-j);"," R z;","}","","static F2(omask){A c,r,x,y;I m,n,p;"," RZ(a\u0026\u0026w);"," m=i0(a); p=ABS(m); n=IC(w);"," RZ(r=sc(0\u003em?(n+p-1)/p:MAX(0,1+n-m)));"," RZ(c=tally(w));"," RZ(x=reshape(sc(p)  ,zero));"," RZ(y=reshape(0\u003em?c:r,one ));"," R reshape(over(r,c),over(x,y));","}","","static AS1(prefix, df2(table(apv(IC(w),1L,1L)),w,atop(fs,ds(CTAKE))))","","static AS1(suffix, df2(table(ii(w)),           w,atop(fs,ds(CDROP))))","","static AS2(infix , df2(iind(a,w),              w,atop(fs,qq(ac2(seg),v2(1L,RMAXL)))))","","static AS2(outfix, df2(omask(a,w),             w,atop(fs,ds(CPOUND))))","","F1(bslash){RZ(w); R VERB\u0026AT(w)?ADERIV(CBSLASH,prefix,infix,RMAXL,0L,RMAXL):gtrain(w);}","","F1(bsdot){"," RZ(w);"," ASSERT(VERB\u0026AT(w),EVDOMAIN);"," R ADERIV(CBSDOT,suffix,outfix,RMAXL,0L,RMAXL);","}",""],"au.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Adverbs:  Utilities                                                     */","","#include \"j.h\"","#include \"a.h\"","","","A ac1(f)AF f;{R fdef(0,VERB, f,0L, 0L,0L,0L, RMAXL,0L,0L   );}","","A ac2(f)AF f;{R fdef(0,VERB, 0L,f, 0L,0L,0L, 0L,RMAXL,RMAXL);}","","DF1(df1){RZ(   w\u0026\u0026self); R(VAV(self)-\u003ef1)(  w,self);}","","DF2(df2){RZ(a\u0026\u0026w\u0026\u0026self); R(VAV(self)-\u003ef2)(a,w,self);}","","A ds(c)C c;{I t;P*p;"," p=ps+psptr[(UC)c]; t=p-\u003etype;"," switch(t){","  case NOUN: R(A)p-\u003ef1;","  case ASGN: R scalar4(t,(I)(c==CASGN));","  case NAME: R scnm(c);","  case VERB:","  case ADV:","  case CONJ: R fdef(c,t, p-\u003ef1,p-\u003ef2, 0L,0L,0L,(I)p-\u003emr,(I)p-\u003elr,(I)p-\u003err);","  case LPAR:","  case RPAR: R scalar4(t,0L);","  default:   R mark;","}}","","static F2(domerr){ASSERT(0,EVDOMAIN);}","","A fdef(id,t,f1,f2,fs,gs,hs,m,l,r)C id;I t,m,l,r;AF f1,f2;A fs,gs,hs;{A z;V*v;"," GA(z,t,1,0,0); v=VAV(z);"," v-\u003eid=id;"," v-\u003emr=m;"," v-\u003elr=l;"," v-\u003err=r;"," v-\u003ef1=f1?f1:domerr;"," v-\u003ef2=f2?f2:domerr;"," v-\u003ef =fs;"," v-\u003eg =gs;"," v-\u003eh =hs;"," R z;","}",""],"c.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Conjunctions                                                            */","","#include \"j.h\"","#include \"a.h\"","","#define ASSERTVV(a,w)  RZ(a\u0026\u0026w); ASSERT(VERB\u0026AT(a)\u0026AT(w),EVDOMAIN)","","","static DF1(withl){DECLFG; R g2(fs,w,gs);}","","static DF1(withr){DECLFG; R f2(w,gs,fs);}","","static CS1(on1, f1(g1(w,gs),fs))","","static CS2(on2, f2(g1(a,gs),g1(w,gs),fs))","","F2(amp){"," RZ(a\u0026\u0026w);"," switch(CONJCASE(a,w)){","  case NN: ASSERT(0,EVDOMAIN);","  case NV: R CDERIV(CAMP,withl,0L,RMAXL,RMAXL,RMAXL);","  case VN: R CDERIV(CAMP,withr,0L,RMAXL,RMAXL,RMAXL);","  case VV: R CDERIV(CAMP,on1,on2,mr(w),mr(w),mr(w));","}}","","","static DF1(under1){DECLFG; R df1(  w,atop(inv(fix(gs)),amp(fs,gs)));}","","static DF2(under2){DECLFG; R df2(a,w,atop(inv(fix(gs)),amp(fs,gs)));}","","F2(under){ASSERTVV(a,w); R CDERIV(CUNDER,under1,under2,mr(w),mr(w),mr(w));}","","","F2(ampco){ASSERTVV(a,w); R CDERIV(CAMPCO,on1,on2,RMAXL,RMAXL,RMAXL);}","","static CS2(upon2, f1(g2(a,w,gs),fs))","","F2(atop){ASSERTVV(a,w); R CDERIV(CAT,on1,upon2,mr(w),lr(w),rr(w));}","","F2(atco){ASSERTVV(a,w); R CDERIV(CATCO,on1,upon2,RMAXL,RMAXL,RMAXL);}","","F2(lev){R a;}","","F2(dex){R w;}","","","static CS1(obv1, f1(w,fs))","","static CS2(obv2, f2(a,w,fs))","","F2(obverse){ASSERTVV(a,w); R CDERIV(COBVERSE,obv1,obv2,mr(a),lr(a),rr(a));}","","","static DF2(dotprod){PROLOG;DECLFG;A z;I lg;"," RZ(a\u0026\u0026w);"," lg=lr(gs);"," z=df2(a,w,atop(fs,qq(qq(gs,v2(lg,MAX(lg,AR(w)-1))),v2(1+lg,RMAXL))));"," EPILOG(z);","}","","static F1(minors){A d; "," RZ(d=apv(3L,-1L,1L)); *AV(d)=0; "," R drop(d,df2(one,w,bsdot(ds(CLEFT))));","}","","static DF1(det){DECLFG;I c;"," PREF1(det);"," c=2\u003eAR(w)?1:*(1+AS(w));"," R !c ? df1(mtv,slash(gs)) : 1==c ? f1(ravel(w),fs) : ","    dotprod(rank1ex(w,0L,1L,head),det(minors(w),self),self);","}","","F2(dot){A f;C b;"," ASSERTVV(a,w);"," b=SCALARFN(CSTAR,w)\u0026\u0026CSLASH==ID(a)\u0026\u0026(f=VAV(a)-\u003ef,SCALARFN(CPLUS,f));"," R CDERIV(b?CPDT:CDOT,det,dotprod,2L,RMAXL,RMAXL);","}","","","static A eo(a,w,f)A a,w,f;{A z;V*u,*v;"," RZ(a\u0026\u0026w);"," ASSERT(VERB\u0026AT(a)\u0026AT(w),EVDOMAIN);"," RZ(z=folk(a,atco(ds(CHALVE),f),amp(a,w)));"," u=VAV(z); v=VAV(a); v-\u003emr=u-\u003emr; v-\u003elr=u-\u003elr; v-\u003err=u-\u003err;"," R z;","}","","F2(even){R eo(a,w,ds(CPLUS ));}","","F2(odd ){R eo(a,w,ds(CMINUS));}",""],"cc.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Conjunctions:  Cuts                                                     */","","#include \"j.h\"","#include \"a.h\"","","","static DF2(cut02){DECLF;A p,y;I*av0,*av1,k,*pv,*ws,*yv;"," PREF2(cut02);"," /* Approximately,  f(i.1{a){,(1{a){.(0{a)}.w */"," RZ(a=vi(a));"," ASSERT(2==AR(a),EVRANK);"," k=*(1+AS(a)); av0=AV(a); av1=k+av0; ws=AS(w);"," ASSERT(2==IC(a)\u0026\u0026k\u003c=AR(w),EVLENGTH);"," RZ(p=rank2ex(shape(w),take(rank(w),head(a)),0L,0L,0L,pind)); pv=AV(p);"," RZ(y=shape(w)); yv=AV(y); DO(k,yv[i]=av1[i];);"," DO(k, if(0\u003eav0[i])pv[i]+=1-ABS(yv[i]); ASSERT(0\u003c=pv[i]\u0026\u0026pv[i]\u003cws[i],EVLENGTH););"," R f1(from(iota(y),ravel(take(mag(y),drop(p,w)))),fs);","}","","static DF1(cut01){R cut02(lamin2(zero,negate(shape(w))),w,self);}","","static DF2(cut2){PROLOG;DECLFG;A t,*x,y,z;B*u;C c,*v;I an,i,j=0,k,m=0,n,s,wcn,wk,wt;"," PREF2(cut2);"," ASSERT(IC(a)==IC(w),EVLENGTH);"," RZ(a=cvt(BOOL,a));"," an=AN(a); u=(B*)AV(a); v=(C*)AV(w); wt=AT(w); wcn=aii(w); wk=wcn*bp(wt);"," DO(an, m+=u[i];);"," GA(t,BOX,m,1,0); x=(A*)AV(t);"," RZ(y=ca(rankle(w))); n=AN(w); s=*AS(w);"," c=1==*AV(gs); if(c)while(an\u003ej\u0026\u0026!u[j])j++;"," for(i=0;i\u003cm;i++){","  k=j; j+=c; while(an\u003ej\u0026\u0026!u[j])j++; j+=!c;","  AN(y)=wcn*(j-k); *AS(y)=j-k; mv(wt,AN(y),AV(y),v+k*wk);","  RZ(*x++=f1(y,fs));"," }"," AN(y)=n; *AS(y)=s;"," z=ope(t); EPILOG(z);","}","","static DF1(cut1){DECLFG;"," RZ(w);"," R!IC(w)?mtv:cut2(eps(w,take(1==*AV(gs)?one:neg1,w)),w,self);","}","","F2(cut){I k;"," RZ(a\u0026\u0026w);"," switch(CONJCASE(a,w)){","  case VN:","   RZ(w=vi(w));","   RE(k=i0(w));","   ASSERT(-3\u003c=k\u0026\u0026k\u003c=3,EVDOMAIN);","   if(0\u003ek){RZ(a=amp(a,ds(k==-1?CDROP:CCTAIL))); RZ(w=sc(-k));}","   switch(ABS(k)){","    case 0:  R CDERIV(CCUT,cut01,cut02,RMAXL,2L,RMAXL);","    case 1:","    case 2:  R CDERIV(CCUT,cut1 ,cut2 ,RMAXL,1L,RMAXL);","   }","  default: ASSERT(0,EVDOMAIN);","}}",""],"cf.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Conjunction: Fit !.                                                     */","","#include \"j.h\"","#include \"a.h\"","","D qct;","C qpps[7]=\"%0.6g\";","","static DF1(fitct1){DECLFG;A z;D q=qct; qct=*(D*)AV(gs); z=f1(  w,fs); qct=q; R z;}","","static DF2(fitct2){DECLFG;A z;D q=qct; qct=*(D*)AV(gs); z=f2(a,w,fs); qct=q; R z;}","","static DF1(fitpp1){DECLFG;A z;C q[3];"," memcpy(q,3+qpps,3L);"," sprintf(3+qpps,\"%ldg\",*AV(gs)); z=f1(w,fs);"," memcpy(3+qpps,q,3L);"," R z;","}","","static DF2(shift2){A gs,s,x,y;I c,m,n,p,t;"," F2RANK(0,RMAX,shift2,self);"," n=IC(w); t=AT(w); c=aii(w);"," p=i0(a); p=p\u003c-n?-n:n\u003cp?n:p; m=ABS(p);"," gs=VAV(self)-\u003eg;"," RZ(s=shape(w)); if(AR(w))*AV(s)=m;"," if(!AR(gs))RZ(x=reshape(s,gs))"," else if(AN(gs))RZ(x=rank2ex(behead(s),reitem(sc(m),gs),0L,1L,-1L,reshape))"," else RZ(x=reshape(s,filler(w)))"," if(AR(w)){y=drop(sc(p),w); R 0\u003cp?over(y,x):over(x,y);} else R m?x:ca(w);","}","","static DF1(shift1){R shift2(neg1,w,self);}","","static DF1(factp1){R df1(w,amp(scf(exp(1.0)),self));}","","static DF2(factp2){A gs,z;I n;V*sv;"," F2RANK(0,0,factp2,self);"," sv=VAV(self); gs=sv-\u003eg;"," RE(n=i0(w)); ASSERT(0\u003c=n,EVDOMAIN);"," RZ(z=reshape(shape(gs),one));"," DO(n, RZ(z=tymes(z,a)); RZ(a=plus(a,gs)););"," R z;","}","","F2(fit){D d;I k;"," RZ(a\u0026\u0026w);"," ASSERT(VERB\u0026AT(a)\u0026\u0026NOUN\u0026AT(w),EVDOMAIN);"," switch(ID(a)){","  case CLT:    case CLE:    case CGE:    case CGT:   case CNE:","  case CEQ:    case CMATCH: case CEPS:   case CIOTA: case CNUB: case CSTAR:","  case CFLOOR: case CCEIL:  case CSTILE: case COR:   case CAND: case CBASE:","   ASSERT(!AR(w),EVRANK);","   RZ(w=cvt(FL,w)); d=*(D*)AV(w);","   ASSERT(0\u003c=d\u0026\u0026d\u003c=5.820766091e-11,EVDOMAIN);","   R CDERIV(CFIT,fitct1,fitct2,mr(a),lr(a),rr(a));","  case CTHORN: case CIBEAM:","   ASSERT(!AR(w),EVRANK);","   RZ(w=vi(w)); k=*AV(w); ASSERT(0\u003ck\u0026\u0026k\u003c=NPP,EVDOMAIN);","   R CDERIV(CFIT,fitpp1,VAV(a)-\u003ef2,mr(a),lr(a),rr(a));","  case CROT:","   R CDERIV(CFIT,shift1,shift2,RMAXL,0L,RMAXL);","  case CEXP:","   R CDERIV(CFIT,factp1,factp2,RMAXL,0L,0L);","  default:","   ASSERT(0,EVDOMAIN);","}}",""],"cg.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Conjunctions: Gerunds ` and `:                                          */","","#include \"j.h\"","#include \"a.h\"","","","static DF1(con1){A h,*hv,*x,z;V*sv;"," PREF1(con1);"," sv=VAV(self); h=sv-\u003eh; hv=(A*)AV(h);"," GA(z,BOX,AN(h),AR(h),AS(h)); x=(A*)AV(z);"," DO(AN(h), RZ(*x++=(VAV(*hv)-\u003ef1)(w,*hv)); ++hv;);"," R ope(z);","}","","static DF2(con2){A h,*hv,*x,z;V*sv;"," PREF2(con2);"," sv=VAV(self); h=sv-\u003eh; hv=(A*)AV(h);"," GA(z,BOX,AN(h),AR(h),AS(h)); x=(A*)AV(z);"," DO(AN(h), RZ(*x++=(VAV(*hv)-\u003ef2)(a,w,*hv)); ++hv;);"," R ope(z);","}","","static DF1(insert){PROLOG;A hs,*hv,z;I hn,j,k,m,n;"," RZ(w);"," m=IC(w); hs=VAV(self)-\u003eh; hn=AN(hs); hv=(A*)AV(hs);"," if(!m)R df1(w,iden(fix(*hv)));"," j=n=MAX(hn,m-1);"," RZ(z=AR(w)?from(sc(n%m),w):ca(w));"," if(1==n)R z;"," DO(n, --j; k=j%hn; RZ(z=(VAV(hv[k])-\u003ef2)(from(sc(j%m),w),z,hv[k])););"," EPILOG(z);","}","","F2(evger){A hs,*hv,u;I i,l=0,m=0,n,r=0;"," RZ(a\u0026\u0026w);"," RZ(w=vi(w)); ASSERT(!AR(w),EVRANK);"," n=AN(a); ASSERT(n,EVLENGTH); ASSERT(BOX\u0026AT(a),EVDOMAIN);"," RZ(hs=every(a,fx)); hv=(A*)AV(hs);"," for(i=0;i\u003cn;++i){","  u=hv[i];","  ASSERT(VERB\u0026AT(u),EVDOMAIN);","  m=MAX(m,mr(u)); l=MAX(l,lr(u)); r=MAX(r,rr(u));"," }"," switch(*AV(w)){","  case GAPPEND:","   R AR(a) ? fdef(CGRCO,VERB, con1,con2, a,w,hs, m,l,r) : *hv;","  case GINSERT:","   ASSERT(1\u003e=AR(a),EVRANK);","   R fdef(CGRCO,VERB, insert,0L, a,w,hs, RMAXL,0L,0L);","  case GTRAIN:","   R gtrain(a);","  default:","   ASSERT(0,EVDOMAIN);","}}","","F2(tie){RZ(a\u0026\u0026w); R over(VERB\u0026AT(a)?arep(a):a,VERB\u0026AT(w)?arep(w):w);}","","","static DF1(case1){A u;V*sv;"," PREF1(case1);"," sv=VAV(self);"," RZ(u=from(df1(w,sv-\u003eg),sv-\u003eh));"," ASSERT(!AR(u),EVRANK);"," R df1(w,*AV(u));","}","","static DF2(case2){A u;V*sv;"," PREF2(case2);"," sv=VAV(self);"," RZ(u=from(df2(a,w,sv-\u003eg),sv-\u003eh));"," ASSERT(!AR(u),EVRANK);"," R df2(a,w,*AV(u));","}","","F2(agenda){A hs;"," RZ(a\u0026\u0026w)"," ASSERT(NOUN\u0026AT(a)\u0026\u0026VERB\u0026AT(w),EVDOMAIN);"," ASSERT(AN(a),EVLENGTH);"," ASSERT(BOX\u0026AT(a),EVDOMAIN);"," RZ(hs=every(a,fx));"," R fdef(CATDOT,VERB, case1,case2, a,w,hs, mr(w),lr(w),rr(w));","}",""],"cp.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Conjunctions:  Power Operator ^: and Associates                         */","","#include \"j.h\"","#include \"a.h\"","","","static DF1(ply){PROLOG;DECLFG;A hs,j,x,*xv,y,z;I i,*jv,k,m,n,*nv,old,p=0;"," hs=sv-\u003eh; m=AN(hs); nv=AV(hs);"," RZ(j=grade1(ravel(hs))); jv=AV(j);"," GA(x,BOX,m,AR(hs),AS(hs)); xv=(A*)AV(x);"," while(p\u003cm\u0026\u00260\u003env[jv[p]])p++;"," if(p\u003cm){","  RZ(z=ca(w));","  n=nv[jv[m-1]]; k=p;","  while(k\u003cm\u0026\u0026!nv[jv[k]]){xv[jv[k]]=z; ++k;}","  old=tbase+ttop;","  for(i=1;i\u003c=n;++i){","   RZ(z=f1(y=z,fs));","   if(all1(match(y,z))){DO(m-k, xv[jv[k+i]]=z;); break;}","   while(k\u003cm\u0026\u0026i==nv[jv[k]]){xv[jv[k]]=z; ++k;}","   gc3(x,z,0L,old);"," }}"," if(0\u003cp){","  RZ(fs=inv(fix(fs))); f1=VAV(fs)-\u003ef1;","  RZ(z=ca(w));","  n=nv[jv[0]]; k=p-1;","  old=tbase+ttop;","  for(i=-1;i\u003e=n;--i){","   RZ(z=f1(y=z,fs));","   if(all1(match(y,z))){DO(1+k, xv[jv[i]]=z;); break;}","   while(0\u003c=k\u0026\u0026i==nv[jv[k]]){xv[jv[k]]=z; --k;}","   gc3(x,z,0L,old);"," }}"," z=ope(x); EPILOG(z);","}","","static DF2(fibon){PROLOG;DECLFG;A hs,j,x,*xv,y,z,z0;B b,c;I i,*jv,k=0,m,n,*nv,old,q,r,s;"," hs=sv-\u003eh; m=AN(hs); nv=AV(hs);"," GA(x,BOX,m,AR(hs),AS(hs)); xv=(A*)AV(x);"," if(m){","  RZ(j=grade1(ravel(hs))); jv=AV(j);","  ASSERT(0\u003c=nv[jv[0]],EVDOMAIN);","  RZ(z0=ca(a)); RZ(z=ca(w)); b=0;","  n=nv[jv[m-1]];","  while(k\u003cm\u0026\u00262\u003e(r=nv[jv[k]])){xv[jv[k]]=r?z:z0; ++k;}","  old=tbase+ttop;","  for(i=2;i\u003c=n;++i){","   RZ(z=f2(z0,y=z,fs)); c=b; b=all1(match(z0,z)); z0=y;","   if(c\u0026\u0026b){r=i%2; DO(m-k, s=nv[q=jv[k+i]]; xv[q]=r!=s%2||s\u003e=LONG_MAX?y:z;); break;}","   while(k\u003cm\u0026\u0026i==nv[jv[k]]){xv[jv[k]]=z; ++k;}","   gc3(x,y,z,old);"," }}"," z=ope(x); EPILOG(z);","}","","static DF1(while1){DECLFG;A n,y,z;I old;"," RZ(z=ca(w));"," old=tbase+ttop;"," while(1){","  RZ(n=df1(z,gs));","  RZ(z=df1(y=z,!AR(n)\u0026\u0026BOOL\u0026AT(n)\u0026\u0026*(B*)AV(n)?fs:powop(fs,n)));","  if(all1(match(z,y)))R z;","  tpop(z);","}}","","static DF2(while2){DECLFG; R df1(w,powop(amp(a,fs),amp(a,gs)));}","","static DF1(inv1){R df1(w,inv(fix(VAV(self)-\u003ef)));}","","F2(powop){A hs;"," RZ(a\u0026\u0026w);"," switch(CONJCASE(a,w)){","  case VN:","   RZ(hs=vib(sc(LONG_MAX),w));","   if(AR(hs)||-1!=*AV(hs))R fdef(CPOWOP,VERB, ply,fibon, a,w,hs, RMAXL,RMAXL,RMAXL);","   R evoke(a) ? fdef(CPOWOP,VERB, inv1,0L, a,w,0L, RMAXL,RMAXL,RMAXL) : inv(fix(a));","  case VV:","   R CDERIV(CPOWOP,while1,while2,RMAXL,RMAXL,RMAXL);","  default: ASSERT(0,EVDOMAIN);","}}",""],"cr.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Conjunctions:  Rank Associates                                          */","","#include \"j.h\"","#include \"a.h\"","","#define DR(r)           (0\u003er?RMAXL:r)","","","static I efr(ar,r)I ar,r;{R 0\u003er?MAX(0,r+ar):MIN(r,ar);}","","static DF1(rank1){DECLF;I m,wr;"," RZ(w);"," wr=AR(w); m=efr(wr,*AV(sv-\u003eh));"," R m\u003cwr?rank1ex(w,fs,m,f1):f1(w,fs);","}","","static DF2(rank2){DECLF;I ar,wr,l,r,*v=AV(sv-\u003eh);"," RZ(a\u0026\u0026w);"," ar=AR(a); l=efr(ar,v[1]);"," wr=AR(w); r=efr(wr,v[2]);"," R l\u003car||r\u003cwr?rank2ex(a,w,fs,l,r,f2):f2(a,w,fs);","}","","F2(qq){A hs,t;D*d;I n,*hv,r[3],*v;"," RZ(a\u0026\u0026w);"," if(NOUN\u0026AT(a))R qq(atop(amp(a,ds(CLEFT)),ds(CLEFT)),w);"," RZ(hs=apv(3L,0L,0L)); hv=AV(hs);"," if(VERB\u0026AT(w)){","  GA(t,FL,3,1,0); d=(D*)AV(t);","  n=r[0]=hv[0]=mr(w); d[0]=n\u003c=-RMAX?-inf:RMAX\u003c=n?inf:n;","  n=r[1]=hv[1]=lr(w); d[1]=n\u003c=-RMAX?-inf:RMAX\u003c=n?inf:n;","  n=r[2]=hv[2]=rr(w); d[2]=n\u003c=-RMAX?-inf:RMAX\u003c=n?inf:n;","  w=t;"," }else{","  n=AN(w);","  ASSERT(1\u003e=AR(w),EVRANK);","  ASSERT(0\u003cn\u0026\u0026n\u003c4,EVLENGTH);","  RZ(t=vib(sc(RMAXL),w)); v=AV(t);","  hv[0]=v[2==n]; r[0]=DR(hv[0]);","  hv[1]=v[3==n]; r[1]=DR(hv[1]);","  hv[2]=v[n-1];  r[2]=DR(hv[2]);"," }"," R fdef(CQQ,VERB, rank1,rank2, a,w,hs, r[0],r[1],r[2]);","}","","","A sex1(w,zt,f1)A w;I zt;SF f1;{A z;C*v,*x;I n,wk,zk;"," RZ(w);"," n=AN(w);"," GA(z,zt,n,AR(w),AS(w));"," wk=bp(AT(w)); v=(C*)AV(w)-wk;"," zk=bp(zt);    x=(C*)AV(z)-zk;"," DO(n,RZ(f1(v+=wk,x+=zk)););"," R z;","}","","A sex2(a,w,zt,f2)A a,w;I zt;SF f2;{A z;C*av,b,*u,*v,*wv,*x;"," I ak,an,ar,*as,m,n,wk,wn,wr,*ws,zk;"," RZ(a\u0026\u0026w);"," an=AN(a); ar=AR(a); as=AS(a); ak=bp(AT(a)); u=av=(C*)AV(a);"," wn=AN(w); wr=AR(w); ws=AS(w); wk=bp(AT(w)); v=wv=(C*)AV(w);"," b=ar\u003c=wr; m=b?an:wn; n=m?(b?wn:an)/m:0;"," DO(b?ar:wr, ASSERT(as[ar-1-i]==ws[wr-1-i],EVLENGTH););"," GA(z,zt,m*n,b?wr:ar,b?ws:as); zk=bp(zt); x=(C*)AV(z);"," DO(n, DO(m, RZ(f2(u,v,x)); x+=zk; u+=ak; v+=wk;); b?(u=av):(v=wv););"," R z;","}","","","A rank1ex(w,fs,mr,f1)A w,fs;I mr;AF f1;{PROLOG;A*x,yw,yz,z;C*v;"," I n,wcn,wcr,wf,wk,wr,*ws,wt;"," RZ(w);"," wr=AR(w); ws=AS(w); wt=AT(w); v=(C*)AV(w); wcr=efr(wr,mr); wf=wr-wcr;"," n=prod(wf,ws); wcn=n?AN(w)/n:prod(wcr,wf+ws);"," GA(yw,wt,wcn,wcr,ws+wf); wk=wcn*bp(wt);"," GA(yz,BOX,n,wf,ws); x=(A*)AV(yz);"," if(n){DO(n, mv(wt,wcn,AV(yw),v); RZ(*x++=f1(yw,fs)); v+=wk;); z=ope(yz);}"," else{A y;","  RZ(y=f1(reshape(shape(yw),zero),fs));","  GA(z,AT(y),0,wf+AR(y),ws); mv(INT,AR(y),wf+AS(z),AS(y));"," }"," EPILOG(z);","}","","A rank2ex(a,w,fs,lr,rr,f2)A a,w,fs;I lr,rr;AF f2;{PROLOG;A*x,ya,yw,yz,z;"," C*av,b,*u,*v,*wv;I acn,acr,af,ak,ar,*as,at,i,j,m,n,p,q,*s,wcn,wcr,wf,wk,wr,*ws,wt;"," RZ(a\u0026\u0026w);"," ar=AR(a); as=AS(a); at=AT(a); u=av=(C*)AV(a);"," wr=AR(w); ws=AS(w); wt=AT(w); v=wv=(C*)AV(w);"," acr=efr(ar,lr); af=ar-acr; acn=prod(acr,as+af); ak=acn*bp(at);"," wcr=efr(wr,rr); wf=wr-wcr; wcn=prod(wcr,ws+wf); wk=wcn*bp(wt);"," b=af\u003c=wf; p=b?wf:af; q=b?af:wf; s=b?ws:as; n=prod(p-q,s); m=prod(q,s+p-q);"," DO(q, ASSERT(as[af-1-i]==ws[wf-1-i],EVLENGTH););"," GA(ya,at,acn,acr,as+af);"," GA(yw,wt,wcn,wcr,ws+wf);"," GA(yz,BOX,m*n,p,s); x=(A*)AV(yz);"," if(n\u0026\u0026m){","  for(i=0;i\u003cn;i++){","   for(j=0;j\u003cm;j++){","    mv(at,acn,AV(ya),u); u+=ak;","    mv(wt,wcn,AV(yw),v); v+=wk;","    RZ(*x++=f2(ya,yw,fs));","   }","   b?(u=av):(v=wv);","  }","  z=ope(yz);"," }else{A y;","  if(AN(a))mv(at,acn,AV(ya),av); else RZ(ya=reshape(shape(ya),zero));","  if(AN(w))mv(wt,wcn,AV(yw),wv); else RZ(yw=reshape(shape(yw),zero));","  RZ(y=f2(ya,yw,fs));","  GA(z,AT(y),0,p+AR(y),s); mv(INT,AR(y),p+AS(z),AS(y));"," }"," EPILOG(z);","}",""],"ct.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Conjunction: Trains -- Fork, Hook, A-Trains, C-Trains                   */","","#include \"j.h\"","#include \"a.h\"","","#define TAAA            0","#define TAAC            1","#define TACA            2","#define TACC            3","#define TCAA            4","#define TCAC            5","#define TCCA            6","#define TCCC            7","","#define TAA             0","#define TAC             1","#define TCA             2","#define TCC             3","","#define TDECL           V*sv=VAV(self);A fs=sv-\u003ef,gs=sv-\u003eg,hs=sv-\u003eh;","","","static DF1(fork1){DECLFG;A hs=sv-\u003eh;AF h1=VAV(hs)-\u003ef1;"," PREF1(fork1);"," R g2(f1(w,fs),h1(w,hs),gs);","}","","static DF2(fork2){DECLFG;A hs=sv-\u003eh;AF h2=VAV(hs)-\u003ef2;"," PREF2(fork2);"," R g2(f2(a,w,fs),h2(a,w,hs),gs);","}","","A folk(f,g,h)A f,g,h;{I l,m,r;"," RZ(f\u0026\u0026g\u0026\u0026h);"," ASSERT(VERB\u0026AT(f)\u0026AT(g)\u0026AT(h),EVDOMAIN);"," m=MAX(mr(f),mr(h));"," l=MAX(lr(f),lr(h));"," r=MAX(rr(f),rr(h));"," R fdef(CFORK,VERB,fork1,fork2,f,g,h,m,l,r);","}","","","static CS1(hook1, f2(w,g1(w,gs),fs))","","static CS2(hook2, f2(a,g1(w,gs),fs))","","F2(hook){"," RZ(a\u0026\u0026w);"," ASSERT(VERB\u0026AT(a)\u0026AT(w),EVDOMAIN);"," R CDERIV(CHOOK,hook1,hook2,RMAXL,RMAXL,RMAXL);","}","","","static DF1(taaa){TDECL; R df1(df1(df1(w,fs),gs),hs);}","","static DF2(taca){TDECL; R df2(df1(a,fs),df1(w,hs),  gs);}","","static DF2(tacc){TDECL; R df2(df1(a,fs),df2(a,w,hs),gs);}","","static DF2(tcaa){TDECL; R df1(df1(df2(a,w,fs),gs),hs);}","","static DF2(tcca){TDECL; R df2(df2(a,w,fs),df1(w,hs),  gs);}","","static DF2(tccc){TDECL; R df2(df2(a,w,fs),df2(a,w,hs),gs);}","","A forko(f,g,h)A f,g,h;{AF f1=0,f2=0;I t=CONJ;"," RZ(f\u0026\u0026g\u0026\u0026h);"," switch(4*!(ADV\u0026AT(f))+2*!(ADV\u0026AT(g))+!(ADV\u0026AT(h))){","  case TAAA: f1=taaa; t=ADV; break;","  case TAAC: ASSERT(0,EVDOMAIN);","  case TACA: f2=taca;        break;","  case TACC: f2=tacc;        break;","  case TCAA: f2=tcaa;        break;","  case TCAC: ASSERT(0,EVDOMAIN);","  case TCCA: f2=tcca;        break;","  case TCCC: f2=tccc;"," }"," R fdef(CFORKO,t, f1,f2, f,g,h, 0L,0L,0L);","}","","static DF1(taa){TDECL; R df1(df1(w,fs),gs);}","","static DF1(tac){TDECL; R df2(df1(w,fs),w,gs);}","","static DF2(tca){TDECL; R df1(df2(a,w,fs),gs);}","","F2(hooko){AF f1=0,f2=0;I t=ADV;"," RZ(a\u0026\u0026w);"," switch(2*!(ADV\u0026AT(a))+!(ADV\u0026AT(w))){","  case TAA: f1=taa;         break;","  case TAC: f1=tac;         break;","  case TCA: f2=tca; t=CONJ; break;","  case TCC: ASSERT(0,EVDOMAIN);"," }"," R fdef(CHOOKO,t, f1,f2, a,w,0L, 0L,0L,0L);","}","","","static DF1(aform){V*sv=VAV(self);A fs=sv-\u003ef,gs=sv-\u003eg;"," R CONJ\u0026AT(fs) ? df2(w,gs,fs) : df2(fs,w,gs);","}","","F2(advform){"," RZ(a\u0026\u0026w);"," ASSERT(AT(a)\u0026CONJ\u0026\u0026AT(w)\u0026NOUN+VERB||AT(a)\u0026NOUN+VERB\u0026\u0026AT(w)\u0026CONJ,EVDOMAIN);"," R fdef(CADVF,ADV, aform,0L, a,w,0L, 0L,0L,0L);","}","","","F1(gtrain){A hs,*hv,u;I j,n,t;"," RZ(w);"," n=AN(w);"," ASSERT(1\u003e=AR(w),EVRANK);"," ASSERT(n,EVLENGTH);"," ASSERT(BOX\u0026AT(w),EVDOMAIN);"," RZ(hs=every(w,fx)); hv=(A*)AV(hs);"," t=AT(hv[0]);"," ASSERT(t\u0026VERB+ADV+CONJ,EVDOMAIN);"," t=t\u0026VERB?t:ADV+CONJ;"," DO(n, ASSERT(t\u0026AT(hv[i]),EVDOMAIN););"," if(t\u0026VERB){","  u=hv[n-1]; j=n-3; DO((n-1)/2, RZ(u=folk(hv[j],hv[1+j],u));  j-=2;);","  R n%2 ? u : hook(*hv,u);"," }else{","  u=hv[0];   j=1;   DO((n-1)/2, RZ(u=forko(u,hv[j],hv[1+j])); j+=2;);","  R n%2 ? u : hooko(u,hv[n-1]);","}}",""],"cx.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Conjunction:  Explicit Definition : and Associates                      */","/*                                                                         */","/*                                                                         */","/* Usage of the f,g,h fields of :-defined verbs:                           */","/*  f  character matrix of  left argument to :                             */","/*  g  character matrix of right argument to :                             */","/*  h  4-element vector of boxes                                           */","/*       0  vector of boxed tokens excluding labels for f                  */","/*       1  2-column matrix of (label) link (line#) for f                  */","/*       2  vector of boxed tokens excluding labels for g                  */","/*       3  2-column matrix of (label) link (line#) for g                  */","","#include \"j.h\"","#include \"a.h\"","","","static I ensuite(w)A w;{"," RZ(w\u0026\u0026AN(w));"," if(!(INT\u0026AT(w)))RZ(w=cvt(INT,w));"," ASSERT(1\u003e=AR(w)\u0026\u0026INT\u0026AT(w),EVDEFN);"," R 1+*AV(w);","}","","static I nline;","","static F1(label){A*v;I k;"," RZ(w);"," v=(A*)AV(w); k=i0(v[1]); RZ(symbis(*v,apv(nline-k,k,1L),local));"," R one;","}","","static DF2(xd){PROLOG;DECLFG;A f,*line,name,loc=local,seq,*v,z=0;B b;I i=0,n,old;"," b=a\u0026\u0026w\u0026\u0026VERB\u0026AT(self); v=b+b+(A*)AV(sv-\u003eh);"," f=v[0]; line=(A*)AV(f); n=nline=AN(f); ASSERT(n,EVDOMAIN);"," GA(local,SYMB,twprimes[0],1,0);"," if(AN(v[1]))RZ(rank1ex(v[1],0L,1L,label));"," symbis(scnm(CALPHA),a,   local);"," symbis(scnm(COMEGA),w,   local);"," name=scnm(CGOTO); seq=ii(f); old=tbase+ttop;"," do{","  tpop(old);","  symbis(name,behead(seq),local);","  z=parse(ca(line[i]));","  if(errsee\u0026\u0026!z){jerr=0; JSPR(\"[%ld] \",i); jpr(from(sc(i),b?gs:fs)); break;}","  seq=srd(name,local);","  i=ensuite(seq)-1;"," } while(0\u003c=i\u0026\u0026i\u003cn);"," z=car(z); ++AC(local); fa(local); local=loc;"," asgn=0;"," EPILOG(z);","}","","static CS1(xv1, f1(w,fs))","","static CS2(xv2, g2(a,w,gs))","","static DF1(xn1){RZ(   w); R vn(xd(0L,w,self));}","","static DF2(xn2){RZ(a\u0026\u0026w); R vn(xd(a ,w,self));}","","static DF1(xadv ){RZ(w);    R xd(w,0L,self);}","","static DF2(xconj){RZ(a\u0026\u0026w); R xd(a,w, self);}","","static F1(preparse){A lab,s,*sv,t,*tv,y,*yv;I i,j=0,n;"," RZ(w);"," RZ(t=every(BOX\u0026AT(w)?w:rank1ex(w,0L,1L,box),tokens));"," n=AN(t); tv=(A*)AV(t);"," RZ(y=reshape(sc(2*n),jot)); yv=(A*)AV(y);"," for(i=0;i\u003cn;++i){","  s=tv[i]; sv=(A*)AV(s); lab=sv[1];","  if(7\u003c=AN(s)\u0026\u0026NAME\u0026AT(lab)\u0026\u0026RPAR\u0026AT(sv[2])){","   yv[j++]=lab; RZ(yv[j++]=sc(i)); sv[2]=mark; RZ(tv[i]=drop(two,s));"," }}"," R link(t,box(reshape(v2(j/2,2L),y)));","}","","F2(colon){A h,ha,hw;B b,c;I an,at,wn,wt;"," RZ(a\u0026\u0026w);"," an=AN(a); at=AT(a); b=NOUN\u0026at;"," wn=AN(w); wt=AT(w); c=NOUN\u0026wt;"," if(wn\u0026\u0026NUMERIC\u0026wt){","  RZ(w=vi(w)); ASSERT(!AR(w),EVRANK);","  switch(*AV(w)){","   case 11: R vtrans(a);","   case 12: R ctrans(a);"," }}"," RZ(ha=hw=over(jot,jot));"," if(b){","  ASSERT(AR(a)\u003c=1+(CHAR==at),EVRANK);","  if(an){","   ASSERT(at\u0026BOX+CHAR,EVDOMAIN);","   RZ(ha=preparse(a));","   RZ(a= at\u0026BOX ? ope(rankle(a)) : 2\u003eAR(a) ? lamin1(rankle(a)) : a);"," }}"," if(!wn||wt\u0026BOX+CHAR){","  ASSERT(AR(w)\u003c=1+(CHAR==wt),EVRANK);","  if(wn){","   RZ(hw=preparse(w));","   RZ(w= wt\u0026BOX ? ope(rankle(w)) : 2\u003eAR(w) ? lamin1(rankle(w)) : w);"," }}"," RZ(h=over(ha,hw));"," if(wn\u0026\u0026NUMERIC\u0026wt)","  switch(*AV(w)){","   case 1:  R fdef(CCOLON, ADV,  xadv,0L,  a,w,h,  0L,0L,0L);","   case 2:  R fdef(CCOLON, CONJ, 0L,xconj, a,w,h,  0L,0L,0L);","   default: ASSERT(0,EVDOMAIN);","  }"," R fdef(CCOLON,VERB, b?xn1:xv1,c?xn2:xv2, a,w,h, b?RMAX:mr(a),c?RMAX:lr(w),c?RMAX:rr(w));","}",""],"f.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Formatting (Thorn)                                                      */","","#include \"j.h\"","","#if (SYS \u0026 SYS_PC386+SYS_386IX)","#define CPINF           'i'             /* printf result of _  */","#define CPNAN           'n'             /* printf result of _. */","#else","#define CPINF           'I'             /* printf result of _  */","#define CPNAN           'N'             /* printf result of _. */","#endif","","#define CPMINUS         '-'             /* printf minus sign   */","#define CPPLUS          '+'             /* printf plus  sign   */","","#define NTH2            500","#define WB              2L","#define WI              12L","#define WD              (9L+NPP)","#define WZ              (WD+WD)","","#define ENGAP(j,r,s,exp) {C b;I k=1;I p=j;I*sr=s+r-2;          \\","                           DO((r-1)*!!p, k*=*(sr-i); b=!(p%k); exp;); }","#define FMTX(f,T)       void f(s,v)C*s;T*v;","","","static FMTX(fmtB,B){*s=*v?'1':'0'; *++s=0;}","","static FMTX(fmtI,I){sprintf(s,\"%ld\",*v); if('-'==*s)*s=CSIGN;}","","static FMTX(fmtD,D){C buf[1+WD],c,q,*t;D x=*v;I k=0;"," sprintf(buf,qpps,0==x\u0026\u00261!=x?0:x);  /* 1!=x to handle NaN */"," c=*buf;"," if(c==CPMINUS)*s++=CSIGN;"," q=(c==CPMINUS)||(c==CPPLUS);"," c=buf[q];"," if(c==CPINF){*s++='_'; *s=0;}"," else if(c==CPNAN){if('-'!=*buf)*s++='_'; *s++='.'; *s=0;}"," else{","  if('.'==c)*s++='0';","  memcpy(s,buf+q,1+WD);","  if(t=strchr(s,'e')){","   if(CPMINUS==*++t)*t++=CSIGN;","   while(c=*(k+t),c=='0'||c==CPPLUS)k++;","   if(k)while(*t=*(k+t))t++;","}}}","","static FMTX(fmtZ,Z){"," fmtD(s,\u0026v-\u003ere);"," if(0!=v-\u003eim){I k=strlen(s); *(k+s)='j'; fmtD(1+k+s,\u0026v-\u003eim);}","}","","static A th(w,wd,fmt)A w;I wd;void(*fmt)();{"," PROLOG;A d,t,z;C q[WZ],*tv,*x,*y;I b,c,*dv,k,m,n,r,*s;"," RZ(w);"," n=AN(w); r=AR(w); s=AS(w);"," c=r?s[r-1]:1; m=n/c; b=bp(AT(w));"," GA(t,CHAR,wd*n,1,0); tv=(C*)AV(t);"," y=tv-wd; x=(C*)AV(w)-b; DO(n,fmt(y+=wd,x+=b);); y=tv;"," RZ(d=apv(c,1L,0L)); dv=AV(d);"," DO(m*(BOOL!=AT(w)), DO(c, k=strlen(y); dv[i]=MAX(dv[i],k); y+=wd;););"," --dv[c-1]; k=0; DO(c, k+=++dv[i];); y=tv;"," GA(z,CHAR,m*k,r+!r,s); *(AS(z)+r-!!r)=k; x=(C*)AV(z); memset(x,' ',AN(z));"," DO(m, DO(c, x+=dv[i]; k=strlen(y); memcpy(x-k-(c\u003e1+i),memcpy(q,y,k),k); y+=wd;););"," EPILOG(z);","}","","","static F1(rc){A*v,x,y;I j,k,n,r,*s,xn,*xv,yn,*yv;"," RZ(w);"," n=AN(w); r=AR(w); s=AS(w); v=(A*)AV(w);"," xn=1\u003cr?s[r-2]:1; yn=r?s[r-1]:1;"," RZ(x=apv(xn,0L,0L)); xv=AV(x);"," RZ(y=apv(yn,0L,0L)); yv=AV(y);"," DO(n, s=AS(*v++); j=i/yn%xn; k=i%yn; xv[j]=MAX(xv[j],*s); yv[k]=MAX(yv[k],*(1+s)););"," DO(xn,xv[i]++;); DO(yn,yv[i]++;);"," R link(x,y);","}","","static void encell(zv,wd,w)C*zv;I wd;A w;{C*p,*q;I c,*s;"," s=AS(w); c=*(1+s); p=zv-wd; q=(C*)AV(w)-c; DO(*s, memcpy(p+=wd,q+=c,c););","}","","static void fram(k,n,x,v)I k,n,*x;C*v;{C a,b=9==k,d,l,r;"," l=qbx[k]; a=b?' ':qbx[10]; d=b?l:qbx[1+k]; r=b?l:qbx[2+k];"," *v++=l; DO(n, memset(v,a,x[i]-1); v+=x[i]-1; *v++=d;); *--v=r;","}","","static F1(enframe){A d,*v,x,y,z;C*s,*t,*zv;I ht,j,k,m,n,p,q,r,wd,xn,*xv,yn,*yv;"," RZ(d=rc(w));"," n=AN(w); r=MAX(2,AR(w)); v=(A*)AV(w);"," x=*(A*)(0+AV(d)); xn=AN(x); xv=AV(x); ht=1; DO(xn,ht+=xv[i];);"," y=*(A*)(1+AV(d)); yn=AN(y); yv=AV(y); wd=1; DO(yn,wd+=yv[i];);"," p=ht*wd; q=MAX(1,xn*yn); m=n/q;"," GA(z,CHAR,m*p,r,AS(w)); *(AS(z)+r-2)=ht; *(AS(z)+r-1)=wd; zv=(C*)AV(z);"," if(!n)R z;","  /* Initialize with box-drawing characters */"," fram(9L,yn,yv,zv); t=zv; DO(ht-2, memcpy(t+=wd,zv,wd););"," fram(3L,yn,yv,s=t=zv+wd*xv[0]); DO(xn-1, memcpy(t+=wd*xv[1+i],s,wd););"," fram(0L,yn,yv,zv);"," fram(6L,yn,yv,zv+p-wd);"," t=zv; DO(m-1, memcpy(t+=p,zv,p););","  /* Fill in each cell */"," j=1; DO(xn, k=xv[i]; xv[i]=j; j+=k;);"," j=1; DO(yn, k=yv[i]; yv[i]=j; j+=k;);"," DO(n, j=i/yn%xn; k=i%yn; encell(zv+i/q*p+wd*xv[j]+yv[k],wd,*v++););"," R z;","}","","static F1(mat){A z;C*v,*x;I c,k,m=1,p,q,qc,r,*s,t;"," RZ(w);"," r=AR(w); s=AS(w); t=AT(w); v=(C*)AV(w);"," q=1\u003cr?s[r-2]:1; c=r?s[r-1]:1; qc=q*c;"," k=2\u003cr?2-r:0; DO(r-2, m*=s[i]; k+=m;); p=m*q+k*(m\u0026\u0026q);"," GA(z,t,p*c,2,0); *AS(z)=p; *(1+AS(z))=c; x=(C*)AV(z);"," if(2\u003cr)mv1(t,AN(z),x,FILL(t));"," DO(m, ENGAP(i*q,r,s,x+=c*b); mv(t,qc,x,v); x+=qc; v+=qc;);"," R z;","}","","F1(matth1){R mat(thorn1(w));}","","static F1(thbox){PROLOG;A z;"," RZ(w);"," z=BOX\u0026AT(w)?enframe(every(w,matth1)):matth1(w);"," EPILOG(z);","}","","","F1(thorn1){"," RZ(w);"," if(!AN(w)){A z;C b=BOX==AT(w);I r=MAX(2*b,AR(w));","  GA(z,CHAR,0,r,AS(w));","  if(b){I*s=r+AS(z); *--s=0; *--s=0;}","  R z;"," }"," switch(AT(w)){","  case NAME:","  case CHAR: R ca(w);","  case BOX:  R thbox(w);","  case BOOL: R th(w,WB,fmtB);","  case INT:  R th(w,WI,fmtI);","  case FL:   R th(w,WD,fmtD);","  case CMPX: R th(w,WZ,fmtZ);","  case VERB:","  case ADV:","  case CONJ: R thbox(drep(evoke(w)?symbrd(VAV(w)-\u003ef):w));","  default:   R 0;","}}","","F1(jpr){PROLOG;A y;C*v;I c,m=1,n,q,r,*s;"," RZ(w);"," RZ(y=thorn1(w));"," n=AN(y); r=AR(y); s=AS(y); v=(C*)AV(y);"," q=1\u003cr?s[r-2]:1; c=r?s[r-1]:1; DO(r-2,m*=s[i];);"," DO(m, ENGAP(i*q,r,s,if(b)jputc(CNL)); DO(q, v=wr(c,v); if(!breaker())R 0;););"," EPILOG(w);","}","","static void c2j(wd,s,x)I wd;C*s,*x;{B b;C c,*q=s,*t=s;I k=0,m;"," if(m=strspn(x,\" \")){memcpy(s,x,m); s+=m; x+=m;}"," if(b=CPMINUS==*x){*s++=CSIGN; ++x;}"," c=*x;"," if(c==CPINF||c==CPPLUS||c==CPNAN){","  if(!wd\u0026\u0026' '==*t)++t; else if(1\u003cwd){memset(q,' ',wd); t=q+wd-2;}","  if(c==CPNAN)strcpy(t,\"_.\"); else strcpy(t+(!b\u0026\u00261\u003cwd),b?\"__\":\"_\");"," }else{","  if('.'==*x)*s++='0';","  memcpy(s,x,1+strlen(x));","  if(t=strchr(s,'e')){","   if(CPMINUS==*++t)*t++=CSIGN;","   while(c=*(k+t),c=='0'||c==CPPLUS)++k;","   if(k){","    if(!c||' '==c){*t++='0'; --k;}","    while(*t=*(k+t))++t;","    if(wd){DO(wd-(t-q),*t++=' ';); *t=0;}","}}}}","","static I pstr(p,e)C*p;D e;{D x,y;S d,w;"," w=x=fabs(0.1*tfloor(10*e));"," if(0\u003c=e)sprintf(p, w?\"%%%1.1ff\":\" %%%1.1ff\", x);"," else{y=10*(x-w); d=tfloor(y)+!!(SYS\u0026SYS_PC); sprintf(p,\" %%- %d.%de\",w-1,d);}"," R w;","}","","F2(thorn2){PROLOG;A z;C buf[NTH2],p[15],*wv,*x;D*av,e,y;I an,i,k,m=0,n,wd,wk,wn,wt,zn;"," F2RANK(1,1,thorn2,0);"," an=AN(a); wn=AN(w); n=MAX(an,wn);"," ASSERT(1==an||1==wn||wn==an,EVLENGTH);"," wt=AT(w); wk=1==wn?0:bp(wt); ASSERT(wt\u0026NUMERIC,EVDOMAIN);"," RZ(a=cvt(FL,a));"," av=(D*)AV(a); wv=(C*)AV(w);"," zn=20*n; GA(z,CHAR,zn,1,0); x=(C*)AV(z);"," for(i=0;i\u003cn;++i){","  if(!i||1\u003can){wd=pstr(p,e=*av++); ASSERT(wd\u003cNTH2,EVLIMIT);}","  switch(wt){","   case BOOL: sprintf(buf,p,(D)*wv);     break;","   case INT:  sprintf(buf,p,(D)*(I*)wv); break;","   default:   y=*(D*)wv; sprintf(buf,p,y);","  }","  while(zn\u003cm+strlen(buf)){RZ(z=over(z,z)); zn+=zn; x=(C*)AV(z);}","  c2j(wd,m+x,buf+(!i\u0026\u0026!wd\u0026\u0026' '==*buf\u0026\u00260\u003c=e));","  k=strlen(m+x);","  if(wd\u0026\u0026wd\u003ck)memset(m+x,'*',wd);","  wv+=wk; m+=wd?wd:k;"," }"," *(m+x)=0; z=str(m,x);"," EPILOG(z);","}",""],"i.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Initializations                                                         */","","#include \"j.h\"","#include \"io.h\"","","#define GGA(v,t,n,r)    {GA(v,t,n,r,0); AC(v)=LONG_MAX/2;}","#define GG4(v,t,exp)    {GGA(v,t,1,0); *AV(v)=(I)(exp);}","#define GG8(v,t,exp)    {GGA(v,t,1,0); *(D*)AV(v)=(exp);}","","","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)","#include \"mac.h\"","static A initevm(v,i,s)A*v;S i;C*s;{C x[256];"," GetIndString(x,IdErrMsgs,i);"," R v[i]=str((I)*x,1+x);","}","#else","static A initevm(v,i,s)A*v;S i;C*s;{R v[i]=cstr(s);}","#endif","","static void sigflpe(k)int k;{jsignal(EVDOMAIN); signal(SIGFPE,sigflpe);}","","C jinit2(argc,argv)int argc;C**argv;{A*v;C b=1,*s;D*d;S t;"," tssbase=CLOCK;"," infile=stdin; outfile=0; jstf-\u003eact=JFPROF;","#if !(SYS \u0026 SYS_ARCHIMEDES)"," b=isatty(fileno(stdin));","#endif","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_SESM)"," sesm=b;"," if(1\u003cargc){C*s;","  ASSERT(2==argc,EVLENGTH); s=argv[1];","  if('/'==*s){ASSERT('s'==s[1],EVDOMAIN); sesm=0;}"," }","#endif"," sesminit();"," GGA(alp,CHAR,NALP,1); s=(C*)AV(alp); DO(NALP,*s++=i;); ps[psptr[(UC)CALP]].f1=(AF)alp;"," GGA(global,SYMB,twprimes[3],1);"," GGA(mtv, BOOL,0,1);"," GGA(zero,BOOL,1,0); *(B*)AV(zero)=0;"," GGA(one, BOOL,1,0); *(B*)AV(one )=1;"," GGA(dash,CHAR,1,0); *(C*)AV(dash)='-';"," GGA(a0j1,CMPX,1,0); d=(D*)AV(a0j1); *d=0; *(1+d)=1;"," GG4(jot, BOX ,mtv);"," GG4(neg1,INT ,-1 );"," GG4(two, INT ,2  );"," GG4(mark,MARK,0  );"," GG8(pie ,FL  ,PI );"," qct=1.0; DO(44, qct  *=0.5;);"," qfuzz=qct;"," memcpy(\u0026inf,XINF,(size_t)sizeof(D));"," memcpy(\u0026nan,XNAN,(size_t)sizeof(D));"," GA(qevm,BOX,1+NEVM,1,0); v=(A*)AV(qevm);"," RZ(initevm(v,EVBREAK  ,\"break\"            ));"," RZ(initevm(v,EVDEFN   ,\"defn error\"       ));"," RZ(initevm(v,EVDOMAIN ,\"domain error\"     ));"," RZ(initevm(v,EVILNAME ,\"ill-formed name\"  ));"," RZ(initevm(v,EVILNUM  ,\"ill-formed number\"));"," RZ(initevm(v,EVINDEX  ,\"index error\"      ));"," RZ(initevm(v,EVINPRUPT,\"input interrupt\"  ));"," RZ(initevm(v,EVFACE   ,\"interface error\"  ));"," RZ(initevm(v,EVLENGTH ,\"length error\"     ));"," RZ(initevm(v,EVLIMIT  ,\"limit error\"      ));"," RZ(initevm(v,EVNONCE  ,\"nonce error\"      ));"," RZ(initevm(v,EVNOTASGN,\"not reassignable\" ));"," RZ(initevm(v,EVOPENQ  ,\"open quote\"       ));"," RZ(initevm(v,EVRANK   ,\"rank error\"       ));"," RZ(initevm(v,EVSPELL  ,\"spelling error\"   ));"," RZ(initevm(v,EVSYNTAX ,\"syntax error\"     ));"," RZ(initevm(v,EVSYSTEM ,\"system error\"     ));"," RZ(initevm(v,EVVALUE  ,\"value error\"      ));"," RZ(initevm(v,EVWSFULL ,\"ws full\"          ));"," ra(qevm);","#if (SYS \u0026 SYS_PC+SYS_PC386)"," t=EM_ZERODIVIDE+EM_INVALID; _control87(t,t);","#else"," signal(SIGFPE,sigflpe);","#endif"," if(b\u0026\u0026!LINKJ){","  jouts(\"J 4.2   Copyright (c) 1990-1992, Iverson Software Inc.  All Rights Reserved.\");","  jputc(CNL); jputc(CNL);"," }else qprompt[0]=0;"," R 1;","}",""],"io.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Input/Output                                                            */","","#include \"j.h\"","#include \"io.h\"","","#if (SYS \u0026 SYS_PC)","#include \u003cdos.h\u003e","static int cbrk;","#endif","","","static C inbuf[2+NINPUT];","I        jbrk=0;","","","F1(joff){","#if (SYS \u0026 SYS_PC)"," setcbrk(cbrk);","#endif"," if(outfile\u0026\u0026outfile!=stdout)fclose(outfile); sesmexit(); exit(0);","}","","void jouts(s)C*s;{if(outfile)fputc(COUT,outfile); jputs(s);}","","static void sigint(k)int k;{++jbrk; signal(SIGINT,sigint);}","","","/* --------------------- Special Session Manager ------------------------- */","","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_SESM)","","#define CINPRUPT \"o\\010u\\010t\"","","#if (SYS \u0026 SYS_PC386)","C breaker(){if(sesm)jstpoll(); if(jbrk){jbrk=0; jsignal(EVBREAK);} R!jerr;}","#else","C breaker(){if(sesm)jstkiav(); if(jbrk){jbrk=0; jsignal(EVBREAK);} R!jerr;}","#endif","","A jgets(){C c,*s=inbuf;I k=0,n;"," if(infile==stdin){if(sesm)jsti((SI)NINPUT,s); else RZ(fgets(s,NINPUT,stdin));}"," else{do RZ(fgets(s,NINPUT,infile))while(COUT==*s); k=strspn(s,\" \");}"," jbrk=0;"," n=strlen(s); if(n\u0026\u0026(c=*(s+n-1),CLF==c||CCR==c)){--n; *(s+n)=0;}"," if(infile!=stdin){jputs(k+s); jputc(CNL);}"," else if(outfile){fputs(k+s,outfile); fputc(CNL,outfile);}"," ASSERT(5!=n||memcmp(s,CINPRUPT,n),EVINPRUPT);"," if(n\u0026\u0026CCTRLD==*(s+n-1))joff(zero);"," R str(n,s);","}","","void jputc(c)C c;{"," if(tostdout){if(sesm)jsto((SI)MTYOUT,(SI)1,\u0026c); else fputc(c,stdout);}"," if(outfile)fputc(c,outfile);","}","","void jputs(s)C*s;{"," if(tostdout){if(sesm)jsto((SI)MTYOUT,(SI)strlen(s),s); else fputs(s,stdout);}"," if(outfile)fputs(s,outfile);","}","","void prompt(s)C*s;{"," if(tostdout){if(sesm)jsto((SI)MTYOIN,(SI)strlen(s),s); else fputs(s,stdout);}"," if(outfile)fputs(s,outfile);","}","","void sesmexit(){if(sesm)jststop();}","","C sesminit(){"," if(sesm){A t;I j,mask=0xfffffff0L;","  struct{Ptr vlog;SI nlog;Ptr vinb;SI ninb;Ptr vfkd;SI nfkd;Ptr vedb;SI nedb;}in;","#if (SYS \u0026 SYS_PC+SYS_PC386)","  /* The 15+ and \u00260xfffffff0 are because addresses must be segment aligned */","  GA(t,CHAR,15+NLOG,1,0); j=(I)(15+(C*)AV(t)); j\u0026=mask; in.vlog=(Ptr)j; in.nlog=NLOG;","  GA(t,CHAR,15+NINB,1,0); j=(I)(15+(C*)AV(t)); j\u0026=mask; in.vinb=(Ptr)j; in.ninb=NINB;","  GA(t,CHAR,15+NFKD,1,0); j=(I)(15+(C*)AV(t)); j\u0026=mask; in.vfkd=(Ptr)j; in.nfkd=NFKD;","  GA(t,CHAR,15+NEDB,1,0); j=(I)(15+(C*)AV(t)); j\u0026=mask; in.vedb=(Ptr)j; in.nedb=NEDB;","  edbuf=in.vedb;","#endif","  jstinit((Ptr)\u0026in);"," }","#if (SYS \u0026 SYS_PC386)"," else jstsbrk();","#else"," signal(SIGINT,sigint);","#endif","#if (SYS \u0026 SYS_PC)"," cbrk=getcbrk(); setcbrk(1);","#endif"," R 1;","}","","C*wr(n,v)I n;C*v;{I k=0,m;"," if(tostdout){","  if(sesm)while(n\u003ek\u0026\u0026!jerr){m=MIN(3000,n-k); jsto((SI)MTYOUT,(SI)m,v+k); k+=m;}","  else    while(n\u003ek\u0026\u0026!jerr)k+=fwrite(v+k,sizeof(C),(size_t)(n-k),stdout);"," }"," if(outfile){","  fputc(COUT,outfile);","  k=0;    while(n\u003ek\u0026\u0026!jerr)k+=fwrite(v+k,sizeof(C),(size_t)(n-k),outfile);"," }"," jputc(CNL); R v+n;","}","","","/* --------------------- Others (No Session Manager) --------------------- */","","#else","","C breaker(){R!jerr;}","","A jgets(){C*s=inbuf;I k=0,n;"," if(infile==stdin)RZ(fgets(s,NINPUT,stdin))"," else{do RZ(fgets(s,NINPUT,infile))while(COUT==*s); k=strspn(s,\" \");}"," jbrk=0;"," n=strlen(s); if(n\u0026\u0026CNL==*(s+n-1)){--n; *(s+n)=0;}"," if(infile!=stdin){jputs(k+s); jputc(CNL);}"," else if(outfile){fputs(k+s,outfile); fputc(CNL,outfile);}"," if(n\u0026\u0026CCTRLD==*(s+n-1))joff(zero);"," R str(n,s);","}","","void jputc(c)C c;{if(tostdout)fputc(c,stdout); if(outfile)fputc(c,outfile);}","","void jputs(s)C*s;{if(tostdout)fputs(s,stdout); if(outfile)fputs(s,outfile);}","","void prompt(s)C*s;{jputs(s);}","","void sesmexit(){}","","C sesminit(){signal(SIGINT,sigint); R 1;}","","C*wr(n,v)I n;C*v;{I k=0;"," if(tostdout)while(n\u003ek\u0026\u0026!jerr)k+=fwrite(v+k,sizeof(C),(size_t)(n-k),stdout);"," if(outfile){","  fputc(COUT,outfile);","  k=0;       while(n\u003ek\u0026\u0026!jerr)k+=fwrite(v+k,sizeof(C),(size_t)(n-k),outfile);"," }"," jputc(CNL); R v+n;","}","","#endif",""],"io.h":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Input/Output                                                            */","","","#define JFOPEN          'o'","#define JFPRINT         'p'","#define JFPROF          'f'","#define JFSAVE          's'","","typedef struct{I vol,type;C act,name[256];} JF;","","extern JF              *jstf;","","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_SESM)","","#define MTYOUT          1","#define MTYOIN          2","#define NLOG            16348           /* size of session log             */","#define NINB            224             /* size of type-ahead buffer       */","#define NFKD            5               /* size of fn key defn buffer      */","#define NEDB            12000           /* size of edit buffer             */","","#if (SYS \u0026 SYS_PC+SYS_PC386)","extern C*               edbuf;","#endif","","#if (SYS \u0026 SYS_PC386)","extern void             jstpoll(void);","extern void             jstsbrk(void);  /* break handling for j /s         */","#else","extern void             jstkiav(void);","#endif","","extern I                jbrk;           /* needed by session manager       */","extern void             jsti(SI,C*);","extern void             jstinit(Ptr);","extern void             jsto(SI,SI,C*);","extern void             jststop(void);","","#endif","","/* jstf                                                                    */","/*  Pointer to file selected during jsti() cycle.                          */","/* jsti(S n, C*s)                                                          */","/*  Put input line into 0-terminated string s, maximum n chars.            */","/* jstinit(Ptr v)                                                          */","/*  Initialize sesm. v=\u0026in and is ignored on the Mac.                      */","/*  struct{C*vlog;short nlog;C*vinb;short ninb;C*vfkd;short nfkd;}in;      */","/*  nlog: length of session log;       vlog: session log space             */","/*  ninb: length of typeahead buffer;  vinb: typeahead buffer              */","/*  nfkd: length of fnkey defn buffer; vfkd: fnkey defn buffer             */","/* jstpoll(void)                                                           */","/*  \"Keyboard input available?\"; invoked by j periodically to pass control */","/*  to sesm.                                                               */","/* jsto(S code, S n, C*s)                                                  */","/*  Output string s, length n.  code is MTYOUT (more output to follow) or  */","/*  MTYOIN (last line of output, i.e. output is prompt)                    */","/* jststop(void)                                                           */","/*  Called before j terminates, to let sesm shut down gracefully.          */",""],"j.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* main(), Main Loop, \u0026 Global Variables                                   */","","#include \"j.h\"","","","A alp,a0j1,dash,jot,mark,mtv,neg1,one,pie,two,zero;","B asgn;","I bytes,maxbytes,tbase= -NTSTACK,totbytes,ttop=NTSTACK;","B errsee=!LINKJ;","D inf;","C jerr;","D nan;","C obuf[NOBUF],tostdout=1; FILE*infile,*outfile;","A qevm;","D qfuzz;","C qprompt[1+NPROMPT]=\"   \";","I qrl=16807;","B sesm;","D tssbase;","Z zeroZ={0,0};","","#if (SYS \u0026 SYS_PC+SYS_PC386)","C*edbuf;","U _stklen = 65535u;","C qbx[11]={218,194,191, 195,197,180, 192,193,217, 179,196};","#else","C qbx[11]={43,43,43,    43,43,43,    43,43,43,    124,45 };","#endif","","","C immloop(){A x=mtv;I old=tbase+ttop;"," while(x)","  if(!appf()){","   prompt(qprompt); x=jgets();","   if(jerr)x=mtv; else{maxbytes=bytes; immex(x);}","   jerr=0;","   tpop(old);","}}","","","#if !LINKJ","int main(argc,argv)int argc;C**argv;{if(jinit2(argc,argv))immloop();}","#endif",""],"j.h":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Global Definitions                                                      */","","","#define SYS_AMIGA               1L","#define SYS_ARCHIMEDES          2L","#define SYS_ATARIST             4L","#define SYS_ATT3B1              8L","#define SYS_IBMRS6000           16L","#define SYS_MACINTOSH           32L","#define SYS_MIPSR3000           64L","#define SYS_NEXT                128L","#define SYS_PC                  256L","#define SYS_PC386               512L","#define SYS_SGIIRIX             1024L","#define SYS_SUN3                2048L","#define SYS_SUN386I             4096L","#define SYS_SUN4                8192L","#define SYS_VAX                 16384L","#define SYS_386IX               32768L","#define\tSYS_IBMRT\t\t65536L","","#ifdef ibm032","#define SYS                     SYS_IBMRT","#elif defined(_IBMR2)","#define\tSYS\t\t\tSYS_IBMRS6000","#elif defined(vax)","#define\tSYS\t\t\tSYS_VAX","#endif","","#define LINKJ                   0","/* #define WATERLOO                1 */","","#define SYS_ANSILIB             (SYS_AMIGA + SYS_ARCHIMEDES + \\","                                 SYS_IBMRS6000 + SYS_MACINTOSH + SYS_PC + \\","                                 SYS_PC386 + SYS_VMCMS)","#define SYS_SESM                (SYS_ARCHIMEDES + SYS_PC + SYS_PC386 + \\","                                 SYS_MACINTOSH)","#define SYS_UNIX                (SYS_ATT3B1 + SYS_IBMRS6000 + \\","                                 SYS_MIPSR3000 + SYS_NEXT + SYS_SGIIRIX + \\","                                 SYS_SUN3 + SYS_SUN386I + SYS_SUN4 + \\","                                 SYS_VAX + SYS_386IX + SYS_IBMRT)","#define SYS_LILENDIAN           (SYS_ARCHIMEDES + SYS_PC + SYS_PC386 + \\","                                 SYS_SUN386I + SYS_386IX)","","","#if (SYS \u0026 SYS_ATARIST)","#define __NO_INLINE__           1","#endif","","#if (SYS \u0026 SYS_UNIX)","#include \u003cmemory.h\u003e","#include \u003csys/types.h\u003e","#endif","","#if (SYS \u0026 SYS_ANSILIB)","#include \u003cfloat.h\u003e","#include \u003climits.h\u003e","#include \u003cstdlib.h\u003e","#endif","","#include \u003cerrno.h\u003e","#include \u003cmath.h\u003e","#include \u003csignal.h\u003e","#include \u003cstdio.h\u003e","#include \u003cstring.h\u003e","#include \u003ctime.h\u003e","#include \"jc.h\"","#include \"jt.h\"","#include \"je.h\"","","","#if (SYS \u0026 SYS_LILENDIAN)","#define XINF            \"\\000\\000\\000\\000\\000\\000\\360\\177\"","#define XNAN            \"\\000\\000\\000\\000\\000\\000\\370\\377\"","#endif","","#if (SYS \u0026 SYS_MACINTOSH)","#define XINF            \"\\177\\377\\000\\000\\000\\000\\000\\000\\000\\000\"","#define XNAN            \"\\377\\377\\100\\000\\000\\000\\000\\000\\000\\000\"","#endif","","#ifndef XINF","#define XINF            \"\\177\\360\\000\\000\\000\\000\\000\\000\"","#define XNAN            \"\\377\\370\\000\\000\\000\\000\\000\\000\"","#endif","","","#ifndef PI","#define PI              3.14159265358979323846","#endif","#ifndef LONG_MAX","#define LONG_MAX        2147483647L","#endif","#ifndef LONG_MIN","#define LONG_MIN        (~2147483647L)","#endif","#ifndef OVERFLOW","#define OVERFLOW        8.988465674311578e307","#endif","#ifndef UNDERFLOW","#define UNDERFLOW       4.450147717014403e-308","#endif","","","#define NALP            256             /* size of alphabet                */","#define NINPUT          843             /* max # of chars in input line    */","#define NOBUF           100             /* length of obuf                  */","#define NPP             20              /* max value for quad pp           */","#define NPROMPT         20              /* max length of immex prompt      */","#define NTSTACK         2000L           /* size of stack for temps         */","#define RMAX            127             /* max rank                        */","#define RMAXL           127L            /* max rank, long                  */","","#ifdef __HIGHC__","#define\tABS(a)\t\t_abs(a)","#else","#define ABS(a)          (0\u003c=(a)?(a):-(a))","#endif","#define DO(n,stm)       {I i=0;I _n=(n); for(;i\u003c_n;i++){stm}}","#define EPILOG(z)       R gc(z,_ttop)","#define F1(f)           A f(  w)A   w;","#define F2(f)           A f(a,w)A a,w;","#define F1RANK(m,f,self)    {RZ(   w); if(m\u003cAR(w))            \\","                                 R rank1ex(  w,(A)self,(I)m,     f);}","#define F2RANK(l,r,f,self)  {RZ(a\u0026\u0026w); if(l\u003cAR(a)||r\u003cAR(w))   \\","                                 R rank2ex(a,w,(A)self,(I)l,(I)r,f);}","#define GA(v,t,n,r,s)   RZ(v=ga((I)(t),(I)(n),(I)(r),(I*)(s)))","#define IC(w)           (AR(w) ? *AS(w) : 1L)","#define JSPR(fmt,x)     {sprintf(obuf,fmt,x); jouts(obuf);}","#define MAX(a,b)        ((a)\u003e(b)?(a):(b))","#define MIN(a,b)        ((a)\u003c(b)?(a):(b))","#define PROLOG          I _ttop=tbase+ttop","#define R               return","#define RE(exp)         {if((exp),jerr)R 0;}","#define RZ(exp)         {if(!(exp))R 0;}","#define SGN(a)          ((0\u003c(a))-(0\u003e(a)))","","","#ifndef CLOCKS_PER_SEC","#if (SYS \u0026 SYS_UNIX)","#define CLOCKS_PER_SEC  1000000","#endif","#ifdef  CLK_TCK","#define CLOCKS_PER_SEC  CLK_TCK","#endif","#endif","","#if (WATERLOO)","#include \u003cmfcf/libc/string.h\u003e\t\t\t/* added by ljd */","#define CLOCK           (m_cpu())","#else","#define CLOCK           ((D)clock()/CLOCKS_PER_SEC)","#endif","","","#define ASSERT(b,e)     {if(!(b)){jsignal(e); R 0;}}","","#define EVBREAK         1","#define EVDEFN          2","#define EVDOMAIN        3","#define EVILNAME        4","#define EVILNUM         5","#define EVINDEX         6","#define EVFACE          7","#define EVINPRUPT       8","#define EVLENGTH        9","#define EVLIMIT         10","#define EVNONCE         11","#define EVNOTASGN       12","#define EVOPENQ         13","#define EVRANK          14","#define EVSPELL         15","#define EVSYNTAX        16","#define EVSYSTEM        17","#define EVVALUE         18","#define EVWSFULL        19","","#define NEVM            19      /* number of event codes                   */",""],"jc.h":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Character Definitions                                                   */","","","#define CX         0            /* other                                   */","#define CS         1            /* space or tab                            */","#define CA         2            /* letter                                  */","#define CN         3            /* N (capital N)                           */","#define CB         4            /* B (capital B)                           */","#define C9         5            /* digit or sign (underscore)              */","#define CD         6            /* dot                                     */","#define CC         7            /* colon                                   */","#define CQ         8            /* quote                                   */","","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)","#define CHome      1            /*   1 001 01                              */","#define CEnter     3            /*   3 003 03                              */","#define CEnd       4            /*   4 004 04                              */","#define CHelp      5            /*   5 005 05                              */","#define CDelete    8            /*   8 010 08                              */","#define CTab       9            /*   9 011 09                              */","#define CPageUp    11           /*  11 013 0b                              */","#define CPageDown  12           /*  12 014 0c                              */","#define CReturn    13           /*  13 015 0d                              */","#define CFunction  16           /*  16 020 10                              */","#define CEscClear  27           /*  27 033 1b                              */","#define CEsc       27           /*  27 033 1b                              */","#define CClear     27           /*  27 033 1b                              */","#define CLeft      28           /*  28 034 1c                              */","#define CRight     29           /*  29 035 1d                              */","#define CUp        30           /*  30 036 1e                              */","#define CDown      31           /*  31 037 1f                              */","#define CNL        '\\r'         /*  13 015 0d     new line                 */","#endif","","#ifndef CNL","#define CNL        '\\n'         /*  10 012 0a     new line                 */","#endif","","#define CESC1      '.'          /*  46 056 2e     1st escape char          */","#define CESC2      ':'          /*  58 072 3a     2nd escape char          */","","#define COUT       '\\000'       /*   0 000 00     output line marker       */","#define CCTRLD     '\\004'       /*   4 004 04     ctrl d                   */","#define CTAB       '\\011'       /*   9 011 09     tab                      */","#define CLF        '\\012'       /*  10 012 0a     line feed                */","#define CCR        '\\015'       /*  13 015 0d     carriage return          */","#define CBANG      '!'          /*  33 041 21                              */","#define CQQ        '\\042'       /*  34 042 22     double quote             */","#define CPOUND     '#'          /*  35 043 23                              */","#define CDOLLAR    '$'          /*  36 044 24                              */","#define CDIV       '%'          /*  37 045 25                              */","#define CAMP       '\u0026'          /*  38 046 26                              */","#define CQUOTE     '\\047'       /*  39 047 27     single quote             */","#define CLPAR      '('          /*  40 050 28                              */","#define CRPAR      ')'          /*  41 051 29                              */","#define CSTAR      '*'          /*  42 052 2a                              */","#define CPLUS      '+'          /*  43 053 2b                              */","#define CCOMMA     ','          /*  44 054 2c                              */","#define CMINUS     '-'          /*  45 055 2d                              */","#define CDOT       '.'          /*  46 056 2e                              */","#define CSLASH     '/'          /*  47 057 2f                              */","#define CCOLON     ':'          /*  58 072 3a                              */","#define CSEMICO    ';'          /*  59 073 3b                              */","#define CRAZE      ';'          /*  59 073 3b                              */","#define CBOX       '\u003c'          /*  60 074 3c                              */","#define CLT        '\u003c'          /*  60 074 3c                              */","#define CEQ        '='          /*  61 075 3d                              */","#define COPE       '\u003e'          /*  62 076 3e                              */","#define CGT        '\u003e'          /*  62 076 3e                              */","#define CQUERY     '?'          /*  63 077 3f                              */","#define CAT        '@'          /*  64 100 40                              */","#define CLEFT      '['          /*  91 133 5b                              */","#define CBSLASH    '\\134'       /*  92 134 5c \\   backslash                */","#define CRIGHT     ']'          /*  93 135 5d                              */","#define CEXP       '^'          /*  94 136 5e                              */","#define CSIGN      '_'          /*  95 137 5f     minus sign               */","#define CINF       '_'          /*  95 137 5f     infinity                 */","#define CGRAVE     '`'          /*  96 140 60                              */","#define CLBRACE    '{'          /* 123 173 7b                              */","#define CSTILE     '|'          /* 124 174 7c                              */","#define CRBRACE    '}'          /* 125 175 7d                              */","#define CTILDE     '~'          /* 126 176 7e                              */","#define CASGN      '\\200'       /* 128 200 80 =.                           */","#define CGASGN     '\\201'       /* 129 201 81 =:                           */","#define CFLOOR     '\\202'       /* 130 202 82 \u003c.                           */","#define CMIN       '\\202'       /* 130 202 82 \u003c.                           */","#define CLE        '\\203'       /* 131 203 83 \u003c:                           */","#define CCEIL      '\\204'       /* 132 204 84 \u003e.                           */","#define CMAX       '\\204'       /* 132 204 84 \u003e.                           */","#define CGE        '\\205'       /* 133 205 85 \u003e:                           */","#define CUSDOT     '\\206'       /* 134 206 86 _.                           */","#define CUSCO      '\\207'       /* 135 207 87 _:                           */","#define CRECT      '\\210'       /* 136 210 88 +.                           */","#define COR        '\\210'       /* 136 210 88 +.                           */","#define CDOUBLE    '\\211'       /* 137 211 89 +:                           */","#define CNOR       '\\211'       /* 137 211 89 +:                           */","#define CPOLAR     '\\212'       /* 138 212 8a *.                           */","#define CAND       '\\212'       /* 138 212 8a *.                           */","#define CSQUARE    '\\213'       /* 139 213 8b *:                           */","#define CNAND      '\\213'       /* 139 213 8b *:                           */","#define CNOT       '\\214'       /* 140 214 8c -.                           */","#define CHALVE     '\\215'       /* 141 215 8d -:                           */","#define CMATCH     '\\215'       /* 141 215 8d -:                           */","#define CDOMINO    '\\216'       /* 142 216 8e %.                           */","#define CSQRT      '\\217'       /* 143 217 8f %:                           */","#define CROOT      '\\217'       /* 143 217 8f %:                           */","#define CLOG       '\\220'       /* 144 220 90 ^.                           */","#define CPOWOP     '\\221'       /* 145 221 91 ^:                           */","#define CGOTO      '\\222'       /* 146 222 92 $.                           */","#define CSELF      '\\223'       /* 147 223 93 $:                           */","#define CNUB       '\\224'       /* 148 224 94 ~.                           */","#define CNE        '\\225'       /* 149 225 95 ~:                           */","#define CREV       '\\226'       /* 150 226 96 |.                           */","#define CROT       '\\226'       /* 150 226 96 |.                           */","#define CCANT      '\\227'       /* 151 227 97 |:                           */","#define CDOTDOT    '\\230'       /* 152 230 98 ..                           */","#define CDOTCO     '\\231'       /* 153 231 99 .:                           */","#define COBVERSE   '\\232'       /* 154 232 9a :.                           */","#define CCOCO      '\\233'       /* 155 233 9b ::                           */","#define CCOMDOT    '\\234'       /* 156 234 9c ,.                           */","#define CLAMIN     '\\235'       /* 157 235 9d ,:                           */","#define CCUT       '\\236'       /* 158 236 9e ;.                           */","#define CWORDS     '\\237'       /* 159 237 9f ;:                           */","#define CBASE      '\\240'       /* 160 240 a0 #.                           */","#define CABASE     '\\241'       /* 161 241 a1 #:                           */","#define CATDOT     '\\242'       /* 162 242 a2 @.                           */","#define CATCO      '\\243'       /* 163 243 a3 @:                           */","#define CSLDOT     '\\244'       /* 164 244 a4 /.                           */","#define CGRADE     '\\245'       /* 165 245 a5 /:                           */","#define CBSDOT     '\\246'       /* 166 246 a6 \\.                           */","#define CDGRADE    '\\247'       /* 167 247 a7 \\:                           */","#define CLEV       '\\250'       /* 168 250 a8 [.                           */","#define CLTCO      '\\251'       /* 169 251 a9 [:                           */","#define CDEX       '\\252'       /* 170 252 aa ].                           */","#define CRTCO      '\\253'       /* 171 253 ab ]:                           */","#define CHEAD      '\\254'       /* 172 254 ac {.                           */","#define CTAKE      '\\254'       /* 172 254 ac {.                           */","#define CTAIL      '\\255'       /* 173 255 ad {:                           */","#define CBEHEAD    '\\256'       /* 174 256 ae }.                           */","#define CDROP      '\\256'       /* 174 256 ae }.                           */","#define CCTAIL     '\\257'       /* 175 257 af }:                           */","#define CGRDOT     '\\260'       /* 176 260 b0 `.                           */","#define CGRCO      '\\261'       /* 177 261 b1 `:                           */","#define CEXEC      '\\262'       /* 178 262 b2 \".                           */","#define CTHORN     '\\263'       /* 179 263 b3 \":                           */","#define CUNDER     '\\264'       /* 180 264 b4 \u0026.                           */","#define CAMPCO     '\\265'       /* 181 265 b5 \u0026:                           */","#define CFIT       '\\266'       /* 182 266 b6 !.                           */","#define CIBEAM     '\\267'       /* 183 267 b7 !:                           */","#define CQRYDOT    '\\270'       /* 184 270 b8 ?.                           */","#define CQRYCO     '\\271'       /* 185 271 b9 ?:                           */","#define CALP       '\\300'       /* 192 300 c0 a.                           */","#define CATOMIC    '\\301'       /* 193 301 c1 A.                           */","#define CBOOL      '\\302'       /* 194 302 c2 b.                           */","#define CEIGEN     '\\303'       /* 195 303 c3 c.                           */","#define CCYCLE     '\\304'       /* 196 304 c4 C.                           */","#define CEPS       '\\305'       /* 197 305 c5 e.                           */","#define CEBAR      '\\306'       /* 198 306 c6 E.                           */","#define CFIX       '\\307'       /* 199 307 c7 f.                           */","#define CIOTA      '\\310'       /* 200 310 c8 i.                           */","#define CJDOT      '\\311'       /* 201 311 c9 j.                           */","#define CCIRCLE    '\\312'       /* 202 312 ca o.                           */","#define CPOLY      '\\313'       /* 203 313 cb p.                           */","#define CRDOT      '\\314'       /* 204 314 cc r.                           */","#define CALPHA     '\\315'       /* 205 315 cd x.                           */","#define COMEGA     '\\316'       /* 206 316 ce y.                           */","#define CZERO      '\\340'       /* 224 340 e0 0:                           */","#define CONE       '\\341'       /* 225 341 e1 1:                           */","#define CHOOK      '\\342'       /* 226 342 e2                              */","#define CFORK      '\\343'       /* 227 343 e3                              */","#define CADVF      '\\344'       /* 228 344 e4     bonded conjunction       */","#define CHOOKO     '\\345'       /* 229 345 e5                              */","#define CFORKO     '\\346'       /* 230 346 e6                              */","#define CPDT       '\\347'       /* 231 347 e7     plus dot times           */",""],"je.h":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Extern Declarations                                                     */","","","extern A        abase1();","extern A        abase2();","extern A        ac1();","extern A        ac2();","extern A        adot1();","extern A        adot2();","extern A        advform();","extern A        agenda();","extern I        aii();","extern A        alp;","extern B        all1();","extern A        amp();","extern A        ampco();","extern B        appf();","extern A        apv();","extern A        arep();","extern A        aro();","extern B        asgn;","extern A        atop();","extern A        atco();","extern A        a0j1;","extern A        base1();","extern A        base2();","extern A        behead();","extern A        bool();","extern A        box();","extern I        bp();","extern C        breaker();","extern A        bsdot();","extern A        bslash();","extern I        bytes;","extern A        ca();","extern A        cant1();","extern A        cant2();","extern A        car();","extern A        catalog();","extern A        cdot1();","extern A        cdot2();","extern A        ceil1();","extern A        circle();","extern I        coerce1();","extern I        coerce2();","extern A        colon();","extern A        conjug();","extern A        connum();","extern A        cstr();","extern A        ctrans();","extern C        ctype[];","extern A        curtail();","extern A        cut();","extern A        cvt();","extern A        dash;","extern A        deal();","extern A        decrem();","extern A        dex();","extern A        df1();","extern A        df2();","extern A        dgrade1();","extern A        dgrade2();","extern A        divide();","extern A        dot();","extern A        drep();","extern A        drop();","extern A        ds();","extern A        duble();","extern A        ebar();","extern A        eig1();","extern A        eig2();","extern A        eps();","extern A        eq();","extern B        errsee;","extern A        even();","extern A        every();","extern A        evger();","extern B        evoke();","extern A        ex();","extern A        exec1();","extern A        exec2();","extern A        expn1();","extern A        expn2();        /* \"exp2\" name conflict under Sun OS       */","extern A        fact();","extern A        fa();","extern A        fdef();","extern B        feq();","extern C       *fi();","extern A        filler();","extern A        fit();","extern A        fix();","extern A        floor1();","extern A        folk();         /* \"fork\" name conflict under UNIX         */","extern A        foreign();","extern A        forko();","extern B        freal();","extern A        from();","extern A        fx();","extern A        ga();","extern A        gc();","extern A        gcd();","extern void     gc3();","extern A        ge();","extern A        global;","extern A        grade1();","extern A        grade2();","extern A        gt();","extern A        gtrain();","extern A        halve();","extern A        head();","extern A        hook();","extern A        hooko();","extern A        iden();","extern A        ii();","extern A        immex();","extern C        immloop();","extern A        increm();","extern A        indexof();","extern D        inf;","extern A        inf1();","extern A        inf2();","extern FILE    *infile;","extern A        inv();","extern A        iota();","extern I        i0();","extern A        jdot1();","extern A        jdot2();","extern C        jerr;","extern A        jgets();","extern C        jinit2();","extern A        joff();","extern A        jot;","extern void     jouts();","extern A        jpr();","extern void     jputc();","extern void     jputs();","extern void     jsignal();","extern A        lamin1();","extern A        lamin2();","extern C        lc();","extern A        lcm();","extern A        le();","extern A        left1();","extern A        left2();","extern A        less();","extern A        lev();","extern A        link();","extern A        local;","extern A        logar1();","extern A        logar2();","extern I        lr();","extern A        lt();","extern A        mag();","extern A        mark;","extern A        match();","extern A        matth1();","extern I        maxbytes;","extern A        maximum();      /* \"max\" name conflict in Turbo C          */","extern A        mdiv();","extern A        minimum();      /* \"min\" name conflict in Turbo C          */","extern A        minus();","extern A        minv();","extern I        mr();","extern A        mtv;","extern void     mv();","extern void     mv1();","extern D        nan;","extern A        nand();","extern I        nc();","extern A        ncx();","extern A        ne();","extern A        negate();","extern A        neg1;","extern A        nl1();","extern A        nl2();","extern A        nor();","extern A        not();","extern A        nub();","extern A        nubsieve();","extern A        obverse();","extern C        obuf[];","extern A        odd();","extern A        one;","extern A        one1();","extern A        one2();","extern A        onm();","extern A        ope();","extern FILE    *outfile;","extern A        outof();","extern A        over();","extern A        overr();","extern A        parse();","extern A        pcvt();","extern A        pdt();","extern A        pfill();","extern A        pie;            /* \"pi\" name conflict                      */","extern A        pind();","extern A        pinv();","extern A        pix();","extern A        plus();","extern A        polar();","extern A        poly1();","extern A        poly2();","extern A        powop();","extern I        prod();","extern void     prompt();","extern P        ps[];","extern UC       psptr[];","extern C        qbx[];","extern D        qct;","extern A        qevm;","extern D        qfuzz;","extern C        qpps[];","extern C        qprompt[];","extern A        qq();","extern A        qr();","extern I        qrl;","extern A        ra();","extern A        rank();","extern A        rankle();","extern A        rank1ex();","extern A        rank2ex();","extern A        ravel();","extern A        raze();","extern A        razein();","extern A        rbrace();","extern A        rdot1();","extern A        rdot2();","extern A        recip();","extern A        rect();","extern A        reitem();","extern A        repeat();","extern A        reshape();","extern A        residue();","extern A        reverse();","extern A        right1();","extern A        right2();","extern A        roll();","extern A        root();","extern A        rotate();","extern I        rr();","extern A        sc();","extern A        scalar4();","extern A        scc();","extern A        scf();","extern A        sclass();","extern A        scnm();","extern A        self1();","extern A        self2();","extern B        sesm;","extern void     sesmexit();","extern C        sesminit();","extern A        sex1();","extern A        sex2();","extern A        shape();","extern A        signum();","extern A        slash();","extern A        sldot();","extern C        spellin();","extern A        spellout();","extern A        sqroot();","extern A        square();","extern A        srep();","extern A        srd();","extern A        srdlg();","extern A        srep();","extern A        str();","extern D        strtod();       /* C library fn                            */","extern I        strtol();       /* C library fn                            */","extern A        swap();","extern A        symbis();","extern A        symbrd();","extern A        table();","extern A        tail();","extern A        take();","extern A        tally();","extern I        tbase;","extern D        tceil();","extern B        teq();","extern D        tfloor();","extern A        thorn1();","extern A        thorn2();","extern A        tie();","extern B        tle();","extern B        tlt();","extern B        tne();","extern A        tokens();","extern C        tostdout;","extern I        totbytes;","extern I        tpop();","extern A        traverse();","extern A        trep();","extern A        rinv();","extern D        tssbase;","extern I        ttop;","extern I        twprimes[];","extern A        two;","extern A        tymes();        /* \"times\" name conflict in ThinkC         */","extern A        under();","extern A        unquote();","extern A        unsr();","extern A        vi();","extern A        vib();","extern A        vn();","extern B        vnm();","extern A        vs();","extern A        vtrans();","extern A        v2();","extern A        words();","extern C*       wr();","extern C        wtype[];","extern A        xcvt();","extern A        zero;","extern A        zero1();","extern A        zero2();","extern Z        zeroZ;","","#if (SYS \u0026 SYS_ATARIST+SYS_ATT3B1)","extern int      memcmp();       /* C library fn                            */","#endif",""],"jt.h":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Type Definitions                                                        */","","","#define U unsigned","","typedef char   B;","typedef char   C;","typedef U char UC;","typedef short  S;","typedef long   I;","typedef double D;","typedef struct {D re,im;} Z;","","typedef struct {I t,c,n,r,s[1];} *A;","typedef A(*AF)();","typedef B(*SF)();","","typedef struct {I type;AF f1,f2;UC mr,lr,rr,inv;} P;   /* primitive symbols   */","typedef struct {A name,val;} SY;                       /* symbol table entry  */","typedef struct {AF f1,f2;A f,g,h;I mr,lr,rr;C id;} V;  /* verb value layout   */","","#if !(SYS \u0026 SYS_MACINTOSH)","typedef void* Ptr;","#endif","","#if (SYS \u0026 SYS_PC+SYS_MACINTOSH)        /* for use by the session manager  */","typedef S SI;","#else","typedef I SI;","#endif","","/* Layout of type A                                                        */","/*                                                                         */","/* t      Type.  One of the defined constants below.                       */","/* c      Reference count.                                                 */","/* n      Number of elements in the ravel of the array.                    */","/* r      Rank.                                                            */","/* AS(s)  Pointer to the first element of shape vector.                    */","/* AV(a)  Pointer to the first array element.                              */","","#define AT(a)           ((a)-\u003et)","#define AC(a)           ((a)-\u003ec)","#define AN(a)           ((a)-\u003en)","#define AR(a)           ((a)-\u003er)","#define AH              4L              /* # header words in A             */","#define AS(a)           ((a)-\u003es)","#define AV(a)           ((I*)(a)+AH+AR(a))  /* (AH+AR(a)+(I*)(a)) bombs SGI */","#define VAV(f)          ((V*)AV(f))","#define ID(f)           (VAV(f)-\u003eid)","","#define BOOL            1L","#define CHAR            2L","#define INT             4L","#define FL              8L","#define CMPX            16L             /* complex                      */","#define BOX             32L","#define VERB            64L             /* verb                         */","#define ADV             128L            /* adverb                       */","#define CONJ            256L            /* conjunction                  */","#define NAME            512L            /* pronoun                      */","#define LPAR            1024L           /* left  parenthesis            */","#define RPAR            2048L           /* right parenthesis            */","#define ASGN            4096L           /* assignment                   */","#define MARK            8192L           /* end-of-stack marker          */","#define SYMB            16384L          /* symbols table                */","#define ANY             -1L","#define NUMERIC         (BOOL+INT+FL+CMPX)","#define NOUN            (NUMERIC+CHAR+BOX)","#define FUNC            (VERB+ADV+CONJ)","#define RHS             (NOUN+FUNC)","","#define IS1BYTE         (BOOL+CHAR+NAME)","#define HOMO(at,wt)     (at==wt || at\u0026NUMERIC\u0026\u0026wt\u0026NUMERIC)","#define FILL(t)         ((t)\u0026NUMERIC ? (C*)\u0026zeroZ : (t)\u0026CHAR?\"        \":(C*)\u0026mtv)","","#if (SYS \u0026 SYS_MACINTOSH)","#define WP(t,n,r)       (1+AH+r+((n)*bp(t)+!!(IS1BYTE\u0026t)+3)/4)","#else","#define WP(t,n,r)       (  AH+r+((n)*bp(t)+!!(IS1BYTE\u0026t)+3)/4)","#endif",""],"k.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Conversions amongst Internal Types                                      */","","#include \"j.h\"","","#define KF1(f)          B f(w,y)A w,*y;","","#define CVCASE(a,b)     ((a)+128*(b))","#define BxI             CVCASE(BOOL,INT )","#define BxD             CVCASE(BOOL,FL  )","#define BxZ             CVCASE(BOOL,CMPX)","#define IxB             CVCASE(INT ,BOOL)","#define IxD             CVCASE(INT ,FL  )","#define IxZ             CVCASE(INT ,CMPX)","#define DxB             CVCASE(FL  ,BOOL)","#define DxI             CVCASE(FL  ,INT )","#define DxZ             CVCASE(FL  ,CMPX)","#define ZxB             CVCASE(CMPX,BOOL)","#define ZxI             CVCASE(CMPX,INT )","#define ZxD             CVCASE(CMPX,FL  )","","","static KF1(BfromI){B*x;I n,p,*v;"," RZ(w);"," n=AN(w); v=AV(w);"," GA(*y,BOOL,n,AR(w),AS(w)); x=(B*)AV(*y);"," DO(n, p=*v++; if(0==p||1==p)*x++=p; else R 0;);"," R 1;","}","","static KF1(BfromD){B*x;D p,*u,*v;I n;"," RZ(w);"," n=AN(w); u=(D*)AV(w);"," GA(*y,BOOL,n,AR(w),AS(w)); x=(B*)AV(*y);"," v=u; DO(n, p=*v++; if(p\u003c-2||2\u003cp)R 0;);  /* 2==p to catch NaN */"," v=u; DO(n, p=*v++; if(!p)*x++=0; else if(feq(1.0,p))*x++=1; else R 0;);"," R 1;","}","","static KF1(IfromD){D p,q,r,*v;I n,*x;"," RZ(w);"," n=AN(w); v=(D*)AV(w);"," GA(*y,INT,n,AR(w),AS(w)); x=AV(*y);"," q=LONG_MIN*(1+qfuzz); r=LONG_MAX*(1+qfuzz);"," DO(n, p=v[i]; if(p\u003cq||r\u003cp)R 0;);"," DO(n, p=v[i]; q=floor(p); if(feq(p,q))*x++=q; else if(feq(p,1+q))*x++=1+q; else R 0;);"," R 1;","}","","static KF1(DfromZ){D*x;I n;Z*v;"," RZ(w);"," n=AN(w); v=(Z*)AV(w);"," GA(*y,FL,n,AR(w),AS(w)); x=(D*)AV(*y);"," DO(n, if(freal(*v)){*x++=v-\u003ere; v++;} else R 0;);"," R 1;","}","","static KF1(BfromZ){R DfromZ(w,y)?BfromD(*y,y):0;}","","static KF1(IfromZ){R DfromZ(w,y)?IfromD(*y,y):0;}","","","static B ccvt(t,w,y)I t;A w,*y;{I n,*wv,wt,*yv;"," RZ(w=ca(w));"," n=AN(w); wt=AT(w); wv=AV(w);"," if(t\u003e=wt||!n){","  if(t==wt)*y=w; else {GA(*y,t,n,AR(w),AS(w)); yv=AV(*y);}","  if(t==wt||!n)R 1;"," }"," switch(CVCASE(t,wt)){","  case BxI: R BfromI(w,y);","  case BxD: R BfromD(w,y);","  case IxD: R IfromD(w,y);","  case BxZ: R BfromZ(w,y);","  case IxZ: R IfromZ(w,y);","  case DxZ: R DfromZ(w,y);","  case IxB: {I*x=    yv;B*v=(B*)wv; DO(n,*x++=*v++;);} R 1;","  case DxB: {D*x=(D*)yv;B*v=(B*)wv; DO(n,*x++=*v++;);} R 1;","  case DxI: {D*x=(D*)yv;I*v=    wv; DO(n,*x++=*v++;);} R 1;","  case ZxB: {Z*x=(Z*)yv;B*v=(B*)wv; DO(n, x-\u003ere=*v++; x-\u003eim=0; x++;);} R 1;","  case ZxI: {Z*x=(Z*)yv;I*v=    wv; DO(n, x-\u003ere=*v++; x-\u003eim=0; x++;);} R 1;","  case ZxD: {Z*x=(Z*)yv;D*v=(D*)wv; DO(n, x-\u003ere=*v++; x-\u003eim=0; x++;);} R 1;","  default:  ASSERT(0,EVDOMAIN);","}}","","A cvt(t,w)I t;A w;{A y; ASSERT(ccvt(t,w,\u0026y),EVDOMAIN); R y;}","","A pcvt(t,w)I t;A w;{A y; R ccvt(t,w,\u0026y)?y:w;}","","static F1(xcvta){A y; R ccvt(BOOL,w,\u0026y)?y:ccvt(INT,w,\u0026y)?y:ccvt(FL,w,\u0026y)?y:w;}","","F1(xcvt){A z;D ofuzz=qfuzz; qfuzz=0; z=xcvta(w); qfuzz=ofuzz; R z;}",""],"lj.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* LinkJ                                                                   */","","#include \"lj.h\"","","","#if LINKJ","","#define MARK    8192L","#define RPAR    2048L","","extern I        bytes;","extern A        cstr();","extern A        fa();","extern A        ga();","extern A        global;","extern C        jinit2();","extern A        mark;","extern I        maxbytes;","extern A        onm();","extern A        parse();","extern A        symbis();","extern I        tbase;","extern A        tokens();","extern I        tpop();","extern I        ttop;","","static I old;","","","C jinit(){C c=jinit2(0,0L); old=tbase+ttop; R c;}","","A jx(s)C*s;{A t,*x;"," jerr=0; maxbytes=bytes;"," tpop(old);"," RZ(t=tokens(cstr(s)));"," x=(A*)AV(t);"," R MARK\u0026AT(x[1])?mark:parse(t);","}","","A jma(t,n,r)I t,n,r;{R ga(t,n,r,0L);}","","C jfr(x)A x;{R fa(x)?1:0;}","","A jset(name,x)C*name;A x;{R symbis(onm(cstr(name)),x,global);}","","#endif","",""],"lj.h":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* LinkJ:  Declarations and Definitions                                    */","","","#define LINKJ 1","","typedef char B;","typedef char C;","typedef long I;","typedef struct {I t,c,n,r,s[1];} *A;","typedef A(*AF)();","",""," /* Fields of Type A */","","#define AT(a)   ((a)-\u003et)        /* Type.  One of the constants below.      */","#define AC(a)   ((a)-\u003ec)        /* Reference count.  Do not touch.         */","#define AN(a)   ((a)-\u003en)        /* Number of elements.                     */","#define AR(a)   ((a)-\u003er)        /* Rank (number of elements in the shape). */","#define AH      4L              /* Number of header words in A.            */","#define AS(a)   ((a)-\u003es)        /* Ptr to the first element of the shape.  */","#define AV(a)   ((I*)(a)+AH+AR(a))  /* Ptr to the first array element.     */","",""," /* Values for AT(a) */","","#define BOOL            1L      /* Boolean           B                     */","#define CHAR            2L      /* Character         C                     */","#define INT             4L      /* Integer           I                     */","#define FL              8L      /* Floating point    D                     */","#define CMPX            16L     /* Complex           Z                     */","#define BOX             32L     /* Boxed             void*                 */","",""," /* Event Codes */","","#define EVBREAK         1","#define EVDEFN          2","#define EVDOMAIN        3","#define EVILNAME        4","#define EVILNUM         5","#define EVINDEX         6","#define EVFACE          7","#define EVINPRUPT       8","#define EVLENGTH        9","#define EVLIMIT         10","#define EVNONCE         11","#define EVNOTASGN       12","#define EVOPENQ         13","#define EVRANK          14","#define EVSPELL         15","#define EVSYNTAX        16","#define EVSYSTEM        17","#define EVVALUE         18","#define EVWSFULL        19","","#define NEVM            19      /* number of event codes                   */","",""," /* Useful Definitions */","","#define ASSERT(b,e)     {if(!(b)){jerr=e; R 0;}}","#define F1(f)           A f(y)A y;","#define F2(f)           A f(x,y)A x,y;","#define R               return","#define RZ(exp)         {if(!(exp))R 0;}","",""," /* External Declarations */","","extern B asgn;","extern C jerr;","","extern C jc();                  /* C jc(I,AF*,AF*);                        */","extern C jfr();                 /* C jfr(A);                               */","extern C jinit();               /* C jinit(void);                          */","extern A jma();                 /* A jma(I,I,I);                           */","extern A jpr();                 /* A jpr(A);                               */","extern A jset();                /* A jset(C*,A);                           */","extern A jx();                  /* A jx(C*);                               */","",""],"m.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Memory Management Utilities                                             */","","#include \"j.h\"","","#if (SYS \u0026 SYS_PC)","#include \u003calloc.h\u003e","#define FREE            farfree","#define MALLOC          (A)farmalloc","#define NMEM            65520L","#else","#define FREE            free","#define MALLOC          (A)malloc","#define NMEM            LONG_MAX","#endif","","","static A *tstack, tstacka;","","static F1(fr){"," RZ(w);"," if(--AC(w))R zero;"," bytes-=4*WP(AT(w),AN(w),AR(w));"," FREE(w);"," R one;","}","","static A ma(m)I m;{A z;","#if (SYS \u0026 SYS_PC)"," ASSERT(m\u003c=NMEM,EVLIMIT);","#endif"," z=MALLOC(m);"," if(!breaker())R 0;"," ASSERT(z,EVWSFULL);"," bytes+=m; totbytes+=m; maxbytes=MAX(bytes,maxbytes);"," R z;","}","","A traverse(w,f)A w;AF f;{"," RZ(w);"," switch(AT(w)){","  case BOX:","   {A*v=(A*)AV(w); DO(AN(w),f(*v++););}        break;","  case VERB: case ADV: case CONJ:","   {V*v=(V*)AV(w); f(v-\u003ef); f(v-\u003eg); f(v-\u003eh);} break;","  case SYMB:","   {SY*v=(SY*)AV(w); DO(AN(w), f(v-\u003ename); f(v-\u003eval); ++v;);}"," }"," R one;","}","","F1(fa){traverse(w,fa); R fr(w);}","","F1(ra){RZ(w); traverse(w,ra); ++AC(w); R w;}","","","static A tg(){A t=tstacka,z;"," RZ(z=ma(4*WP(BOX,NTSTACK,1L)));"," AT(z)=BOX; AC(z)=AR(z)=1; AN(z)=*AS(z)=NTSTACK;"," tstacka=z; tstack=(A*)AV(tstacka); tbase+=NTSTACK; ttop=1;"," *tstack=t;"," R z;","}","","static A tf(){A t=tstacka;"," tstacka=*tstack; tstack=(A*)AV(tstacka); tbase-=NTSTACK; ttop=NTSTACK;"," R fr(t);","}","","static F1(tpush){"," RZ(w);"," traverse(w,tpush);"," if(ttop\u003e=NTSTACK)RZ(tg());"," tstack[ttop]=w;"," ++ttop;"," R w;","}","","I tpop(old)I old;{while(old\u003ctbase+ttop)1\u003cttop?fr(tstack[--ttop]):tf(); R old;}","","A gc(w,old)A w;I old;{ra(w); tpop(old); R tpush(w);}","","void gc3(x,y,z,old)A x,y,z;I old;{"," if(x)ra(x);    if(y)ra(y);    if(z)ra(z);"," tpop(old);"," if(x)tpush(x); if(y)tpush(y); if(z)tpush(z);","}","","","A ga(t,n,r,s)I t,n,r,*s;{A z;I m;"," ASSERT(r\u003c=RMAX,EVLIMIT);"," RZ(z=ma(m=4*WP(t,n,r)));"," if(t\u0026BOX+FUNC+SYMB)memset(z,'\\000',m);"," AC(z)=1; AN(z)=n; AR(z)=r;"," AT(z)=0; tpush(z); AT(z)=t;"," if(t\u0026IS1BYTE)*(n+(C*)AV(z))=0;"," if(1==r)*AS(z)=n; else if(r\u0026\u0026s)mv(INT,r,AS(z),s);"," R z;","}","","F1(ca){A z; RZ(w); GA(z,AT(w),AN(w),AR(w),AS(w)); mv(AT(w),AN(w),AV(z),AV(w)); R z;}","","F1(car){"," RZ(w=ca(w));"," switch(AT(w)){","  case BOX:","   {A*v=(A*)AV(w); DO(AN(w), RZ(*v=car(*v)); ++v;);}","   break;","  case VERB: case ADV: case CONJ:","   {V*v=(V*)AV(w);","    if(v-\u003ef)RZ(v-\u003ef=car(v-\u003ef));","    if(v-\u003eg)RZ(v-\u003eg=car(v-\u003eg));","    if(v-\u003eh)RZ(v-\u003eh=car(v-\u003eh));"," }}"," R w;","}",""],"p.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Parsing; see APL Dictionary, pp. 12-13 \u0026 38.                            */","","#include \"j.h\"","#include \"p.h\"","#include \"a.h\"","","#if (SYS \u0026 SYS_PC)","#define NDEPTH          512","#endif","#ifndef NDEPTH","#define NDEPTH          4096","#endif","","static I depth;","static A selfv;","","","F1(self1){A z; ASSERT(NDEPTH\u003e++depth,EVLIMIT); z=df1(  w,selfv); --depth; R z;}","","F2(self2){A z; ASSERT(NDEPTH\u003e++depth,EVLIMIT); z=df2(a,w,selfv); --depth; R z;}","","static DF1(dfs1){A oself=selfv,z; z=df1(  w,selfv=self); selfv=oself; R z;}","","static DF2(dfs2){A oself=selfv,z; z=df2(a,w,selfv=self); selfv=oself; R z;}","","DF2(unquote){A fs,z;"," RZ(fs=symbrd(VAV(self)-\u003ef));"," ASSERT(AT(self)==AT(fs),EVDOMAIN);"," ASSERT(NDEPTH\u003e++depth,EVLIMIT); z=a?dfs2(a,w,fs):dfs1(w,fs); --depth; R z;","}","","","static ACTION(monad){R dfs1(stack[e],stack[b]);}","","static ACTION(dyad ){R dfs2(stack[b],stack[e],stack[e-1]);}","","static ACTION(adv  ){R df1(stack[b],stack[e]);}","","static ACTION(conj ){R df2(stack[b],stack[e],stack[e-1]);}","","static ACTION(forkv){R folk(stack[b],stack[1+b],stack[e]);}","","static ACTION(hookv){R hook(stack[b],stack[e]);}","","static ACTION(formo){A f,g,h;"," f=stack[b]; g=stack[1+b]; h=stack[2+b];"," R b==e-1?hooko(f,g):forko(f,g,h);","}","","static ACTION(curry){R advform(stack[b],stack[e]);}","","static ACTION(punc ){R stack[e-1];}","","static ACTION(move ){A z=stack[MAX(0,e)]; R NAME\u0026AT(z)\u0026\u0026!(ASGN\u0026AT(stack[b]))?swap(z):z;}","","static F2(isg){R symbis(onm(a),ope(w),global);}","","static F2(isl){R symbis(onm(a),ope(w),local );}","","static ACTION(is){A n=stack[b],v=stack[e];C p=local\u0026\u0026*AV(stack[1+b]);"," RZ(NAME\u0026AT(n) ? symbis(n,v,p?local:global) : rank2ex(n,v,0L,0L,0L,p?isl:isg));"," R v;","}","","","#define EDGE    (MARK+ASGN+LPAR)","#define NOTCONJ (NOUN+VERB+ADV)","","PT cases[] = {"," EDGE,         VERB,      NOUN,      ANY,       monad, vmonad, cmonad, 1, 2,"," EDGE+NOTCONJ, VERB,      VERB,      NOUN,      monad, vmonad, cmonad, 2, 3,"," EDGE+NOTCONJ, NOUN,      VERB,      NOUN,      dyad,  vdyad,  cdyad,  1, 3,"," EDGE+NOTCONJ, NOUN+VERB, ADV,       ANY,       adv,   vadv,   cadv,   1, 2,"," EDGE+NOTCONJ, NOUN+VERB, CONJ,      NOUN+VERB, conj,  vconj,  cconj,  1, 3,"," EDGE+NOTCONJ, VERB,      VERB,      VERB,      forkv, vforkv, cforkv, 1, 3,"," EDGE,         VERB,      VERB,      ANY,       hookv, vhookv, chookv, 1, 2,"," EDGE,         ADV+CONJ,  ADV+CONJ,  ADV+CONJ,  formo, vformo, cformo, 1, 3,"," EDGE,         ADV+CONJ,  ADV+CONJ,  ANY,       formo, vformo, cformo, 1, 2,"," EDGE,         CONJ,      NOUN+VERB, ANY,       curry, vcurry, ccurry, 1, 2,"," EDGE,         NOUN+VERB, CONJ,      ANY,       curry, vcurry, ccurry, 1, 2,"," NAME+NOUN,    ASGN,      RHS,       ANY,       is,    vis,    vis,    0, 2,"," LPAR,         RHS,       RPAR,      ANY,       punc,  vpunc,  vpunc,  0, 2,","};","","I ncases=(sizeof cases)/(sizeof cases[0]);","","","F1(parse){A*s,*stack,z;I b,*c,e,i,j,k,m,n;"," RZ(w);"," stack=(A*)AV(w); n=m=AN(w)-4; asgn=0;"," do{","  for(i=0;i\u003cncases;i++){","   c=cases[i].c; s=n+stack;","   if(*c++\u0026AT(*s++)\u0026\u0026*c++\u0026AT(*s++)\u0026\u0026*c++\u0026AT(*s++)\u0026\u0026*c++\u0026AT(*s++)) break;","  }","  if(i\u003cncases){","   b=cases[i].b; j=n+b;","   e=cases[i].e; k=n+e;","   asgn=is==cases[i].f;","   RZ(stack[k]=(cases[i].f)(j,k,stack));","   DO(b,stack[--k]=stack[--j];); n=k;","  } else {RZ(stack[n-1]=move(n,m-1,stack)); n-=0\u003cm--;}"," } while(0\u003c=m);"," z=stack[1+n];"," ASSERT(AT(z)\u0026MARK+RHS\u0026\u0026AT(stack[2+n])\u0026MARK,EVSYNTAX);"," R z;","}",""],"p.h":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Definitions for the Parser and Translators                              */","","","#define ACTION(f)       A  f(b,e,stack)I b,e;A *stack;","#define TACT(f)         AA f(b,e,stack)I b,e;AA*stack;","","typedef struct{A a,t;} AA;","typedef AA(*AAF)();","typedef struct{I c[4];AF f;AAF vf,cf;I b,e;} PT;","","extern AA               vadv(),   cadv();","extern AA               vconj(),  cconj();","extern AA               vcurry(), ccurry();","extern AA               vdyad(),  cdyad();","extern AA               vforkv(), cforkv();","extern AA               vhookv(), chookv();","extern AA               vformo(), cformo();","extern AA               vis();","extern AA               vmonad(), cmonad();","extern AA               vmove();","extern AA               vpunc();","","extern PT               cases[];","extern I                ncases;","extern B                tfail;","extern A                tname;","extern A                tparse();","extern A                ttokens();","extern A                tval;",""],"pc.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Parsing: Tacit Conjunction Translator (s : 12)                          */","","#include \"j.h\"","#include \"p.h\"","","","TACT(cmonad){AA z; z.a=df1(stack[e].a,stack[b].a); z.t=0; R z;}","","TACT(cdyad){AA z; z.a=df2(stack[b].a,stack[e].a,stack[e-1].a); z.t=0; R z;}","","TACT(cadv){A fs;AA x,z;"," x=stack[b]; fs=stack[e].a;"," z.a=df1(x.a,fs);"," z.t=x.t?hooko(x.t,fs):0;"," R z;","}","","TACT(cconj){A fs;AA x,y,z;"," x=stack[b]; y=stack[e]; fs=stack[e-1].a;"," z.a=df2(x.a,y.a,fs);"," switch(2*!x.t+!y.t){","  case 0: z.t=forko(x.t,fs,y.t);          break;","  case 1: z.t=hooko(x.t,advform(fs,y.a)); break;","  case 2: z.t=hooko(y.t,advform(x.a,fs)); break;","  case 3: z.t=0;"," }"," R z;","}","","static F1(gt1){R hooko(  w,ds(CBSLASH));}","","static F2(gt2){R forko(a,w,ds(CBSLASH));}","","static A consa(w)AA w;{R w.t?w.t:advform(ds(CDEX),w.a);}","","TACT(cforkv){AA p,q,r,z;"," p=stack[b]; q=stack[1+b]; r=stack[e];"," z.a=folk(p.a,q.a,r.a);"," switch(4*!p.t+2*!q.t+!r.t){","  case 3:  z.t=gt2(p.t,advform(ds(CGRAVE),tie(q.a,r.a))); break;","  case 6:  z.t=gt2(r.t,advform(tie(p.a,q.a),ds(CGRAVE))); break;","  case 7:  z.t=0; break;","  default: z.t=gt1(forko(forko(consa(p),ds(CGRAVE),consa(q)),ds(CGRAVE),consa(r)));"," }"," R z;","}","","TACT(chookv){AA x,y,z;"," x=stack[b]; y=stack[e];"," z.a=hook(x.a,y.a);"," switch(2*!x.t+!y.t){","  case 0: z.t=gt1(forko(x.t,ds(CGRAVE),y.t));   break;","  case 1: z.t=gt2(x.t,advform(ds(CGRAVE),y.a)); break;","  case 2: z.t=gt2(y.t,advform(x.a,ds(CGRAVE))); break;","  case 3: z.t=0;"," }"," R z;","}","","TACT(cformo){AA p,q,r,z;"," p=stack[b]; q=stack[1+b]; r=stack[e];"," tfail=p.t||q.t||r.t;"," z.a=b==e-1?hooko(p,q):forko(p,q,r);"," z.t=0;"," R z;","}","","TACT(ccurry){AA x,y,z;"," x=stack[b]; y=stack[e];"," tfail=x.t||y.t;"," z.a=advform(x.a,y.a);"," z.t=0;"," R z;","}","","F1(ctrans){PROLOG;A loc=local,z;"," RZ(w);"," ASSERT(CHAR\u0026AT(w),EVDOMAIN);"," ASSERT(1\u003e=AR(w),EVRANK);"," GA(local,SYMB,twprimes[0],1,0);"," symbis(scnm(CALPHA),ds(CPLUS),local);"," symbis(scnm(COMEGA),ds(CPLUS),local);"," RZ(tname=link(ds(CALPHA),ds(COMEGA)));"," RZ(tval =link(ds(CLEV  ),ds(CDEX  )));"," z=tparse(zero,ttokens(w));"," if(z\u0026\u0026MARK\u0026AT(z))z=colon(w,sc(2L));"," local=loc;"," EPILOG(z);","}",""],"pv.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Parsing: Tacit Verb Translator (s : 11)                                 */","/* See  Hui, Iverson \u0026 McDonnell, Tacit Definition, APL91                  */","","#include \"j.h\"","#include \"p.h\"","","","B tfail;","A tname;","A tval;","","F1(ttokens){A t,*y,z;AA*x;"," RZ(t=tokens(w));"," GA(z,BOX,2*AN(t),1,0);"," x=(AA*)AV(z); y=(A*)AV(t); DO(AN(t), x++-\u003ea=*y++;);"," R z;","}","","TACT(vmonad){A fs;AA y,z;"," y=stack[e]; fs=stack[b].a;"," if(y.t){z.a=one;         z.t=atop(fs,y.t);}"," else   {z.a=df1(y.a,fs); z.t=0;           }"," R z;","}","","TACT(vdyad){A fs;AA x,y,z;"," x=stack[b]; y=stack[e]; fs=stack[e-1].a; z.a=one;"," switch(2*!x.t+!y.t){","  case 0: z.t=folk(x.t,fs,y.t);      break;","  case 1: z.t=atop(amp(fs,y.a),x.t); break;","  case 2: z.t=atop(amp(x.a,fs),y.t); break;","  case 3: z.t=0; z.a=df2(x.a,y.a,fs);"," }"," R z;","}","","TACT(vadv){AA z;"," if(stack[b].t)tfail=1;"," else{z.t=0; z.a=df1(stack[b].a,stack[e].a);}"," R z;","}","","TACT(vconj){AA z;"," if(stack[b].t||stack[e].t)tfail=1;"," else{z.t=0; z.a=df2(stack[b].a,stack[e].a,stack[e-1].a);}"," R z;","}","","TACT(vforkv){AA z; z.a=folk(stack[b].a,stack[1+b].a,stack[e].a); z.t=0; R z;}","","TACT(vhookv){AA z; z.a=hook(stack[b].a,stack[e].a); z.t=0; R z;}","","TACT(vformo){AA z;A f=stack[b].a,g=stack[1+b].a,h=stack[2+b].a;"," z.a=b==e-1?hooko(f,g):forko(f,g,h);"," z.t=0;"," R z;","}","","TACT(vcurry){AA z;"," tfail=stack[b].t||stack[e].t;"," z.a=advform(stack[b].a,stack[e].a);"," z.t=0;"," R z;","}","","TACT(vpunc){R stack[e-1];}","","TACT(vmove){A j;AA x,z;"," x=stack[MAX(0,e)];"," if(NAME\u0026AT(x.a)\u0026\u0026!(ASGN\u0026AT(stack[b].a))){","  j=indexof(tname,box(x.a));","  z.a=swap(x.a);","  z.t=all1(lt(j,tally(tname)))?ope(from(j,tval)):0;","  R z;"," }"," R x;","}","","TACT(vis){A n=stack[b].a,v=stack[e].a;C p=local\u0026\u0026*AV(stack[1+b].a);"," tfail=!(NAME\u0026AT(n));"," symbis(n,v,p?local:global);"," tname=link(n,tname); tval=link(stack[e].t,tval);"," R stack[e];","}","","F2(tparse){A*s,x,t;AA*stack;B p;C d;I b,*c,e,i,j,k,m,n;"," RZ(w);"," stack=(AA*)AV(w); n=m=AN(w)/2-4; tfail=0; p=one==a;"," do{","  for(i=0;i\u003cncases;i++){","   c=cases[i].c; s=(A*)(n+stack); d=1;","   d=d\u0026\u0026*c++\u0026AT(*s); s+=2;","   d=d\u0026\u0026*c++\u0026AT(*s); s+=2;","   d=d\u0026\u0026*c++\u0026AT(*s); s+=2;","   d=d\u0026\u0026*c++\u0026AT(*s);","   if(d)break;","  }","  if(i\u003cncases){","   b=cases[i].b; j=n+b;","   e=cases[i].e; k=n+e;","   stack[k]=(p?cases[i].vf:cases[i].cf)(j,k,stack);","   if(tfail)R mark;","   DO(b,stack[--k]=stack[--j];); n=k;","  } else {stack[n-1]=vmove(n,m-1,stack); n-=0\u003cm--;}"," } while(0\u003c=m);"," ASSERT(MARK\u0026AT(stack[2+n].a),EVSYNTAX);"," x=stack[1+n].a;"," t=stack[1+n].t;"," if(p){ASSERT(NOUN\u0026AT(x),EVSYNTAX); R t?t:qq(x,sc(RMAXL));}"," else {ASSERT(AT(x)\u0026NOUN+VERB,EVSYNTAX); R t?t:hooko(ds(CDEX),advform(ds(CDEX),x));}","}","","F1(vtrans){PROLOG;A loc=local,x=one,y=one,z;"," RZ(w);"," ASSERT(CHAR\u0026AT(w),EVDOMAIN);"," ASSERT(1\u003e=AR(w),EVRANK);"," GA(local,SYMB,twprimes[0],1,0);"," symbis(scnm(CALPHA),x,local);"," symbis(scnm(COMEGA),y,local);"," RZ(tname=link(ds(CALPHA),ds(COMEGA)));"," RZ(tval =link(ds(CLEFT ),ds(CRIGHT)));"," z=tparse(one,ttokens(w));"," if(z\u0026\u0026MARK\u0026AT(z))z=all1(eps(scc('x'),w))?colon(mtv,w):colon(w,mtv);"," local=loc;"," EPILOG(z);","}",""],"r.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Representations                                                         */","","#include \"j.h\"","","","static F1(drr){PROLOG;A fs,gs,t,*x,z;C b,c,id,p;I m;V*v;"," RZ(w);"," if(AT(w)\u0026NOUN+NAME)R w;"," v=VAV(w); id=v-\u003eid;  fs=v-\u003ef; gs=v-\u003eg; m=!!fs+!!gs;"," if(!m)R spellout(id);"," if(evoke(w))R CA==ctype[c=*(C*)AV(fs)]?fs:spellout(c);"," b=id==CHOOK||id==CHOOKO||id==CADVF; c=id==CFORK||id==CFORKO;"," GA(z,BOX,m+!b,1,0); x=(A*)AV(z);"," if(id==CADVF\u0026\u0026((p=CGRAVE==ID(fs))||CGRAVE==ID(gs))){","  t=p?gs:fs;","  RZ(x[!p]=ravel(scc(CGRAVE)));","  RZ(x[ p]=NOUN\u0026AT(t)?every(every(t,fx),drr):drr(t));"," }else{","  RZ(x[0]=(id==CGRCO||id==CATDOT)\u0026\u00261\u003e=AR(fs) ? every(v-\u003eh,drr) : drr(fs) );","  RZ(x[1]=b||c?drr(gs):spellout(id));","  if(!b\u0026\u00261\u003cm)RZ(x[2]=c?drr(v-\u003eh):drr(gs));"," }"," EPILOG(z);","}","","F1(drep){A z; R(z=drr(w),z\u0026\u0026BOX\u0026AT(z))?z:ravel(box(z));}","","","","F1(aro){A fs,gs,*u,*x,y,z;C c,id;I m;V*v;"," RZ(w);"," if(FUNC\u0026AT(w)){","  v=VAV(w); id=v-\u003eid; fs=v-\u003ef; gs=v-\u003eg;","  m=id==CFORK||id==CFORKO?3:!!fs+!!gs;","  if(!m)R spellout(id);"," }"," GA(z,BOX,2,1,0); x=(A*)AV(z);"," if(NOUN\u0026AT(w)){*x++=str(1L,\"0\"); *x=w; R z;}"," GA(y,BOX,m,1,0); u=(A*)AV(y);"," if(0\u003cm)RZ(u[0]=aro(evoke(w)\u0026\u0026CA!=ctype[c=*(C*)AV(fs)]?spellout(c):fs));"," if(1\u003cm)RZ(u[1]=aro(gs));"," if(2\u003cm)RZ(u[2]=aro(v-\u003eh));"," RZ(*x++=spellout(id));"," *x=y;"," R z;","}","","F1(arep){R box(aro(w));}","","","static F1(fxr){PROLOG;A z; RZ(z=fx(w)); ASSERT(AT(z)\u0026NOUN+VERB,EVDOMAIN); EPILOG(z);}","","F1(fx){A arg,fs,*u,*x,y;C b,id;I n;"," RZ(w);"," b=BOX\u0026AT(w); u=(A*)AV(w); y=b?u[0]:w; arg=u[1];"," ASSERT(1\u003e=AR(w),EVRANK);"," ASSERT(b||CHAR\u0026AT(w),EVDOMAIN);"," ASSERT(!b||2==AN(w),EVLENGTH);"," RZ(vs(y));"," ASSERT(id=spellin(AN(y),AV(y)),EVSPELL);"," if(C9==ctype[id]){","  ASSERT(b,EVDOMAIN);","  if('0'==id)R arg;","  ASSERT(1\u003e=AR(arg),EVRANK);","  ASSERT(BOX\u0026AT(arg),EVDOMAIN);","  n=AN(arg); x=(A*)AV(arg);","  switch(id){","   case '2': ASSERT(2==n,EVLENGTH); R hook(fx(x[0]),fx(x[1]));","   case '3': ASSERT(3==n,EVLENGTH); R folk(fx(x[0]),fx(x[1]),fx(x[2]));","   case '4': ASSERT(2==n,EVLENGTH); R advform(fx(x[0]),fx(x[1]));","   case '5': ASSERT(2==n,EVLENGTH); R hooko(fx(x[0]),fx(x[1]));","   case '6': ASSERT(3==n,EVLENGTH); R forko(fx(x[0]),fx(x[1]),fx(x[2]));","   default:  ASSERT(0,EVDOMAIN);"," }}else{","  RZ(fs=ds(id));","  ASSERT(RHS\u0026AT(fs),EVDOMAIN);","  if(!b)R fs;","  ASSERT(1\u003e=AR(arg),EVRANK);","  n=AN(arg); x=(A*)AV(arg);","  if(!n)R fs;","  ASSERT(BOX\u0026AT(arg),EVDOMAIN);","  ASSERT(nc(fs)==3+n,EVLENGTH);","  R 1==n ? df1(fxr(x[0]),fs) : df2(fxr(x[0]),fxr(x[1]),fs);","}}","","","static F1(sr1){R srep(dash,w);}","","F2(srep){PROLOG;A p,*v,*vv,y,z;C b,*s,*ss,*u;I m,r,t,x;"," RZ(a\u0026\u0026w);"," t=AT(w); if(t\u0026FUNC)RZ(w=aro(w)); r=AR(w);"," GA(p,CHAR,18+AN(a),1,0); s=ss=(C*)AV(p);"," u=t\u0026CHAR+NAME?\"c\":t\u0026NUMERIC?\"n\":t\u0026BOX?\"xb\":t\u0026VERB?\"xv\":t\u0026ADV?\"xa\":t\u0026CONJ?\"xc\":\"?\";"," *s++=*u++; if(*u)*s++=*u;"," memcpy(s,AV(a),AN(a)); s+=AN(a);"," if(1==r)sprintf(s,\" %ld %ld \",r,*AS(w)); else sprintf(s,\" %ld \",r);"," x=*AV(w); b=t\u0026INT\u0026\u00261\u003e=r\u0026\u00261==AN(w)\u0026\u00260\u003c=x;"," if(b)sprintf(s+strlen(s),\"%ld\",x);"," GA(y,BOX,b?2:1\u003e=r?3:5,1,0); vv=(A*)AV(y); v=1+vv;"," m=strlen(ss);"," RZ(*v++=str(m,ss));"," if(1\u003cr){RZ(*v++=thorn1(shape(w))); RZ(*v++=scc(' '));}"," if(!b)RZ(*v=BOX\u0026AT(w)?raze(every(ravel(w),sr1)):thorn1(ravel(w)));"," DO(AN(y)-2,m+=AN(vv[2+i]););"," RZ(*vv=thorn1(sc(m)));"," z=raze(y);"," EPILOG(z);","}","","static A unw(n,s,s1,b)I n;C*s,**s1,b;{A nm=0,*x,sh,z;C c,*s0=s,*t;I d,k,m,n0=n,p,q,r,*v;"," RZ(s=fi(s,\u0026m)); *s1=m+s; q=s-s0;"," ASSERT(6\u003c=m\u0026\u0026m\u003c=n-q,EVLENGTH);"," c=*s++; d='c'==c||'p'==c?CHAR:'n'==c?INT:0;"," if('x'==c){c=*s++; d='a'==c?ADV:'b'==c?BOX:'c'==c?CONJ:'v'==c?VERB:0;}"," ASSERT(d\u0026\u0026(b||d\u0026NOUN),EVDOMAIN);"," t=strchr(s,' '); k=t-s; ASSERT(t\u0026\u0026k,EVILNAME);"," if(1\u003ck||'-'!=*s)RZ(nm=onm(str(k,s)));"," RZ(s=fi(t,\u0026r)); ASSERT(r\u003c=RMAX,EVLIMIT);"," ASSERT(' '==*s++,EVDOMAIN);"," GA(sh,INT,r,1,0); v=AV(sh);"," if(r){DO(r, RZ(s=fi(s,i+v));); ASSERT(' '==*s++,EVDOMAIN);}"," p=prod(r,v); k=(s-s0)-q; n-=k;"," if(d\u0026CHAR||d\u0026FUNC\u0026\u00262\u003e=m-k)RZ(z=str(m-k,s))"," else if(d\u0026INT)RZ(z=connum(m-k,s))"," else{","  GA(z,BOX,p,r,v); x=(A*)AV(z);","  DO(p, RZ(*x++=unw(n,t=s,\u0026s,0)); n-=s-t; ASSERT(n||i==p-1,EVLENGTH););","  ASSERT(m==n0-n,EVLENGTH);"," }"," ASSERT(p==AN(z),EVLENGTH);"," if(d\u0026FUNC){RZ(z=fx(z)); ASSERT(d\u0026AT(z),EVDOMAIN);} else RZ(z=reshape(sh,z));"," symbis(nm,z,global);"," R z;","}","","F1(unsr){A z=mtv;C*s,*t;I n;"," RZ(vs(w));"," s=t=(C*)AV(w); while(' '==*s)++s;"," if(n=AN(w)-(s-t))do{RZ(z=unw(n,t=s,\u0026s,1)); while(' '==*s)++s;}while(n-=s-t);"," R z;","}",""],"rt.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Tree Representation                                                     */","","#include \"j.h\"","","static A trr();","static C xdash;","","","static F1(rc){A bot,p,top,*v,x,y;C*bv,*pv,*tv;I i,j,k,m,n,*s,xn,*xv,yn,*yv;"," RZ(w);"," n=AN(w); s=AS(w); v=(A*)AV(w);"," xn=*s;   RZ(x=apv(xn,0L,0L)); xv=AV(x);"," yn=*++s; RZ(y=apv(yn,0L,0L)); yv=AV(y);"," j=0; DO(xn, xv[i]=IC(v[j]); j+=yn;);"," GA(top,CHAR,n,1,0); tv=(C*)AV(top); memset(tv,' ',n);"," GA(bot,CHAR,n,1,0); bv=(C*)AV(bot); memset(bv,' ',n);"," for(i=j=k=0;i\u003cn;++i){","  p=*v++;","  if(AN(p)){","   pv=(C*)AV(p); tv[i]=*pv; if(IC(p)==xv[j])bv[i]=*(pv+AN(p)-*(1+AS(p)));","   m=*(1+AS(p)); yv[k]=MAX(yv[k],m);","  }","  ++k; if(k==yn){k=0; ++j;}"," }"," {C ll,*u,ul,*v;","  u=tv+yn; v=bv; ul=qbx[0]; ll=qbx[6]; m=xn-1;","  for(j=0;j\u003cm;++j){","   DO(yn, if(' '!=v[i]\u0026\u0026ul==u[i]||ll==v[i]\u0026\u0026' '!=u[i]){xv[j]+=1; break;});","   u+=yn; v+=yn;"," }}"," R link(x,y);","}","","static F2(pad){A z;C*wv,*zv;I c,d,k;"," RZ(a\u0026\u0026w);"," if(!AN(w))R reshape(a,scc(' '));"," RZ(z=take(a,w));"," c=*(1+AS(w)); wv=(C*)AV(w)+c-1; zv=(C*)AV(z)+c;"," d=*(1+AS(z)); k=d-c;"," if(0\u003ck)DO(IC(w), if(xdash==*wv)memset(zv,xdash,k); wv+=c; zv+=d;);"," R z;","}","","static F1(graft){A p,q,t,*u,x,y,z,*zv;C*v;I d,j,k,m,n,*pv,*s,xn,*xv,yn,*yv;"," RZ(t=rc(w)); u=(A*)AV(t);"," x=*u;   xn=AN(x); xv=AV(x); m=0; DO(xn,m+=xv[i];);"," y=*++u; yn=AN(y); yv=AV(y);"," RZ(p=v2(0L,0L));  pv=AV(p);"," GA(z,BOX,yn,1,0); zv=(A*)AV(z);"," u=(A*)AV(w);"," for(j=0;j\u003cyn;++j){","  GA(q,CHAR,m*yv[j],2,0); s=AS(q); *s=m; *++s=yv[j]; v=(C*)AV(q);","  pv[1]=yv[j]; k=j;","  DO(xn, *pv=xv[i]; RZ(t=pad(p,u[k])); memcpy(v,AV(t),AN(t)); v+=AN(t); k+=yn;);","  zv[j]=q;"," }"," t=zv[0]; n=yv[0];"," if(1==m)RZ(p=scc(xdash))"," else{","  v=(C*)AV(t);         DO(m, if(' '!=*v){j=i;   break;} v+=n;);","  v=(C*)AV(t)+AN(t)-n; DO(m, if(' '!=*v){k=m-i; break;} v-=n;);","  d=k-j;","  GA(p,CHAR,m,1,0); v=(C*)AV(p); memset(v,' ',m);","  if(1==d)*(v+j)=xdash; else{memset(v+j,qbx[9],d); *(v+j)=*qbx; *(v+k-1)=qbx[6];}"," }"," RZ(zv[0]=overr(p,t));"," R z;","}","","static F2(center){A z;B*v;C b=1,*x;I j,k=0,m,n,*s;"," RZ(a\u0026\u0026w);"," m=AN(a); n=AN(w);"," GA(z,CHAR,m*n,2,0); s=AS(z); *s=n; *++s=m;"," v=(B*)AV(w); DO(n, if(b\u0026\u0026*v){b=0; j=i;} k+=*v++;);"," x=(C*)AV(z); memset(x,' ',AN(z)); memcpy(x+m*(k/2+j),AV(a),m);"," R z;","}","","static F2(troot){A s,t,x;B d;C*u,*v;I j,k,m,n;"," RZ(a\u0026\u0026w);"," m=AN(a); u=(C*)AV(a); d=!m||'0'\u003c=*u\u0026\u0026*u\u003c='9';"," GA(s,CHAR,d?1:4+m,1,0); v=(C*)AV(s);"," *v=xdash; if(!d){v[3+m]=xdash; v[1]=v[2+m]=' '; memcpy(2+v,u,m);}"," t=*(A*)AV(w); m=IC(t); n=*(1+AS(t));"," u=(C*)AV(t);         DO(m, if(' '!=*u){j=i;   break;} u+=n;);"," u=(C*)AV(t)+(m-1)*n; DO(m, if(' '!=*u){k=m-i; break;} u-=n;);"," GA(x,BOOL,m,1,0); v=(B*)AV(x);"," d=0; mv1(BOOL,m,  v,  \u0026d);"," d=1; mv1(BOOL,k-j,v+j,\u0026d);"," R link(center(s,x),w);","}","","static F1(tleaf){A t,*x,z;C d[2],*v;I n,*s;"," RZ(w);"," GA(z,BOX,1,1,0); x=(A*)AV(z);"," if(CHAR\u0026AT(w)\u0026\u00261\u003e=AR(w)){","  n=AN(w);","  GA(t,CHAR,2+n,2,0); s=AS(t); *s=1; *++s=2+n;","  v=(C*)AV(t); *v=xdash; *(v+1)=' '; memcpy(2+v,AV(w),n);","  *x=t;"," }else{","  RZ(t=matth1(w)); d[0]=xdash; d[1]=' ';","  RZ(*x=overr(center(str(2L,d),reshape(tally(t),one)),t));"," }"," R z;","}","","static F1(connect){C b,c=' ',d=' ',*x;I i,j=0,n,p;"," RZ(w);"," x=(C*)AV(w); n=AN(w); p=n/ *AS(w);"," for(i=0;i\u003cn;++i){","  b=j?c:' '; c=j?d:x[i]; d=j==p-1?' ':x[1+i];","  if(c==qbx[9]\u0026\u0026b==xdash)x[i]=c=qbx[5];","  if(c==qbx[5]\u0026\u0026d==xdash)x[i]=c=qbx[4];","  if(c==qbx[9]\u0026\u0026d==xdash)x[i]=c=qbx[3];","  if(c==qbx[6]\u0026\u0026b==xdash)x[i]=c=qbx[7];","  ++j; j=j==p?0:j;"," }"," R w;","}","","static F1(treach){R troot(scc('0'),graft(ope(every(w,trr))));}","","static F1(trr){PROLOG;A fs,gs,hs,p,t,*x,z;B b;C c,id;I m;V*v;"," RZ(w);"," if(AT(w)\u0026NOUN+NAME)R tleaf(w);"," v=VAV(w); id=v-\u003eid;  fs=v-\u003ef; gs=v-\u003eg; hs=v-\u003eh;"," m=!!fs+!!gs+(id==CFORK||id==CFORKO);"," if(!m)R tleaf(spellout(id));"," if(evoke(w))R tleaf(CA==ctype[c=*(C*)AV(fs)]?fs:spellout(c));"," GA(t,BOX,m,1,0); x=(A*)AV(t);"," if(id==CADVF\u0026\u0026((b=CGRAVE==ID(fs))||CGRAVE==ID(gs))){","  p=b?gs:fs;","  RZ(x[!b]=tleaf(scc(CGRAVE)));","  RZ(x[ b]=NOUN\u0026AT(p)\u0026\u00261\u003e=AR(p) ? treach(every(p,fx)) : trr(p) );"," }else{","  RZ(x[0]=(id==CGRCO||id==CATDOT)\u0026\u00261\u003e=AR(fs) ? treach(hs) : trr(fs) );","  if(1\u003cm)RZ(x[1]=trr(gs));","  if(2\u003cm)RZ(x[2]=trr(hs));"," }"," z=troot(spellout(id),graft(ope(t)));"," EPILOG(z);","}","","F2(trep){PROLOG;A*v,x,y,z;"," xdash=qbx[10];"," RZ(x=troot(a,trr(w)));"," RZ(y=ope(head(x)));"," v=(A*)AV(x); DO(AN(x)-1, RZ(y=overr(y,*++v)););"," z=connect(y);"," EPILOG(z);","}",""],"s.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Symbol Table \u0026 Associates                                               */","","#include \"j.h\"","#include \"a.h\"","","","A global,local=0;","I twprimes[]={61,139,271,523,1021,2029,4093,8221,16363,0}; /* p-2 also prime */","","static I probe(a,symb,is)A a,symb;C is;{A t;C*av;I c,i,k,m;SY*tab;"," av=(C*)AV(a); tab=(SY*)AV(symb); m=AN(symb);"," k=256L*(UC)*av+*(av+AN(a)-1);"," i=k%m;"," c=1+k%(m-2);"," if(is)while((t=tab[i].name)\u0026\u0026!(MARK\u0026AT(t)))i-=i\u003cc?c-m:c;"," else  while((t=tab[i].name)\u0026\u0026(MARK\u0026AT(t)||strcmp(av,(C*)AV(t))))i-=i\u003cc?c-m:c;"," R i;","} /* D.E. Knuth, Algorithm D, \"Searching \u0026 Sorting\", p. 521. */","","F2(srd){R(probe(a,w,0)+(SY*)AV(w))-\u003eval;}","","static B sex(a,w,b)A a,w;B b;{SY*e;"," e=probe(a,w,0)+(SY*)AV(w);"," if(e-\u003eval\u0026\u0026!b){","  fa(e-\u003ename); e-\u003ename=mark;","  fa(e-\u003eval ); e-\u003eval =0;"," }"," R!!e-\u003eval;","}","","A symbis(a,w,symb)A a,w,symb;{B b;SY*e;"," RZ(a\u0026\u0026w);"," a=ra(a); w=ra(w);"," b=CESC2==lc(a);"," ASSERT(!(sex(a,symb,b)\u0026\u0026b),EVNOTASGN);"," e=probe(a,symb,1)+(SY*)AV(symb);"," e-\u003ename=a; e-\u003eval=w;"," R mark;","}","","F1(srdlg){A z; R local\u0026\u0026(z=srd(w,local))?z:srd(w,global);}","","static F1(stdnm){C c,*s;I j,n,p,q;"," RZ(vs(w));"," n=AN(w); s=(C*)AV(w);"," j=0;    DO(n, if(' '!=s[j++])break;); p=n?j-1:0;"," j=n-1;  DO(n, if(' '!=s[j--])break;); q=n?(n-2)-j:0;"," if(p||q)RZ(w=drop(sc(p),drop(sc(-q),w)));"," c=spellin(n,AV(w));"," R c\u0026\u00261!=c? scc(c) : w;","}","","","DF1(ex){A y;B b;"," PREF1(ex);"," ASSERT(BOX\u0026AT(w),EVDOMAIN);"," RZ(y=stdnm(*(A*)AV(w)));"," b=CESC2==lc(y);"," R !vnm(AN(y),AV(y)) ? zero : b ? (sex(y,global,b)?zero:one) :","   (local\u0026\u0026sex(y,local,b)||sex(y,global,b),one);","}","","I nc(w)A w;{R !w ? 0 : NOUN\u0026AT(w) ? 2 : VERB\u0026AT(w) ? 3 : ADV\u0026AT(w) ? 4 : 5;}","","DF1(ncx){A t,y;"," PREF1(ncx);"," R sc(BOX\u0026AT(w) \u0026\u0026 (t=*(A*)AV(w)) \u0026\u0026 AN(t) \u0026\u0026 1\u003e=AR(t) \u0026\u0026 AT(t)\u0026CHAR+NAME \u0026\u0026","  (y=stdnm(t)) \u0026\u0026 vnm(AN(y),AV(y)) ? nc(srdlg(y)) : -1L);","}","","static C nla[256];","static I nlmask[] = {0, 0, NOUN, VERB, ADV, CONJ};","","static A nls(tm,w)I tm;A w;{A x,y,*yv;C b,c;I i,k=0,n;SY*e;"," RZ(w);"," n=AN(w); e=(SY*)AV(w);"," GA(y,BOX,n,1,0); yv=(A*)AV(y);"," for(i=0;i\u003cn;i++){","  x=e-\u003ename;","  b=x\u0026\u0026e-\u003eval\u0026\u0026tm\u0026AT(e-\u003eval)\u0026\u0026nla[c=*(C*)AV(x),(UC)c];","  if(b){*yv++=0\u003c=c\u0026\u0026c\u003c=127?str(AN(x),AV(x)):spellout(c); ++k;}","  ++e;"," }"," R take(sc(k),y);","}","","static F1(nlx){A l=0,z;I tm=0,*v;"," RZ(w=vi(w));"," v=AV(w); DO(AN(w), ASSERT(0\u003c*v\u0026\u0026*v\u003c6,EVDOMAIN); tm+=nlmask[*v++];);"," RZ(z=nls(tm,global));"," if(local)RZ(z=over(l=nls(tm,local),z));"," RZ(z=grade2(z,ope(z)));"," if(l)z=repeat(ne(z,behead(over(z,jot))),z);"," R z;","}","","DF1(nl1){DO(256,nla[i]=1;); R nlx(w);}","","DF2(nl2){UC*u;"," RZ(a\u0026\u0026w);"," ASSERT(CHAR\u0026AT(a),EVDOMAIN);"," u=(UC*)AV(a); DO(256,nla[i]=0;); DO(AN(a),nla[*u++]=1;);"," R nlx(w);","}","","F1(onm){RZ(w=stdnm(ope(w))); ASSERT(vnm(AN(w),AV(w)),EVILNAME); R w;}","","F1(symbrd){A z; RZ(w); ASSERT(z=srdlg(w),EVVALUE); R z;}","","B vnm(n,s)I n;C*s;{C c=*s;"," RZ(n);"," if(1==n\u0026\u0026(c==CALPHA||c==COMEGA||c==CGOTO))R 1;"," DO(n-1, c=ctype[s[i]]; RZ(c==CA||c==C9););"," c=ctype[s[n-1]];"," R CA==ctype[s[0]]\u0026\u0026(c==CA||c==C9||c==CC);","}",""],"t.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Tables: primitive symbols and character types                           */","","#include \"j.h\"","","P ps[]={","/*   0 00             */ {0,    0,         0,        0,    0,    0,    0      },","/*  33 21 !  CBANG    */ {VERB, fact,      outof,    RMAX, 0,    0,    0      },","/*  34 22    CQQ      */ {CONJ, 0,         qq,       0,    0,    0,    0      },","/*  35 23 #  CPOUND   */ {VERB, tally,     repeat,   RMAX, 1,    RMAX, 0      },","/*  36 24 $  CDOLLAR  */ {VERB, shape,     reitem,   RMAX, 1,    RMAX, 0      },","/*  37 25 %  CDIV     */ {VERB, recip,     divide,   RMAX, 0,    0,    CDIV   },","/*  38 26 \u0026  CAMP     */ {CONJ, 0,         amp,      0,    0,    0,    0      },","/*  40 28 (  CLPAR    */ {LPAR, 0,         0,        0,    0,    0,    0      },","/*  41 29 )  CRPAR    */ {RPAR, 0,         0,        0,    0,    0,    0      },","/*  42 2a *  CSTAR    */ {VERB, signum,    tymes,    RMAX, 0,    0,    0      },","/*  43 2b +  CPLUS    */ {VERB, conjug,    plus,     RMAX, 0,    0,    CPLUS  },","/*  44 2c ,  CCOMMA   */ {VERB, ravel,     over,     RMAX, RMAX, RMAX, 0      },","/*  45 2d -  CMINUS   */ {VERB, negate,    minus,    RMAX, 0,    0,    CMINUS },","/*  46 2e .  CDOT     */ {CONJ, 0,         dot,      0,    0,    0,    0      },","/*  47 2f /  CSLASH   */ {ADV,  slash,     0,        0,    0,    0,    0      },","/*  58 3a :  CCOLON   */ {CONJ, 0,         colon,    0,    0,    0,    0      },","/*  59 3b ;  CSEMICO  */ {VERB, raze,      link,     RMAX, RMAX, RMAX, 0      },","/*  60 3c \u003c  CLT      */ {VERB, box,       lt,       RMAX, 0,    0,    COPE   },","/*  61 3d =  CEQ      */ {VERB, sclass,    eq,       RMAX, 0,    0,    0      },","/*  62 3e \u003e  CGT      */ {VERB, ope,       gt,       0,    0,    0,    CBOX   },","/*  63 3f ?  CQUERY   */ {VERB, roll,      deal,     RMAX, 0,    0,    0      },","/*  64 40 @  CAT      */ {CONJ, 0,         atop,     0,    0,    0,    0      },","/*  91 5b [  CLEFT    */ {VERB, left1,     left2,    RMAX, RMAX, RMAX, CLEFT  },","/*  92 5c \\  CBSLASH  */ {ADV,  bslash,    0,        0,    0,    0,    0      },","/*  93 5d ]  CRIGHT   */ {VERB, right1,    right2,   RMAX, RMAX, RMAX, CRIGHT },","/*  94 5e ^  CEXP     */ {VERB, expn1,     expn2,    RMAX, 0,    0,    CLOG   },","/*  96 60 `  CGRAVE   */ {CONJ, 0,         tie,      0,    0,    0,    0      },","/* 123 7b {  CLBRACE  */ {VERB, catalog,   from,     1,    0,    RMAX, 0      },","/* 124 7c |  CSTILE   */ {VERB, mag,       residue,  RMAX, 0,    0,    0      },","/* 125 7d }  CRBRACE  */ {ADV,  rbrace,    0,        0,    0,    0,    0      },","/* 126 7e ~  CTILDE   */ {ADV,  swap,      0,        0,    0,    0,    0      },","/* 128 80 =. CASGN    */ {ASGN, 0,         0,        0,    0,    0,    0      },","/* 129 81 =: CGASGN   */ {ASGN, 0,         0,        0,    0,    0,    0      },","/* 130 82 \u003c. CMIN     */ {VERB, floor1,    minimum,  RMAX, 0,    0,    0      },","/* 131 83 \u003c: CLE      */ {VERB, decrem,    le,       RMAX, 0,    0,    CGE    },","/* 132 84 \u003e. CCEIL    */ {VERB, ceil1,     maximum,  RMAX, 0,    0,    0      },","/* 133 85 \u003e: CGE      */ {VERB, increm,    ge,       RMAX, 0,    0,    CLE    },","/* 135 87 _: CUSCO    */ {VERB, inf1,      inf2,     RMAX, RMAX, RMAX, 0      },","/* 136 88 +. COR      */ {VERB, rect,      gcd,      RMAX, 0,    0,    0      },","/* 137 89 +: CNOR     */ {VERB, duble,     nor,      RMAX, 0,    0,    CHALVE },","/* 138 8a *. CAND     */ {VERB, polar,     lcm,      RMAX, 0,    0,    0      },","/* 139 8b *: CNAND    */ {VERB, square,    nand,     RMAX, 0,    0,    CSQRT  },","/* 140 8c -. CNOT     */ {VERB, not,       less,     RMAX, RMAX, RMAX, CNOT   },","/* 141 8d -: CMATCH   */ {VERB, halve,     match,    RMAX, RMAX, RMAX, CDOUBLE},","/* 142 8e %. CDOMINO  */ {VERB, minv,      mdiv,     2,    RMAX, 2,    CDOMINO},","/* 143 8f %: CROOT    */ {VERB, sqroot,    root,     RMAX, 0,    0,    CSQUARE},","/* 144 90 ^. CLOG     */ {VERB, logar1,    logar2,   RMAX, 0,    0,    CEXP   },","/* 145 91 ^: CPOWOP   */ {CONJ, 0,         powop,    0,    0,    0,    0      },","/* 146 92 $. CGOTO    */ {NAME, 0,         0,        0,    0,    0,    0      },","/* 147 93 $: CSELF    */ {VERB, self1,     self2,    RMAX, RMAX, RMAX, 0      },","/* 148 94 ~. CNUB     */ {VERB, nub,       0,        RMAX, 0,    0,    0      },","/* 149 95 ~: CNE      */ {VERB, nubsieve,  ne,       RMAX, 0,    0,    0      },","/* 150 96 |. CREV     */ {VERB, reverse,   rotate,   RMAX, 0,    RMAX, CREV   },","/* 151 97 |: CCANT    */ {VERB, cant1,     cant2,    RMAX, 1,    RMAX, CCANT  },","/* 152 98 .. CDOTDOT  */ {CONJ, 0,         even,     0,    0,    0,    0      },","/* 153 99 .: CDOTCO   */ {CONJ, 0,         odd,      0,    0,    0,    0      },","/* 154 9a :. COBVERSE */ {CONJ, 0,         obverse,  0,    0,    0,    0      },","/* 156 9c ,. CCOMDOT  */ {VERB, table,     overr,    RMAX, RMAX, RMAX, 0      },","/* 157 9d ,: CLAMIN   */ {VERB, lamin1,    lamin2,   RMAX, RMAX, RMAX, CHEAD  },","/* 158 9e ;. CCUT     */ {CONJ, 0,         cut,      0,    0,    0,    0      },","/* 159 9f ;: CWORDS   */ {VERB, words,     0,        1,    0,    0,    0      },","/* 160 a0 #. CBASE    */ {VERB, base1,     base2,    1,    1,    1,    CABASE },","/* 161 a1 #: CABASE   */ {VERB, abase1,    abase2,   RMAX, 1,    0,    CBASE  },","/* 162 a2 @. CATDOT   */ {CONJ, 0,         agenda,   0,    0,    0,    0      },","/* 163 a3 @: CATCO    */ {CONJ, 0,         atco,     0,    0,    0,    0      },","/* 164 a4 /. CSLDOT   */ {ADV,  sldot,     0,        0,    0,    0,    0      },","/* 165 a5 /: CGRADE   */ {VERB, grade1,    grade2,   RMAX, RMAX, RMAX, CGRADE },","/* 166 a6 \\. CBSDOT   */ {ADV,  bsdot,     0,        0,    0,    0,    0      },","/* 167 a7 \\: CDGRADE  */ {VERB, dgrade1,   dgrade2,  RMAX, RMAX, RMAX, 0      },","/* 168 a8 [. CLEV     */ {CONJ, 0,         lev,      0,    0,    0,    0      },","/* 170 aa ]. CDEX     */ {CONJ, 0,         dex,      0,    0,    0,    0      },","/* 172 ac {. CTAKE    */ {VERB, head,      take,     RMAX, 1,    RMAX, CLAMIN },","/* 173 ad {: CTAIL    */ {VERB, tail,      0,        RMAX, 0,    0,    0      },","/* 174 ae }. CDROP    */ {VERB, behead,    drop,     RMAX, 1,    RMAX, 0      },","/* 175 af }: CCTAIL   */ {VERB, curtail,   0,        RMAX, 0,    0,    0      },","/* 177 b1 `: CGRCO    */ {CONJ, 0,         evger,    0,    0,    0,    0      },","/* 178 b2 \". CEXEC    */ {VERB, exec1,     exec2,    1,    1,    1,    CTHORN },","/* 179 b3 \": CTHORN   */ {VERB, thorn1,    thorn2,   RMAX, 1,    1,    CEXEC  },","/* 180 b4 \u0026. CUNDER   */ {CONJ, 0,         under,    0,    0,    0,    0      },","/* 181 b5 \u0026: CAMPCO   */ {CONJ, 0,         ampco,    0,    0,    0,    0      },","/* 182 b6 !. CFIT     */ {CONJ, 0,         fit,      0,    0,    0,    0      },","/* 183 b7 !: CIBEAM   */ {CONJ, 0,         foreign,  0,    0,    0,    0      },","/* 192 c0 a. CALP     */ {NOUN, 0,         0,        0,    0,    0,    0      },","/* 193 c1 A. CATOMIC  */ {VERB, adot1,     adot2,    1,    0,    RMAX, 0      },","/* 194 c2 b. CBOOL    */ {ADV,  bool,      0,        0,    0,    0,    0      },","/* 195 c3 c. CEIGEN   */ {VERB, eig1,      eig2,     2,    0,    2,    0      },","/* 196 c4 C. CCYCLE   */ {VERB, cdot1,     cdot2,    1,    1,    RMAX, CCYCLE },","/* 197 c5 e. CEPS     */ {VERB, razein,    eps,      RMAX, RMAX, RMAX, 0      },","/* 198 c6 E. CEBAR    */ {VERB, 0,         ebar,     0,    RMAX, RMAX, 0      },","/* 199 c7 f. CFIX     */ {ADV,  fix,       0,        0,    0,    0,    0      },","/* 200 c8 i. CIOTA    */ {VERB, iota,      indexof,  1,    RMAX, RMAX, 0      },","/* 201 c9 j. CJDOT    */ {VERB, jdot1,     jdot2,    RMAX, 0,    0,    0      },","/* 202 ca o. CCIRCLE  */ {VERB, pix,       circle,   RMAX, 0,    0,    0      },","/* 203 cb p. CPOLY    */ {VERB, poly1,     poly2,    1,    1,    0,    CPOLY  },","/* 204 cc r. CRDOT    */ {VERB, rdot1,     rdot2,    RMAX, 0,    0,    0      },","/* 205 cd x. CALPHA   */ {NAME, 0,         0,        0,    0,    0,    0      },","/* 206 ce y. COMEGA   */ {NAME, 0,         0,        0,    0,    0,    0      },","/* 224 e0 0: CZERO    */ {VERB, zero1,     zero2,    RMAX, RMAX, RMAX, 0      },","/* 225 e1 1: CONE     */ {VERB, one1,      one2,     RMAX, RMAX, RMAX, 0      },","/* 231 e7    CPDT     */ {VERB, 0,         pdt,      0,    RMAX, RMAX, 0      }","};","","UC psptr[256]={"," 0,  0,  0,  0,  0,  0,  0,  0,    0,  0,  0,  0,  0,  0,  0,  0, /* 0 */"," 0,  0,  0,  0,  0,  0,  0,  0,    0,  0,  0,  0,  0,  0,  0,  0, /* 1 */"," 0,  1,  2,  3,  4,  5,  6,  0,    7,  8,  9, 10, 11, 12, 13, 14, /* 2 */"," 0,  0,  0,  0,  0,  0,  0,  0,    0,  0, 15, 16, 17, 18, 19, 20, /* 3 */","21,  0,  0,  0,  0,  0,  0,  0,    0,  0,  0,  0,  0,  0,  0,  0, /* 4 */"," 0,  0,  0,  0,  0,  0,  0,  0,    0,  0,  0, 22, 23, 24, 25,  0, /* 5 */","26,  0,  0,  0,  0,  0,  0,  0,    0,  0,  0,  0,  0,  0,  0,  0, /* 6 */"," 0,  0,  0,  0,  0,  0,  0,  0,    0,  0,  0, 27, 28, 29, 30,  0, /* 7 */","31, 32, 33, 34, 35, 36,  0, 37,   38, 39, 40, 41, 42, 43, 44, 45, /* 8 */","46, 47, 48, 49, 50, 51, 52, 53,   54, 55, 56,  0, 57, 58, 59, 60, /* 9 */","61, 62, 63, 64, 65, 66, 67, 68,   69,  0, 70,  0, 71, 72, 73, 74, /* a */"," 0, 75, 76, 77, 78, 79, 80, 81,    0,  0,  0,  0,  0,  0,  0,  0, /* b */","82, 83, 84, 85, 86, 87, 88, 89,   90, 91, 92, 93, 94, 95, 96,  0, /* c */"," 0,  0,  0,  0,  0,  0,  0,  0,    0,  0,  0,  0,  0,  0,  0,  0, /* d */","97, 98,  0,  0,  0,  0,  0, 99,    0,  0,  0,  0,  0,  0,  0,  0, /* e */"," 0,  0,  0,  0,  0,  0,  0,  0,    0,  0,  0,  0,  0,  0,  0,  0, /* f */","};","/*   1   2   3   4   5   6   7     8   9   a   b   c   d   e   f   */","","","C ctype[256]={"," 0,  0,  0,  0,  0,  0,  0,  0,  0, CS,  0,  0,  0,  0,  0,  0, /* 0                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* 1                  */","CS,  0,  0,  0,  0,  0,  0, CQ,  0,  0,  0,  0,  0,  0, CD,  0, /* 2  !\"#$%\u0026'()*+,-./ */","C9, C9, C9, C9, C9, C9, C9, C9, C9, C9, CC,  0,  0,  0,  0,  0, /* 3 0123456789:;\u003c=\u003e? */"," 0, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, /* 4 @ABCDEFGHIJKLMNO */","CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA,  0,  0,  0,  0, C9, /* 5 PQRSTUVWXYZ[\\]^_ */"," 0, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, /* 6 `abcdefghijklmno */","CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA,  0,  0,  0,  0,  0, /* 7 pqrstuvwxyz{|}~  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* 8                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* 9                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* a                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* b                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* c                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* d                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* e                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* f                  */","};","/*   1   2   3   4   5   6   7   8   9   a   b   c   d   e   f   */","","C wtype[256]={"," 0,  0,  0,  0,  0,  0,  0,  0,  0, CS,  0,  0,  0,  0,  0,  0, /* 0                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* 1                  */","CS,  0,  0,  0,  0,  0,  0, CQ,  0,  0,  0,  0,  0,  0, CD,  0, /* 2  !\"#$%\u0026'()*+,-./ */","C9, C9, C9, C9, C9, C9, C9, C9, C9, C9, CC,  0,  0,  0,  0,  0, /* 3 0123456789:;\u003c=\u003e? */"," 0, CA, CB, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CN, CA, /* 4 @ABCDEFGHIJKLMNO */","CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA,  0,  0,  0,  0, C9, /* 5 PQRSTUVWXYZ[\\]^_ */"," 0, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, /* 6 `abcdefghijklmno */","CA, CA, CA, CA, CA, CA, CA, CA, CA, CA, CA,  0,  0,  0,  0,  0, /* 7 pqrstuvwxyz{|}~  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* 8                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* 9                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* a                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* b                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* c                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* d                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* e                  */"," 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, /* f                  */","};","/*   1   2   3   4   5   6   7   8   9   a   b   c   d   e   f   */",""],"u.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Interpreter Utilities                                                   */","","#include \"j.h\"","","","I aii(w)A w;{I m=IC(w); R m?AN(w)/m:prod(AR(w)-1,1+AS(w));}","","B all1(w)A w;{B*b; RZ(w); b=(B*)AV(w); DO(AN(w), if(!*b++)R 0;); R 1;}","","A apv(n,b,m)I n,b,m;{A z;I j=b-m,*x; GA(z,INT,n,1,0); x=AV(z); DO(n,*x++=j+=m;); R z;}","","I bp(t)I t;{"," switch(t){","  case BOOL:  R sizeof(B);","  case NAME:","  case CHAR:  R sizeof(C);","  case LPAR:","  case RPAR:","  case ASGN:","  case MARK:","  case INT:   R sizeof(I);","  case FL:    R sizeof(D);","  case CMPX:  R sizeof(Z);","  case BOX:   R sizeof(A);","  case VERB:","  case ADV:","  case CONJ:  R sizeof(V);","  case SYMB:  R sizeof(SY);","  default:    jsignal(EVSYSTEM); jouts(\"bp\\n\"); R 0;","}}","","I coerce1(w,mt)A*w;I mt;{I t,wt;"," RZ(*w);"," if(!AN(*w))R MAX(BOOL,mt);"," wt=AT(*w);"," t=MAX(wt,mt);"," ASSERT(!mt||!(t\u0026NUMERIC)==!(mt\u0026NUMERIC),EVDOMAIN);"," if(t!=wt)RZ(*w=cvt(t,*w));"," R t;","}","","I coerce2(a,w,mt)A*a,*w;I mt;{I at,t,wt;"," RZ(*a\u0026\u0026*w);"," at=AT(*a)*!!AN(*a);"," wt=AT(*w)*!!AN(*w);"," if(!at\u0026\u0026!wt)R MAX(BOOL,mt);"," t=MAX(mt,MAX(at,wt));"," ASSERT(!mt||!(t\u0026NUMERIC)==!(mt\u0026NUMERIC),EVDOMAIN);"," if(t!=at)RZ(*a=cvt(t,*a));"," if(t!=wt)RZ(*w=cvt(t,*w));"," R t;","}","","A cstr(s)C*s;{R str((I)strlen(s),s);}","","B evoke(w)A w;{V*v=VAV(w); R CTILDE==v-\u003eid\u0026\u0026CHAR\u0026AT(v-\u003ef);}","","C*fi(s,v)C*s;I*v;{C*t; *v=strtol(s,\u0026t,10); ASSERT(0\u003c=*v\u0026\u0026s!=t,EVDOMAIN); R t;}","","F1(filler){A z;I t; RZ(w); t=AT(w); GA(z,t,1,0,0); mv1(t,1L,AV(z),FILL(t)); R z;}","","F1(ii){RZ(w); R apv(IC(w),0L,1L);}","","I i0(w)A w;{RZ(w=vi(w)); ASSERT(!AR(w),EVRANK); R*AV(w);}","","#if LINKJ","void jsignal(e)int e;{if(jerr)R; jerr=e;}","#else","void jsignal(e)int e;{A t=*(e+(A*)AV(qevm));"," if(jerr)R;"," jerr=e;"," if(errsee){jouts(AV(t)); jputc(CNL);}","}","#endif","","C lc(w)A w;{RZ(w); R*((C*)AV(w)+AN(w)-1);}","","void mv(t,n,z,w)I t,n;C*z,*w;{memcpy(z,w,n*bp(t));}","","void mv1(t,n,z,w)I t,n;C*z,*w;{I m=bp(t);"," if(1==m)memset(z,*w,n);else DO(n, memcpy(z,w,m); z+=m;);","}","","I prod(n,v)I n,*v;{I z=1; DO(n,if(!v[i])R 0;); DO(n,z*=v[i];); R z;}","","F1(rankle){R!w||AR(w)?w:ravel(w);}","","A sc(k)I k;{A z; GA(z,INT,1,0,0); *AV(z)=k; R z;}","","A scalar4(t,v)I t,v;{A z; GA(z,t,1,0,0); *AV(z)=v; R z;}","","A scc(c) C c;{A z; GA(z,CHAR,1,0,0); *(C*)AV(z)=c; R z;}","","A scf(x) D x;{A z; GA(z,FL  ,1,0,0); *(D*)AV(z)=x; R z;}","","A scnm(c)C c;{A z; GA(z,NAME,1,0,0); *(C*)AV(z)=c; R z;}","","A str(n,s)I n;C*s;{A z; GA(z,CHAR,n,1,0); memcpy(AV(z),s,n); R z;}","","F1(vi){RZ(w); ASSERT(!AN(w)||AT(w)\u0026NUMERIC,EVDOMAIN); R INT\u0026AT(w)?w:cvt(INT,w);}","","F2(vib){"," RZ(w);"," if(INT\u0026AT(w))R w;"," ASSERT(all1(eq(w,floor1(w))),EVDOMAIN);"," R cvt(INT,maximum(negate(a),minimum(a,w)));","}","","F1(vn){RZ(w); ASSERT(NOUN\u0026AT(w),EVSYNTAX); R w;}","","F1(vs){RZ(w); ASSERT(!AN(w)||AT(w)\u0026CHAR+NAME,EVDOMAIN); ASSERT(1\u003e=AR(w),EVRANK); R w;}","","A v2(a,b)I a,b;{A z;I*x; GA(z,INT,2,1,0); x=AV(z); *x++=a; *x=b; R z;}","","","I mr(w)A w;{R VAV(w)-\u003emr;}","","I lr(w)A w;{R VAV(w)-\u003elr;}","","I rr(w)A w;{R VAV(w)-\u003err;}","",""],"ut.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Tolerant and Fuzzy Comparisons                                          */","","#include \"j.h\"","","","B teq(u,v)D u,v;{D x;"," if(u==v)R 1;"," if(0\u003cu!=0\u003cv)R 0;"," x=0\u003cu?MAX(u,v):-MIN(u,v);"," R x==inf ? u==v : ABS(u-v)\u003c=qct*x;","}","","B tlt(u,v)D u,v;{R u\u003c v\u0026\u0026!teq(u,v);}","","B tle(u,v)D u,v;{R u\u003c=v|| teq(u,v);}","","D tfloor(v)D v;{D x=floor(0.5+v); R x-!tle(x,v);}","","D tceil(v) D v;{D x=floor(0.5+v); R x+ tlt(x,v);}","","","B feq(u,v) D u,v;{R ABS(u-v)\u003c=qfuzz*MAX(ABS(u),ABS(v));}","","B freal(v)Z v;{R ABS(v.im)\u003c=qfuzz*ABS(v.re);}","","","/* See  R. Bernecky, Comparison Tolerance, SATN-23, IPSA, 1977-06-10       */","/* For finite numbers, the following defns hold:                           */","/*   teq(u,v)   ABS(u-v)\u003c=qct*MAX(ABS(u),ABS(v))                           */","/*   tne(u,v)   !teq(u,v)                                                  */","/*   tlt(u,v)   (u\u003c v)\u0026\u0026tne(u,v)                                           */","/*   tle(u,v)   (u\u003c=v)||teq(u,v)                                           */","/*   tge(u,v)   (u\u003e=v)||teq(u,v)                                           */","/*   tgt(u,v)   (u\u003e v)\u0026\u0026tne(u,v)                                           */","/*   tfloor(v)  x=floor(0.5+v), x-tgt(x,v)                                 */","/*   tceil(v)   x=floor(0.5+v), x+tlt(x,v)                                 */",""],"v.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Verbs                                                                   */","","#include \"j.h\"","#include \"v.h\"","","","F1(left1){R ca(w);}","","F2(left2){R ca(a);}","","F1(right1){R ca(w);}","","F2(right2){R ca(w);}","","F2(less){A s;I ar,k,m,*sv,wr,*ws;"," RZ(a\u0026\u0026w);"," ar=AR(a); wr=AR(w);"," if(ar\u003e1+wr)R ca(a);"," if(wr\u0026\u0026ar!=wr){","  m=MAX(1,ar);","  GA(s,INT,m,1,0); sv=AV(s); ws=AS(w);","  k=ar\u003ewr?0:1+wr-m; *sv=prod(k,ws); mv(INT,m-1,1+sv,k+ws);","  RZ(w=reshape(s,w));"," }"," R repeat(not(eps(a,w)),a);","}","","F1(nub){R repeat(nubsieve(w),w);}","","F1(iota){A z;I m,n,*v;"," F1RANK(1,iota,0);"," RZ(w=vi(w));"," n=AN(w); v=AV(w); m=prod(n,v);"," RZ(z=reshape(mag(w),apv(ABS(m),0L,1L)));"," DO(n*!!m, if(0\u003ev[i])RZ(z=rank1ex(z,0L,n-i,reverse)););"," R z;","}","","F1(immex){A z; R (z=parse(tokens(w)))\u0026\u0026!asgn ? jpr(z) : z;}","","F1(exec1){A z;"," F1RANK(1,exec1,0);"," z=parse(tokens(vs(w))); asgn=0;"," R !z?0:MARK\u0026AT(z)?mtv:vn(z);","}","","F2(exec2){A z;C es=errsee;"," F2RANK(1,1,exec2,0);"," errsee=0; z=exec1(w); errsee=es; jerr=0;"," R z?z:exec1(a);","}","","","F1(box){RZ(w); R scalar4(BOX,ca(w));}","","static void povtake(a,w,x)A a,w;C*x;{C*v;I d,i,j,k,m,n,q,r,*s,t,*u,y;"," m=AN(a); u=AV(a);"," n=AN(w); v=(C*)AV(w); r=AR(w); s=AS(w); t=AT(w); k=bp(t);"," if(r==m){C b=0; DO(m,if(b=u[i]!=s[i])break;); if(!b){mv(t,n,x,v); R;}}"," for(i=0;i\u003cn;i++){","  y=0; d=1; q=i; /* y=.a#.((-$a){.(($a)$1),$w)#:i */","  DO(r, j=s[r-1-i]; y+=q%j*d; d*=u[m-i-1]; q/=j;);","  mv1(t,1L,x+y*k,v); v+=k;","}}","","F1(ope){PROLOG;A a,*v,y,z;C*x;I j,k,m,n,p,r=0,*s,t=0,*u,*uu;"," RZ(w);"," n=AN(w); v=(A*)AV(w);"," if(!(BOX\u0026AT(w)))R ca(w);"," if(!n)R cvt(BOOL,w);"," if(!AR(w))R*v;"," DO(n, r=MAX(r,AR(v[i])););"," DO(n, if(AN(v[i])){k=AT(v[i]); t=t?t:k; ASSERT(HOMO(t,k),EVDOMAIN); t=MAX(t,k);});"," t=MAX(BOOL,t);"," RZ(a=apv(r,0L,0L)); uu=r+AV(a);"," for(j=0;j\u003cn;j++){","  y=v[j]; p=AR(y); s=p+AS(y); u=uu;","  DO(p, --s; --u; *u=MAX(*s,*u);); DO(r-p, --u; *u=MAX(1,*u););"," }"," u=AV(a); m=prod(r,u);"," GA(z,t,n*m,r+AR(w),AS(w)); mv(INT,r,AS(z)+AR(w),u);"," x=(C*)AV(z); mv1(t,n*m,x,FILL(t)); k=m*bp(t);"," DO(n, if(AN(v[i]))povtake(a,cvt(t,v[i]),x); x+=k;);"," EPILOG(z);","}","","F1(raze){A u,*v,y,z;C b=0,*x;I c=0,k,m=0,n,p,r=1,t,*s;"," RZ(w);"," n=AN(w); v=(A*)AV(w);"," if(!(n\u0026\u0026BOX\u0026AT(w)))R ravel(w);"," t=AT(*v); k=bp(t);"," DO(n, y=v[i]; c+=IC(y); m+=AN(y); r=MAX(r,AR(y)); if(b=t!=AT(y))break;);"," if(!b\u0026\u00261\u003cr){","  c=0;","  DO(n, y=v[i]; c+=r\u003eAR(y)?1:(u=y,IC(y)););","  p=4*(r-1); s=1+AS(u);","  DO(n, y=v[i]; if(b=r\u003e1+AR(y)||p\u0026\u0026memcmp(s,1+AS(y),p))break;);"," }"," if(b){z=*v++; DO(n-1,RZ(z=over(z,*v++));); R rankle(z);}"," GA(z,t,m,r,AS(u)); *AS(z)=c; x=(C*)AV(z);"," DO(n, y=*v++; p=k*AN(y); memcpy(x,AV(y),p); x+=p;);"," R z;","}","","F2(link){RZ(a\u0026\u0026w); R over(box(a),AN(w)\u0026\u0026BOX\u0026AT(w)?w:box(w));}","","","F1(zero1){RZ(   w); R zero;}","","F2(zero2){RZ(a\u0026\u0026w); R zero;}","","F1(one1 ){RZ(   w); R one;}","","F2(one2 ){RZ(a\u0026\u0026w); R one;}","","F1(inf1 ){RZ(   w); R scf(inf);}","","F2(inf2 ){RZ(a\u0026\u0026w); R scf(inf);}","","","F1(roll){A z;D rl=qrl;static D m=16807,p=2147483647L;I k,wn,*wv,*zv;"," RZ(w=vi(w));"," wn=AN(w); wv=AV(w);"," GA(z,INT,wn,AR(w),AS(w)); zv=AV(z);"," DO(wn, k=*wv++; ASSERT(0\u003ck, EVDOMAIN); rl=fmod(rl*m,p); *zv++=(I)floor(rl*k/p););"," qrl=rl;"," R z;","}  /* P.C. Berry, Sharp APL Reference Manual, 1979, p. 126. */","","F2(deal){A y;D rl=qrl;static D m=16807,p=2147483647L;I am,j,k,wm,*yv;"," F2RANK(0,0,deal,0);"," am=i0(a);"," wm=i0(w);"," ASSERT(0\u003c=am\u0026\u0026am\u003c=wm,EVDOMAIN);"," RZ(y=apv(wm,wm-1,-1L)); yv=AV(y);"," DO(am, rl=fmod(rl*m,p); j=i+(I)floor(rl*(wm-i)/(1+p)); k=yv[i]; yv[i]=yv[j]; yv[j]=k;);"," qrl=rl;"," R take(a,y);","}  /* P.C. Berry, Sharp APL Reference Manual, 1979, p. 178. */",""],"v.h":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Macros and Defined-Constants for Verbs                                  */","","","#define SF1(f,Tv,Tx,exp)        B f(v,x)Tv*v;Tx*x;{*x=(exp); R!jerr;}","#define SF2(f,Tv,Tx,exp)        B f(u,v,x)Tv*u,*v;Tx*x;{*x=(exp); R!jerr;}","","extern Z        zcir();","extern Z        zconjug();","extern Z        zdiv();","extern B        zeq();","extern Z        zexp();","extern Z        zfloor();","extern Z        zgcd();","extern Z        zlcm();","extern Z        zlog();","extern D        zmag();","extern Z        zminus();","extern Z        znonce1();","extern Z        znonce2();","extern Z        zplus();","extern Z        zpow();","extern Z        zrem();","extern Z        zsqrt();","extern Z        ztymes();","extern Z        ztrend();",""],"vb.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Verbs:  Boolean-valued                                                  */","","#include \"j.h\"","#include \"v.h\"","","","static SF2(ble,B,B, !*u||*v)","","static SF2(ile,I,B, *u\u003c=*v)","","static SF2(dle,D,B, tle(*u,*v))","","F2(le){"," switch(coerce2(\u0026a,\u0026w,BOOL)){","  case BOOL: R sex2(a,w,BOOL,ble);","  case INT:  R sex2(a,w,BOOL,ile);","  case FL:   R sex2(a,w,BOOL,dle);","  default:   R sex2(cvt(FL,a),cvt(FL,w),BOOL,dle);","}}","","static SF2(blt,B,B, !*u\u0026\u0026*v)","","static SF2(ilt,I,B, *u\u003c*v)","","static SF2(dlt,D,B, tlt(*u,*v))","","F2(lt){"," switch(coerce2(\u0026a,\u0026w,BOOL)){","  case BOOL: R sex2(a,w,BOOL,blt);","  case INT:  R sex2(a,w,BOOL,ilt);","  case FL:   R sex2(a,w,BOOL,dlt);","  default:   R sex2(cvt(FL,a),cvt(FL,w),BOOL,dlt);","}}","","F2(ge){R not(lt(a,w));}","","F2(gt){R not(le(a,w));}","","static SF2(beq,B,B, *u==*v)","","static SF2(ieq,I,B, *u==*v)","","static SF2(deq,D,B, teq(*u,*v))","","static SF2(jeq,Z,B, zeq(*u,*v))","","static SF2(ceq,C,B, *u==*v)","","static SF2(aeq,A,B, one==match(*u,*v))","","static SF2(neq,C,B, 0)","","F2(eq){I at,t=-1,wt;"," RZ(a\u0026\u0026w);"," at=AT(a); wt=AT(w);"," if(AN(a)\u0026\u0026AN(w)\u0026\u0026HOMO(at,wt)){","  t=MAX(at,wt);","  if(t!=at)RZ(a=cvt(t,a));","  if(t!=wt)RZ(w=cvt(t,w));"," }"," switch(t){","  case BOOL: R sex2(a,w,BOOL,beq);","  case INT:  R sex2(a,w,BOOL,ieq);","  case FL:   R sex2(a,w,BOOL,deq);","  case CMPX: R sex2(a,w,BOOL,jeq);","  case CHAR:","  case NAME: R sex2(a,w,BOOL,ceq);","  case BOX:  R sex2(a,w,BOOL,aeq);","  case -1:   R sex2(a,w,BOOL,neq);","}}","","F2(ne){R not(eq(a,w));}","","F2(nand){R not(lcm(cvt(BOOL,a),cvt(BOOL,w)));}","","F2(nor){R not(gcd(cvt(BOOL,a),cvt(BOOL,w)));}","","F1(sclass){A x;"," RZ(w);"," x=indexof(w,AR(w)?w:ravel(w));"," R df2(repeat(eq(ii(w),x),x),x,slash(ds(CEQ)));","}","","F1(nubsieve){R eq(ii(w),indexof(w,w));}","","F2(match){PROLOG;A y,z;I an,ar,*as,at,wn,wr,*ws,wt;"," RZ(a\u0026\u0026w);"," if(a==w)R one;"," an=AN(a); ar=AR(a); as=AS(a); at=AT(a);"," wn=AN(w); wr=AR(w); ws=AS(w); wt=AT(w);"," if(an!=wn||ar!=wr)R zero;"," DO(ar,if(*as++!=*ws++)R zero;);"," if(!an)R one;"," if(!HOMO(at,wt))R zero;"," if(BOX\u0026at\u0026\u00261==an)z=match(*(A*)AV(a),*(A*)AV(w));"," else{RZ(y=eq(a,w)); z=all1(y)?one:zero;}"," EPILOG(z);","}","","F2(eps){R lt(indexof(w,a),tally(w));}","","F1(razein){R df2(w,box(raze(w)),amp(swap(ds(CEPS)),ds(COPE)));}","","F2(ebar){A z;B*x;I i,k=0,m,n,p,td1[NALP];UC*u,*v;"," ASSERT((!AN(a)||CHAR\u0026AT(a))\u0026\u0026(!AN(w)||CHAR\u0026AT(w))\u0026\u00261\u003e=AR(a)\u0026\u00261\u003e=AR(w),EVNONCE);"," m=AN(a); u=(UC*)AV(a);"," n=AN(w); v=(UC*)AV(w);"," DO(NALP, td1[i]=1+m;); DO(m, td1[u[i]]=m-i;);"," GA(z,BOOL,n,AR(w),0); x=(B*)AV(z); mv1(BOOL,n,x,\"\");"," p=1+n-m;"," while(k\u003cp){for(i=0;i\u003cm\u0026\u0026u[i]==v[k+i];++i); x[k]=i==m; k+=td1[v[k+m]];}"," R z;","}  /* Daniel M. Sunday, CACM 1990 8, 132-142 */",""],"ve.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Verbs:  Elementary Functions (Arithmetic, etc.)                         */","","#include \"j.h\"","#include \"v.h\"","","","static SF1(jconjug,Z,Z, zconjug(*v))","","F1(conjug){"," switch(coerce1(\u0026w,BOOL)){","  case BOOL:","  case INT:","  case FL:   R ca(w);","  case CMPX: R sex1(w,CMPX,jconjug);","  default:   R 0;","}}","","static SF2(bplus,B,I, *u+*v)","","static SF2(iplus,I,D, *u+(D)*v)","","static SF2(dplus,D,D, *u+*v)","","static SF2(jplus,Z,Z, zplus(*u,*v))","","F2(plus){"," switch(coerce2(\u0026a,\u0026w,BOOL)){","  case BOOL: R sex2(a,w,INT ,bplus);","  case INT:  R pcvt(INT,sex2(a,w,FL,iplus));","  case FL:   R sex2(a,w,FL  ,dplus);","  case CMPX: R sex2(a,w,CMPX,jplus);","  default:   R 0;","}}","","extern A sreduce();","","F1(sum){"," RZ(w);"," switch(AT(w)){","  case FL:   R sreduce(zero,w,dplus);","  case CMPX: R sreduce(zero,w,jplus);","  default:   R pcvt(INT,sreduce(zero,cvt(FL,w),dplus));","}}","","F1(negate){R minus(zero,w);}","","static SF2(bminus,B,I, *u-*v)","","static SF2(iminus,I,D, *u-(D)*v)","","static SF2(dminus,D,D, *u-*v)","","static SF2(jminus,Z,Z, zminus(*u,*v))","","F2(minus){"," switch(coerce2(\u0026a,\u0026w,BOOL)){","  case BOOL: R sex2(a,w,INT ,bminus);","  case INT:  R pcvt(INT,sex2(a,w,FL,iminus));","  case FL:   R sex2(a,w,FL  ,dminus);","  case CMPX: R sex2(a,w,CMPX,jminus);","  default:   R 0;","}}","","static SF1(isignum,I,I, SGN(*v))","","static SF1(dsignum,D,I, qct\u003cABS(*v)?SGN(*v):0)","","static B jsignum(v,x)Z*v,*x;{if(qct\u003czmag(*v))*x=ztrend(*v); else *x=zeroZ; R!jerr;}","","F1(signum){"," switch(coerce1(\u0026w,BOOL)){","  case BOOL: R ca(w);","  case INT:  R sex1(w,INT ,isignum);","  case FL:   R sex1(w,INT ,dsignum);","  case CMPX: R sex1(w,CMPX,jsignum);","  default:   R 0;","}}","","static SF2(band,B,B, *u\u0026\u0026*v)","","static SF2(itymes,I,D, *u*(D)*v)","","static SF2(dtymes,D,D, *u\u0026\u0026*v?*u**v:0)","","static SF2(jtymes,Z,Z, ztymes(*u,*v))","","F2(tymes){"," switch(coerce2(\u0026a,\u0026w,BOOL)){","  case BOOL: R sex2(a,w,BOOL,band);","  case INT:  R pcvt(INT,sex2(a,w,FL,itymes));","  case FL:   R sex2(a,w,FL  ,dtymes);","  case CMPX: R sex2(a,w,CMPX,jtymes);","  default:   R 0;","}}","","F1(recip){R divide(one,w);}","","static B bdiv(u,v,x)B*u,*v,*x;{*x=!*u?0:*v?1:(jerr=EVDOMAIN,0); R!jerr;}","","static B idiv(u,v,x)I*u,*v;D*x;{*x=*v?*u/(D)*v:*u?*u*inf:0; R 1;}","","static B ddiv(u,v,x)D*u,*v,*x;{*x=*v?*u/ *v:*u?*u*inf:0; R 1;}","","static B jdiv(u,v,x)Z*u,*v,*x;{*x=zdiv(*u,*v); R!jerr;}","","F2(divide){A z;C es;"," switch(coerce2(\u0026a,\u0026w,BOOL)){","  case BOOL:","   es=errsee; errsee=0; z=sex2(a,w,BOOL,bdiv); errsee=es;","   R jerr?(jerr=0,divide(a,cvt(INT,w))):z;","  case INT:  R sex2(a,w,FL  ,idiv);","  case FL:   R sex2(a,w,FL  ,ddiv);","  case CMPX: R sex2(a,w,CMPX,jdiv);","  default:   R 0;","}}","","F1(decrem){R minus(w,one);}","","F1(increm){R plus(one,w);}","","F1(not){R w\u0026\u0026BOOL\u0026AT(w)?eq(zero,w):minus(one,w);}","","F1(duble){R plus(w,w);}","","F1(halve){R divide(w,two);}","","F1(square){R tymes(w,w);}","","static SF1(jmag,Z,D, zmag(*v))","","F1(mag){R w\u0026\u0026CMPX\u0026AT(w)?sex1(w,FL,jmag):maximum(w,negate(w));}","","static I xirem(u,v)I u,v;{I r; R!u?v:(r=v%u,0\u003cu?r+u*(0\u003er):r+u*(0\u003cr));}","","static D xdrem(u,v)D u,v;{D q,t;"," if(!u)R v;"," q=v/u; t=tfloor(q); R teq(t,tceil(q))?0:v-u*t;","}","","static SF2(brem,B,B, *u\u003c*v)","","static SF2(irem,I,I, xirem(*u,*v))","","static SF2(dren,D,D, xdrem(*u,*v))","","static SF2(jrem,Z,Z, zrem(*u,*v))","","F2(residue){"," switch(coerce2(\u0026a,\u0026w,BOOL)){","  case BOOL: R sex2(a,w,BOOL,brem);","  case INT:  R sex2(a,w,INT ,irem);","  case FL:   R sex2(a,w,FL  ,dren);","  case CMPX: R sex2(a,w,CMPX,jrem);","  default:   R 0;","}}","","static I xigcd(u,v)I u,v;{R u?xigcd(xirem(u,v),u):v;}","","static D xdgcd(u,v)D u,v;{D a,aa,b,bb,c,d,t,x,y;"," a=d=1; b=c=0; x=u; y=v;"," while(!teq(u,u+x)){","  aa=a; bb=b; t=floor(y/x);","  a=c-t*a; b=d-t*b; x=a*u+b*v;","  c=aa;    d=bb;    y=c*u+d*v;"," }"," R y;","}","","static SF2(bor,B,B, *u||*v)","","static SF2(igcd,I,I, xigcd(ABS(*u),ABS(*v)))","","static SF2(dgcd,D,D, xdgcd(ABS(*u),ABS(*v)))","","static SF2(jgcd,Z,Z, zgcd(*u,*v))","","F2(gcd){"," switch(coerce2(\u0026a,\u0026w,BOOL)){","  case BOOL: R sex2(a,w,BOOL,bor);","  case INT:  R sex2(a,w,INT ,igcd);","  case FL:   R sex2(a,w,FL  ,dgcd);","  case CMPX: R sex2(a,w,CMPX,jgcd);","  default:   R 0;","}}","","static I ilcm(u,v,x)I*u,*v;D*x;{I a,b;"," a=ABS(*u); b=ABS(*v);"," *x=a\u0026\u0026b?*u*(D)*v/xigcd(a,b):0;"," R!jerr;","}","","static I dlcm(u,v,x)D*u,*v,*x;{D a,b;"," a=ABS(*u); b=ABS(*v);"," *x=a\u0026\u0026b?*u**v/xdgcd(a,b):0;"," R!jerr;","}","","static SF2(jlcm,Z,Z, zlcm(*u,*v))","","F2(lcm){"," switch(coerce2(\u0026a,\u0026w,BOOL)){","  case BOOL: R sex2(a,w,BOOL,band);","  case INT:  R pcvt(INT,sex2(a,w,FL,ilcm));","  case FL:   R sex2(a,w,FL  ,dlcm);","  case CMPX: R sex2(a,w,CMPX,jlcm);","  default:   R 0;","}}","","static SF1(dfloor,D,D, tfloor(*v))","","static SF1(jfloor,Z,Z, zfloor(*v))","","F1(floor1){"," switch(coerce1(\u0026w,BOOL)){","  case BOOL:","  case INT:  R ca(w);","  case FL:   R pcvt(INT,sex1(w,FL,dfloor));","  case CMPX: R sex1(w,CMPX,jfloor);","  default:   R 0;","}}","","static SF2(imin,I,I, MIN(*u,*v))","","static SF2(dmin,D,D, MIN(*u,*v))","","F2(minimum){"," switch(coerce2(\u0026a,\u0026w,BOOL)){","  case BOOL: R lcm(a,w);","  case INT:  R sex2(a,w,INT ,imin);","  case FL:   R sex2(a,w,FL  ,dmin);","  default:   R sex2(cvt(FL,a),cvt(FL,w),FL,dmin);","}}","","F1(ceil1){R negate(floor1(negate(w)));}","","F2(maximum){R negate(minimum(negate(a),negate(w)));}","","F1(base1){R base2(two,w);}","","F2(base2){PROLOG;A z;"," F2RANK(1,1,base2,0);"," ASSERT(!AR(a)||!AR(w)||AN(a)==AN(w),EVLENGTH);"," if(!AN(a))R zero;"," z=pdt(behead(df1(over(AR(a)?a:reshape(tally(w),a),one),bsdot(slash(ds(CSTAR))))),w);"," EPILOG(z);","}","","F1(abase1){PROLOG;A b,t,z;"," RZ(w);"," if(!AN(w))R reshape(over(shape(w),zero),zero);"," RZ(t=df1(mag(ravel(w)),slash(ds(CMAX))));"," RZ(b=increm(floor1(logar2(two,maximum(one,t)))));"," z=abase2(reshape(b,two),w);"," EPILOG(z);","}","","F2(abase2){PROLOG;A y,z,*zv;C*u,*yv;I at,k,n,wt;"," F2RANK(1,0,abase2,0);"," n=AN(a); at=AT(a); wt=AT(w); k=bp(at); u=n*k+(C*)AV(a);"," GA(y,at ,1,0,0); yv=(C*)AV(y);"," GA(z,BOX,n,1,0); zv=(A*)AV(z);"," DO(n, mv(at,1L,yv,u-=k); RZ(w=divide(minus(w,zv[n-1-i]=residue(y,w)),y)););"," RZ(z=ope(z));"," if(at\u0026BOOL+INT\u0026\u0026wt\u0026BOOL+INT)z=cvt(INT,z);"," EPILOG(z);","}",""],"vg.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Verbs: Grades                                                           */","","#include \"j.h\"","#include \"v.h\"","","","#define COMP(f,T,Tp)    int f(a,b)I*a,*b;{I q;T*x=(T*)*a,*y=(T*)*b;Tp p;  \\","                         DO(compn,if(p=*x++-*y++)break;);                 \\","                         R p?SGN(p):(q=*++a-*++b,SGN(q));                 \\","                        }","","static I compn;","","static COMP(compUC,UC,int)","","static COMP(compI, I, I  )","","static COMP(compD, D, D  )","","static F2(grade){PROLOG;A y,z;B ascend;C*wv;I j,k,m,wk,wt,*x,*yv;"," RZ(w);"," ascend=a==one;"," if(CMPX\u0026AT(w))RZ(w=cvt(FL,w));"," wt=AT(w); wv=(C*)AV(w); m=IC(w); compn=aii(w); wk=compn*bp(wt);"," ASSERT(wt\u0026BOOL+CHAR+INT+FL,EVDOMAIN);"," if(1\u003e=m||!compn)R ii(w);"," GA(y,INT,2*m,1,0); yv=AV(y);"," j=(I)wv-wk; DO(m, *yv++=j+=wk; *yv++=ascend?i:-i;);"," qsort(AV(y),m,2*sizeof(I),wt\u0026BOOL+CHAR?compUC:wt\u0026INT?compI:compD);"," GA(z,INT,m,1,0); x=AV(z);"," yv=AV(y); j=ascend?1:2*m-1; k=ascend?2:-2; DO(m, x[i]=ascend?yv[j]:-yv[j]; j+=k;);"," EPILOG(z);","}","","F1(grade1){R grade(one,w);}","","F2(grade2){R from(grade1(w),a);}","","F1(dgrade1){R grade(neg1,w);}","","F2(dgrade2){R from(dgrade1(w),a);}",""],"vh.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Verbs:  Indexof with Hashing                                            */","","#include \"j.h\"","#include \"v.h\"","","/* Archimedes    byte order:  3 2 1 0 7 6 5 4 */","/* VAX           byte order:  1 0 3 2 5 4 7 6 */","/* little endian byte order:  7 6 5 4 3 2 1 0 */","/* normal        byte order:  0 1 2 3 4 5 6 7 */","","#if (SYS \u0026 SYS_ARCHIMEDES+SYS_VAX)","static I thn = 4;","static I ths = 0;","#else","static I thn = (5+(8!=sizeof(D)));","static I ths = (3+(8!=sizeof(D))) * !!(SYS \u0026 SYS_LILENDIAN);","#endif","","","static F2(ciof){A z;I an,k,t[256],wn,*x;UC*u,*v;"," RZ(a\u0026\u0026w);"," an=AN(a); u=(UC*)AV(a)+an; k=an;"," wn=AN(w); v=(UC*)AV(w);"," GA(z,INT,wn,AR(w)-MAX(0,AR(a)-1),AS(w)); x=AV(z);"," DO(256,t[i]=an;); DO(an,t[*--u]=--k;); DO(wn,*x++=t[*v++];);"," R z;","}  /* a i.w, byte-size items */","","static UC htab[256]={"," 122, 139,  99,  84, 246,  45, 155, 114,   7,  62,  50,  59, 133, 144, 182,  71,"," 188,  80, 141, 171, 249, 164,  72,  10,  51,  22, 225,   5, 215, 243, 189, 250,"," 221,  88,  17, 196, 100, 203,  96, 226, 112, 130, 126,  93,  12,  63,  86, 206,"," 149, 213,  52,  89,  90, 148, 178, 168, 129,  38, 145, 159, 248,  68,  91, 201,"," 101, 118, 236,  95, 163, 146, 104, 119,   1,  19, 190, 191,  35,   3, 124,  74,","  78, 207,  85, 209,  46, 156, 216, 254, 103, 185, 255, 137,  23, 165, 223,  33,"," 228, 184, 113,  70,  43,  75,  79, 253,  21, 222, 186, 211, 220, 210,   0, 172,"," 244,  27, 252, 134, 174, 120,  58,   4, 235, 107, 234, 230, 212, 218,   2, 183,","  53, 237,  60, 195, 187,  39,  49, 217, 239, 152, 208, 131,  24,  14, 115, 102,","  94,  83,  26, 205,  65, 177, 170,  42, 132, 128, 136, 161, 167,  31,  15,  36,"," 181,  57, 198, 127,  18,  47, 142,  16, 162,  61, 179,  44,   8, 214, 125, 135,"," 153, 204, 105, 160, 157, 154, 193,  25, 227, 231,  97, 194, 251, 200, 180,  77,","  13,  82, 117,  69, 166,  98, 147, 140,   6,  41,  66, 150, 175, 109,  87, 176,","  56, 247, 240, 224, 192, 138,  30,  48,   9, 110, 116,  20, 143, 202,  11,  37,"," 111, 158,  55, 123,  40, 169, 197,  28,  92, 238,  32, 242,  76, 173,  54, 232,","  34, 199,  64, 108,  81,  73, 121, 233, 241, 151, 106, 229,  29,  67, 245, 219","};  /* P.K. Pearson, CACM 1990 6, pp. 677 */","","static UC fh(fzz,t,k,v)B fzz;I k,t;C*v;{A x,*y;C*u;I i,n;UC z=0;"," if(t\u0026BOX){","  n=k/4; y=(A*)v;","  for(i=0;i\u003cn;++i){","   x=*y++; t=AT(x);","   if(AN(x)){t=t\u0026NUMERIC?NUMERIC:t; u=(C*)\u0026t; DO(4,z=htab[z^*u++];);}","   u=(C*)AS(x); DO(4*AR(x)+(t\u0026CHAR?AN(x):0),z=htab[z^*u++];);","  }","  R z;"," }"," if(fzz){if(0==*(D*)v)v=(C*)\u0026zeroZ; v+=ths; k=thn;}  /* NB. !*(D*)v is not the same */"," DO(k,z=htab[z^*v++];); "," R z;","}","","static int ane(u,v,k)A*u,*v;I k;{DO(k/4, if(one!=match(*u++,*v++))R 1;); R 0;}","","static int dne(u,v,n)D*u,*v;I n;{DO(n, if(!teq(*u++,*v++))R 1;); R 0;}","","static int jne(u,v,n)Z*u,*v;I n;{DO(n, if(!zeq(*u++,*v++))R 1;); R 0;}","","static int fne(fzz,t,u,v,n)B fzz;I t;C*u,*v;I n;{"," if(fzz)R t\u0026FL  ? dne(u,v,n) : jne(u,v,n);"," else   R t\u0026BOX ? ane(u,v,n) : memcmp(u,v,n);","}","","#define FINDC(c,lim)    \\","  {j=0; p=hv-1;                                                       \\","   do{p=memchr(1+p,c,m-j); j=p-hv;} while(p\u0026\u0026fne(fzz,t,v,u+j*k,lim)); \\","   j=p?j:m;                                                           \\","  }","","F2(indexof){PROLOG;A h,z;C fzz,*hv,*p,*u,*v,*yv;D qctl=1-qct,qctr=1+qct,y,yy;","  I*as,at,i,j,j1,k,m,n,r,t,*ws,wt,*x,zn,zr;UC c,d;"," RZ(a\u0026\u0026w);"," at=AT(a); as=AS(a); m=IC(a); n=aii(a);"," wt=AT(w); ws=AS(w);"," r=MAX(0,AR(a)-1); zr=MAX(0,AR(w)-r); zn=n?AN(w)/n:0;"," if(c=r\u003c=AR(w))DO(r,if(as[1+i]!=ws[zr+i]){c=0; break;});"," if(!(c\u0026\u0026m\u0026\u0026n\u0026\u0026zn\u0026\u0026HOMO(at,wt)))R reshape(take(sc(zr),shape(w)),c\u0026\u0026!n?sc(0L):tally(a));"," t=MAX(at,wt); k=n*bp(t);"," if(1==k)R ciof(a,w);"," if(t!=at)RZ(a=cvt(t,a)); u=(C*)AV(a);"," if(t!=wt)RZ(w=cvt(t,w)); v=(C*)AV(w);"," fzz=0!=qct\u0026\u0026t\u0026FL+CMPX;"," GA(h,CHAR,m,1,0); hv=(C*)AV(h); p=u-k; DO(m,hv[i]=fh(fzz,t,k,p+=k););"," GA(z,INT,zn,zr,AS(w)); x=AV(z);"," if(fzz){","  yv=(C*)\u0026y;","  for(i=0;i\u003czn;++i){","   yy=*(D*)v;","   y=qctl*yy; c=fh(fzz,t,k,yv); FINDC(c,n);","   y=qctr*yy; d=fh(fzz,t,k,yv); if(c==d)*x++=j; else{j1=j; FINDC(d,n); *x++=MIN(j,j1);}","   v+=k;"," }} else for(i=0;i\u003czn;++i){c=fh(fzz,t,k,v); FINDC(c,k); *x++=j; v+=k;}"," EPILOG(z);","}",""],"vi.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Verbs:  Matrix Inverse and Associates                                   */","","#include \"j.h\"","","","static F1(round){R floor1(plus(scf(0.5),w));}","","static F1(norm){R sqroot(pdt(w,conjug(w)));}","","F2(pdt){R df2(a,w,dot(slash(ds(CPLUS)),ds(CSTAR)));}","","F1(rinv){PROLOG;A ai,b,bx,di,z;I m,n,r,*s;"," RZ(w);"," r=AR(w); s=AS(w); n=2\u003er?1:s[1]; m=(1+n)/2;"," ASSERT(2\u003e=r,EVRANK);"," ASSERT(!r||n==s[0],EVLENGTH);"," if(1\u003e=n)R recip(w);"," RZ(ai=rinv(take(v2(m,m),w)));"," RZ(di=rinv(drop(v2(m,m),w)));"," RZ(b=take(v2(m,m-n),w));"," RZ(bx=negate(pdt(ai,pdt(b,di))));"," z=over(overr(ai,bx),take(v2(n-m,-n),di));"," EPILOG(z);","}  /* R.K.W. Hui, Uses of { and }, APL87, p. 56 */","","F1(qr){PROLOG;A a1,q,q0,q1,r,r0,r1,t,*tv,t0,t1,y,z;I m,n,p,*s,wr;"," RZ(w);"," wr=AR(w); s=AS(w); n=2\u003ewr?1:s[1]; m=(1+n)/2; p=IC(w);"," ASSERT(2\u003e=wr,EVRANK);"," ASSERT(2\u003ewr||p\u003e=n,EVLENGTH);"," if(1\u003e=n){t=norm(ravel(w)); R link(table(divide(w,t)),reshape(v2(n,n),t));}"," RZ(t0=qr(take(v2(p,m),w)));"," tv=(A*)AV(t0); q0=*tv++; r0=*tv;"," RZ(a1=drop(v2(0L,m),w));"," RZ(y=pdt(conjug(cant1(q0)),a1));"," RZ(t1=qr(minus(a1,pdt(q0,y))));"," tv=(A*)AV(t1); q1=*tv++; r1=*tv;"," RZ(q=overr(q0,q1));"," RZ(r=over(overr(r0,y),take(v2(n-m,-n),r1)));"," z=link(q,r); EPILOG(z);","}       /* R.K.W. Hui, M.Sc. Thesis, 1981 */","","F1(minv){PROLOG;A q,r,*v,y,z;"," F1RANK(2,minv,0);"," RZ(y=qr(w));"," v=(A*)AV(y); q=*v++; r=*v;"," RZ(z=pdt(rinv(r),conjug(cant1(q))));"," if(AT(w)\u0026INT+BOOL\u0026\u00262==AR(w)\u0026\u0026*AS(w)==*(1+AS(w))){A t;D*u,x;I n;","  x=1; n=*AS(w); u=(D*)AV(r);","  DO(n, x*=*u; u+=1+n;); t=scf(x);","  z=divide(round(tymes(t,z)),t);"," }"," z=2==AR(w)?z:reshape(shape(w),z);"," EPILOG(z);","}","","F2(mdiv){F2RANK(2,RMAX,mdiv,0); R pdt(minv(w),a);}",""],"vm.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Verbs:  \"Mathematical\" Functions (Non-Rational, Transcendental, etc.)   */","","#include \"j.h\"","#include \"v.h\"","","","static A math1(w,df,jf)A w;SF df,jf;{"," switch(coerce1(\u0026w,FL)){","  case FL:   R sex1(w,FL  ,df);","  case CMPX: R sex1(w,CMPX,jf);","  default:   R 0;","}}","","static A math2(a,w,df,jf)A a,w;SF df,jf;{"," switch(coerce2(\u0026a,\u0026w,FL)){","  case FL:   R sex2(a,w,FL  ,df);","  case CMPX: R sex2(a,w,CMPX,jf);","  default:   R 0;","}}","","static A math1z(w,jf)A w;SF jf;{PROLOG;A z;"," RZ(coerce1(\u0026w,CMPX));"," RZ(z=pcvt(FL,sex1(w,CMPX,jf)));"," EPILOG(z);","}","","static A math2z(a,w,jf)A a,w;SF jf;{PROLOG;A z;"," RZ(coerce2(\u0026a,\u0026w,CMPX));"," RZ(z=pcvt(FL,sex2(a,w,CMPX,jf)));"," EPILOG(z);","}","","","static SF1(dexp,D,D, exp(*v))","","static SF1(jexp,Z,Z, zexp(*v))","","F1(expn1){R math1(w,dexp,jexp);}","","static SF2(jpow,Z,Z, zpow(*u,*v))","","F2(expn2){"," if(INT\u0026AT(w)\u0026\u0026!AR(w)){A t=a,z;I n;","  n=i0(w);","  if(0\u003en){RZ(t=recip(a)); n=-n;}","  RZ(z=reshape(shape(a),one));","  while(n){if(n%2)RZ(z=tymes(z,t)); RZ(t=tymes(t,t)); n/=2;}","  R z;"," }"," R math2z(a,w,jpow);","}","","static SF1(jsqrt,Z,Z, zsqrt(*v))","","F1(sqroot){R math1z(w,jsqrt);}","","F2(root){R expn2(w,recip(a));}","","static SF1(jlog,Z,Z, zlog(*v))","","F1(logar1){R math1z(w,jlog);}","","F2(logar2){R divide(logar1(w),logar1(a));}","","F1(jdot1){R tymes(a0j1,w);}","","F2(jdot2){R plus(a,tymes(a0j1,w));}","","F1(rdot1){R expn1(jdot1(w));}","","F2(rdot2){R tymes(a,rdot1(w));}","","F1(pix){R tymes(pie,w);}","","static SF2(jcir,Z,Z, zcir(*u,*v))","","F2(circle){R math2z(a,w,jcir);}","","F1(rect ){R rank2ex(v2( 9L,11L),w,0L,1L,0L,circle);}","","F1(polar){R rank2ex(v2(10L,12L),w,0L,1L,0L,circle);}","","F1(eig1){ASSERT(0,EVNONCE);}","","F2(eig2){ASSERT(0,EVNONCE);}","","F1(poly1){ASSERT(0,EVNONCE);}","","F2(poly2){ASSERT(0,EVNONCE);}","","","static D gam5243(v)D v;{D a,b,x;"," static D p[]={-42353.689509744089,-20886.861789269888,-8762.710297852149,","  -2008.52740130727915,-439.3304440600257,-50.108693752970954,-6.744950724592529};"," static D q[]={-42353.689509744089,-2980.385330925665,9940.307415082771,","  -1528.607273779522,-499.028526621439,189.498234157028016,-23.081551524580124,1.0};"," static I m=sizeof(p)/sizeof(D),n=sizeof(q)/sizeof(D);"," a=0; x=1; DO(m, a+=x*p[i]; x*=v;);"," b=0; x=1; DO(n, b+=x*q[i]; x*=v;);"," R a/b;","} /* Hart et al, \"Computer Approximations\" */","","static D fac(v)D v;{B b,e;D t=1,x;"," x=floor(v); b=v==x; e=x==2*floor(x/2);"," if(170\u003cABS(v)||b\u0026\u00260\u003ev)R e\u0026\u00260\u003ev?-inf:inf;"," if(0\u003c=v) while(1\u003cv)t*=v--; else while(0\u003ev)t/=++v;"," R b?t:t*gam5243(v-1);","}","","static SF1(dfact,D,D, fac(*v))","","F1(fact){R math1(w,dfact,znonce1);}","","","static D binD(u,v)D u,v;{D z=1; DO(v-170,z*=v--/u--;); R fac(v)/fac(u)/fac(v-u)*z;}","","static D binI(u,v)D u,v;{D c=MIN(u,v-u),z=1; DO(c,z*=v--/c--;); R z;}","","#define MOD2(x) ((x)-2*floor(0.5*(x)))","","static D bin(u,v)D u,v;{D t=v-u;"," switch(2*(u==floor(u))+(v==floor(v))){","  case 0: R 0\u003et\u0026\u0026t==floor(t)?0:binD(u,v);","  case 1: ASSERT(0\u003c=v,EVDOMAIN); R binD(u,v);","  case 2: R u?binD(u,v):1;","  case 3: switch(4*(0\u003eu)+2*(0\u003ev)+(0\u003et)){","           case 0:  R binI(u,v);","           case 1:  R 0;","           case 2:  ASSERT(0,EVDOMAIN);","           case 3:  R (MOD2(u)?-1:1)*binI(u,u-v-1);","           case 4:  R 0;","           case 5:  /* Impossible */","           case 6:  R (MOD2(t)?-1:1)*binI(-1-v,-1-u);","           case 7:  R 0;","}}} /* P.C. Berry, Sharp APL Reference Manual, 1979, p. 132 */","","static SF2(dbin,D,D, bin(*u,*v))","","F2(outof){R math2(a,w,dbin,znonce2);}",""],"vp.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Verbs:  Permutations                                                    */","","#include \"j.h\"","#include \"v.h\"","","","static F1(ord){R cvt(INT,increm(df1(w,slash(ds(CMAX)))));}","","F2(pind){I j,m,n,*v;"," n=i0(a); m=-n;"," RZ(w=cvt(INT,w)); v=AV(w);"," DO(AN(w), j=*v; ASSERT(m\u003c=j\u0026\u0026j\u003cn,EVINDEX); *v++=0\u003ej?j+n:j;);"," R w;","}  /* positive indices */","","F1(pinv){I m=0,n,*v;"," F1RANK(1,pinv,0);"," RZ(w=vi(w));"," n=AN(w); v=AV(w);"," DO(n, m=0\u003ev[i]?MAX(m,-1-v[i]):MAX(m,v[i]);); m+=0\u003cn;"," R indexof(pfill(sc(m),w),apv(m,0L,1L));","}  /* permutation inverse */","","F2(pfill){PROLOG;A z;"," RZ(a\u0026\u0026w);"," RZ(a=vi(a));"," RZ(w=pind(a,w));"," RZ(z=over(less(iota(a),w),w));"," ASSERT(AN(z)==*AV(a),EVINDEX);"," EPILOG(z);","}","","static F2(cfd){PROLOG;A b,p,q,y,*x,z;B*bv;I c,d,i,j,k,n,*pv,*qv,r,*v;"," RZ(w);"," RZ(w=pfill(a,w)); v=AV(w);"," n=AN(w); i=j=0;"," RZ(b=reshape(tally(w),zero)); bv=(B*)AV(b);"," GA(p,INT,n,1,0); pv=AV(p);"," GA(q,INT,n,1,0); qv=AV(q);"," GA(z,BOX,n,1,0); x=(A*)AV(z);"," for(;;){","  while(j\u003cn\u0026\u0026bv[j])j++; if(j\u003e=n)break;","  k=d=r=0; c=j;","  do{bv[c]=1; d=MAX(d,c); r=c==d?k:r; qv[k++]=c; c=v[c];}while(c!=j);","  pv[i]=d; RZ(x[i++]=rotate(sc(r),take(sc(k),q)));"," }"," RZ(y=sc(i)); z=grade2(take(y,z),take(y,p)); EPILOG(z);","}  /* cycle from direct*/","","static F2(dfc){PROLOG;A b,q,*v,z;B*bv;I c,j,qn,*qv,*x;"," RZ(a\u0026\u0026w);"," ASSERT(!AR(a)\u0026\u0026INT\u0026AT(a)\u0026\u00260\u003c=*AV(a),EVINDEX);"," RZ(b=reshape(a,one)); bv=(B*)AV(b);"," RZ(z=iota(a)); x=AV(z);"," v=(A*)AV(w);"," for(j=AN(w)-1;0\u003c=j;j--){","  RZ(q=pind(a,v[j])); qv=AV(q); qn=AN(q);","  if(!qn)continue;","  DO(qn, ASSERT(bv[qv[i]],EVINDEX); bv[qv[i]]=0;); DO(qn,bv[qv[i]]=1;);","  c=x[qv[0]]; DO(qn-1,x[qv[i]]=x[qv[i+1]];); x[qv[qn-1]]=c;"," }"," EPILOG(z);","}  /* direct from cycle */","","F1(cdot1){PROLOG;A y,z;"," F1RANK(1,cdot1,0);"," if(BOX\u0026AT(w)){RZ(y=raze(w)); z= AN(y) ? dfc(ord(y),w) : mtv;}"," else                         z= AN(w) ? cfd(ord(w),w) : reshape(zero,jot);"," EPILOG(z);","}","","F2(cdot2){RZ(a\u0026\u0026w); R from((BOX\u0026AT(a)?dfc:pfill)(tally(w),a),w);}","","static F1(dfr){A z;I c,d,j,n,*v,*x;"," F1RANK(1,dfr,0);"," n=AN(w); v=AV(w);"," RZ(z=ii(w)); x=AV(z);"," DO(n-1, j=i; c=x[j+v[j]]; DO(1+v[j], d=x[j+i]; x[j+i]=c; c=d;););"," R z;","}  /* direct from reduced */","","static F1(rfd){A z;I j=0,k,n,*v,*x;"," F1RANK(1,rfd,0);"," n=AN(w); v=AV(w);"," RZ(z=ca(w)); x=AV(z);"," DO(n-1, ++j; k=0; DO(n-j, k+=v[j]\u003ev[j+i];); x[j]=k;);"," R z;","}  /* reduced from direct */","","F1(adot1){PROLOG;A y,z;I n;"," F1RANK(1,adot1,0);"," RZ(y=BOX\u0026AT(w)?cdot1(w):pfill(ord(w),w));"," n=IC(y);"," z=base2(apv(n,n,-1L),rfd(y));"," EPILOG(z);","}","","F2(adot2){A m;I n;"," RZ(a\u0026\u0026w);"," n=IC(w);"," RZ(m=fact(sc(n)));"," ASSERT(all1(le(negate(m),a))\u0026\u0026all1(lt(a,m)),EVINDEX);"," R from(dfr(vi(abase2(apv(n,n,-1L),a))),w);","}",""],"vs.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Verbs:  Selection \u0026 Structural                                          */","","#include \"j.h\"","#include \"v.h\"","","","F1(reverse){RZ(w); R AR(w)?from(apv(IC(w),-1L,-1L),w):ca(w);}","","F2(rotate){I n,p;"," F2RANK(0,RMAX,rotate,0);"," p=i0(a); n=IC(w);"," R n\u0026\u0026AR(w)?from(apv(n,p%n-n*(0\u003cp),1L),w):ca(w);","}","","F1(cant1){RZ(w); R cant2(apv(AR(w),AR(w)-1,-1L),w);}","","static F2(canta){PROLOG;A e,p,*pv,q,*qv,t,z;C b;I an,*av,d,*ev,i,j,k,*tv,*v,wr,*ws,zr;"," RZ(a\u0026\u0026w);"," an=AN(a); av=AV(a); wr=AR(w); ws=AS(w);"," ASSERT(an==wr,EVLENGTH);"," if(!wr)R ca(w);"," zr=0; DO(an, zr=MAX(zr,av[i]);); zr++;"," DO(zr, k=i; DO(an,if(b=k==av[i])break;); ASSERT(b,EVINDEX););"," GA(t,INT,wr,1,0); tv=AV(t);"," GA(p,BOX,zr,1,0); pv=(A*)AV(p);"," k=1; DO(wr, j=wr-1-i; tv[j]=k; k*=ws[j];);"," for(i=0;i\u003czr;i++){","  j=i; d=0; k=LONG_MAX;","  DO(an, if(j==av[i]){d+=tv[i]; k=MIN(k,ws[i]);});","  RZ(*pv++=apv(k,0L,d));"," }"," RZ(q=catalog(p)); qv=(A*)AV(q);"," GA(e,INT,AN(q),zr,AS(q)); ev=AV(e);"," DO(AN(q), k=0; v=AV(*qv); DO(zr,k+=*v++;); qv++; *ev++=k;);"," z=from(e,ravel(w)); EPILOG(z);","}  /* R.K.W. Hui, Uses of { and }, APL87, p. 57 */","","static F1(cantm){A z;C*v,*vv,*x;I j,k,m,n,*s,t;"," RZ(w);"," s=AS(w); m=*s; n=*++s;"," t=AT(w); j=bp(t); k=j*n;"," GA(z,t,AN(w),AR(w),0); s=AS(z); *s=n; *++s=m;"," x=(C*)AV(z)-j; v=vv=(C*)AV(w)-k;"," DO(n, DO(m, memcpy(x+=j,v+=k,j);); v=vv+=j;);"," R z;","}","","F2(cant2){A p,r,t,*v,y;I j=0,k,*pv,*yv;"," F2RANK(1,RMAX,cant2,0);"," RZ(r=rank(w));"," if(BOX\u0026AT(a)){","  RZ(t=raze(a));","  RZ(p=pfill(r,t)); pv=AV(p);","  RZ(y=ca(p)); yv=AV(y);","  v=(A*)AV(a);","  DO(AR(w)-IC(t),yv[*pv++]=j++;);","  DO(AN(a), k=AN(v[i]); DO(k,yv[*pv++]=j;); j+=!!k;);","  R canta(y,w);"," } else {RZ(p=pinv(pfill(r,a))); R all1(match(p,v2(1L,0L)))?cantm(w):canta(p,w);}","}","","static F2(itake){A z;I c,k,m,n,p,r,*s,t;"," RZ(a\u0026\u0026w);"," n=IC(w); r=AR(w); s=AS(w); t=AT(w);"," p=*AV(a); m=ABS(p); c=aii(w); k=c*bp(t)*(0\u003ep);"," GA(z,t,c*m,MAX(1,r),s); *AS(z)=m; mv1(t,c*m*(m\u003en),AV(z),FILL(t));"," mv(t,c*MIN(m,n),(C*)AV(z)+k*MAX(0,m-n),(C*)AV(w)+k*MAX(0,n-m));"," R z;","}","","F2(take){PROLOG;A s,t,z;B b;I an,*sv,*tv,*u,wr,*ws;"," F2RANK(1,RMAX,take,0);"," RZ(a=vi(a));"," an=AN(a); u=AV(a);"," if(!AR(w))RZ(w=reshape(apv(an,1L,0L),w));"," wr=AR(w); ws=AS(w);"," ASSERT(an\u003c=wr,EVLENGTH);"," RZ(s=shape(w)); sv=AV(s);"," b=0; DO(wr,if(b=!sv[i])break;); if(!b)DO(an,if(b=!u[i])break;);"," if(b){mv(INT,an,sv,u); R reshape(mag(s),filler(one));}"," z=w; RZ(t=sc(0L)); tv=AV(t);"," DO(an, *tv=*u++; RZ(z=rank2ex(t,z,0L,0L,wr-i,itake)););"," EPILOG(z);","}","","F2(drop){A s;I an,*sv,*u,wr,*ws;"," F2RANK(1,RMAX,drop,0);"," RZ(a=vi(a));"," an=AN(a); u=AV(a);"," if(!AR(w))RZ(w=reshape(apv(an,1L,0L),w));"," wr=AR(w); ws=AS(w);"," ASSERT(an\u003c=wr,EVLENGTH);"," RZ(s=shape(w)); sv=AV(s);"," DO(an, sv[i]=0\u003cu[i]?MIN(0,u[i]-ws[i]):MAX(0,u[i]+ws[i]););"," R take(s,w);","}","","F1(head   ){R from(zero,w);}","","F1(tail   ){R from(neg1,w);}","","F1(behead ){R drop(one ,w);}","","F1(curtail){R drop(neg1,w);}","","F1(rank){RZ(w); R sc(AR(w));}","","F1(shape){A z; RZ(w); GA(z,INT,AR(w),1,0); mv(INT,AR(w),AV(z),AS(w)); R z;}","","F2(reshape){A z;C*v,*x;I k,m,n,r,t,*u;"," F2RANK(1,RMAX,reshape,0);"," RZ(a=vi(a)); r=AN(a); u=AV(a);"," n=AN(w); t=AT(w); k=n*bp(t); v=(C*)AV(w);"," DO(r,ASSERT(0\u003c=u[i],EVDOMAIN););"," m=prod(r,u); ASSERT(n||!m, EVLENGTH);"," GA(z,t,m,r,u);"," if(n){x=(C*)AV(z); DO(m/n, mv(t,n,x,v); x+=k;); mv(t,m%n,x,v);}"," R z;","}","","F2(reitem){F2RANK(1,RMAX,reitem,0); R reshape(over(a,behead(shape(w))),w);}","","F1(tally){RZ(w); R sc(IC(w));}","","F2(repeat){A z;C*v,*x;I c,j,k,m,p=0,n,r,t,*u;"," F2RANK(1,RMAX,repeat,0);"," RZ(a=vi(a));"," n=AN(a); u=AV(a); v=(C*)AV(w); r=AR(w); t=AT(w);"," m=IC(w); c=aii(w); k=c*bp(t);"," ASSERT(!AR(a)||!r||n==m,EVLENGTH);"," DO(n, ASSERT(0\u003c=u[i],EVDOMAIN); p+=u[i];); p=1==n?m*p:p;"," if(r){","  GA(z,t,p*c,r,AS(w)); *AS(z)=p; x=(C*)AV(z);","  DO(1==n?m:n, j=i; DO(u[1\u003cn?j:0], mv(t,c,x,v+j*k); x+=k;););","  R z;"," } else R reshape(sc(p),w);","}","","F1(ravel){A z; RZ(w); GA(z,AT(w),AN(w),1,0); mv(AT(w),AN(w),AV(z),AV(w)); R z;}","","F2(over){A s,z;C*x;I ar,*as,r,*sv,t,wr,*ws;"," RZ(a\u0026\u0026w);"," ar=AR(a); wr=AR(w); r=MAX(ar,wr); RZ(s=r?shape(r==ar?a:w):apv(1L,1L,0L)); sv=AV(s);"," if(r\u003ear){DO(ar?r-ar:1,sv[i]=1;); mv(INT,ar,sv+r-ar,AS(a)); RZ(a=reshape(s,a));}"," if(r\u003ewr){DO(wr?r-wr:1,sv[i]=1;); mv(INT,wr,sv+r-wr,AS(w)); RZ(w=reshape(s,w));}"," as=AS(a); ws=AS(w); DO(r,sv[i]=MAX(as[i],ws[i]););"," sv[0]=IC(a); RZ(a=take(s,AN(a)?a:filler(w)));"," sv[0]=IC(w); RZ(w=take(s,AN(w)?w:filler(a)));"," RZ(t=coerce2(\u0026a,\u0026w,0L));"," GA(z,t,AN(a)+AN(w),r+!r,sv); *AS(z)=IC(a)+IC(w);"," x=(C*)AV(z); mv(t,AN(a),x,AV(a)); mv(t,AN(w),x+AN(a)*bp(t),AV(w));"," R z;","}","","F2(overr){R rank2ex(a,w,0L,-1L,-1L,over);}","","F1(lamin1){R reshape(over(one,shape(w)),w);}","","F2(lamin2){RZ(a\u0026\u0026w); R over(AR(a)?lamin1(a):a, AR(w)?lamin1(w):AR(a)?w:table(w));}","","F1(table){A z;"," RZ(w);"," GA(z,AT(w),AN(w),2,0); *AS(z)=IC(w); *(1+AS(z))=aii(w); mv(AT(w),AN(w),AV(z),AV(w));"," R z;","}","","F1(catalog){PROLOG;A b,c,p,q,*v,*x,z;C*bu,*bv,**pv;I*cv,i,j,k,m,n,*qv,r=0,*s,t=0,*u;"," F1RANK(1,catalog,0);"," if(!(AN(w)\u0026\u0026BOX\u0026AT(w)))R box(w);"," n=AN(w); v=(A*)AV(w);"," DO(n, if(AN(v[i])){k=AT(v[i]); t=t?t:k; ASSERT(HOMO(t,k),EVDOMAIN); t=MAX(t,k);});"," t=MAX(BOOL,t);"," GA(b,t,n,1,0);      bv=(C*)AV(b);"," GA(q,INT,n,1,0);    qv=AV(q);"," GA(p,BOX,n,1,0);    pv=(C**)AV(p);"," RZ(c=apv(n,0L,0L)); cv=AV(c);"," DO(n, RZ(c=cvt(t,v[i])); r+=AR(c); qv[i]=AN(c); pv[i]=(C*)AV(c););"," m=prod(n,qv);"," GA(z,BOX,m,r,0);    x=(A*)AV(z);"," s=AS(z); DO(n, u=AS(v[i]); k=AR(v[i]); DO(k,*s++=*u++;););"," k=bp(t);"," for(i=0;i\u003cm;i++){","  bu=bv-k;","  DO(n, mv1(t,1L,bu+=k,pv[i]+k*cv[i]););","  DO(n, j=n-1-i; if(qv[j]\u003e++cv[j])break; cv[j]=0;);","  *x++=ca(b);"," }"," EPILOG(z);","}  /* R.K.W. Hui, Uses of { and }, APL87, p. 57 */","","static A ifrom(a,w,r)A a,w;I r;{A z;C*v,*x;I an,ar,*as,c,d,k,wr,*ws,wt,*u;"," RZ(a\u0026\u0026w);"," ar=AR(a); u=    AV(a); as=AS(a); an=AN(a);"," wr=AR(w); v=(C*)AV(w); ws=AS(w); wt=AT(w);"," d=MAX(0,wr-r); c=prod(d,r+ws); k=c*bp(wt);"," GA(z,wt,an*c,ar+d,as); mv(INT,d,ar+AS(z),ws+r); x=(C*)AV(z)-k;"," DO(an, memcpy(x+=k,v+k**u++,k););"," R z;","}","","static F2(afi){RZ(a\u0026\u0026w); R(BOX\u0026AT(w))?less(iota(a),pind(a,ope(w))):pind(a,w);}","","static F2(afrom){PROLOG;A j,s,z;"," F2RANK(0,RMAX,afrom,0);"," RZ(a=ope(a));"," ASSERT(IC(a)\u003c=AR(w),EVLENGTH);"," ASSERT(1\u003e=AR(a),EVRANK);"," if(!AR(w))R w;"," RZ(s=take(tally(a),shape(w)));"," RZ(j=catalog(df2(s,a,under(ac2(afi),ds(COPE)))));"," z=ifrom(AN(j)?base2(s,ope(j)):j,w,IC(a));"," EPILOG(z);","}  /* R.K.W. Hui, Some Uses of { and }, APL87, p. 57 */","","F2(from){RZ(a\u0026\u0026w); R BOX\u0026AT(a)?afrom(a,w):ifrom(pind(tally(w),a),w,1L);}",""],"vz.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Verbs:  Complex-Valued Scalar Functions                                 */","","#include \"j.h\"","#include \"v.h\"","","#define ZF1DECL         D a=v.re,b=v.im,              zi=0,zr=0;Z z","#define ZF2DECL         D a=u.re,b=u.im,c=v.re,d=v.im,zi=0,zr=0;Z z","#define ZEPILOG         z.re=zr; z.im=zi; R z","#define ZF1(f)          Z f(v)Z v;","#define ZF2(f)          Z f(u,v)Z u,v;","#define ZS1(f,stmts)    ZF1(f){ZF1DECL; stmts; ZEPILOG;}","#define ZS2(f,stmts)    ZF2(f){ZF2DECL; stmts; ZEPILOG;}","#define ZASSERT(b,e)    {if(!(b)){jsignal(e); R zeroZ;}}","","#define ZNZ(v)          (v.re||v.im)","#define ZEZ(v)          (!(v.re||v.im))","#define ZEQ(u,v)        (u.re==v.re \u0026\u0026 u.im==v.im)","#define ZOV(v)          (ABS(v.re)\u003e OVERFLOW||ABS(v.im)\u003e OVERFLOW)","#define ZUN(v)          (ABS(v.re)\u003cUNDERFLOW||ABS(v.im)\u003cUNDERFLOW)","","#define MMM(a,b)        {p=ABS(a); q=ABS(b); if(p\u003cq){D t=p; p=q; q=t;}}","","","static D hypoth(u,v)D u,v;{D p,q,t; MMM(u,v); R p?(t=q/p,p*sqrt(1+t*t)):0;}","","static Z zj={0,1}, zmj={0,-1}, z1={1,0};","","ZS1(zconjug, zr=a; zi=-b;)","","ZS2(zplus,  zr=a+c; zi=b+d;)","","ZS2(zminus, zr=a-c; zi=b-d;)","","ZS1(ztrend, if(ZNZ(v)){D t; if(ZOV(v)){a/=2; b/=2;} t=hypoth(a,b); zr=a/t; zi=b/t;})","","ZS2(ztymes, if(ZNZ(u)\u0026\u0026ZNZ(v)){zr=a*c-b*d; zi=a*d+b*c;})","","ZF2(zdiv){ZF2DECL;D t;"," if(ZNZ(v)){","  if(ABS(c)\u003cABS(d)){t=a; a=-b; b=t;  t=c; c=-d; d=t;}","  a/=c; b/=c; d/=c; t=1+d*d; zr=(a+b*d)/t; zi=(b-a*d)/t;"," } else if(ZNZ(u))switch(2*(0\u003ea)+(0\u003eb)){","   case 0: if(a\u003e b)zr= inf; else zi= inf; break;","   case 1: if(a\u003e-b)zr= inf; else zi=-inf; break;","   case 2: if(a\u003c-b)zr=-inf; else zi= inf; break;","   case 3: if(a\u003c b)zr=-inf; else zi=-inf;"," }"," ZEPILOG;","}","","static ZF1(znegate){R zminus(zeroZ,v);}","","D zmag(v)Z v;{R hypoth(v.re,v.im);}","","B zeq(u,v)Z u,v;{D a=u.re,b=u.im,c=v.re,d=v.im;"," if(ZEQ(u,v)) R 1;"," else if(ZEZ(u)||ZEZ(v)||!qct||(0\u003ea!=0\u003ec\u0026\u00260\u003eb!=0\u003ed)) R 0;"," else {D p,q;Z t;","  if(ZOV(u)||ZOV(v)){a/=2; b/=2; c/=2; d/=2;}","  if(ZUN(u)||ZUN(v)){a*=2; b*=2; c*=2; d*=2;}","  p=hypoth(a,b); q=hypoth(c,d); t=zminus(u,v);","  R hypoth(t.re,t.im)\u003c=qct*MAX(p,q);","}}","","ZF1(zfloor){D p,q;"," ZF1DECL;"," zr=floor(a); p=a-zr;"," zi=floor(b); q=b-zi;"," if(1\u003c=p+q+qct)if(p\u003e=q)++zr; else ++zi;"," ZEPILOG;","}","","static ZF1(zceiling){R znegate(zfloor(znegate(v)));}","","ZF2(zrem){Z q,s,t;"," if(!u.re\u0026\u0026!u.im)R v;"," q=zdiv(v,u); s=zceiling(q); t=zfloor(q);"," if(zeq(s,t))R zeroZ; else R zminus(v,ztymes(u,t));","}","","static ZF2(zgcd1){if(ZEZ(u))R v; else R zgcd1(zrem(u,v),u);}","","ZF2(zgcd){D a,b;Z z;"," z=zgcd1(u,v); a=z.re; b=z.im;"," switch(2*(0\u003ea)+(0\u003eb)){","  case 1: z.re=-b; z.im= a; break;","  case 2: z.re= b; z.im=-a; break;","  case 3: z.re=-a; z.im=-b;"," }"," R z;","}","","ZF2(zlcm){if(ZEZ(u)||ZEZ(v))R zeroZ; else R ztymes(u,zdiv(v,zgcd(u,v)));}","","ZS1(zexp, {D t=exp(a); zr=t*cos(b); zi=t*sin(b);})","","","#if (SYS \u0026 SYS_ATARIST)","","static D jtan2(y,x)D x,y;{R !y ? (0\u003c=x?0.0:PI) : !x ? (0\u003c=y?PI/2:-PI/2) : atan2(x,y);}","","ZS1(zlog, if(ZEZ(v))zr=-inf; else{zr=log(hypoth(a,b)); zi=jtan2(b,a);})","","#else","ZS1(zlog, zr=b?log(hypoth(a,b)):a==inf||a==-inf?inf:a?log(hypoth(a,b)):-inf;","    zi=a||b?atan2(b,a):0;)","#endif","","ZF2(zpow){ZF2DECL;"," if(!(a||b||d)){z.re=0\u003ec?inf:!c; z.im=0; R z;}"," z=zexp(ztymes(v,zlog(u)));"," if(!(b||d)){D m=floor(c); if(0\u003ca||c==m)z.im=0; else if(c==0.5+m)z.re=0;}"," R z;","}","","ZF1(zsqrt){D p,q,t;"," ZF1DECL;"," MMM(a,b);"," if(p){","  t=0.5*q/p; zr=sqrt(ABS(a/2)+p*sqrt(0.25+t*t)); zi=b/(zr+zr);","  if(0\u003ea){t=ABS(zi); zi=0\u003eb?-zr:zr; zr=t;}"," }"," ZEPILOG;","}","","","/* See Abramowitz \u0026 Stegun, Handbook of Mathematical Functions,            */","/*   National Bureau of Standards, 1964 6.                                 */","","static ZF1(zsin){ZF1DECL;"," zr=(a==inf||a==-inf?0:sin(a))*(b==inf||b==-inf?inf       :cosh(b));"," zi=(a==inf||a==-inf?0:cos(a))*(b==inf||b==-inf?inf*SGN(b):sinh(b));"," ZEPILOG;","}  /* 4.3.55 */","","static ZF1(zcos){ZF1DECL;"," zr= (a==inf||a==-inf?0:cos(a))*(b==inf||b==-inf?inf       :cosh(b));"," zi=-(a==inf||a==-inf?0:sin(a))*(b==inf||b==-inf?inf*SGN(b):sinh(b));"," ZEPILOG;","}  /* 4.3.56 */","","static ZF1(ztan){R zdiv(zsin(v),zcos(v));}","","static ZF1(zp4){R zsqrt(ztymes(zplus(v,zj),zminus(v,zj)));}","","static ZF1(zm4){R ztymes(zplus(v,z1),zsqrt(zdiv(zminus(v,z1),zplus(v,z1))));}","","static ZF1(zsinh){R ztymes(zmj,zsin(ztymes(zj,v)));}  /* 4.5.7 */","","static ZF1(zcosh){R zcos(ztymes(zj,v));}              /* 4.5.8 */","","static ZF1(ztanh){R zdiv(zsinh(v),zcosh(v));}","","static ZF1(zp8){R zsqrt(ztymes(zplus(zj,v),zminus(zj,v)));}","","static ZF1(zasinh){if(0\u003ev.re)R znegate(zasinh(znegate(v))); R zlog(zplus(v,zp4(v)));}","","static ZF1(zacosh){Z z;"," z=zlog(zplus(v,zm4(v)));"," if(0\u003e=z.re){z.re=0; z.im=ABS(z.im);}"," R z;","}","","static ZF1(zatanh){Z z05;"," z05.re=0.5; z05.im=0;"," R ztymes(z05,zlog(zdiv(zplus(z1,v),zminus(z1,v))));","}","","static ZF1(zasin){R ztymes(zmj,zasinh(ztymes(zj,v)));}   /* 4.4.20 */","","static ZF1(zacos){Z zpi2; zpi2.re=PI/2; zpi2.im=0; R zminus(zpi2,zasin(v));}","","static ZF1(zatan){R ztymes(zmj,zatanh(ztymes(zj,v)));}   /* 4.4.22 */","","static ZF1(zarc){if(v.re||v.im)R ztymes(zmj,zlog(ztrend(v))); R zeroZ;}","","ZF2(zcir){D x=u.re;Z z;"," z=zeroZ; /* Sun386i does not allow init of aggregate object */"," ZASSERT(!u.im\u0026\u0026-12\u003c=x\u0026\u0026x\u003c=12\u0026\u0026x==floor(x),EVDOMAIN);"," switch((int)x){","  case  0: R zsqrt(ztymes(zplus(z1,v),zminus(z1,v)));","  case  1: R zsin(v);           case  -1: R zasin(v);","  case  2: R zcos(v);           case  -2: R zacos(v);","  case  3: R ztan(v);           case  -3: R zatan(v);","  case  4: R zp4(v);            case  -4: R zm4(v);","  case  5: R zsinh(v);          case  -5: R zasinh(v);","  case  6: R zcosh(v);          case  -6: R zacosh(v);","  case  7: R ztanh(v);          case  -7: R zatanh(v);","  case  8: R zp8(v);            case  -8: R znegate(zp8(v));","  case  9: z.re=v.re;     R z;  case  -9: R v;","  case 10: z.re=zmag(v);  R z;  case -10: R zconjug(v);","  case 11: z.re=v.im;     R z;  case -11: R ztymes(zj,v);","  case 12: R zarc(v);           case -12: R zexp(ztymes(zj,v));","  default: ZASSERT(0,EVDOMAIN);","}}","","ZF1(znonce1){ZASSERT(0,EVNONCE);}","","ZF2(znonce2){ZASSERT(0,EVNONCE);}",""],"w.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Spelling and Word Formation                                             */","","#include \"j.h\"","","#define SS              0    /* space                           */","#define SX              1    /* base                            */","#define SA              2    /* alphanumeric                    */","#define SN              3    /* N                               */","#define SNB             4    /* NB                              */","#define SNZ             5    /* NB.                             */","#define S9              6    /* numeric                         */","#define SQ              7    /* quote                           */","#define SQQ             8    /* even quotes                     */","#define SZ              9    /* trailing comment                */","","#define EI              1    /* emit (b,i-1); b=.i              */","#define EN              2    /* b=.i                            */","","typedef struct {C new,effect;} ST;","","static ST state[10][9]={","/*SS */ {{SX,EN},{SS,0 },{SA,EN},{SN,EN},{SA,EN},{S9,EN},{SX,EN},{SX,EN},{SQ,EN}},","/*SX */ {{SX,EI},{SS,EI},{SA,EI},{SN,EI},{SA,EI},{S9,EI},{SX,0 },{SX,0 },{SQ,EI}},","/*SA */ {{SX,EI},{SS,EI},{SA,0 },{SA,0 },{SA,0 },{SA,0 },{SX,0 },{SX,0 },{SQ,EI}},","/*SN */ {{SX,EI},{SS,EI},{SA,0 },{SA,0 },{SNB,0},{SA,0 },{SX,0 },{SX,0 },{SQ,EI}},","/*SNB*/ {{SX,EI},{SS,EI},{SA,0 },{SA,0 },{SA,0 },{SA,0 },{SNZ,0},{SX,0 },{SQ,EI}},","/*SNZ*/ {{SZ,0 },{SZ,0 },{SZ,0 },{SZ,0 },{SZ,0 },{SZ,0 },{SX,0 },{SX,0 },{SZ,0 }},","/*S9 */ {{SX,EI},{SS,EI},{S9,0 },{S9,0 },{S9,0 },{S9,0 },{S9,0 },{SX,0 },{SQ,EI}},","/*SQ */ {{SQ,0 },{SQ,0 },{SQ,0 },{SQ,0 },{SQ,0 },{SQ,0 },{SQ,0 },{SQ,0 },{SQQ,0}},","/*SQQ*/ {{SX,EI},{SS,EI},{SA,EI},{SN,EI},{SA,EI},{S9,EI},{SX,EI},{SX,EI},{SQ,0 }},","/*SZ */ {{SZ,0 },{SZ,0 },{SZ,0 },{SZ,0 },{SZ,0 },{SZ,0 },{SZ,0 },{SZ,0 },{SZ,0 }}","};","/*         CX      CS      CA      CN      CB      C9      CD      CC      CQ   */","","static F1(wordil){A z;C e,nv,s,t;I b,i,m,n,*x,xb,xe;ST p;UC*v;"," RZ(w);"," nv=0; s=SS;"," n=AN(w); v=(UC*)AV(w); GA(z,INT,1+n+n,1,0); x=1+AV(z);"," for(i=0;i\u003cn;++i){","  p=state[s][wtype[v[i]]]; e=p.effect;","  if(e==EI){","   t\u0026=s==S9;","   if(t){if(!nv){nv=1; xb=b;} xe=i;}","   else{if(nv){nv=0; *x++=xb; *x++=xe-xb;} *x++=b; *x++=i-b;}","  }","  s=p.new;","  if(e){b=i; t=s==S9;}"," }"," ASSERT(s!=SQ,EVOPENQ);"," t\u0026=s==S9;"," if(t){*x++=xb=nv?xb:b; *x++=n-xb;}"," else{if(nv){*x++=xb; *x++=xe-xb;} if(s!=SS){*x++=b; *x++=n-b;}}"," m=x-AV(z); *AV(z)=s==SZ||s==SNZ?-m/2:m/2;"," R z;","}","","F1(words){A t,*x,z;C*s;I k,n,*y;"," F1RANK(1,words,0);"," ASSERT(CHAR\u0026AT(w)||!AN(w),EVDOMAIN);"," RZ(t=wordil(w));"," s=(C*)AV(w); y=AV(t); n=*y++; n=0\u003en?-n:n;"," GA(z,BOX,n,1,0); x=(A*)AV(z);"," DO(n, k=*y++; *x++=str(*y++,s+k););"," R z;","}","","","static D num(q,s)I q;C*s;{C c,*t;D z;"," if('-'==*s\u0026\u00263\u003eq){if(1==q)R inf; c=*(1+s); if(c=='-')R-inf; if(c=='.')R nan;}"," z=strtod(s,\u0026t); ASSERT(q\u0026\u0026t==q+s,EVILNUM); R z;","}","","A connum(n,s)I n;C*s;{PROLOG;A y,z;B b,p=1;C c,*t;D*u;I i,j=0,k,m=0,q,*x;Z*v;"," RZ(y=str(n,s)); s=t=(C*)AV(y);"," GA(y,INT,1+n,1,0); x=AV(y);"," DO(n, c=*t; *t++=c=CSIGN==c?'-':c==CTAB?' ':c; b=' '==c; if(p!=b)x[j++]=i; p=b;);"," if(j%2)x[j++]=n; m=j/2; b=!memchr(s,'j',n);"," GA(z,b?FL:CMPX,m,1!=m,0); u=(D*)AV(z); v=(Z*)AV(z);"," if(b)DO(m, j=i+i; k=x[j]; RE(*u++=num(x[j+1]-k,k+s));)"," else for(i=0;i\u003cm;++i){","  j=i+i; k=x[j]; q=x[j+1]-k; t=memchr(k+s,'j',q);","  RE(v-\u003ere=num(t?t-(k+s):q,k+s));","  if(t)RE(v-\u003eim=num(q+k+s-(1+t),1+t)) else v-\u003eim=0;","  ++v;"," }"," z=xcvt(z); EPILOG(z);","}","","static A conname(n,s)I n;C*s;{A z;"," ASSERT(vnm(n,s),EVILNAME);"," GA(z,NAME,n,1,0); memcpy(AV(z),s,n);"," R z;","}","","static A constr(n,s)I n;C*s;{A z;C b,c,p,*t,*x;I m=0;"," p=0; t=s; DO(n-2, c=*++t; b=c==CQUOTE; if(!b||p)m++;    p=b\u0026\u0026!p;);"," GA(z,CHAR,m,1!=m,0); x=(C*)AV(z);"," p=0; t=s; DO(n-2, c=*++t; b=c==CQUOTE; if(!b||p)*x++=c; p=b\u0026\u0026!p;);"," R z;","}","","static F2(enstack){A t,*x,z;B b;C c,d,e,*s,*wi;I i,n,*u,wl;"," RZ(a\u0026\u0026w);"," s=(C*)AV(w); u=AV(a); n=*u++; n=0\u003en?-(1+n):n;"," GA(z,BOX,5+n,1,0); x=(A*)AV(z); *x++=mark;"," for(i=0;i\u003cn;i++){","  wi=s+*u++; wl=*u++; c=e=*wi; d=*(wi+wl-1);","  b=1==wl||!(C9!=ctype[c]\u0026\u0026CESC1==d||CA!=ctype[c]\u0026\u0026CESC2==d);","  ASSERT(b||(e=spellin(wl,wi)),EVSPELL);","  RZ(t=ds(e));","  if(AT(t)\u0026MARK) switch(ctype[c]){","   case CA: RZ(*x++=conname(wl,wi)); break;","   case CS:","   case C9: RZ(*x++=connum(wl,wi) ); break;","   case CQ: RZ(*x++=constr(wl,wi) ); break;","   default: ASSERT(0,EVDOMAIN);","  } else *x++=t;"," }"," *x++=mark;"," *x++=mark;"," *x++=mark;"," *x++=mark;"," R z;","}","","F1(tokens){R enstack(wordil(w),w);}","","","static C spell[3][47]={"," '=',     '\u003c',     '\u003e',     '_',     '+',     '*',     '-',     '%',"," '^',     '$',     '~',     '|',     '.',     ':',     ',',     ';',"," '#',     '@',     '/',     CBSLASH, '[',     ']',     '{',     '}',"," '`',     CQQ,     '\u0026',     '!',     '?',     'a',     'A',     'b',"," 'c',     'C',     'e',     'E',     'f',     'i',     'j',     'o',"," 'p',     'r',     'x',     'y',     '0',     '1',     0,",""," CASGN,   CFLOOR,  CCEIL,   1,       COR,     CAND,    CNOT,    CDOMINO,"," CLOG,    CGOTO,   CNUB,    CREV,    CDOTDOT, COBVERSE,CCOMDOT, CCUT,"," CBASE,   CATDOT,  CSLDOT,  CBSDOT,  CLEV,    CDEX,    CTAKE,   CDROP,"," CGRDOT,  CEXEC,   CUNDER,  CFIT,    1,       CALP,    CATOMIC, CBOOL,"," CEIGEN,  CCYCLE,  CEPS,    CEBAR,   CFIX,    CIOTA,   CJDOT,   CCIRCLE,"," CPOLY,   CRDOT,   CALPHA,  COMEGA,  1,       1,       0,",""," CGASGN,  CLE,     CGE,     CUSCO,   CNOR,    CNAND,   CMATCH,  CROOT,"," CPOWOP,  CSELF,   CNE,     CCANT,   CDOTCO,  1,       CLAMIN,  CWORDS,"," CABASE,  CATCO,   CGRADE,  CDGRADE, 1,       1,       CTAIL,   CCTAIL,"," CGRCO,   CTHORN,  CAMPCO,  CIBEAM,  1,       1,       1,       1,"," 1,       1,       1,       1,       1,       1,       1,       1,"," 1,       1,       1,       1,       CZERO,   CONE,    0,","};","","static C nu[12][5]={"," 'A','T',  CAT,     CATDOT,  CATCO,"," 'B','S',  CBSLASH, CBSDOT,  CDGRADE,"," 'C','A',  CEXP,    CLOG,    CPOWOP,"," 'G','R',  CGRAVE,  CGRDOT,  CGRCO,"," 'L','B',  CLEFT,   CLEV,    CLTCO,"," 'L','C',  CLBRACE, CTAKE,   CTAIL,"," 'N','O',  CPOUND,  CBASE,   CABASE,"," 'R','B',  CRIGHT,  CDEX,    CRTCO,"," 'R','C',  CRBRACE, CDROP,   CCTAIL,"," 'S','H',  CDOLLAR, CGOTO,   CSELF,"," 'S','T',  CSTILE,  CREV,    CCANT,"," 'T','I',  CTILDE,  CNUB,    CNE,","};","","C spellin(n,s)I n;C*s;{C d,p,q,*t;I j,k;"," switch(n){","  case 1:","   R *s;","  case 2:","   d=*(s+1); j=d==CESC1?1:d==CESC2?2:0;","   R j\u0026\u0026(t=(C*)strchr(spell[0],*s)) ? spell[j][k=t-spell[0],k] : 0;","   /* k is workaround for TurboC bug */","  case 3:","  case 4:","   if(CESC1!=*(s+n-1))R 0;","   p=*s; q=*(1+s); d=*(2+s); j=CESC1==d?2:d=='1'?3:d=='2'?4:0;","   if(j)DO(12, if(p==nu[i][0]\u0026\u0026q==nu[i][1])R nu[i][j];);","  default:","   R 0;","}}","","A spellout(c)C c;{A z;C*q,*s;I k;"," switch(c){","  case CHOOK:  R str(1L,\"2\");","  case CFORK:  R str(1L,\"3\");","  case CADVF:  R str(1L,\"4\");","  case CHOOKO: R str(1L,\"5\");","  case CFORKO: R str(1L,\"6\");","  case CPDT:   R str(1L,\".\");"," }"," if(0\u003c=c\u0026\u0026c\u003c=127)R str(1L,\u0026c);"," RZ(z=str(2L,\"??\")); s=(C*)AV(z);"," if     (q=(C*)strchr(spell[1],c)){k=q-spell[1]; s[0]=spell[0][k]; s[1]=CESC1;}"," else if(q=(C*)strchr(spell[2],c)){k=q-spell[2]; s[0]=spell[0][k]; s[1]=CESC2;}"," R z;","}",""],"x.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* External (Foreign) Stuff                                                */","","#include \"j.h\"","#include \"a.h\"","#include \"io.h\"","#include \"x.h\"","","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)","#include \"mac.h\"","#include \"PrintTraps.h\"","#endif","","#if (SYS \u0026 SYS_MACINTOSH)","#include \"PrintTraps.h\"","#endif","","","static DF1(stype){R sc(AT(w));}","","static DF1(ir){A z;I m;"," RZ(w);"," m=4*WP(AT(w),AN(w),AR(w)); GA(z,CHAR,m,1,0); memcpy(AV(z),w,m);"," R z;","}","","static DF1(ri){A y,z;I n,r,*s,t;"," PREF1(ri);"," ASSERT(CHAR\u0026AT(w),EVDOMAIN);"," y=(A)AV(w); n=AN(y); r=AR(y); s=AS(y); t=AT(y);"," ASSERT(t==BOOL||t==CHAR||t==INT||t==FL||t==CMPX,EVDOMAIN);"," ASSERT(0\u003c=r,EVRANK);"," DO(r,ASSERT(0\u003c=s[i],EVLENGTH);); ASSERT(n==prod(r,s),EVLENGTH);"," ASSERT((3+AN(w))/4==WP(t,n,r),EVLENGTH);"," GA(z,t,n,r,0); memcpy(AS(z),s,AN(w)-AH*sizeof(I));"," R z;","}","","static DF1(fxx){"," RZ(w);"," ASSERT(AT(w)\u0026CHAR+BOX,EVDOMAIN);"," ASSERT(1\u003e=AR(w),EVRANK);"," R AT(w)\u0026CHAR ? unsr(ca(w)) : fx(ope(w));","}","","static DF1(arx){PREF1(arx); ASSERT(BOX\u0026AT(w),EVDOMAIN); R arep(symbrd(onm(w)));}","","static DF1(drx){PREF1(drx); ASSERT(BOX\u0026AT(w),EVDOMAIN); R drep(symbrd(onm(w)));}","","static DF1(srx){PREF1(srx); ASSERT(BOX\u0026AT(w),EVDOMAIN); R srep(ope(w),symbrd(onm(w)));}","","static DF1(trx){PREF1(trx); ASSERT(BOX\u0026AT(w),EVDOMAIN); R trep(ope(w),symbrd(onm(w)));}","","static DF1(ts){A z;I*x;struct tm*t;time_t now;"," RZ(w);"," time(\u0026now); t=localtime(\u0026now);"," GA(z,INT,6,1,0); x=AV(z);"," x[0]=t-\u003etm_year+1900;"," x[1]=t-\u003etm_mon+1;"," x[2]=t-\u003etm_mday;"," x[3]=t-\u003etm_hour;"," x[4]=t-\u003etm_min;"," x[5]=t-\u003etm_sec;"," R z;","}","","static DF1(tss){R scf(CLOCK-tssbase);}","","static DF1(tsit){D t; PREF1(tsit); t=CLOCK; RZ(exec1(w)); R scf(CLOCK-t);}","","static DF1(dl){"," PREF1(dl);","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)"," {I m=TickCount()+60*i0(w); while(m\u003eTickCount()\u0026\u0026breaker());}","#else"," DO(i0(w), sleep(1); if(!breaker())R 0;);","#endif"," R w;","}","","static DF1(sp){R sc(bytes);}","","static DF1(sps){R sc(totbytes);}","","static DF1(spit){I k;"," PREF1(spit);"," k=maxbytes;"," RZ(exec1(w));"," R sc(maxbytes-k);","}","","","#if (!LINKJ \u0026\u0026 SYS_SESM \u0026\u0026 SYS \u0026 SYS_PC+SYS_PC386)","","static int      cgav;","extern I        jstratts();","extern void     jstref();","extern void     jstsatts();","extern void     jstslow();","","static DF1(cgaq){ASSERT(sesm,EVDOMAIN); R sc((I)cgav);}","","static DF1(cgas){"," ASSERT(sesm,EVDOMAIN);"," ASSERT(!AR(w),EVRANK);"," RZ(w=cvt(BOOL,w));"," jstslow(cgav=*(B*)AV(w));"," R mtv;","}","","static DF1(colorq){A z;I k,*s,*x;UC t[4];"," RZ(w);"," ASSERT(sesm,EVDOMAIN);"," GA(z,INT,8,2,0); s=AS(z); *s=4; *++s=2;"," x=AV(z);"," k=jstratts(); memcpy(t,\u0026k,4L); DO(4, *x++=t[i]/16; *x++=t[i]%16;);"," R z;","}","","static DF1(colors){I*x;UC c,t[4],*tv;"," ASSERT(sesm,EVDOMAIN);"," RZ(w=vi(w));"," ASSERT(2==AR(w),EVRANK);"," ASSERT(8==AN(w)\u0026\u00264==*AS(w),EVLENGTH);"," x=AV(w);"," DO(8, ASSERT(0\u003c=x[i]\u0026\u0026x[i]\u003c16,EVDOMAIN););"," tv=t; DO(4, c=16**x++; c+=*x++; *tv++=c;); jstsatts(*(unsigned long*)t);"," R mtv;","}","","static DF1(refresh){ASSERT(sesm,EVDOMAIN); jstref(); R mtv;}","","","#if (SYS \u0026 SYS_PC386)","","extern SI       jstedit(SI);","","static DF1(edit){PROLOG;A z;I k,n;"," RZ(w);"," ASSERT(sesm,EVDOMAIN);"," ASSERT(1\u003e=AR(w),EVRANK);"," n=AN(w);"," ASSERT(!n||CHAR\u0026AT(w),EVDOMAIN);"," ASSERT(n\u003c=NEDB,EVLIMIT);"," memcpy(edbuf,AV(w),n);"," k=jstedit((SI)n);"," z=0\u003ek?ca(w):str(k,edbuf);"," EPILOG(z);","}","","#else","","extern SI       jstedit(SI,SI,C*);","","static DF1(edit){PROLOG;A t,z;C*s;I k,m,n;"," RZ(w);"," ASSERT(sesm,EVDOMAIN);"," ASSERT(1\u003e=AR(w),EVRANK);"," n=AN(w);"," ASSERT(!n||CHAR\u0026AT(w),EVDOMAIN);"," m=MIN(32767,4000+n);"," GA(t,CHAR,m,1,0);"," k=(I)(15+(C*)AV(t)); k\u0026=0xfffffff0L; s=(C*)k; /* ensure segment aligned */"," memcpy(s,AV(w),n);"," k=jstedit((S)n,(S)m-15,s);"," z=0\u003ek?ca(w):str(k,s);"," EPILOG(z);","}","","#endif","#endif","","","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)","","static DF1(fontq){A z;I*x;"," GA(z,INT,3,1,0); x=AV(z);"," x[0]=texi.tsFont;"," x[1]=texi.tsFace;"," x[2]=texi.tsSize;"," R z;","}","","static DF1(fonts){I*v;TextStyle old=texi;"," RZ(w=vi(w));"," ASSERT(1==AR(w),EVRANK);"," ASSERT(3==AN(w),EVLENGTH);"," v=AV(w);"," texi.tsFont=v[0];"," texi.tsFace=v[1];"," texi.tsSize=v[2];"," reFont(\u0026old,\u0026texi);"," R mtv;","}","","static DF1(prtscr){"," PrClose(); PrDrvrClose();"," PrDrvrOpen();"," PrCtlCall(iPrDevCtl,lPrReset,0L,0L);"," PrCtlCall(iPrBitsCtl,\u0026screenBits,\u0026screenBits.bounds,lPaintBits);"," PrDrvrClose();"," PrOpen();"," R mtv;","}","#endif","","","static DF1(rlq){R sc(qrl);}","","static DF1(rls){I k; RE(k=i0(w)); ASSERT(0\u003ck\u0026\u0026k\u003c2147483646L,EVDOMAIN); qrl=k; R mtv;}","","static DF1(promptq){R cstr(qprompt);}","","static DF1(prompts){C*v;I n;"," RZ(vs(w));"," n=AN(w); v=(C*)AV(w);"," ASSERT(!memchr(v,'\\0',n),EVDOMAIN);"," ASSERT(NPROMPT\u003e=n,EVLIMIT);"," memcpy(qprompt,v,1+n);"," R mtv;","}","","static DF1(boxq){R str(11L,qbx);}","","static DF1(boxs){RZ(vs(w)); ASSERT(11==AN(w),EVLENGTH); memcpy(qbx,AV(w),11L); R mtv;}","","static DF1(evmq){R behead(qevm);}","","static DF1(evms){A t,*y;"," ASSERT(1==AR(w),EVRANK);"," ASSERT(NEVM==AN(w),EVLENGTH);"," ASSERT(BOX\u0026AT(w),EVDOMAIN);"," y=(A*)AV(w); DO(NEVM, RZ(vs(*y++)););"," RZ(t=link(mtv,w)); ra(t); fa(qevm); qevm=t;"," R mtv;","}","","","#if !LINKJ","C jc(k,f1,f2)I k;AF*f1,*f2;{R 0;}","#endif","","","F2(foreign){I p,q;"," p=i0(a); q=i0(w);"," switch(XC(p,q)){","  case XC(0,0):   R CDERIV(CIBEAM, host,    0L,       1L,   0L,   0L   );","  case XC(0,1):   R CDERIV(CIBEAM, hostne,  0L,       1L,   0L,   0L   );","  case XC(0,2):   R CDERIV(CIBEAM, script1, script2,  0L,   0L,   0L   );","  case XC(0,3):   R CDERIV(CIBEAM, sscript1,sscript2, 0L,   0L,   0L   );","  case XC(0,55):  R CDERIV(CIBEAM, joff,    0L,       RMAXL,0L,   0L   );","  case XC(1,0):   R CDERIV(CIBEAM, jfdir,   0L,       RMAXL,0L,   0L   );","  case XC(1,1):   R CDERIV(CIBEAM, jfread,  0L,       0L,   0L,   0L   );","  case XC(1,2):   R CDERIV(CIBEAM, 0L,      jfwrite,  0L,   RMAXL,0L   );","  case XC(1,3):   R CDERIV(CIBEAM, 0L,      jfappend, 0L,   RMAXL,0L   );","  case XC(1,4):   R CDERIV(CIBEAM, jfsize,  0L,       0L,   0L,   0L   );","  case XC(1,11):  R CDERIV(CIBEAM, jiread,  0L,       1L,   0L,   0L   );","  case XC(1,12):  R CDERIV(CIBEAM, 0L,      jiwrite,  0L,   RMAXL,1L   );","  case XC(1,55):  R CDERIV(CIBEAM, jferase, 0L,       0L,   0L,   0L   );","  case XC(2,0):   R CDERIV(CIBEAM, 0L,      wnc,      0L,   0L,   0L   );","  case XC(2,1):   R CDERIV(CIBEAM, wnl,     0L,       0L,   0L,   0L   );","  case XC(2,2):   R CDERIV(CIBEAM, save1,   save2,    0L,   0L,   0L   );","  case XC(2,3):   R CDERIV(CIBEAM, psave1,  psave2,   0L,   0L,   0L   );","  case XC(2,4):   R CDERIV(CIBEAM, copy1,   copy2,    0L,   0L,   0L   );","  case XC(2,5):   R CDERIV(CIBEAM, pcopy1,  pcopy2,   0L,   0L,   0L   );","  case XC(2,55):  R CDERIV(CIBEAM, 0L,      wex,      0L,   0L,   0L   );","  case XC(3,0):   R CDERIV(CIBEAM, stype,   0L,       RMAXL,0L,   0L   );","  case XC(3,1):   R CDERIV(CIBEAM, ir,      0L,       RMAXL,0L,   0L   );","  case XC(3,2):   R CDERIV(CIBEAM, ri,      0L,       1L,   0L,   0L   );","  case XC(4,0):   R CDERIV(CIBEAM, ncx,     0L,       0L,   0L,   0L   );","  case XC(4,1):   R CDERIV(CIBEAM, nl1,     nl2,      RMAXL,RMAXL,RMAXL);","  case XC(4,55):  R CDERIV(CIBEAM, ex,      0L,       0L,   0L,   0L   );","  case XC(5,0):   R fdef(CIBEAM,ADV, fxx,0L, a,w,0L, 0L,0L,0L);","  case XC(5,1):   R CDERIV(CIBEAM, arx,     0L,       0L,   0L,   0L   );","  case XC(5,2):   R CDERIV(CIBEAM, drx,     0L,       0L,   0L,   0L   );","  case XC(5,3):   R CDERIV(CIBEAM, srx,     0L,       0L,   0L,   0L   );","  case XC(5,4):   R CDERIV(CIBEAM, trx,     0L,       0L,   0L,   0L   );","  case XC(6,0):   R CDERIV(CIBEAM, ts,      0L,       RMAXL,0L,   0L   );","  case XC(6,1):   R CDERIV(CIBEAM, tss,     0L,       RMAXL,0L,   0L   );","  case XC(6,2):   R CDERIV(CIBEAM, tsit,    0L,       1L,   0L,   0L   );","  case XC(6,3):   R CDERIV(CIBEAM, dl,      0L,       0L,   0L,   0L   );","  case XC(7,0):   R CDERIV(CIBEAM, sp,      0L,       RMAXL,0L,   0L   );","  case XC(7,1):   R CDERIV(CIBEAM, sps,     0L,       RMAXL,0L,   0L   );","  case XC(7,2):   R CDERIV(CIBEAM, spit,    0L,       1L,   0L,   0L   );","#if (!LINKJ \u0026\u0026 SYS_SESM \u0026\u0026 SYS \u0026 SYS_PC+SYS_PC386)","  case XC(8,0):   R CDERIV(CIBEAM, cgaq,    0L,       RMAXL,0L,   0L   );","  case XC(8,1):   R CDERIV(CIBEAM, cgas,    0L,       RMAXL,0L,   0L   );","  case XC(8,4):   R CDERIV(CIBEAM, colorq,  0L,       RMAXL,0L,   0L   );","  case XC(8,5):   R CDERIV(CIBEAM, colors,  0L,       RMAXL,0L,   0L   );","  case XC(8,7):   R CDERIV(CIBEAM, refresh, 0L,       RMAXL,0L,   0L   );","  case XC(8,9):   R CDERIV(CIBEAM, edit,    0L,       RMAXL,0L,   0L   );","#endif","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)","  case XC(8,16):  R CDERIV(CIBEAM, fontq,   0L,       RMAXL,0L,   0L   );","  case XC(8,17):  R CDERIV(CIBEAM, fonts,   0L,       RMAXL,0L,   0L   );","  case XC(8,19):  R CDERIV(CIBEAM, prtscr,  0L,       RMAXL,0L,   0L   );","#endif","  case XC(9,0):   R CDERIV(CIBEAM, rlq,     0L,       RMAXL,0L,   0L   );","  case XC(9,1):   R CDERIV(CIBEAM, rls,     0L,       RMAXL,0L,   0L   );","  case XC(9,4):   R CDERIV(CIBEAM, promptq, 0L,       RMAXL,0L,   0L   );","  case XC(9,5):   R CDERIV(CIBEAM, prompts, 0L,       RMAXL,0L,   0L   );","  case XC(9,6):   R CDERIV(CIBEAM, boxq,    0L,       RMAXL,0L,   0L   );","  case XC(9,7):   R CDERIV(CIBEAM, boxs,    0L,       RMAXL,0L,   0L   );","  case XC(9,8):   R CDERIV(CIBEAM, evmq,    0L,       RMAXL,0L,   0L   );","  case XC(9,9):   R CDERIV(CIBEAM, evms,    0L,       RMAXL,0L,   0L   );","  case XC(128,0): R CDERIV(CIBEAM, qr,      0L,       2L,   0L,   0L   );","  case XC(128,1): R CDERIV(CIBEAM, rinv,    0L,       2L,   0L,   0L   );"," }"," if(10==p){AF*f1,*f2;","  ASSERT(jc(q,\u0026f1,\u0026f2),EVDOMAIN);","  R CDERIV(CIBEAM, f1,f2, RMAXL,RMAXL,RMAXL);"," }"," ASSERT(0,EVDOMAIN);","}",""],"x.h":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Macros and Defined Constants for !:                                     */","","","#define XC(m,n)         (64*m+n)","","#if (SYS \u0026 SYS_VAX)","#define FAPPEND         \"a\"","#define FREAD           \"r\"","#define FUPDATE         \"r+\"","#define FWRITE          \"w\"","#define SAPPEND         \"a\"     /* script output        */","#define SREAD           \"r\"     /* script input         */","#endif","","#if (SYS \u0026 SYS_ARCHIMEDES)","#define FAPPEND         \"ab\"","#define FREAD           \"rb\"","#define FUPDATE         \"r+b\"","#define FWRITE          \"wb\"","#define SAPPEND         \"a\"","#define SREAD           \"r\"","#endif","","#ifndef FAPPEND","#define FAPPEND         \"ab\"","#define FREAD           \"rb\"","#define FUPDATE         \"r+b\"","#define FWRITE          \"wb\"","#define SAPPEND         \"at\"","#define SREAD           \"rt\"","#endif","","#define WREAD           1","#define WUPDATE         2","#define WWRITE          3","","","#ifndef SEEK_SET","#define SEEK_SET        0","#endif","#ifndef SEEK_CUR","#define SEEK_CUR        1","#endif","#ifndef SEEK_END","#define SEEK_END        2","#endif","","#ifndef L_tmpnam","#define L_tmpnam        59","#endif","","extern A        copy1();","extern A        copy2();","extern I        fsize();","extern A        host();","extern A        hostne();","extern C        jc();","extern A        jfappend();","extern A        jfdir();","extern A        jferase();","extern FILE    *jfopen();","extern A        jfread();","extern A        jfsize();","extern A        jfwrite();","extern A        jiread();","extern A        jiwrite();","extern A        pcopy1();","extern A        pcopy2();","extern A        psave1();","extern A        psave2();","extern A        rd();","extern A        save1();","extern A        save2();","extern A        script1();","extern A        script2();","extern A        sscript1();","extern A        sscript2();","extern A        wa();","extern A        wex();","extern A        wnc();","extern A        wnl();","","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)","extern void     setftype(A,OSType,OSType);","#endif",""],"xf.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Xenos: File stuff                                                       */","","#include \"j.h\"","#include \"a.h\"","#include \"x.h\"","","","#if (SYS \u0026 SYS_ARCHIMEDES)","#define Wimp_StartTask 0x400DE","static int unlink(s)C*s;{R remove(s);}","extern int os_swi1(I,I);","#endif","","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)","void setftype(A w,OSType type,OSType crea){C p[256];FInfo f;"," __c2p((C*)AV(w),p);"," GetFInfo(p,0,\u0026f);"," f.fdType=type; f.fdCreator=crea;"," SetFInfo(p,0,\u0026f);","}","#endif","","#if (SYS \u0026 SYS_MACINTOSH)","","DF1(host  ){ASSERT(0,EVDOMAIN);}","DF1(hostne){ASSERT(0,EVDOMAIN);}","","#else","","DF1(host){A t,z;C*fname,*s;FILE*f;I n;"," PREF1(host);"," ASSERT(CHAR\u0026AT(w),EVDOMAIN);"," n=AN(w);"," GA(t,CHAR,n+7+L_tmpnam,1,0); s=(C*)AV(t); fname=5+n+s;"," memcpy(s,AV(w),n);","#if (SYS \u0026 SYS_ARCHIMEDES)"," memcpy(n+s,\" { \u003e \",5L); strcpy(fname,\"\u003cJ$Dir\u003e.Temp\"); strcat(s,\" }\");"," unlink(fname);"," ASSERT(sesm?!os_swi1(Wimp_StartTask,(I)s):!system(s),EVFACE);","#endif","#if (SYS \u0026 SYS_ATARIST)"," memcpy(n+s,\"   \u003e \",5L); memcpy(fname,\"jxxhost\",8L); ASSERT(!system(s),EVFACE);","#endif","#if !(SYS \u0026 SYS_ARCHIMEDES+SYS_ATARIST)"," memcpy(n+s,\"   \u003e \",5L); tmpnam(fname);              ASSERT(!system(s),EVFACE);","#endif"," f=fopen(fname,FREAD); z=rd(f,-1L,fsize(f)); fclose(f);"," unlink(fname);"," R z;","}","","DF1(hostne){C*s;"," PREF1(hostne);"," ASSERT(CHAR\u0026AT(w),EVDOMAIN);"," s=(C*)AV(w);","#if (SYS \u0026 SYS_ARCHIMEDES)"," ASSERT(sesm?!os_swi1(Wimp_StartTask,(I)s):!system(s),EVFACE);","#else"," ASSERT(!system(s),EVFACE);","#endif"," R mtv;","}","","#endif","","","I fsize(f)FILE*f;{I z; RZ(f); fseek(f,0L,SEEK_END); z=ftell(f); rewind(f); R z;}","","DF2(jfappend){FILE*f;"," PREF2(jfappend);"," if(NUMERIC\u0026AT(w)){ASSERT(2==i0(w),EVDOMAIN); R jpr(a);}"," RZ(f=jfopen(w,FAPPEND)); ","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)"," setftype(*(A*)AV(w),'TEXT','    ');","#endif"," wa(f,-1L,vs(a)); "," fclose(f); "," R mtv;","}","","DF1(jfdir){ASSERT(0,EVNONCE);}","","DF1(jferase){A t;FILE*f;"," PREF1(jferase);"," RZ(f=jfopen(w,FREAD)); fclose(f);"," t=*(A*)AV(w);"," R unlink((C*)AV(t))?zero:one;","}","","FILE*jfopen(w,mode)A w;C*mode;{A t;FILE*f;"," RZ(w);"," ASSERT(BOX\u0026AT(w),EVDOMAIN);"," RZ(t=vs(*(A*)AV(w)));"," ASSERT(AN(t),EVLENGTH);"," f=fopen((C*)AV(t),mode); ASSERT(f,EVFACE);"," R f;","}","","DF1(jfread){A z;FILE*f;"," PREF1(jfread);"," if(BOX\u0026AT(w)){RZ(f=jfopen(w,FREAD)); z=rd(f,-1L,fsize(f)); fclose(f); R z;}"," else{ASSERT(1==i0(w),EVDOMAIN); prompt(\"\"); R jgets();}","}","","DF1(jfsize){FILE*f;I m;"," PREF1(jfsize);"," RZ(f=jfopen(w,FREAD)); m=fsize(f); fclose(f);"," R sc(m);","}","","DF2(jfwrite){A t;FILE*f;"," PREF2(jfwrite);"," if(NUMERIC\u0026AT(w)){ASSERT(2==i0(w),EVDOMAIN); R jpr(a);}"," RZ(t=vs(a)); "," RZ(f=jfopen(w,FWRITE)); ","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)"," setftype(*(A*)AV(w),'TEXT','    ');","#endif"," wa(f,-1L,t); "," fclose(f); "," R mtv;","}","","static C vfin(w,f,i,n,rd)A w;FILE**f;I*i,*n;B rd;{A in;I j,k,m,s,*u;"," *f=0;"," ASSERT(BOX\u0026AT(w),EVDOMAIN);"," ASSERT(2==AN(w),EVLENGTH);"," in=vi(*(1+(A*)AV(w))); k=AN(in);"," ASSERT(1\u003e=AR(in),EVRANK);"," ASSERT(1==k||2==k,EVLENGTH);"," u=AV(in); j=u[0]; m=1==k?-1:u[1];"," ASSERT(1==k||0\u003c=m,EVLENGTH);"," RZ(*f=jfopen(w,rd?FREAD:FUPDATE));"," s=fsize(*f);"," ASSERT(-s\u003c=j\u0026\u0026j\u003cs,EVINDEX);"," *i=j=0\u003ej?s+j:j;"," if(!rd)ASSERT(j+*n\u003c=s,EVINDEX);"," *n=m=0\u003em?s-j:m;"," ASSERT(j+m\u003c=s,EVINDEX);"," R 1;","}","","DF1(jiread){A z;FILE*f;I i,n;"," PREF1(jiread);"," if(vfin(w,\u0026f,\u0026i,\u0026n,1))z=rd(f,i,n);"," if(f)fclose(f);"," R z;","}","","DF2(jiwrite){FILE*f;I i,n;"," PREF2(jiwrite);"," RZ(a=vs(a)); n=AN(a);"," if(vfin(w,\u0026f,\u0026i,\u0026n,0)){","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)","  setftype(*(A*)AV(w),'TEXT','    ');","#endif","  wa(f,i,a);"," }"," if(f)fclose(f);"," R mtv;","}","","A rd(f,j,n)FILE*f;I j,n;{A z;C*x;I p=0;size_t q=1;"," RZ(f);"," GA(z,CHAR,n,1,0); x=(C*)AV(z);"," if(0\u003c=j)fseek(f,j,SEEK_SET);"," while(q\u0026\u0026n\u003ep)p+=q=fread(p+x,sizeof(C),(size_t)(n-p),f);"," ASSERT(!ferror(f),EVFACE);"," R z;","}","","A wa(f,j,w)FILE*f;I j;A w;{C*x;I n,p=0;size_t q=1;"," RZ(w\u0026\u0026f);"," n=AN(w); x=(C*)AV(w);"," if(0\u003c=j)fseek(f,j,SEEK_SET);"," while(q\u0026\u0026n\u003ep)p+=q=fwrite(p+x,sizeof(C),(size_t)(n-p),f);"," ASSERT(!ferror(f),EVFACE);"," R mtv;","} /* Write or append string w to file f */",""],"xs.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Script Handling                                                         */","","#include \"j.h\"","#include \"a.h\"","#include \"io.h\"","#include \"x.h\"","","static FILE*oldout;","","static FILE*ropen(w,md)A w;S md;{A x;B b;FILE*z;"," RZ(w);"," b=md==WREAD;"," ASSERT(BOX\u0026AT(w),EVDOMAIN);"," ASSERT(!AR(w),EVRANK);"," x=*(A*)AV(w);"," if(!AN(x)){if(b\u0026\u0026oldout\u0026\u0026oldout!=stdout)fclose(oldout); R b?stdin:stdout;}"," ASSERT(CHAR\u0026AT(x),EVDOMAIN);"," z=fopen((C*)AV(x),b?SREAD:SAPPEND);"," ASSERT(z,EVFACE);","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)"," if(!b)setftype(x,'TEXT','ISIj');","#endif"," R z;","}","","static A scpt(no,ni)FILE*ni,*no;{FILE*xi,*xo;"," RZ(ni);"," xi=infile;  infile =ni;"," xo=outfile; outfile=no;"," immloop(); jputc(CNL);"," if(infile \u0026\u0026infile !=stdin )fclose(infile ); infile =xi;"," if(outfile\u0026\u0026outfile!=stdout)fclose(outfile); outfile=xo;"," R mtv;","}","","static F1(scpt1){F1RANK(0,scpt1,0); oldout=outfile; R scpt(0L,ropen(w,WREAD));}","","static F2(scpt2){FILE*t;"," F2RANK(0,0,scpt2,0);"," oldout=outfile; RZ(t=ropen(a,WUPDATE)); R scpt(t,ropen(w,WREAD));","}","","DF1(script1 ){A z;B b=tostdout; tostdout=1; z=scpt1(  w); tostdout=b; R z;}","","DF2(script2 ){A z;B b=tostdout; tostdout=1; z=scpt2(a,w); tostdout=b; R z;}","","DF1(sscript1){A z;B b=tostdout; tostdout=0; z=scpt1(  w); tostdout=b; R z;}","","DF2(sscript2){A z;B b=tostdout; tostdout=0; z=scpt2(a,w); tostdout=b; R z;}","","","static JF               jstfrec={0,0L,0,0};","JF                     *jstf=\u0026jstfrec;","","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)","","static C appf1(act,w)C act;A w;{A t;C*s;fileParam f;"," RZ(w);"," t=*(A*)AV(w); s=(C*)AV(t);"," if(act==JFSAVE){","  save1(w);","  JSPR(\"\\rws %s saved 1991-xx-xx xx:xx:xx\\r\",s);"," }else if(act==JFOPEN){","  f.ioNamePtr=(StringPtr)s;","  f.ioVRefNum=jstf-\u003evol;","  f.ioFDirIndex=0;","  if('WKSP'==jstf-\u003etype){JSPR(\"\\rws %s saved 1991-xx-xx xx:xx:xx\\r\",s); copy1(w);}","  else{JSPR(\"\\rscript %s saved 1991-xx-xx xx:xx:xx\\r\",s); script1(w,0L);}","}}","","B appf(){C a;"," if(a=jstf-\u003eact){ioParam pb,pb0;","  jstf-\u003eact=0; pb.ioNamePtr=NULL; pb0.ioNamePtr=NULL;","  PBGetVol(\u0026pb0,false);","  if(a==JFPROF){AppFile f;C*t;S i,msg,n;","   CountAppFiles(\u0026msg,\u0026n);","   n=msg==appOpen?n:0;","   for(i=1;i\u003c=n;++i){","    GetAppFiles(i,\u0026f); jstf-\u003etype=f.fType; t=(C*)\u0026f.fName;","    pb.ioNamePtr=NULL; pb.ioVRefNum=f.vRefNum; PBSetVol(\u0026pb,false);","    appf1(JFOPEN,box(str((I)*t,1+t)));","  }}else{","   pb.ioNamePtr=NULL;  pb.ioVRefNum=jstf-\u003evol; PBSetVol(\u0026pb,false);","   appf1(a,box(cstr(jstf-\u003ename)));","  }","  PBSetVol(\u0026pb0,false);"," }"," R a;","}","","#else","","static C appf1(act,w)C act;A w;{"," RZ(w);"," if(act==JFSAVE)save1(w);"," else if(act==JFOPEN)'W'==jstf-\u003etype ? copy1(w) : script1(w,0L);","}","","B appf(){C a;"," if(a=jstf-\u003eact){","  jstf-\u003eact=0;","  if(a==JFPROF){static C*prof=\"profile.js\";","   if(fopen(prof,\"rt\")){","    jstf-\u003etype='T';","    appf1(JFOPEN,box(cstr(prof)));","  }} else appf1(a,box(cstr(jstf-\u003ename)));"," }"," R a;","}","","#endif",""],"xw.c":["/* ----------------------------------------------------------------------- */","/* J-Source Version 4.1 - COPYRIGHT 1992 Iverson Software Inc.             */","/* 33 Major Street, Toronto, Ontario, Canada, M5S 2K9, (416) 925 6096      */","/*                                                                         */","/* J-Source is provided \"as is\" without warranty of any kind.              */","/*                                                                         */","/* J-Source Version 4.1 license agreement:  You may use, copy, and         */","/* modify the source.  You have a non-exclusive, royalty-free right        */","/* to redistribute source and executable files.                            */","/* ----------------------------------------------------------------------- */","/*                                                                         */","/* Xenos: Workspace stuff                                                  */","/*                                                                         */","/*                                                                         */","/* Internal Organization of Workspaces:                                    */","/*                                                                         */","/* Objects are represented in WSIS format.                                 */","/* The first NWPFX bytes are two fixed variables, \"wpfx\":                  */","/*   wsis    scalar 0 (required by WSIS)                                   */","/*   -       scalar 1 (indicates version 1)                                */","/* The next NWPTR bytes are an anonymous 4-element integer vector, \"wptr\": */","/*   0 index  of name list \"wp\"                                            */","/*   1 length of name list                                                 */","/*   2 index  of pointers \"wq\"                                             */","/*   3 length of pointers                                                  */","/* wp is a string of the names in the ws, separated by spaces.             */","/* wq is a corresponding 3-column integer matrix:                          */","/*   0 index                                                               */","/*   1 length                                                              */","/*   2 internal type                                                       */","/* wp and wq typically come at the end of the WS.                          */","","#include \"j.h\"","#include \"a.h\"","#include \"x.h\"","","#if (SYS \u0026 SYS_PC)","#define NXIL            8000","#else","#define NXIL            32000","#endif","","#define NW              (NWPFX+NWPTR)","#define NWPFX           20L","#define NWPTR           50L","","#define WF1(g)          A g(f)FILE*f;","#define WF2(g)          A g(f,w)FILE*f;A w;","","","static A wp;","static A wq;","static I wptr[4];","static C wpfx[1+NWPFX] = \"9pwsis 0 09n- 0 1   \";","","static F1(gnl){A loc=local,z; local=0; z=nl1(apv(4L,2L,1L)); local=loc; R z;}","","static F1(xil){I c,i,j=0,k,m,n,*v;"," RZ(w=grade2(w,w));"," n=*AS(w); k=c=*(1+AS(w));"," if(1\u003e=n)R w;"," v=AV(w); m=v[1+j];"," for(i=1;i\u003cn;++i){","  if(v[k]!=m+v[j]||NXIL\u003cm+v[1+k]){v[1+j]=m; v[j+=c]=v[k]; m=v[1+k];}","  else m+=v[1+k];","  k+=c;"," }"," v[1+j]=m;"," R take(sc(1+j/c),w);","}","","static WF2(wcp){I j,old=tbase+ttop,*qv;"," RZ(w=xil(w));"," qv=AV(w);"," DO(*AS(w), j=*qv++; RZ(unsr(rd(f,j,*qv++))); qv++; tpop(old););"," R one;","}","","static F1(ung){A b,p,s,*u,*v;I m=0;"," RZ(s=str(0L,\"\")); RZ(p=ca(wp)); u=(A*)AV(p); v=(A*)AV(wp);"," DO(AN(wp), if(CESC2==lc(*v++))++m; else *u++=s;);"," if(m){","  RZ(b=not(eps(wp,repeat(eps(p,gnl(mtv)),p))));","  RZ(wp=repeat(b,wp));","  RZ(wq=repeat(b,wq));"," }"," R mark;","}","","static WF1(copy1f){RZ(ung(mark)); R wcp(f,wq);}","","static WF2(copy2f){A y;"," RZ(ung(mark));"," RZ(wcp(f,repeat(eps(ii(wq),y=indexof(wp,w)),wq)));"," R lt(y,tally(wp));","}","","static WF1(pcopy1f){R wcp(f,repeat(not(eps(wp,gnl(mtv))),wq));}","","static WF2(pcopy2f){A b;"," RZ(b=not(eps(wp,gnl(mtv))));"," RZ(wp=repeat(b,wp));"," RZ(wq=repeat(b,wq));"," R copy2f(f,w);","}","","","static F1(catsp){R over(w,scc(' '));}","","static I wend(w)A w;{RZ(w); if(AN(w)){I*v=AV(w)+AN(w)-3; R*v+*(1+v);}else R NW;}","","static WF1(wrdir){A t,y;"," RZ(y=AN(wp)?raze(every(wp,catsp)):mtv);"," wptr[0]=ftell(f); RZ(wa(f,-1L,t=srep(dash,y ))); wptr[1]=AN(t);"," wptr[2]=ftell(f); RZ(wa(f,-1L,t=srep(dash,wq))); wptr[3]=AN(t);"," RZ(wa(f,-1L,str(9L,\"8pend 0 0\")));"," GA(t,INT,4,1,0); memcpy(AV(t),wptr,16L);"," RZ(wa(f,NWPFX,take(sc(NWPTR),srep(dash,t))));"," R mtv;","}","","static WF1(psave1f){ASSERT(0,EVNONCE);}","","static WF2(psave2f){ASSERT(0,EVNONCE);}","","static WF1(save1f){A p,t,y;C*pv;I d,i,k,m=AN(global),n,old,*qv;SY*e,*ee=(SY*)AV(global);"," RZ(wa(f,-1L,str(NW,wpfx)));"," e=ee; d=n=0; DO(m, if(e-\u003eval){++n; d+=AN(e-\u003ename);} ++e;);"," GA(p,CHAR,d+n,1,0); pv=(C*)AV(p);"," GA(wq,INT,3*n,2,0); *AS(wq)=n; *(1+AS(wq))=3; qv=AV(wq);"," e=ee; k=NW; old=tbase+ttop;"," for(i=0;i\u003cm;++i,++e)","  if(e-\u003eval){","   y=e-\u003ename; d=AN(y); memcpy(pv,AV(y),d); pv+=d; *pv++=' ';","   RZ(wa(f,-1L,t=srep(y,e-\u003eval)));","   *qv++=k; *qv++=AN(t); *qv++=AT(e-\u003eval); k+=AN(t);","   tpop(old);","  }"," RZ(wp=words(p)); RZ(wrdir(f));"," R one;","}","","static WF2(save2f){A b,t,*v,y,z;I i,k,n,old,*qv;"," RZ(z=eps(w,gnl(mtv)));"," RZ(w=nub(repeat(z,w)));"," RZ(b=not(eps(wp,w)));"," RZ(wq=repeat(b,wq)); fseek(f,k=wend(wq),SEEK_SET);"," RZ(wp=over(repeat(b,wp),w));"," n=AN(wq); RZ(wq=take(tally(wp),n?wq:over(wq,two))); qv=n+AV(wq);"," n=AN(w); v=(A*)AV(w); old=tbase+ttop;"," for(i=0;i\u003cn;++i){","  RZ(wa(f,-1L,t=srep(v[i],y=srd(v[i],global))));","  *qv++=k; *qv++=AN(t); *qv++=AT(y); k+=AN(t);","  tpop(old);"," }"," RZ(wrdir(f));"," R z;","}","","static WF2(wexf){A b,t,*u,z;I*bv,m,n,*x;"," RZ(z=indexof(wp,w));"," m=AN(w); n=AN(wp); u=(A*)AV(w); x=AV(z);"," RZ(b=apv(n,1L,0L)); bv=AV(b);"," DO(m, if(n==x[i]){t=u[i]; RZ(vs(t)); x[i]=vnm(AN(t),AV(t));}else{bv[x[i]]=0; x[i]=1;});"," RZ(wp=repeat(b,wp));"," RZ(wq=repeat(b,wq));"," fseek(f,wend(wq),SEEK_SET);"," RZ(wrdir(f));"," R z;","}","","static WF2(wncf){A t,*u,z;B b;I i,j,m,n,*v,*x;"," RZ(z=indexof(wp,w));"," m=AN(w); n=AN(wp); u=(A*)AV(w); v=AV(wq); x=AV(z);"," for(i=0;i\u003cm;++i)","  if(n==*x){t=u[i]; b=AN(t)\u0026\u0026AT(t)\u0026CHAR+NAME\u0026\u00261\u003e=AR(t)\u0026\u0026vnm(AN(t),AV(t)); *x++=-!b;}","  else{j=v[2+3**x]; *x++=j\u0026NOUN?2:j\u0026VERB?3:j\u0026ADV?4:5;}"," R z;","}","","static WF1(wnlf){R grade2(wp,ope(wp));}","","","static FILE*wopen(w,md)A w;S md;{A t;FILE*f;"," RZ(f=jfopen(w,md==WREAD?FREAD:md==WUPDATE?FUPDATE:FWRITE));","#if (!LINKJ \u0026\u0026 SYS \u0026 SYS_MACINTOSH)"," if(md!=WREAD)setftype(*(A*)AV(w),'WKSP','ISIj');","#endif"," wp=wq=0;"," if(md!=WWRITE){","  RZ(t=rd(f,-1L,NWPFX));","  ASSERT(!memcmp(AV(t),wpfx,NWPFX),EVDOMAIN);","  RZ(t=unsr(rd(f,-1L,NWPTR))); memcpy(wptr,AV(t),16L);","  RZ(wp=words(unsr(rd(f,wptr[0],wptr[1]))));","  RZ(wq=unsr(rd(f,-1L,wptr[3])));","  ASSERT(2==AR(wq),EVRANK);","  ASSERT(AN(wp)==*AS(wq)\u0026\u00263==*(1+AS(wq)),EVLENGTH);","  if(!AN(wq))GA(wq,INT,0,2,AS(wq));","  ASSERT(INT\u0026AT(wq),EVDOMAIN);"," }"," R f;","}","","static A wopr1(w,ff,fa,md)A w;AF ff,fa;int md;{PROLOG;A z;FILE*f;"," RZ(w);"," if(1\u003cAN(w))R rank1ex(w,0L,0L,fa);"," RZ(f=wopen(w,md)); z=ff(f); fclose(f); EPILOG(z);","}","","static A wopr2(a,w,ff,fa,md)A a,w;AF ff,fa;int md;{PROLOG;A z;FILE*f;"," RZ(a\u0026\u0026w);"," if(1\u003cAN(w))R rank2ex(a,w,0L,0L,0L,fa);"," ASSERT(BOX\u0026AT(a),EVDOMAIN);"," RZ(f=wopen(w,md)); z=ff(f,every(a,rankle)); fclose(f); EPILOG(z);","}","","DF1(copy1 ){R wopr1(  w,copy1f, copy1, WREAD  );}","","DF2(copy2 ){R wopr2(a,w,copy2f, copy2, WREAD  );}","","DF1(pcopy1){R wopr1(  w,pcopy1f,pcopy1,WREAD  );}","","DF2(pcopy2){R wopr2(a,w,pcopy2f,pcopy2,WREAD  );}","","DF2(wex   ){R wopr2(a,w,wexf,   wex,   WUPDATE);}","","DF2(wnc   ){R wopr2(a,w,wncf,   wnc,   WREAD  );}","","DF1(wnl   ){R wopr1(  w,wnlf,   wnl,   WREAD  );}","","DF1(save1 ){R wopr1(  w,save1f, save1, WWRITE );}","","DF2(save2 ){R wopr2(a,w,save2f, save2, WUPDATE);}","","DF1(psave1){R wopr1(  w,psave1f,psave1,WWRITE );}","","DF2(psave2){R wopr2(a,w,psave2f,psave2,WUPDATE);}",""]}
