NB. Copyright (c) 1989 1990, Roger K.W. Hui & K.E. Iverson
NB. Copyright (c) 1990-1992, Iverson Software Inc.
NB. All Rights Reserved.


NB. C.y -----------------------------------------------------------------

dr    =. 5!:2
type  =. 3!:0
boxed =. 32&=@type
ord   =. >:@(>./)
pind  =. ]`]`+@.(*@])"0
pfill =. [ ((i.@[-.]) , ]) pind

ac    =. (, i. ]) { 1&|.@[ , ]
dfc   =. >@(ac&.>/)@(pind&.> , <@i.@[)
bc    =. <@((] i. >./) |. ])@~.
cfd   =. ~.@(/: {.&>)@:(bc"1)@|:@({/\)@(,~@[ $ pfill)
cdot1 =. (ord cfd ])`(ord@; dfc ])@.boxed " 1

isperm  =. '(/:~y.)-:i.#y.':'' " 1
iscyc   =. '(isperm ;y.)*.(({.&>y.)-:>./&>y.)*.(i.#y.)-:/:{.&>y.':'' " 1

(C.4 5 2 1 0 3) -: (,2);4 0;5 3 1
(C.2;4 0;5 3 1) -: 4 5 2 1 0 3
f =. C.
g =. f f.^:_1
(dr <'f') -: dr <'g'

p =. 12?15$12
^/@:(iscyc@C.) p
p -: C.&C. p
c =. C.p
c -: C.C.c
^/@:(C. -: cdot1) p

(C.k   ) -: (,&.>i._1{k),<k      [ k =. 1 0+?100
(C.k,_2) -: (,&.>i. <:k),<k-0 1  [ k =. 2+?100


NB. x C.y ---------------------------------------------------------------

type  =. 3!:0
boxed =. 32&=@type
pind  =. ]`]`+@.(*@])"0
pfill =. [ ((i.@[-.]) , ]) pind

ac    =. (, i. ]) { 1&|.@[ , ]
dfc   =. >@(ac&.>/)@(pind&.> , <@i.@[)
cdot2 =. ((#@] pfill`dfc@.(boxed@]) [) { ]) " 1 _

cyc =. (1&<@#@> # ])@C.

p (C. -: cdot2) x [ p=.?~#x=.1=?200 2$2
p (C. -: cdot2) x [ p=.?~#x=.(?200$#a.){a.
p (C. -: cdot2) x [ p=.?~#x=.?200 2$2
p (C. -: cdot2) x [ p=.?~#x=.o.?200 2$2
p (C. -: cdot2) x [ p=.?~#x=.r.?200$2002
p (C. -: cdot2) x [ p=.?~#x=.(?200$#t){t=.;:'#a.){a.now is the 1 2 3'

(cyc p) (C. -: cdot2) x [ p=.?~#x=.1=?200 2$2
(cyc p) (C. -: cdot2) x [ p=.?~#x=.(?200$#a.){a.
(cyc p) (C. -: cdot2) x [ p=.?~#x=.?200 2$2
(cyc p) (C. -: cdot2) x [ p=.?~#x=.o.?200 2$2
(cyc p) (C. -: cdot2) x [ p=.?~#x=.r.?200$2002
(cyc p) (C. -: cdot2) x [ p=.?~#x=.(?200$#t){t=.;:'#a.){a.now is the 1 2 3'

1 2 3 0 4 -: (2 1;3 0 1)C.i.5

(p C. x) -: (p=.?~200){x=.1=?200 2$2
(p C. x) -: (p=.?~200){x=.(?200$#a.){a.
(p C. x) -: (p=.?~200){x=.?200 2$2000
(p C. x) -: (p=.?~200){x=.o.?200 2$2000
(p C. x) -: (p=.?~200){x=.^0j1*?200$200
(p C. x) -: (p=.?~200){x=.(?200$#x){x=.;:'#a.){a.now is the 1 2 3'

((cyc p) C. x) -: (p=.?~400){x=.1=?400 2$2
((cyc p) C. x) -: (p=.?~1200){x=.(?1200$#a.){a.
((cyc p) C. x) -: (p=.?~200){x=.?200 2$2000
((cyc p) C. x) -: (p=.?~200){x=.o.?200 2$2000
((cyc p) C. x) -: (p=.?~200){x=.^0j1*?200$200
((cyc p) C. x) -: (p=.?~200){x=.(?200$#x){x=.;:'#a.){a.now is the 1 2 3'
